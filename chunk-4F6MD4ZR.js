import{$ as Bi,$a as or,$c as ho,A as ji,Aa as Ut,Ab as ft,Ac as br,Ad as Ur,B as ne,Ba as C,Bb as Gt,Bc as Cr,Bd as Wr,C as ze,Ca as x,Cb as K,Cc as an,Cd as Ct,D as re,Da as mt,Dc as yr,Dd as pn,Ea as st,Ec as Sr,Ed as at,F as c,Fa as no,Fc as bi,Fd as qr,G as Go,Ga as ut,Gc as wr,Gd as kt,H as T,Ha as We,Hc as xr,Hd as yt,I as k,Ia as qe,Ib as ee,Id as It,J as $e,Ja as Jo,Jb as Z,Jd as Le,K as Bt,Ka as $i,Kc as Pr,Kd as U,L as Y,La as Wt,Lb as $,Lc as Mr,M as se,Ma as Ee,Mb as vi,Mc as ln,Md as _e,N as Se,Na as Ge,Nb as Kt,Nc as Er,Nd as ue,O,Oa as G,Ob as Zt,Oc as Dr,Od as Ye,P as we,Pa as er,Pb as dr,Pc as Or,Pd as St,Q as Ko,Qa as m,Qc as cn,Qd as mn,R as Zo,Ra as f,Rb as De,Rc as Tr,Rd as Gr,S as Ht,Sa as D,Sb as Oe,Sc as dn,Sd as un,Ta as oo,Tb as hr,Tc as kr,Td as po,U as me,Ua as tr,Ub as pr,Uc as hn,Ud as Je,Va as ir,Vb as Qi,Vc as Ir,Vd as Fe,W as l,Wa as nr,Wb as mr,Wc as Rr,Wd as Yt,X as Et,Xa as Ui,Xb as Tt,Xc as Ar,Xd as Jt,Y as ui,Ya as Wi,Yb as _t,Yc as Q,Yd as ei,Z as gi,Za as _i,Zb as Xi,Zc as Lr,Zd as ti,_ as fi,_a as de,_b as Te,_c as Fr,_d as Kr,a as M,aa as S,ab as _,ac as Yi,ad as A,b as ae,ba as Ue,bb as v,bc as Ji,c as Ft,ca as xe,cb as qi,d as Be,db as V,e as Vt,ea as Qo,eb as Gi,f as P,fa as pt,fd as Vr,g as He,ga as Xo,gb as qt,gc as ur,gd as Qe,h as Bo,ha as Hi,hb as J,hc as Ze,hd as Nr,i as Ho,ia as Ae,ib as Ki,ic as Qt,id as Xe,j as pi,ja as j,jb as rr,jc as gr,jd as fe,k as Vi,ka as B,kb as gt,kc as ro,kd as ke,l as zo,la as W,lb as Ke,lc as en,ld as te,ma as q,mb as le,mc as tn,md as L,n as $o,na as zt,nb as sr,nc as so,o as ht,oa as $t,oc as fr,od as vt,p as io,pa as Pe,pb as ar,pd as pe,qa as Me,qb as Zi,qc as nn,qd as R,r as Ni,ra as y,rc as ao,rd as jr,sa as h,sc as on,t as Uo,ta as p,tc as Xt,u as Wo,ua as w,ub as lr,uc as lo,v as qo,va as Dt,vc as rn,vd as Br,w as mi,wa as Ot,wb as cr,wc as _r,wd as bt,x as Nt,xa as zi,xc as co,xd as Hr,y as Mt,ya as Yo,yc as vr,yd as zr,z as jt,za as F,zc as sn,zd as $r}from"./chunk-ETCNA7VU.js";var Rt=(()=>{class o{constructor(){this._imageChange=O({mosaicConfig:null,shouldFocus:!1}),this.imageChange=this._imageChange.asReadonly()}emitImageChange(e,t){this._imageChange.set({mosaicConfig:e,shouldFocus:t})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac})}}return o})();var Zr=(()=>{class o{constructor(){this.store=c(A),this.destroyRef=c(Y),this.configService=c(Rt),this.toolService=c(_e),this.mosaicConfig=this.store.selectSignal(Qe),this.imageObject=O(null),this.imageChanged$=Fr(this.configService.imageChange),this.ribbonActions=[{iconName:"crop",visibility:O("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"configuration_snapshot.png")},{iconName:"recenter",visibility:V(()=>this.imageObject()?"on":"disabled"),onClick:()=>{this.focusOnImage(this.imageObject()),this.activeCanvas.redraw()}}]}sectionEntered(e,t){return this.activeCanvas=e,this.imageChanged$.pipe(Q(this.destroyRef),qo(1)).subscribe(n=>{let r=n.shouldFocus||t;this.drawImage(n.mosaicConfig,r)}),{ribbon:this.ribbonActions}}async drawImage(e,t){let n=this.imageObject();n?.removeObject(),n=null,e&&(n=await _e.createImageObject(e),this.activeCanvas.addCanvasObject(n,!1),t&&this.focusOnImage(n)),this.imageObject.set(n),this.activeCanvas.redraw()}focusOnImage(e){let t=_e.calculateZoomForImage(e.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(t,R.zero)}onRouterChange(){this.configService.emitImageChange(this.mosaicConfig(),!1)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-configuration"]],features:[de([Rt])],decls:1,vars:0,consts:[[3,"activate"]],template:function(t,n){t&1&&(h(0,"router-outlet",0),C("activate",function(){return n.onRouterChange()}),p())},dependencies:[L,$,Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var wt=(()=>{class o{constructor(){this.translate=c(ee),this.data=c(Br),this.noLabel=this.data.noCustomLabel??this.translate.instant("common.no"),this.yesLabel=this.data.yesCustomLabel??this.translate.instant("common.yes")}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-dialog"]],decls:10,vars:5,consts:[[1,"dialog-content"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"]],template:function(t,n){t&1&&(h(0,"div",0)(1,"h1",1),m(2),p(),h(3,"div",2),m(4),p(),h(5,"div",3)(6,"button",4),m(7),p(),h(8,"button",5),m(9),p()()()),t&2&&(l(2),f(n.data.title),l(2),f(n.data.message),l(3),f(n.noLabel),l(),y("mat-dialog-close",!0),l(),f(n.yesLabel))},dependencies:[Wr,Hr,zr,Ur,$r,L,te],styles:[".dialog-content[_ngcontent-%COMP%]{max-width:400px}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding-bottom:0}"],changeDetection:0})}}return o})();function Sa(o,i){if(o&1){let e=F();h(0,"button",0),C("click",function(){T(e);let n=x();return k(n.navigateToProjectConfiguration())}),m(1),_(2,"translate"),p(),h(3,"button",1),m(4),_(5,"translate"),p(),h(6,"button",1),m(7),_(8,"translate"),p(),h(9,"button",2),C("click",function(){T(e);let n=x();return k(n.rejectProject())}),m(10),_(11,"translate"),p()}o&2&&(l(),f(v(2,4,"tool.config.menu.projectSettings")),l(3),f(v(5,6,"tool.config.menu.saveProject")),l(3),f(v(8,8,"tool.config.menu.loadProject")),l(3),f(v(11,10,"tool.config.menu.rejectProject")))}function wa(o,i){if(o&1){let e=F();h(0,"button",3),C("click",function(){T(e);let n=x();return k(n.navigateToProjectConfiguration())}),m(1),_(2,"translate"),p(),h(3,"button",1),m(4),_(5,"translate"),p(),h(6,"button",1),m(7),_(8,"translate"),p()}o&2&&(l(),f(v(2,3,"tool.config.menu.newProject")),l(3),f(v(5,5,"tool.config.menu.exampleProjects")),l(3),f(v(8,7,"tool.config.menu.loadProject")))}var Qr=(()=>{class o{constructor(){this.store=c(A),this.translate=c(ee),this.mosaicConfig=this.store.selectSignal(Qe),this.dialog=c(bt),this.router=c(K),this.configService=c(Rt),this.destroyRef=c(Y)}navigateToProjectConfiguration(){this.router.navigate(["/tool/config/project"])}rejectProject(){let e={title:this.translate.instant("tool.config.menu.rejectProject"),message:this.translate.instant("tool.config.menu.rejectProjectWarning")};this.dialog.open(wt,{data:e}).afterClosed().pipe(Q(this.destroyRef)).subscribe(t=>{t&&(this.store.dispatch(ue.projectCanceled()),this.configService.emitImageChange(null,!1))})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-config-menu"]],decls:2,vars:1,consts:[["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","accent",3,"click"]],template:function(t,n){t&1&&W(0,Sa,12,12)(1,wa,9,9),t&2&&q(n.mosaicConfig()?0:1)},dependencies:[L,te,$,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:10px}"],changeDetection:0})}}return o})();var xa=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-text-field-style-loader",""],decls:0,vars:0,template:function(t,n){},styles:[`textarea.cdk-textarea-autosize{resize:none}textarea.cdk-textarea-autosize-measuring{padding:2px 0 !important;box-sizing:content-box !important;height:auto !important;overflow:hidden !important}textarea.cdk-textarea-autosize-measuring-firefox{padding:2px 0 !important;box-sizing:content-box !important;height:0 !important}@keyframes cdk-text-field-autofill-start{/*!*/}@keyframes cdk-text-field-autofill-end{/*!*/}.cdk-text-field-autofill-monitored:-webkit-autofill{animation:cdk-text-field-autofill-start 0s 1ms}.cdk-text-field-autofill-monitored:not(:-webkit-autofill){animation:cdk-text-field-autofill-end 0s 1ms}
`],encapsulation:2,changeDetection:0})}return o})(),Pa={passive:!0},Xr=(()=>{class o{_platform=c(_t);_ngZone=c(Se);_renderer=c(gi).createRenderer(null,null);_styleLoader=c(Zt);_monitoredElements=new Map;constructor(){}monitor(e){if(!this._platform.isBrowser)return Ho;this._styleLoader.load(xa);let t=Te(e),n=this._monitoredElements.get(t);if(n)return n.subject;let r=new P,s="cdk-text-field-autofilled",a=g=>{g.animationName==="cdk-text-field-autofill-start"&&!t.classList.contains(s)?(t.classList.add(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!0}))):g.animationName==="cdk-text-field-autofill-end"&&t.classList.contains(s)&&(t.classList.remove(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!1})))},d=this._ngZone.runOutsideAngular(()=>(t.classList.add("cdk-text-field-autofill-monitored"),this._renderer.listen(t,"animationstart",a,Pa)));return this._monitoredElements.set(t,{subject:r,unlisten:d}),r}stopMonitoring(e){let t=Te(e),n=this._monitoredElements.get(t);n&&(n.unlisten(),n.subject.complete(),t.classList.remove("cdk-text-field-autofill-monitored"),t.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(t))}ngOnDestroy(){this._monitoredElements.forEach((e,t)=>this.stopMonitoring(t))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Yr=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ue({type:o});static \u0275inj=ze({})}return o})();var Jr=new re("MAT_INPUT_VALUE_ACCESSOR");var es=(()=>{class o{isErrorState(e,t){return!!(e&&e.invalid&&(e.touched||t&&t.submitted))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var gn=class{_defaultMatcher;ngControl;_parentFormGroup;_parentForm;_stateChanges;errorState=!1;matcher;constructor(i,e,t,n,r){this._defaultMatcher=i,this.ngControl=e,this._parentFormGroup=t,this._parentForm=n,this._stateChanges=r}updateErrorState(){let i=this.errorState,e=this._parentFormGroup||this._parentForm,t=this.matcher||this._defaultMatcher,n=this.ngControl?this.ngControl.control:null,r=t?.isErrorState(n,e)??!1;r!==i&&(this.errorState=r,this._stateChanges.next())}};var Ma=["button","checkbox","file","hidden","image","radio","range","reset","submit"],Ea=new re("MAT_INPUT_CONFIG"),et=(()=>{class o{_elementRef=c(me);_platform=c(_t);ngControl=c(Or,{optional:!0,self:!0});_autofillMonitor=c(Xr);_ngZone=c(Se);_formField=c(un,{optional:!0});_renderer=c(fi);_uid=c(Ze).getId("mat-input-");_previousNativeValue;_inputValueAccessor;_signalBasedValueAccessor;_previousPlaceholder;_errorStateTracker;_config=c(Ea,{optional:!0});_cleanupIosKeyup;_cleanupWebkitWheel;_isServer;_isNativeSelect;_isTextarea;_isInFormField;focused=!1;stateChanges=new P;controlType="mat-input";autofilled=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=tn(e),this.focused&&(this.focused=!1,this.stateChanges.next())}_disabled=!1;get id(){return this._id}set id(e){this._id=e||this._uid}_id;placeholder;name;get required(){return this._required??this.ngControl?.control?.hasValidator(Dr.required)??!1}set required(e){this._required=tn(e)}_required;get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&so().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}_type="text";get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(e){this._errorStateTracker.matcher=e}userAriaDescribedBy;get value(){return this._signalBasedValueAccessor?this._signalBasedValueAccessor.value():this._inputValueAccessor.value}set value(e){e!==this.value&&(this._signalBasedValueAccessor?this._signalBasedValueAccessor.value.set(e):this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=tn(e)}_readonly=!1;disabledInteractive;get errorState(){return this._errorStateTracker.errorState}set errorState(e){this._errorStateTracker.errorState=e}_neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(e=>so().has(e));constructor(){let e=c(Tr,{optional:!0}),t=c(kr,{optional:!0}),n=c(es),r=c(Jr,{optional:!0,self:!0}),s=this._elementRef.nativeElement,a=s.nodeName.toLowerCase();r?Hi(r.value)?this._signalBasedValueAccessor=r:this._inputValueAccessor=r:this._inputValueAccessor=s,this._previousNativeValue=this.value,this.id=this.id,this._platform.IOS&&this._ngZone.runOutsideAngular(()=>{this._cleanupIosKeyup=this._renderer.listen(s,"keyup",this._iOSKeyupListener)}),this._errorStateTracker=new gn(n,this.ngControl,t,e,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=a==="select",this._isTextarea=a==="textarea",this._isInFormField=!!this._formField,this.disabledInteractive=this._config?.disabledInteractive||!1,this._isNativeSelect&&(this.controlType=s.multiple?"mat-native-select-multiple":"mat-native-select"),this._signalBasedValueAccessor&&we(()=>{this._signalBasedValueAccessor.value(),this.stateChanges.next()})}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._cleanupIosKeyup?.(),this._cleanupWebkitWheel?.()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(e){if(e!==this.focused){if(!this._isNativeSelect&&e&&this.disabled&&this.disabledInteractive){let t=this._elementRef.nativeElement;t.type==="number"?(t.type="text",t.setSelectionRange(0,0),t.type="number"):t.setSelectionRange(0,0)}this.focused=e,this.stateChanges.next()}}_onInput(){}_dirtyCheckNativeValue(){let e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_dirtyCheckPlaceholder(){let e=this._getPlaceholder();if(e!==this._previousPlaceholder){let t=this._elementRef.nativeElement;this._previousPlaceholder=e,e?t.setAttribute("placeholder",e):t.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){Ma.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let e=this._elementRef.nativeElement,t=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&t&&t.label)}else return this.focused&&!this.disabled||!this.empty}get describedByIds(){return this._elementRef.nativeElement.getAttribute("aria-describedby")?.split(" ")||[]}setDescribedByIds(e){let t=this._elementRef.nativeElement;e.length?t.setAttribute("aria-describedby",e.join(" ")):t.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}_iOSKeyupListener=e=>{let t=e.target;!t.value&&t.selectionStart===0&&t.selectionEnd===0&&(t.setSelectionRange(1,1),t.setSelectionRange(0,0))};_getReadonlyAttribute(){return this._isNativeSelect?null:this.readonly||this.disabled&&this.disabledInteractive?"true":null}static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:21,hostBindings:function(t,n){t&1&&C("focus",function(){return n._focusChanged(!0)})("blur",function(){return n._focusChanged(!1)})("input",function(){return n._onInput()}),t&2&&(Ut("id",n.id)("disabled",n.disabled&&!n.disabledInteractive)("required",n.required),Ae("name",n.name||null)("readonly",n._getReadonlyAttribute())("aria-disabled",n.disabled&&n.disabledInteractive?"true":null)("aria-invalid",n.empty&&n.required?null:n.errorState)("aria-required",n.required)("id",n.id),G("mat-input-server",n._isServer)("mat-mdc-form-field-textarea-control",n._isInFormField&&n._isTextarea)("mat-mdc-form-field-input-control",n._isInFormField)("mat-mdc-input-disabled-interactive",n.disabledInteractive)("mdc-text-field__input",n._isInFormField)("mat-mdc-native-select-inline",n._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly",disabledInteractive:[2,"disabledInteractive","disabledInteractive",le]},exportAs:["matInput"],features:[de([{provide:Gr,useExisting:o}]),Ht]})}return o})(),tt=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ue({type:o});static \u0275inj=ze({imports:[Fe,Fe,Yr,Kt]})}return o})();function Da(o,i){if(o&1){let e=F();h(0,"div",1)(1,"button",2),C("click",function(){T(e);let n=x();return k(n.action())}),m(2),p()()}if(o&2){let e=x();l(2),D(" ",e.data.action," ")}}var Oa=["label"];function Ta(o,i){}var ka=Math.pow(2,31)-1,yi=class{_overlayRef;instance;containerInstance;_afterDismissed=new P;_afterOpened=new P;_onAction=new P;_durationTimeoutId;_dismissedByAction=!1;constructor(i,e){this._overlayRef=e,this.containerInstance=i,i._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(i){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(i,ka))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},ts=new re("MatSnackBarData"),ii=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},Ia=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return o})(),Ra=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return o})(),Aa=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return o})(),La=(()=>{class o{snackBarRef=c(yi);data=c(ts);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(t,n){t&1&&(h(0,"div",0),m(1),p(),W(2,Da,3,1,"div",1)),t&2&&(l(),D(" ",n.data.message,`
`),l(),q(n.hasAction?2:-1))},dependencies:[te,Ia,Ra,Aa],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return o})(),mo="_mat-snack-bar-enter",uo="_mat-snack-bar-exit",Fa=(()=>{class o extends _r{_ngZone=c(Se);_elementRef=c(me);_changeDetectorRef=c(Ke);_platform=c(_t);_animationsDisabled=Xt();snackBarConfig=c(ii);_document=c(Bt);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=c($e);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new P;_onExit=new P;_onEnter=new P;_animationState="void";_live;_label;_role;_liveElementId=c(Ze).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let t=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),t}attachTemplatePortal(e){this._assertNotAttached();let t=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),t}attachDomPortal=e=>{this._assertNotAttached();let t=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),t};onAnimationEnd(e){e===uo?this._completeExit():e===mo&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?Et(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(mo)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(mo)},200)))}exit(){return this._destroyed?pi(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?Et(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(uo)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(uo),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,t=this.snackBarConfig.panelClass;t&&(Array.isArray(t)?t.forEach(s=>e.classList.add(s)):e.classList.add(t)),this._exposeToModals();let n=this._label.nativeElement,r="mdc-snackbar__label";n.classList.toggle(r,!n.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,t=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let n=0;n<t.length;n++){let r=t[n],s=r.getAttribute("aria-owns");this._trackedModals.add(r),s?s.indexOf(e)===-1&&r.setAttribute("aria-owns",s+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let t=e.getAttribute("aria-owns");if(t){let n=t.replace(this._liveElementId,"").trim();n.length>0?e.setAttribute("aria-owns",n):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,t=e.querySelector("[aria-hidden]"),n=e.querySelector("[aria-live]");if(t&&n){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&t.contains(document.activeElement)&&(r=document.activeElement),t.removeAttribute("aria-hidden"),n.appendChild(t),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["mat-snack-bar-container"]],viewQuery:function(t,n){if(t&1&&(ut(co,7),ut(Oa,7)),t&2){let r;We(r=qe())&&(n._portalOutlet=r.first),We(r=qe())&&(n._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(t,n){t&1&&C("animationend",function(s){return n.onAnimationEnd(s.animationName)})("animationcancel",function(s){return n.onAnimationEnd(s.animationName)}),t&2&&G("mat-snack-bar-container-enter",n._animationState==="visible")("mat-snack-bar-container-exit",n._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!n._animationsDisabled)},features:[Qo],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(t,n){t&1&&(h(0,"div",1)(1,"div",2,0)(3,"div",3),pt(4,Ta,0,0,"ng-template",4),p(),w(5,"div"),p()()),t&2&&(l(5),Ae("aria-live",n._live)("role",n._role)("id",n._liveElementId))},dependencies:[co],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return o})(),Va=new re("mat-snack-bar-default-options",{providedIn:"root",factory:()=>new ii}),it=(()=>{class o{_live=c(ur);_injector=c($e);_breakpointObserver=c(Ji);_parentSnackBar=c(o,{optional:!0,skipSelf:!0});_defaultConfig=c(Va);_animationsDisabled=Xt();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=La;snackBarContainerComponent=Fa;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,t){return this._attach(e,t)}openFromTemplate(e,t){return this._attach(e,t)}open(e,t="",n){let r=M(M({},this._defaultConfig),n);return r.data={message:e,action:t},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,t){let n=t&&t.viewContainerRef&&t.viewContainerRef.injector,r=$e.create({parent:n||this._injector,providers:[{provide:ii,useValue:t}]}),s=new lo(this.snackBarContainerComponent,t.viewContainerRef,r),a=e.attach(s);return a.instance.snackBarConfig=t,a.instance}_attach(e,t){let n=M(M(M({},new ii),this._defaultConfig),t),r=this._createOverlay(n),s=this._attachSnackBarContainer(r,n),a=new yi(s,r);if(e instanceof ui){let d=new rn(e,null,{$implicit:n.data,snackBarRef:a});a.instance=s.attachTemplatePortal(d)}else{let d=this._createInjector(n,a),g=new lo(e,void 0,d),b=s.attachComponentPortal(g);a.instance=b.instance}return this._breakpointObserver.observe(on.HandsetPortrait).pipe(Mt(r.detachments())).subscribe(d=>{r.overlayElement.classList.toggle(this.handsetCssClass,d.matches)}),n.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(n.announcementMessage,n.politeness)}),this._animateSnackBar(a,n),this._openedSnackBarRef=a,this._openedSnackBarRef}_animateSnackBar(e,t){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),t.announcementMessage&&this._live.clear()}),t.duration&&t.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(t.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let t=new sn;t.direction=e.direction;let n=Cr(this._injector),r=e.direction==="rtl",s=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,a=!s&&e.horizontalPosition!=="center";return s?n.left("0"):a?n.right("0"):n.centerHorizontally(),e.verticalPosition==="top"?n.top("0"):n.bottom("0"),t.positionStrategy=n,t.disableAnimations=this._animationsDisabled,an(this._injector,t)}_createInjector(e,t){let n=e&&e.viewContainerRef&&e.viewContainerRef.injector;return $e.create({parent:n||this._injector,providers:[{provide:yi,useValue:t},{provide:ts,useValue:e.data}]})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ne=class{static getFieldErrorLabel(i,e){return this.getErrorLabel(i.errors(),e)}static getErrorLabel(i,e){for(let{kind:t}of i)if(t in e)return e[t]();return null}};var is=1,ns=1e3,os=(()=>{class o{constructor(){this.snackBar=c(it),this.router=c(K),this.configService=c(Rt),this.store=c(A),this.translate=c(ee),this.mosaicConfig=this.store.selectSignal(Qe),this.isReadOnlyMode=V(()=>!!this.mosaicConfig()),this.errorLabels={min:()=>this.translate.instant("tool.config.project.mosaicMinWidthErrorMessage",{width:is}),max:()=>this.translate.instant("tool.config.project.mosaicMaxWidthErrorMessage",{width:ns}),required:()=>this.translate.instant("tool.config.project.mosaicWidthRequiredErrorMessage")},this.formData=O({mosaicWidth:this.mosaicConfig()?.mosaicWidth??100,mosaicImage:null}),this.form=Ct(this.formData,e=>{U(e.mosaicWidth),Le(e.mosaicWidth,is),It(e.mosaicWidth,ns),qr(e.mosaicWidth,()=>this.isReadOnlyMode()),U(e.mosaicImage)}),this.formValueChangedEffect=we(()=>{if(this.form().valid()){let e=new FileReader;e.readAsDataURL(this.form.mosaicImage().value()),e.onload=t=>{this.configService.emitImageChange({base64Image:t?.target?.result,mosaicWidth:this.form.mosaicWidth().value()},!0)}}else this.configService.emitImageChange(null,!1)})}navigateToConfiguration(){this.router.navigate(["/tool/config"])}trySave(){if(this.form().valid())this.save();else{let e=this.getErrorMessage();this.snackBar.open(e,this.translate.instant("common.ok"),{duration:2e3})}}save(){let e=this.formData(),t=new FileReader;t.readAsDataURL(e.mosaicImage),t.onload=n=>{let s={config:{base64Image:n?.target?.result,mosaicWidth:e.mosaicWidth},tilesSets:[],sectors:[]};this.createNewProject(s),this.snackBar.open(this.translate.instant("tool.config.project.projectCreated"),this.translate.instant("common.ok"),{duration:2e3}),this.navigateToConfiguration()}}createNewProject(e){this.store.dispatch(ue.projectCreated({project:e}))}getErrorMessage(){if(this.form.mosaicImage().valid()){if(!this.form.mosaicWidth().valid())return this.getFieldErrorLabel(this.form.mosaicWidth())}else return this.translate.instant("tool.config.project.selectImageErrorMessage");return null}getFieldErrorLabel(e){return Ne.getFieldErrorLabel(e,this.errorLabels)}onImageSelected(e){let n=e.target.files?.item(0);this.formData.update(r=>ae(M({},r),{mosaicImage:n}))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-config-project"]],decls:23,vars:21,consts:[["imageUploader",""],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click","hidden"],[1,"form"],["hidden","","type","file","accept",".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*",3,"change"],["mat-flat-button","","type","button",3,"click","color","hidden"],[1,"density-3"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(t,n){if(t&1){let r=F();h(0,"div",1)(1,"button",2),C("click",function(){return T(r),k(n.navigateToConfiguration())}),m(2),_(3,"translate"),p(),h(4,"button",3),C("click",function(){return T(r),k(n.trySave())}),m(5),_(6,"translate"),p()(),h(7,"form",4)(8,"input",5,0),C("change",function(a){return T(r),k(n.onImageSelected(a))}),p(),h(10,"button",6),C("click",function(){T(r);let a=Ee(9);return k(a.click())}),m(11),_(12,"translate"),p(),h(13,"mat-form-field",7)(14,"mat-label"),m(15),_(16,"translate"),p(),w(17,"input",8),j(),h(18,"span",9),m(19),_(20,"translate"),p(),h(21,"mat-error"),m(22),p()()()}t&2&&(l(2),D(" ",v(3,11,"common.return")," "),l(2),y("hidden",n.isReadOnlyMode()),l(),D(" ",v(6,13,"common.confirm")," "),l(5),y("color",n.form.mosaicImage().valid()?"":"accent")("hidden",n.isReadOnlyMode()),l(),D(" ",v(12,15,n.form.mosaicImage().valid()?"tool.config.project.changeImage":"tool.config.project.chooseImage")," "),l(4),f(v(16,17,"tool.config.project.mosaicWidth")),l(2),B(n.form.mosaicWidth),l(2),f(v(20,19,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.mosaicWidth())))},dependencies:[$,L,te,Fe,Je,Ye,St,mn,tt,et,yt,Z],styles:[".actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;margin-top:20px}"],changeDetection:0})}}return o})();var ni=class extends vt{constructor(i,e){super(),this.vertices=i,this.hexColor=e}drawObject(i,e){i.beginPath();let t=e.getViewportPosition(this.vertices[0]);i.moveTo(t.x,t.y);for(let n=1;n<this.vertices.length;++n)t=e.getViewportPosition(this.vertices[n]),i.lineTo(t.x,t.y);i.closePath(),i.fillStyle=this.hexColor,i.fill()}getOrder(){return 100}};var Na=Math.PI/180;function ja(o,i,e){e*=Na;let t=Math.cos(e)*(o.x-i.x)-Math.sin(e)*(o.y-i.y)+i.x,n=Math.sin(e)*(o.x-i.x)+Math.cos(e)*(o.y-i.y)+i.y;return new R(t,n)}function _n(o,i,e=0,t=1){return o.map(n=>ja(n,R.zero,e).multiply(t).add(i))}var rs=(()=>{class o{static drawTiles(e,t){let n=this.sortAndMapTilesBySize(e),r=this.getTreeMapChartArray(n),s={width:r.size.width,height:r.size.height,x:-r.size.width/2,y:-r.size.height/2};this.drawChart(r,s,t)}static drawChart(e,t,n){if(e.type==="group"){let r=e.left.size.width+e.right.size.width,s=e.left.size.height+e.right.size.height;this.drawChart(e.left,{x:t.x,y:t.y,width:t.width*(e.split==="horizontal"?e.left.size.width/r:1),height:t.height*(e.split==="horizontal"?1:e.left.size.height/s)},n),this.drawChart(e.right,{x:t.x+(e.split==="horizontal"?t.width*(e.left.size.width/r):0),y:t.y+(e.split==="horizontal"?0:t.height*(e.left.size.height/s)),width:t.width*(e.split==="horizontal"?e.right.size.width/r:1),height:t.height*(e.split==="horizontal"?1:e.right.size.height/s)},n)}else{let r=_n(e.value.vertices,new R(t.x+t.width/2,t.y+t.height/2),0),s=new ni(r,e.value.color);n.addCanvasObject(s)}}static getTreeMapChartArray(e){if(e.length>1){let t=this.splitTileArrayInHalf(e),n=this.getTreeMapChartArray(t[0]),r=this.getTreeMapChartArray(t[1]),s=(n.size.height+r.size.height)*1.5<n.size.width+r.size.width?"vertical":"horizontal";return{type:"group",split:s,size:{width:s==="horizontal"?n.size.width+r.size.width:Math.max(n.size.width,r.size.width),height:s==="horizontal"?Math.max(n.size.height,r.size.height):n.size.height+r.size.height},left:n,right:r}}else return{type:"leaf",size:this.getTileSize(e[0].tile),value:e[0].tile}}static sortAndMapTilesBySize(e){return e.map(t=>{let n=this.getTileSize(t),r=n.height*n.height+n.width*n.width;return{tile:t,size:n,radius:r}}).sort((t,n)=>n.radius-t.radius)}static splitTileArrayInHalf(e){let n=e.reduce((a,d)=>a+d.size.width,0)/2,r=e.length-1,s=e[r].size.width;for(let a=e.length-2;a>0;a--){let d=e[a];if(s+=d.size.width,s>n){r=a;break}}return[e.slice(0,r),e.slice(r)]}static getTileSize(e){return{width:Math.max(...e.vertices.map(t=>t.x))-Math.min(...e.vertices.map(t=>t.x)),height:Math.max(...e.vertices.map(t=>t.y))-Math.min(...e.vertices.map(t=>t.y))}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac})}}return o})();var ss=(()=>{class o{constructor(){this.store=c(A),this.destroyRef=c(Y),this.toolService=c(_e),this.tilesSets$=this.store.select(Xe)}ngAfterViewInit(){queueMicrotask(()=>this.subscribeOnTilesSetsChange())}subscribeOnTilesSetsChange(){this.tilesSets$.pipe(Q(this.destroyRef)).subscribe(e=>this.drawTiles(e.flatMap(t=>t.tiles)))}sectionEntered(e){return this.activeCanvas=e,{ribbon:[{iconName:"crop",visibility:O("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")}]}}drawTiles(e){this.activeCanvas.removeObjects(),e.length&&rs.drawTiles(e,this.activeCanvas),this.activeCanvas.redraw()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tray"]],decls:1,vars:0,template:function(t,n){t&1&&w(0,"router-outlet")},dependencies:[Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var vn="/tool";var bn=()=>c(A).selectSignal(Nr)()?!0:(c(K).navigate([vn]),!1);var Ha=["text"],za=[[["mat-icon"]],"*"],$a=["mat-icon","*"];function Ua(o,i){if(o&1&&w(0,"mat-pseudo-checkbox",1),o&2){let e=x();y("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function Wa(o,i){if(o&1&&w(0,"mat-pseudo-checkbox",3),o&2){let e=x();y("disabled",e.disabled)}}function qa(o,i){if(o&1&&(h(0,"span",4),m(1),p()),o&2){let e=x();l(),D("(",e.group.label,")")}}var fo=new re("MAT_OPTION_PARENT_COMPONENT"),_o=new re("MatOptgroup");var Si=class{source;isUserInput;constructor(i,e=!1){this.source=i,this.isUserInput=e}},oi=(()=>{class o{_element=c(me);_changeDetectorRef=c(Ke);_parent=c(fo,{optional:!0});group=c(_o,{optional:!0});_signalDisableRipple=!1;_selected=!1;_active=!1;_mostRecentViewValue="";get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}value;id=c(Ze).getId("mat-option-");get disabled(){return this.group&&this.group.disabled||this._disabled()}set disabled(e){this._disabled.set(e)}_disabled=O(!1);get disableRipple(){return this._signalDisableRipple?this._parent.disableRipple():!!this._parent?.disableRipple}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}onSelectionChange=new se;_text;_stateChanges=new P;constructor(){let e=c(Zt);e.load(Mr),e.load(dr),this._signalDisableRipple=!!this._parent&&Hi(this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(e=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}deselect(e=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}focus(e,t){let n=this._getHostElement();typeof n.focus=="function"&&n.focus(t)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!Qt(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=e)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new Si(this,e))}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["mat-option"]],viewQuery:function(t,n){if(t&1&&ut(Ha,7),t&2){let r;We(r=qe())&&(n._text=r.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(t,n){t&1&&C("click",function(){return n._selectViaInteraction()})("keydown",function(s){return n._handleKeydown(s)}),t&2&&(Ut("id",n.id),Ae("aria-selected",n.selected)("aria-disabled",n.disabled.toString()),G("mdc-list-item--selected",n.selected)("mat-mdc-option-multiple",n.multiple)("mat-mdc-option-active",n.active)("mdc-list-item--disabled",n.disabled))},inputs:{value:"value",id:"id",disabled:[2,"disabled","disabled",le]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],ngContentSelectors:$a,decls:8,vars:5,consts:[["text",""],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"]],template:function(t,n){t&1&&(mt(za),W(0,Ua,1,2,"mat-pseudo-checkbox",1),st(1),h(2,"span",2,0),st(4,1),p(),W(5,Wa,1,1,"mat-pseudo-checkbox",3),W(6,qa,2,1,"span",4),w(7,"div",5)),t&2&&(q(n.multiple?0:-1),l(5),q(!n.multiple&&n.selected&&!n.hideSingleSelectionIndicator?5:-1),l(),q(n.group&&n.group._inert?6:-1),l(),y("matRippleTrigger",n._getHostElement())("matRippleDisabled",n.disabled||n.disableRipple))},dependencies:[Ir,Pr],styles:[`.mat-mdc-option{-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;min-height:48px;padding:0 16px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-option-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-option-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-option-label-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-option-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-option-label-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));outline:0}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover){background-color:var(--mat-option-selected-state-layer-color, var(--mat-sys-secondary-container))}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option .mat-pseudo-checkbox{--mat-pseudo-checkbox-minimal-selected-checkmark-color: var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}@media(forced-colors: active){.mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{right:auto;left:16px}}.mat-mdc-option-multiple{--mat-list-list-item-selected-container-color: var(--mat-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-focus-indicator::before{content:""}
`],encapsulation:2,changeDetection:0})}return o})();function as(o,i,e){if(e.length){let t=i.toArray(),n=e.toArray(),r=0;for(let s=0;s<o+1;s++)t[s].group&&t[s].group===n[r]&&r++;return r}return 0}function ls(o,i,e,t){return o<e?o:o+i>e+t?Math.max(0,o-t+i):e}var vo=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ue({type:o});static \u0275inj=ze({imports:[Ar,Rr,oi,Kt]})}return o})();var Za=["panel"],Qa=["*"];function Xa(o,i){if(o&1&&(Dt(0,"div",1,0),st(2),Ot()),o&2){let e=i.id,t=x();er(t._classList),G("mat-mdc-autocomplete-visible",t.showPanel)("mat-mdc-autocomplete-hidden",!t.showPanel)("mat-autocomplete-panel-animations-enabled",!t._animationsDisabled)("mat-primary",t._color==="primary")("mat-accent",t._color==="accent")("mat-warn",t._color==="warn"),Ut("id",t.id),Ae("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby(e))}}var bo=class{source;option;constructor(i,e){this.source=i,this.option=e}},hs=new re("mat-autocomplete-default-options",{providedIn:"root",factory:()=>({autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1})}),ps=(()=>{class o{_changeDetectorRef=c(Ke);_elementRef=c(me);_defaults=c(hs);_animationsDisabled=Xt();_activeOptionChanges=Be.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new se;opened=new se;closed=new se;optionActivated=new se;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=c(Ze).getId("mat-autocomplete-");inertGroups;constructor(){let e=c(_t);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new gr(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let t=new bo(this,e);this.optionSelected.emit(t)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let t=e?e+" ":"";return this.ariaLabelledby?t+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["mat-autocomplete"]],contentQueries:function(t,n,r){if(t&1&&(no(r,oi,5),no(r,_o,5)),t&2){let s;We(s=qe())&&(n.options=s),We(s=qe())&&(n.optionGroups=s)}},viewQuery:function(t,n){if(t&1&&(ut(ui,7),ut(Za,5)),t&2){let r;We(r=qe())&&(n.template=r.first),We(r=qe())&&(n.panel=r.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",le],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",le],requireSelection:[2,"requireSelection","requireSelection",le],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",le],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",le]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[de([{provide:fo,useExisting:o}])],ngContentSelectors:Qa,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(t,n){t&1&&(mt(),Xo(0,Xa,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden,.cdk-overlay-pane:has(>.mat-mdc-autocomplete-hidden){visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return o})();var Ya={provide:ln,useExisting:ji(()=>Co),multi:!0};var Ja=new re("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let o=c($e);return()=>vr(o)}}),Co=(()=>{class o{_environmentInjector=c(Go);_element=c(me);_injector=c($e);_viewContainerRef=c(Bi);_zone=c(Se);_changeDetectorRef=c(Ke);_dir=c(vi,{optional:!0});_formField=c(un,{optional:!0,host:!0});_viewportRuler=c(nn);_scrollStrategy=c(Ja);_renderer=c(fi);_animationsDisabled=Xt();_defaults=c(hs,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new P;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=Be.EMPTY;_breakpointObserver=c(Ji);_handsetLandscapeSubscription=Be.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new P;_overlayPanelClass=Yi(this._defaults?.overlayPanelClass||[]);_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&en(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return ht(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(io(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(io(()=>this._overlayAttached)):pi()).pipe(Vi(e=>e instanceof Si?e:null))}optionSelections=zo(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(mi(e),Nt(()=>ht(...e.map(t=>t.onSelectionChange)))):this._initialized.pipe(Nt(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new Vt(e=>{let t=r=>{let s=Tt(r),a=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,d=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&s!==this._element.nativeElement&&!this._hasFocus()&&(!a||!a.contains(s))&&(!d||!d.contains(s))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(s)&&e.next(r)},n=[this._renderer.listen("document","click",t),this._renderer.listen("document","auxclick",t),this._renderer.listen("document","touchend",t)];return()=>{n.forEach(r=>r())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let t=e,n=t.keyCode,r=Qt(t);if(n===27&&!r&&t.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&n===13&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){let s=this.autocomplete._keyManager.activeItem,a=n===38||n===40;n===9||a&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(t):a&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(a||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let t=e.target,n=t.value;if(t.type==="number"&&(n=n==""?null:parseFloat(n)),this._previousValue!==n){if(this._previousValue=n,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(n),!n)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let r=this.autocomplete.options?.find(s=>s.selected);if(r){let s=this._getDisplayValue(r.value);n!==s&&r.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let r=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(r)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return mr()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new Vt(n=>{Et(()=>{n.next()},{injector:this._environmentInjector})}),t=this.autocomplete.options?.changes.pipe(jt(()=>this._positionStrategy.reapplyLastPosition()),Uo(0))??pi();return ht(e,t).pipe(Nt(()=>this._zone.run(()=>{let n=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),n!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),Ni(1)).subscribe(n=>this._setValueAndClose(n))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let t=this.autocomplete;return t&&t.displayWith?t.displayWith(e):e}_assignOptionValue(e){let t=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(t??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let t=this.autocomplete,n=e?e.source:this._pendingAutoselectedOption;n?(this._clearPreviousSelectedOption(n),this._assignOptionValue(n.value),this._onChange(n.value),t._emitSelectEvent(n),this._element.nativeElement.focus()):t.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,t){this.autocomplete?.options?.forEach(n=>{n!==e&&n.selected&&n.deselect(t)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let t=this.autocomplete.id;ro(this._trackedModal,"aria-owns",t)}}_attachOverlay(e){if(!this.autocomplete)return;let t=this._overlayRef;t?(this._positionStrategy.setOrigin(this._getConnectedElement()),t.updateSize({width:this._getPanelWidth()})):(this._portal=new rn(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),t=an(this._injector,this._getOverlayConfig()),this._overlayRef=t,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&t&&t.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(on.HandsetLandscape).subscribe(r=>{r.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),t&&!t.hasAttached()&&(t.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let n=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&n!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!Qt(e)||e.keyCode===38&&Qt(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new sn({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:this._overlayPanelClass,disableAnimations:this._animationsDisabled})}_getOverlayPosition(){let e=br(this._injector,this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1).withPopoverLocation("inline");return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let t=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],n=this._aboveClass,r=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:n},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:n}],s;this.position==="above"?s=r:this.position==="below"?s=t:s=[...t,...r],e.withPositions(s)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let t=-1;for(let n=0;n<e.options.length;n++)if(!e.options.get(n).disabled){t=n;break}e._keyManager.setActiveItem(t)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let t=this.autocomplete,n=as(e,t.options,t.optionGroups);if(e===0&&n===1)t._setScrollTop(0);else if(t.panel){let r=t.options.toArray()[e];if(r){let s=r._getHostElement(),a=ls(s.offsetTop,s.offsetHeight,t._getScrollTop(),t.panel.nativeElement.offsetHeight);t._setScrollTop(a)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let t=this.autocomplete.id;this._trackedModal&&en(this._trackedModal,"aria-owns",t),ro(e,"aria-owns",t),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;en(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(t,n){t&1&&C("focusin",function(){return n._handleFocus()})("blur",function(){return n._onTouched()})("input",function(s){return n._handleInput(s)})("keydown",function(s){return n._handleKeydown(s)})("click",function(){return n._handleClick()}),t&2&&Ae("autocomplete",n.autocompleteAttribute)("role",n.autocompleteDisabled?null:"combobox")("aria-autocomplete",n.autocompleteDisabled?null:"list")("aria-activedescendant",n.panelOpen&&n.activeOption?n.activeOption.id:null)("aria-expanded",n.autocompleteDisabled?null:n.panelOpen.toString())("aria-controls",n.autocompleteDisabled||!n.panelOpen||n.autocomplete==null?null:n.autocomplete.id)("aria-haspopup",n.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",le]},exportAs:["matAutocompleteTrigger"],features:[de([Ya]),Ht]})}return o})(),ms=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Ue({type:o});static \u0275inj=ze({imports:[bi,vo,ao,vo,Kt]})}return o})();var wi=class{static calculateConvexityFactor(i){let e=this.calculatePolygonArea(i),t=this.calculatePolygonCircumference(i);return Math.sqrt(e)/t}static calculatePolygonArea(i){if(i.length<3)throw new Error("polygon should have at least 3 vertices");let e=i.at(-1).x*i[0].y,t=i.at(-1).y*i[0].x;for(let n=0,r=i.length-1;n<r;++n)e+=i[n].x*i[n+1].y,t+=i[n].y*i[n+1].x;return(e-t)/2}static calculatePolygonCircumference(i){let e=R.distance(i[0],i.at(-1));for(let t=1;t<i.length;++t)e+=R.distance(i[t],i[t-1]);return e}static calculatePolygonCentroid(i){let e=0,t=0,n=0,r=i.at(-1);for(let s of i){let a=s.y*r.x-s.x*r.y;n+=a,e+=(s.x+r.x)*a,t+=(s.y+r.y)*a,r=s}return n*=3,n==0?R.zero:new R(e/n,t/n)}static calculateOuterRadius(i){let e=0;for(let t of i){let n=R.distance(R.zero,t);n>e&&(e=n)}return e}};var lt=class{static nextInt(i,e){return Math.floor(Math.random()*(e-i+1)+i)}static nextFloat(i,e){return Math.random()*(e-i)+i}};var Cn=class{constructor(i){this.imagePixelArray=i}generateTileSet(i,e){let t=[];for(let n=0;n<e;++n)t.push(this.generateTile(i));return t}generateTile(i){let e;do e=this.generateVertices(i);while(wi.calculateConvexityFactor([...e].reverse())<.18);let t=this.rotatePolygonToHorizontal(e),n=wi.calculatePolygonCentroid(t),r=this.normalizeVertices(t,n);return{id:crypto.randomUUID(),vertices:r,color:this.randomColor().hex()}}generateVertices(i){let e=lt.nextInt(4,6),t=[];for(let n=0;n<e;++n){let r=lt.nextFloat(i.min,i.max);t.push(this.generateVertex(n,e,r))}return t}generateVertex(i,e,t){let r=(360/e*i+lt.nextFloat(0,30))%360*Math.PI/180;return new R(Math.sin(r),Math.cos(r)).multiply(t)}randomColor(){let i=this.imagePixelArray.length/4,e=lt.nextInt(0,i-1);return pe({r:this.imagePixelArray[e*4],g:this.imagePixelArray[e*4+1],b:this.imagePixelArray[e*4+2]})}normalizeVertices(i,e){return i.map(t=>this.roundVertexCoords(t.sub(e)))}roundVertexCoords(i){return new R(Math.round((i.x+Number.EPSILON)*100)/100,Math.round((i.y+Number.EPSILON)*100)/100)}rotatePolygonToHorizontal(i){let e=0,t=i[0],n=i[1];for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++){let d=i[a].x-i[s].x,g=i[a].y-i[s].y,b=d*d+g*g;b>e&&(e=b,t=i[s],n=i[a])}let r=Math.atan2(n.y-t.y,n.x-t.x);return i.map(s=>{let a=s.x-t.x,d=s.y-t.y,g=a*Math.cos(-r)-d*Math.sin(-r),b=a*Math.sin(-r)+d*Math.cos(-r);return new R(g+t.x,b+t.y)})}};function tl(o,i){if(o&1&&(h(0,"mat-option",7),m(1),p()),o&2){let e=i.$implicit,t=x();y("value",e)("disabled",t.immutableSeriesNames().includes(e)),l(),D(" ",e," ")}}var yo=(()=>{class o{constructor(){this.router=c(K),this.route=c(ft),this.store=c(A),this.snackBar=c(it),this.translate=c(ee),this.dialog=c(bt),this.tilesSetsSignal=this.store.selectSignal(Xe),this.existingSeriesNames=V(()=>this.tilesSetsSignal().filter(e=>e.source==="generated").map(e=>e.name)),this.immutableSeriesNames=V(()=>this.tilesSetsSignal().filter(e=>e.source!=="generated").map(e=>e.name)),this.errorLabels={min:()=>this.translate.instant("tool.tiles.random.radiusTooSmall"),max:()=>this.translate.instant("tool.tiles.random.radiusTooLarge"),required:()=>this.translate.instant("common.fieldRequired"),minGreaterThenMax:()=>this.translate.instant("tool.tiles.random.maxRadiusLargerThanMin"),cannotNowOverrideOtherTilesSet:()=>this.translate.instant("tool.tiles.random.cannotNowOverrideOtherTilesSet"),cannotOverrideTilesSet:()=>this.translate.instant("tool.tiles.random.cannotOverrideTilesSet")},this.formData=O({name:"",minRadius:null,maxRadius:null,count:null}),this.editedTilesSet=null,this.form=Ct(this.formData,e=>{U(e.name),kt(e.name,({value:t})=>this.immutableSeriesNames().includes(t())?at({kind:"cannotOverrideTilesSet"}):null),kt(e.name,({value:t})=>this.editedTilesSet&&this.existingSeriesNames().some(r=>r===t()&&r!==this.editedTilesSet.name)?at({kind:"cannotNowOverrideOtherTilesSet"}):null),U(e.minRadius),Le(e.minRadius,.01),It(e.minRadius,1e3),U(e.maxRadius),Le(e.maxRadius,.01),It(e.maxRadius,1e3),kt(e.maxRadius,({value:t,valueOf:n})=>Number(t())<Number(n(e.minRadius))?at({kind:"minGreaterThenMax"}):null),U(e.count)})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.initFormForEditedTilesSet(e)}initFormForEditedTilesSet(e){let t=this.tilesSetsSignal().find(n=>n.id===e);this.isGeneratedTilesSet(t)&&(this.editedTilesSet=t,this.formData.set({name:t.name,count:t.tiles.length,minRadius:t.minRadius,maxRadius:t.maxRadius}))}getFieldErrorLabel(e){return Ne.getFieldErrorLabel(e,this.errorLabels)}trySaveTileSet(){pn(this.form,async()=>{let e=this.getIdOfEditedTilesSet();e?this.openWarningDialog().subscribe(async t=>{t&&await this.saveTileSet(e)}):await this.saveTileSet(null)})}getIdOfEditedTilesSet(){let{name:e}=this.formData();return this.editedTilesSet?.id??this.getTileSetByName(e)?.id??null}getTileSetByName(e){return this.existingSeriesNames().includes(e)?this.tilesSetsSignal().filter(t=>this.isGeneratedTilesSet(t)).find(t=>t.name===e):null}async saveTileSet(e){this.snackBar.open(this.translate.instant("tool.tiles.random.tilesSeriesGenerated"),this.translate.instant("common.ok"),{duration:3e3}),this.store.dispatch(ue.tilesSetCommitted({tilesSet:await this.buildTileSet(e)})),this.navigateToMenu()}async buildTileSet(e){let{name:t,minRadius:n,maxRadius:r,count:s}=this.formData(),a=Number(n),d=Number(r),g=new Cn(await this.getImagePixelArray());return{id:e??crypto.randomUUID(),name:t,source:"generated",tiles:g.generateTileSet({min:a,max:d},Number(s)),minRadius:a,maxRadius:d}}async getImagePixelArray(){let e=this.store.selectSignal(Vr)();return jr.getImageSrcPixelArray(e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}isGeneratedTilesSet(e){return e.source==="generated"}openWarningDialog(){let e={title:this.translate.instant("common.warning"),message:this.translate.instant("tool.tiles.random.overrideTileSetWarning")};return this.dialog.open(wt,{data:e}).afterClosed()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-random-tiles"]],decls:46,vars:37,consts:[["auto","matAutocomplete"],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"form"],["subscriptSizing","dynamic",1,"density-3"],["matInput","","type","text",3,"field","matAutocomplete"],[3,"value","disabled"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(t,n){if(t&1){let r=F();h(0,"div",1)(1,"button",2),C("click",function(){return T(r),k(n.navigateToMenu())}),m(2),_(3,"translate"),p(),h(4,"button",3),C("click",function(){return T(r),k(n.trySaveTileSet())}),m(5),_(6,"translate"),p()(),h(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),m(10),_(11,"translate"),p(),w(12,"input",6),j(),h(13,"mat-autocomplete",null,0),Pe(15,tl,2,3,"mat-option",7,$t),p(),h(17,"mat-error"),m(18),p()(),h(19,"mat-form-field",5)(20,"mat-label"),m(21),_(22,"translate"),p(),w(23,"input",8),j(),h(24,"span",9),m(25),_(26,"translate"),p(),h(27,"mat-error"),m(28),p()(),h(29,"mat-form-field",5)(30,"mat-label"),m(31),_(32,"translate"),p(),w(33,"input",8),j(),h(34,"span",9),m(35),_(36,"translate"),p(),h(37,"mat-error"),m(38),p()(),h(39,"mat-form-field",5)(40,"mat-label"),m(41),_(42,"translate"),p(),w(43,"input",8),j(),h(44,"mat-error"),m(45),p()()()}if(t&2){let r=Ee(14);l(2),D(" ",v(3,21,"common.return")," "),l(3),D(" ",v(6,23,"tool.tiles.random.randomTiles")," "),l(5),f(v(11,25,"tool.tiles.random.seriesName")),l(2),B(n.form.name),y("matAutocomplete",r),l(3),Me(n.existingSeriesNames()),l(3),f(n.getFieldErrorLabel(n.form.name())),l(3),f(v(22,27,"tool.tiles.random.minRadius")),l(2),B(n.form.minRadius),l(2),f(v(26,29,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.minRadius())),l(3),f(v(32,31,"tool.tiles.random.maxRadius")),l(2),B(n.form.maxRadius),l(2),f(v(36,33,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.maxRadius())),l(3),f(v(42,35,"tool.tiles.random.count")),l(2),B(n.form.count),l(2),f(n.getFieldErrorLabel(n.form.count()))}},dependencies:[Fe,Je,Ye,St,mn,tt,et,$,L,te,ms,ps,oi,Co,yt,Z],styles:["[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px;gap:18px}"],changeDetection:0})}}return o})();var il=["*"],ri=(()=>{class o{constructor(){this.isOpen=J.required(),this.elementRef=c(me),this.expandDuration=V(()=>{let e=this.elementRef.nativeElement.scrollHeight,t=150+Math.sqrt(e)*5;return this.isOpen()?t:t*.66})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-expandable-panel"]],hostVars:4,hostBindings:function(t,n){t&2&&(Ge("--expand-duration",n.expandDuration()+"ms"),G("open",n.isOpen()))},inputs:{isOpen:[1,"isOpen"]},ngContentSelectors:il,decls:1,vars:0,template:function(t,n){t&1&&(mt(),st(0))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden;height:0;interpolate-size:allow-keywords;transition:height var(--expand-duration, .3s) ease-out}.open[_nghost-%COMP%]{height:auto}"],changeDetection:0})}}return o})();var gs=(()=>{class o{constructor(){this.tile=J.required(),this.router=c(K)}navigateToTileDetails(){this.router.navigate([`/tool/tray/tile/${this.tile().id}`])}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tile-list-elem"]],inputs:{tile:[1,"tile"]},decls:13,vars:5,consts:[["menu","matMenu"],[1,"label"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(t,n){if(t&1){let r=F();h(0,"span",1),m(1),p(),h(2,"div",2)(3,"button",3)(4,"mat-icon",4),m(5," more_vert "),p()(),h(6,"mat-menu",5,0)(8,"button",6),C("click",function(){return T(r),k(n.navigateToTileDetails())}),h(9,"mat-icon",7),m(10," page_info "),p(),m(11),_(12,"translate"),p()()()}if(t&2){let r=Ee(7);l(),D(" ",n.tile().id,`
`),l(2),y("matMenuTriggerFor",r),l(8),D(" ",v(12,3,"common.details")," ")}},dependencies:[Oe,De,L,ke,ti,Jt,Yt,ei,$,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.selected[_nghost-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;margin-left:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}"],changeDetection:0})}}return o})();var nl=["element"],ol=o=>({$implicit:o});function rl(o,i){if(o&1){let e=F();h(0,"button",3),C("click",function(){T(e);let n=x();return k(n.goToPreviousPage())}),m(1),_(2,"translate"),p()}if(o&2){let e=x().previousPageNumbers();l(),oo(" ",v(2,3,"common.previousElements")," ",e.from,"-",e.to," ")}}function sl(o,i){if(o&1&&Yo(0,1),o&2){let e=i.$implicit,t=x();y("ngTemplateOutlet",t.template())("ngTemplateOutletContext",or(2,ol,e))}}function al(o,i){if(o&1){let e=F();h(0,"button",4),C("click",function(){T(e);let n=x();return k(n.goToNextPage())}),m(1),_(2,"translate"),p()}if(o&2){let e=x().nextPageNumbers();l(),oo(" ",v(2,3,"common.nextElements")," ",e.from,"-",e.to," ")}}var yn=(()=>{class o{constructor(){this.template=rr.required("element"),this.pageSize=J(50),this.items=J(),this.page=O(1),this.itemsToShow=V(()=>{let e=this.pageSize(),t=(this.page()-1)*e;return this.items().slice(t,t+e)}),this.hasPreviousPage=V(()=>this.page()>1),this.previousPageNumbers=V(()=>{let e=(this.page()-2)*this.pageSize()+1,t=(this.page()-1)*this.pageSize();return{from:Math.max(e,1),to:Math.min(t,this.items().length)}}),this.hasNextPage=V(()=>this.page()*this.pageSize()<this.items().length),this.nextPageNumbers=V(()=>{let e=this.page()*this.pageSize()+1,t=(this.page()+1)*this.pageSize();return{from:Math.min(e,this.items().length),to:Math.min(t,this.items().length)}})}goToPreviousPage(){this.hasPreviousPage()&&this.page.update(e=>e-1)}goToNextPage(){this.hasNextPage()&&this.page.update(e=>e+1)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-scrollable-list"]],contentQueries:function(t,n,r){t&1&&Jo(r,n.template,nl,5),t&2&&Wt()},inputs:{pageSize:[1,"pageSize"],items:[1,"items"]},decls:4,vars:2,consts:[["mat-flat-button","",1,"page-button","previous"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-flat-button","",1,"page-button","next"],["mat-flat-button","",1,"page-button","previous",3,"click"],["mat-flat-button","",1,"page-button","next",3,"click"]],template:function(t,n){t&1&&(W(0,rl,3,5,"button",0),Pe(1,sl,1,4,"ng-container",1,zt),W(3,al,3,5,"button",2)),t&2&&(q(n.hasPreviousPage()?0:-1),l(),Me(n.itemsToShow()),l(2),q(n.hasNextPage()?3:-1))},dependencies:[ar,te,$,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .page-button[_ngcontent-%COMP%]{--mat-button-filled-container-height: 28px;--mat-button-filled-container-shape: 4px}"],changeDetection:0})}}return o})();function ll(o,i){if(o&1){let e=F();h(0,"button",10),C("click",function(){T(e);let n=x();return k(n.navigateToRandomSetAgain())}),h(1,"mat-icon",11),m(2," shuffle "),p(),m(3),_(4,"translate"),p()}o&2&&(l(3),D(" ",v(4,1,"tool.tiles.menu.generateAgain")," "))}function cl(o,i){if(o&1&&w(0,"app-tile-list-elem",14),o&2){let e=i.$implicit;y("tile",e)}}var fs=(()=>{class o{constructor(){this.tilesSet=J.required(),this.isOpen=O(!1),this.store=c(A),this.dialog=c(bt),this.translate=c(ee),this.destroyRef=c(Y),this.router=c(K)}toggleTilesList(){this.isOpen.update(e=>!e)}removeTilesSet(){this.showRemoveTilesSetWarning().pipe(Q(this.destroyRef)).subscribe(e=>{e&&this.store.dispatch(ue.tilesSetRemoved({removedTilesSet:this.tilesSet()}))})}showRemoveTilesSetWarning(){let e={title:this.translate.instant("tool.tiles.menu.removeTilesSet"),message:this.translate.instant("tool.tiles.menu.removeTilesSetQuery",{name:this.tilesSet().name})};return this.dialog.open(wt,{data:e}).afterClosed()}navigateToRandomSetAgain(){this.router.navigate([`/tool/tray/random/${this.tilesSet().id}`])}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tiles-set-list-elem"]],inputs:{tilesSet:[1,"tilesSet"]},decls:22,vars:10,consts:[["menu","matMenu"],["element",""],[1,"list-elem"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["mat-icon-button","",1,"elem-action","toggle-action",3,"click"],[1,"chevron"],["classList","paddingless"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"],[1,"panel",3,"isOpen"],[3,"items"],[3,"tile"]],template:function(t,n){if(t&1){let r=F();h(0,"div",2)(1,"span"),m(2),p(),h(3,"div",3)(4,"button",4)(5,"mat-icon",5),m(6," more_vert "),p()(),h(7,"button",6),C("click",function(){return T(r),k(n.toggleTilesList())}),h(8,"mat-icon",7),m(9," keyboard_arrow_up "),p()(),h(10,"mat-menu",8,0),W(12,ll,5,3,"button",9),h(13,"button",10),C("click",function(){return T(r),k(n.removeTilesSet())}),h(14,"mat-icon",11),m(15," delete "),p(),m(16),_(17,"translate"),p()()()(),h(18,"app-expandable-panel",12)(19,"app-scrollable-list",13),pt(20,cl,1,1,"ng-template",null,1,qi),p()()}if(t&2){let r=Ee(11),s=n.tilesSet();l(2),f(s.name),l(2),y("matMenuTriggerFor",r),l(4),G("chevron--closed",!n.isOpen()),l(4),q(s.source==="generated"?12:-1),l(4),D(" ",v(17,8,"tool.tiles.menu.removeTilesSet")," "),l(2),y("isOpen",n.isOpen()),l(),y("items",s.tiles)}},dependencies:[ri,L,ke,Oe,De,ti,Jt,Yt,ei,gs,$,yn,Z],styles:["[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .list-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{margin-top:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:#666}"],changeDetection:0})}}return o})();function dl(o,i){if(o&1&&w(0,"app-tiles-set-list-elem",4),o&2){let e=i.$implicit;y("tilesSet",e)}}function hl(o,i){o&1&&(h(0,"span",5),m(1),_(2,"translate"),p()),o&2&&(l(),D(" ",v(2,1,"tool.tiles.menu.noTiles")," "))}var _s=(()=>{class o{constructor(){this.router=c(K),this.store=c(A),this.tilesSets=this.store.selectSignal(Xe)}navigateToRandomTiles(){this.router.navigate(["/tool/tray/random"])}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tray-menu"]],decls:14,vars:10,consts:[[1,"actions"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","accent",3,"click"],[1,"tiles-sets"],[3,"tilesSet"],[1,"no-sets"]],template:function(t,n){t&1&&(h(0,"div",0)(1,"button",1),m(2),_(3,"translate"),p(),h(4,"button",1),m(5),_(6,"translate"),p(),h(7,"button",2),C("click",function(){return n.navigateToRandomTiles()}),m(8),_(9,"translate"),p()(),h(10,"div",3),Pe(11,dl,1,1,"app-tiles-set-list-elem",4,zt,!1,hl,3,3,"span",5),p()),t&2&&(l(2),D(" ",v(3,4,"tool.tiles.menu.loadFromFile")," "),l(3),D(" ",v(6,6,"tool.tiles.menu.createTile")," "),l(3),D(" ",v(9,8,"tool.tiles.menu.randomTiles")," "),l(3),Me(n.tilesSets()))},dependencies:[L,te,fs,$,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;flex:1 1 0}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]   .no-sets[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}"],changeDetection:0})}}return o})();var pl=["canvas"],vs=(()=>{class o{constructor(){this.value=gt(),this.valueChange=qt(),this.canvas=Ki.required("canvas"),this.cursorData=V(()=>{let e=this.value(),t=this.canvas()?.nativeElement.getBoundingClientRect().width??1;return this.computeCursorData(e,t)}),this.destroyRef=c(Y),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onSliderMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onSliderMouseInteraction(e)}}onSliderMouseInteraction(e){let t=this.canvas().nativeElement.getBoundingClientRect(),n=(e.clientX-t.x)/t.width;this.value.set(Math.max(0,Math.min(1,n))),this.valueChange.emit(this.value())}ngAfterViewInit(){this.drawSliderCanvas(),this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove)})}drawSliderCanvas(){let e=this.canvas().nativeElement.getContext("2d"),t={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},n=e.createLinearGradient(0,0,t.width,0),r=20;for(let s=0;s<=r;++s){let a=s*(1/r);n.addColorStop(a,pe({h:a*360,s:100,v:100}).hex())}e.fillStyle=n,e.fillRect(0,0,t.width,t.height)}computeCursorData(e,t){let n=t*e-8,r=pe({h:e*360,s:100,v:100}).hex();return{horizontalOffset:`${n}px`,color:r}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-slider"]],viewQuery:function(t,n){t&1&&$i(n.canvas,pl,5),t&2&&Wt()},inputs:{value:[1,"value"]},outputs:{value:"valueChange",valueChange:"valueChange"},decls:3,vars:4,consts:[["canvas",""],["width","250","height","8",1,"slider"],[1,"cursor"]],template:function(t,n){if(t&1&&zi(0,"canvas",1,0)(2,"div",2),t&2){let r=n.cursorData();l(2),Ge("left",r.horizontalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{width:100%;position:relative;cursor:pointer}[_nghost-%COMP%]   .slider[_ngcontent-%COMP%]{display:block;width:100%;height:8px;border-radius:5px}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;top:-5px;pointer-events:none}"],changeDetection:0})}}return o})();var ml=["canvas"],bs=(()=>{class o{constructor(){this.hValue=J(),this.sValue=gt(),this.vValue=gt(),this.colorChange=qt(),this.canvas=Ki.required("canvas"),this.cursorData=V(()=>this.computeCursorData()),this.destroyRef=c(Y),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onCanvasMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onCanvasMouseInteraction(e)},we(()=>this.drawColorCanvas())}onCanvasMouseInteraction(e){let t=this.canvas().nativeElement.getBoundingClientRect(),n=(e.clientX-t.x)/t.width,r=(e.clientY-t.y)/t.height;this.sValue.set(Math.min(1,Math.max(0,n))),this.vValue.set(Math.min(1,Math.max(0,1-r))),this.colorChange.emit(pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}))}ngAfterViewInit(){this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove)})}drawColorCanvas(){let e={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},t=this.canvas().nativeElement.getContext("2d"),n=t.createLinearGradient(0,0,e.width,0);n.addColorStop(0,"#FFFFFF");let r=pe({h:this.hValue()*360,s:100,v:100}).hex();n.addColorStop(1,r);let s=t.createLinearGradient(0,0,0,e.height);s.addColorStop(0,"#00000000"),s.addColorStop(1,"#000000"),t.fillStyle=n,t.fillRect(0,0,e.width,e.height),t.fillStyle=s,t.fillRect(0,0,e.width,e.height)}computeCursorData(){let e=this.canvas().nativeElement.getBoundingClientRect(),t=e.width*this.sValue()-8,n=e.height*(1-this.vValue())-8;return{horizontalOffset:`${t}px`,verticalOffset:`${n}px`,color:pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex()}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-canvas"]],viewQuery:function(t,n){t&1&&$i(n.canvas,ml,5),t&2&&Wt()},inputs:{hValue:[1,"hValue"],sValue:[1,"sValue"],vValue:[1,"vValue"]},outputs:{sValue:"sValueChange",vValue:"vValueChange",colorChange:"colorChange"},decls:3,vars:6,consts:[["canvas",""],["width","250","height","150",1,"panel"],[1,"cursor"]],template:function(t,n){if(t&1&&zi(0,"canvas",1,0)(2,"div",2),t&2){let r=n.cursorData();l(2),Ge("left",r.horizontalOffset)("top",r.verticalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{position:relative;cursor:pointer;overflow:hidden;display:block}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{display:block;width:100%}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;pointer-events:none}"],changeDetection:0})}}return o})();var gl=/^#([0-9a-f]{3}){1,2}$/i,Cs=(()=>{class o{constructor(){this.color=J.required({transform:e=>pe(e)}),this.colorChange=qt(),this.hValue=Gi({source:this.color,computation:e=>e.hue()/360}),this.sValue=Gi({source:this.color,computation:e=>e.saturationv()/100}),this.vValue=Gi({source:this.color,computation:e=>e.value()/100}),this.hexColor=V(()=>pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex())}ngOnDestroy(){let e=pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100});this.colorChange.emit(e)}onHexCodeChange(e){let t=e.currentTarget;if(gl.test(t.value)){let n=pe(t.value);this.hValue.set(n.hue()/360),this.sValue.set(n.saturationv()/100),this.vValue.set(n.value()/100)}}onColorCanvasChanged(e){this.sValue.set(e.saturationv()/100),this.vValue.set(e.value()/100)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-selection-panel"]],inputs:{color:[1,"color"]},outputs:{colorChange:"colorChange"},decls:10,vars:7,consts:[[1,"sv-preview"],[3,"colorChange","hValue","sValue","vValue"],[1,"slider-container"],[3,"valueChange","value"],[1,"result-wrapper"],["role","presentation",1,"color-preview"],[1,"density-3","code-input"],["matInput","",3,"change","ngModel"]],template:function(t,n){t&1&&(h(0,"div",0)(1,"app-color-canvas",1),C("colorChange",function(s){return n.onColorCanvasChanged(s)}),p()(),h(2,"div",2)(3,"app-color-slider",3),nr("valueChange",function(s){return ir(n.hValue,s)||(n.hValue=s),s}),p()(),h(4,"div",4),w(5,"div",5),h(6,"mat-form-field",6)(7,"mat-label"),m(8,"Hex"),p(),h(9,"input",7),C("change",function(s){return n.onHexCodeChange(s)}),p()()()),t&2&&(l(),y("hValue",n.hValue())("sValue",n.sValue())("vValue",n.vValue()),l(2),tr("value",n.hValue),l(2),Ge("background",n.hexColor()),l(4),y("ngModel",n.hexColor()))},dependencies:[tt,et,Je,Ye,hn,Er,cn,dn,vs,bs],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;background-color:var(--irr-contrast-lightest);border-radius:5px;overflow:hidden;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{padding:20px 10px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:0 10px 15px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;min-width:40px;height:40px;border-radius:50%;box-shadow:0 0 4px 1px #0003}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]{width:auto}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}}return o})();function fl(o,i){if(o&1){let e=F();h(0,"app-color-selection-panel",6),C("colorChange",function(n){T(e);let r=x();return k(r.onColorChanged(n))}),p()}if(o&2){let e=x();y("color",e.value())}}var Sn=(()=>{class o{constructor(){this.label=J.required(),this.value=gt("#000000"),this.disabled=gt(!1),this.isOpen=O(!1),this.onChange=()=>{},this.onTouched=()=>{},this.valueChangedEffect=we(()=>{this.onChange(this.value())})}toggleColorPanel(){this.disabled()||this.isOpen.update(e=>!e)}onColorChanged(e){this.value.set(e.hex())}writeValue(e){this.value.set(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled.set(e)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-picker"]],inputs:{label:[1,"label"],value:[1,"value"],disabled:[1,"disabled"]},outputs:{value:"valueChange",disabled:"disabledChange"},features:[de([{provide:ln,useExisting:ji(()=>o),multi:!0}])],decls:8,vars:10,consts:[["trigger","cdkOverlayOrigin"],[1,"color-label"],[1,"color-label__header"],[1,"color-label__code"],["role","presentation","cdkOverlayOrigin","",1,"color-preview",3,"click"],["cdkConnectedOverlay","",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayBackdropClass"],[3,"colorChange","color"]],template:function(t,n){if(t&1){let r=F();h(0,"div",1)(1,"span",2),m(2),p(),h(3,"span",3),m(4),p()(),h(5,"div",4,0),C("click",function(){return T(r),k(n.toggleColorPanel())}),p(),pt(7,fl,1,1,"ng-template",5),C("backdropClick",function(){return T(r),k(n.toggleColorPanel())})}if(t&2){let r=Ee(6);l(2),f(n.label()),l(2),f(n.value()),l(),Ge("background-color",n.value()),G("disabled",n.disabled()),l(2),y("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",n.isOpen())("cdkConnectedOverlayHasBackdrop",n.isOpen())("cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop-cs")}},dependencies:[bi,Sr,yr,Cs],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;border-radius:4px;padding:10px 15px;background-color:var(--irr-contrast-lightest);box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;width:40px;height:40px;margin-left:auto;border-radius:50%;box-shadow:0 0 4px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}[_nghost-%COMP%]   .color-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .color-label__header[_ngcontent-%COMP%]{color:var(--irr-contrast-highest)}[_nghost-%COMP%]   .color-label__code[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);font-size:15px}"],changeDetection:0})}}return o})();function _l(o,i){if(o&1&&(h(0,"div",5)(1,"div",6),m(2),_(3,"translate"),p(),h(4,"div",7),m(5),p()(),w(6,"app-color-picker",8)),o&2){let e=i,t=x();l(2),D("",v(3,5,"tool.tiles.details.tileId"),":"),l(3),f(e.id),l(),y("disabled",!0)("ngModel",e.color)("label",t.translate.instant("tool.tiles.details.tileColor"))}}function vl(o,i){o&1&&(h(0,"div",4),m(1),_(2,"translate"),p()),o&2&&(l(),f(v(2,1,"tool.tiles.details.tileNoExist")))}var ys=(()=>{class o{constructor(){this.tile=O(null),this.route=c(ft),this.store=c(A),this.router=c(K),this.translate=c(ee)}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(e){let t=this.getTileModel(e);t&&this.tile.set(t)}}getTileModel(e){return this.store.selectSignal(Xe)().flatMap(n=>n.tiles).find(n=>n.id===e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tile-detail"]],decls:10,vars:7,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],[1,"details"],[1,"no-exist"],[1,"id"],[1,"label"],[1,"value"],[3,"disabled","ngModel","label"]],template:function(t,n){if(t&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.navigateToMenu()}),m(2),_(3,"translate"),p(),h(4,"button",2),m(5),_(6,"translate"),p()(),h(7,"div",3),W(8,_l,7,7)(9,vl,3,3,"div",4),p()),t&2){let r;l(2),D(" ",v(3,3,"common.return")," "),l(3),D(" ",v(6,5,"common.edit")," "),l(3),q((r=n.tile())?8:9,r)}},dependencies:[$,L,te,Sn,hn,cn,dn,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:12px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{padding:2px;color:#e6e6e6}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .no-exist[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:auto}"],changeDetection:0})}}return o})();var ct=(()=>{class o{constructor(){this.sectorForContourEditionChanged=new He(null),this.sectorForContourEdition$=this.sectorForContourEditionChanged.asObservable(),this.sectorListChanged=new He(null),this.sectorListChange$=this.sectorListChanged.asObservable(),this.sectorForPropertyEditionChanged=new He(null),this.sectorForPropertyEdition$=this.sectorForPropertyEditionChanged.asObservable(),this.canvasClickedSub=new P,this.canvasClicked$=this.canvasClickedSub.asObservable()}emitEditedSectorContour(e){this.sectorForContourEditionChanged.next(e)}emitEditedSectorProperty(e){this.sectorForPropertyEditionChanged.next(e)}emitSectorListChanged(e){this.sectorListChanged.next(e)}emitCanvasClicked(e){this.canvasClickedSub.next(e)}static createNewSector(){return{id:crypto.randomUUID(),name:"",color:pe({h:lt.nextFloat(0,360),s:75,v:95}).hex(),vertices:[],properties:{sectionMaxArea:5,sectionMinAngle:35,maxTileRadius:4,minTileRadius:0,tilesMargin:.1,evaluationParams:{singleSectionPopulation:2,overlappingAreaOutsideSector:-2,additionalPopulationOfNeighboringSectors:4,overlappingNotPopulatedSections:-1,tileColorMismatch:-2},populationParams:{initialPopulationSize:100,countOfTriesToInsertTile:30,countOfTrianglePositionDraws:30,countOfColorMatchingAttempts:40,iterationsCount:100,populationSize:10}}}}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var bl=10,Cl=10,wn=class extends vt{constructor(i,e,t,n=100){super(),this.vertices=i,this.selectedIndex=e,this.hexColor=t,this.order=n}drawObject(i,e){if(this.vertices.length>=2){let t=bl*e.scaleFactor;i.lineWidth=t,i.strokeStyle=this.hexColor,i.setLineDash([t]),i.beginPath(),i.globalAlpha=.25;let n=e.getViewportPosition(this.vertices.at(-1));i.moveTo(n.x,n.y),n=e.getViewportPosition(this.vertices[0]),i.lineTo(n.x,n.y),i.stroke(),i.globalAlpha=.7,i.setLineDash([]),i.beginPath(),i.moveTo(n.x,n.y);for(let r=1;r<this.vertices.length;++r)n=e.getViewportPosition(this.vertices[r]),i.lineTo(n.x,n.y);i.stroke()}i.lineWidth=1,i.globalAlpha=1,this.selectedIndex!==-1&&this.drawPoint(i,e,this.vertices[this.selectedIndex])}drawPoint(i,e,t){let n=e.getViewportPosition(t);i.beginPath();let r=Cl*e.scaleFactor;i.arc(n.x,n.y,r,0,2*Math.PI),i.fillStyle=this.hexColor,i.fill()}getOrder(){return this.order}};function yl(o){let i=o.length,e=5381,t=52711,n;for(;i--;)n=o.charCodeAt(i),e=e*33^n,t=t*33^n;return(e>>>0)*4096+(t>>>0)}var Mi="|",Sl=/\[object ([HTML|SVG](.*)Element)\]/,wl={"[object Arguments]":0,"[object Array]":1,"[object ArrayBuffer]":2,"[object AsyncFunction]":3,"[object AsyncGeneratorFunction]":4,"[object BigInt]":5,"[object BigInt64Array]":6,"[object BigUint64Array]":7,"[object Boolean]":8,"[object DataView]":9,"[object Date]":10,"[object DocumentFragment]":11,"[object Error]":12,"[object Event]":13,"[object Float32Array]":14,"[object Float64Array]":15,"[object Function]":16,"[object Generator]":17,"[object GeneratorFunction]":18,"[object Int8Array]":19,"[object Int16Array]":20,"[object Map]":21,"[object Number]":22,"[object Object]":23,"[object Promise]":24,"[object RegExp]":25,"[object Set]":26,"[object SharedArrayBuffer]":27,"[object String]":28,"[object Uint8Array]":29,"[object Uint8ClampedArray]":30,"[object Uint16Array]":31,"[object Uint32Array]":32,"[object WeakMap]":33,"[object WeakRef]":34,"[object WeakSet]":35,CUSTOM:36,ELEMENT:37},xl={"[object Arguments]":1,"[object Array]":2},Ms={"[object Generator]":1,"[object Promise]":2,"[object WeakMap]":3,"[object WeakRef]":4,"[object WeakSet]":5},Pl={"[object AsyncFunction]":1,"[object AsyncGeneratorFunction]":2,"[object Boolean]":3,"[object Function]":4,"[object GeneratorFunction]":5,"[object Number]":6,"[object String]":7},Ml={"[object BigInt64Array]":1,"[object BigUint64Array]":2,"[object Float32Array]":3,"[object Float64Array]":4,"[object Int8Array]":5,"[object Int16Array]":6,"[object Uint8Array]":7,"[object Uint8ClampedArray]":8,"[object Uint16Array]":9,"[object Uint32Array]":10},El={"[object Arguments]":1,"[object Array]":2,"[object ArrayBuffer]":3,"[object BigInt64Array]":4,"[object BigUint64Array]":5,"[object DataView]":6,"[object Float32Array]":7,"[object Float64Array]":8,"[object Int8Array]":9,"[object Int16Array]":10,"[object Map]":11,"[object Object]":12,"[object Set]":13,"[object SharedArrayBuffer]":14,"[object Uint8Array]":15,"[object Uint8ClampedArray]":16,"[object Uint16Array]":17,"[object Uint32Array]":18,CUSTOM:19},Pi={bigint:"i",boolean:"b",empty:"e",function:"g",number:"n",object:"o",string:"s",symbol:"s"};function he(o,i){return Pi.object+Mi+wl[o]+Mi+i}var Ss=new WeakMap,Dl=0;function So(o,i){let e=Ss.get(o);if(e)return e;let t=he(i,"NOT_ENUMERABLE"+Mi+Dl++);return Ss.set(o,t),t}function Ol(o,i){return o[0]>i[0]}function Es(o,i){return o>i}function wo(o,i){let e,t;for(let n=0;n<o.length;++n){for(t=o[n],e=n-1;~e&&i(o[e],t);--e)o[e+1]=o[e];o[e+1]=t}return o}var Tl=Object.prototype.toString;function kl(o,i,e){if(El[i])return ws(i,o,e);if(i==="[object Date]")return he(i,o.getTime());if(i==="[object RegExp]")return he(i,o.toString());if(i==="[object Event]")return he(i,[o.bubbles,o.cancelBubble,o.cancelable,o.composed,o.currentTarget,o.defaultPrevented,o.eventPhase,o.isTrusted,o.returnValue,o.target,o.type].join());if(i==="[object Error]")return he(i,o.message+Mi+o.stack);if(i==="[object DocumentFragment]")return he(i,Fl(o));let t=i.match(Sl);return t?he("ELEMENT",t[1]+Mi+o.outerHTML):Ms[i]?So(o,i):Pl[i]?he(i,o.toString()):ws("CUSTOM",o,e)}function ws(o,i,e){let t=e.cache.get(i);return t?he(o,"RECURSIVE~"+t):(e.cache.set(i,++e.id),o==="[object Object]"?i[Symbol.iterator]?So(i,o):he(o,Ps(i,e)):xl[o]?he(o,Il(i,e)):o==="[object Map]"?he(o,Vl(i,e)):o==="[object Set]"?he(o,Nl(i,e)):Ml[o]?he(o,i.join()):o==="[object ArrayBuffer]"?he(o,xs(i)):o==="[object DataView]"?he(o,xs(i.buffer)):Ms[o]?So(i,o):he("CUSTOM",Ps(i,e)))}function Il(o,i){let e=o.length,t=new Array(e);for(;--e>=0;)t[e]=si(o[e],i);return t.join()}function Rl(o){return Buffer.from(o).toString("utf8")}function Al(o){return String.fromCharCode.apply(null,new Uint16Array(o))}function Ll(){return"UNSUPPORTED"}function Fl(o){let i=o.children,e=i.length,t=new Array(e);for(;--e>=0;)t[e]=i[e].outerHTML;return t.join()}var xs=typeof Buffer<"u"&&typeof Buffer.from=="function"?Rl:typeof Uint16Array=="function"?Al:Ll;function Vl(o,i){let e=new Array(o.size),t=0;for(o.forEach((n,r)=>{e[t++]=[si(r,i),si(n,i)]}),wo(e,Ol);--t>=0;)e[t]="["+e[t][0]+","+e[t][1]+"]";return"["+e.join()+"]"}function Ps(o,i){let e=wo(Object.getOwnPropertyNames(o),Es),t=e.length,n=new Array(t),r=t;for(;--r>=0;)n[r]=e[r]+":"+si(o[e[r]],i);return"{"+n.join()+"}"}function Nl(o,i){let e=new Array(o.size),t=0;return o.forEach(n=>{e[t++]=si(n,i)}),"["+wo(e,Es).join()+"]"}function si(o,i){let e=typeof o;return o==null||e==="undefined"?Pi.empty+o:e==="object"?kl(o,Tl.call(o),i||{cache:new WeakMap,id:1}):e==="function"||e==="symbol"?Pi[e]+o.toString():e==="boolean"?Pi.boolean+ +o:Pi[e]+o}function Ds(o){return yl(si(o,void 0))}var dt=class{constructor(i,e){this.start=i,this.end=e}hash(){return Ds(this)}};var ai=class o extends vt{constructor(i,e,t,n=100){super(),this.hexColor=t,this.order=n,this.borderThickness=8,this.innerThickness=3,this.outerContour=e,this.innerLines=o.getLines(i)}drawObject(i,e){this.outerContour.length<3||(i.strokeStyle=this.hexColor,this.drawTriangulationMesh(i,e),this.drawBorder(i,e),i.lineWidth=1)}drawBorder(i,e){i.lineWidth=this.borderThickness*e.scaleFactor;let t=e.getViewportPosition(this.outerContour[0]);i.beginPath(),i.moveTo(t.x,t.y);for(let n=1;n<this.outerContour.length;++n)t=e.getViewportPosition(this.outerContour[n]),i.lineTo(t.x,t.y);i.closePath(),i.stroke(),i.globalAlpha=.25,i.fillStyle=this.hexColor,i.fill(),i.globalAlpha=1}drawTriangulationMesh(i,e){i.lineWidth=this.innerThickness*e.scaleFactor,i.globalAlpha=.3;for(let t of this.innerLines){i.beginPath();let n=e.getViewportPosition(t.start);i.moveTo(n.x,n.y);let r=e.getViewportPosition(t.end);i.lineTo(r.x,r.y),i.stroke()}i.globalAlpha=1}static getLines(i){let e=this.collectMeshLines(i),t=[];for(let n of e.values())n.count===2&&t.push(n.line);return t}getOrder(){return this.order}static collectMeshLines(i){let e=new Map;for(let t of i){let n=t.getVertices(),r=n.at(-1);for(let s=0;s<3;++s){let a=n[s],d=r.sqrMagnitude()<a.sqrMagnitude()?[r,a]:[a,r],g=new dt(d[0],d[1]),b=g.hash(),z=e.get(b);z?z.count++:e.set(b,{line:g,count:1}),r=a}}return e}};var li=class extends vt{constructor(i,e,t=10,n=8){super(),this.vertices=i,this.hexColor=e,this.order=t,this.baseLineThickness=n}drawObject(i,e){if(this.vertices.length<3)return;i.beginPath();let t=e.getViewportPosition(this.vertices[0]);i.moveTo(t.x,t.y);for(let n=1;n<this.vertices.length;++n)t=e.getViewportPosition(this.vertices[n]),i.lineTo(t.x,t.y);i.lineWidth=this.baseLineThickness*e.scaleFactor,i.strokeStyle=this.hexColor,i.closePath(),i.globalAlpha=.25,i.fillStyle=this.hexColor,i.fill(),i.globalAlpha=1,i.stroke(),i.lineWidth=1}getOrder(){return this.order}};var Os=(()=>{class o{constructor(){this.store=c(A),this.service=c(ct),this.destroyRef=c(Y),this.toolService=c(_e),this.sectorForContourEdition=ho(this.service.sectorForContourEdition$,{requireSync:!0}),this.sectorForPropertyEdition=ho(this.service.sectorForPropertyEdition$,{requireSync:!0}),this.visualElements=[],this.ribbonActions=[{iconName:"crop",visibility:O("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")},{iconName:"recenter",visibility:O("on"),onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}}]}ngOnInit(){this.service.emitEditedSectorContour(null),this.service.emitEditedSectorProperty(null)}ngAfterViewInit(){this.subscribeOnEditedSectorChange(),this.subscribeOnEditedSectorPropertiesChange(),this.subscribeOnSectorListChange(),Lr(this.activeCanvas.clicked).pipe(Q(this.destroyRef)).subscribe(e=>this.service.emitCanvasClicked(e))}subscribeOnEditedSectorChange(){this.service.sectorForContourEdition$.pipe(Q(this.destroyRef)).subscribe(e=>this.onEditedSectorChanged(e))}subscribeOnEditedSectorPropertiesChange(){this.service.sectorForPropertyEdition$.pipe(Q(this.destroyRef)).subscribe(()=>this.redrawSectors())}subscribeOnSectorListChange(){this.service.sectorListChange$.pipe(Q(this.destroyRef)).subscribe(()=>this.redrawSectors())}onEditedSectorChanged(e){this.activeCanvas.options.update(t=>ae(M({},t),{isMovable:!e})),this.redrawSectors()}redrawSectors(){this.visualElements.forEach(e=>e.removeObject()),this.visualElements=this.prepareSectorsContours();for(let e of this.visualElements)this.activeCanvas.addCanvasObject(e);this.activeCanvas.redraw()}prepareSectorsContours(){let e=this.sectorForContourEdition(),t=this.sectorForPropertyEdition(),n,r=this.store.selectSignal(fe)();return e?r=Kr.addOrUpdate([...r],e.sector,s=>s.id===e.sector.id):this.service.sectorListChange$.pipe(Wo()).subscribe(s=>{n=s?.selectedSector}),this.mapSectorsToContours(r,e,t,n)}mapSectorsToContours(e,t,n,r){return e.map((s,a)=>{if(s.id===t?.sector.id)return new wn([...t.sector.vertices],t.sector.vertices.indexOf(t.selectedVertex),t.sector.color);if(n?.mesh&&s.id===n?.sector.id){let d=n.mesh,g=n.contour;return new ai(d,g,n.sector.color)}else{let d=s.id===r?.id?10:8;return new li([...s.vertices],s.color,10+a,d)}})}sectionEntered(e,t){this.activeCanvas=e;let n=this.store.selectSignal(Qe)();return queueMicrotask(async()=>{this.imageObject=await _e.createImageObject(n),this.activeCanvas.addCanvasObject(this.imageObject),t&&this.focusOnImage(),this.activeCanvas.redraw()}),{ribbon:this.ribbonActions}}focusOnImage(){let e=_e.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sectors"]],decls:1,vars:0,template:function(t,n){t&1&&w(0,"router-outlet")},dependencies:[Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var ve=class extends Error{constructor(i,e){let t=new.target.prototype;super(`${i}: Status code '${e}'`),this.statusCode=e,this.__proto__=t}},xt=class extends Error{constructor(i="A timeout occurred."){let e=new.target.prototype;super(i),this.__proto__=e}},ce=class extends Error{constructor(i="An abort occurred."){let e=new.target.prototype;super(i),this.__proto__=e}},xn=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=t}},Pn=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=t}},Mn=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=t}},Ei=class extends Error{constructor(i){let e=new.target.prototype;super(i),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}},En=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.innerErrors=e,this.__proto__=t}};var ci=class{constructor(i,e,t){this.statusCode=i,this.statusText=e,this.content=t}},nt=class{get(i,e){return this.send(ae(M({},e),{method:"GET",url:i}))}post(i,e){return this.send(ae(M({},e),{method:"POST",url:i}))}delete(i,e){return this.send(ae(M({},e),{method:"DELETE",url:i}))}getCookieString(i){return""}};var u=(function(o){return o[o.Trace=0]="Trace",o[o.Debug=1]="Debug",o[o.Information=2]="Information",o[o.Warning=3]="Warning",o[o.Error=4]="Error",o[o.Critical=5]="Critical",o[o.None=6]="None",o})(u||{});var ot=class{constructor(){}log(i,e){}};ot.instance=new ot;var Ts="10.0.0";var N=class{static isRequired(i,e){if(i==null)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(i,e){if(!i||i.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(i,e,t){if(!(i in e))throw new Error(`Unknown ${t} value: ${i}.`)}},H=class o{static get isBrowser(){return!o.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!o.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!o.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};function Pt(o,i){let e="";return je(o)?(e=`Binary data of length ${o.byteLength}`,i&&(e+=`. Content: '${jl(o)}'`)):typeof o=="string"&&(e=`String data of length ${o.length}`,i&&(e+=`. Content: '${o}'`)),e}function jl(o){let i=new Uint8Array(o),e="";return i.forEach(t=>{let n=t<16?"0":"";e+=`0x${n}${t.toString(16)} `}),e.substring(0,e.length-1)}function je(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}async function On(o,i,e,t,n,r){let s={},[a,d]=rt();s[a]=d,o.log(u.Trace,`(${i} transport) sending data. ${Pt(n,r.logMessageContent)}.`);let g=je(n)?"arraybuffer":"text",b=await e.post(t,{content:n,headers:M(M({},s),r.headers),responseType:g,timeout:r.timeout,withCredentials:r.withCredentials});o.log(u.Trace,`(${i} transport) request complete. Response status: ${b.statusCode}.`)}function ks(o){return o===void 0?new At(u.Information):o===null?ot.instance:o.log!==void 0?o:new At(o)}var Dn=class{constructor(i,e){this._subject=i,this._observer=e}dispose(){let i=this._subject.observers.indexOf(this._observer);i>-1&&this._subject.observers.splice(i,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}},At=class{constructor(i){this._minLevel=i,this.out=console}log(i,e){if(i>=this._minLevel){let t=`[${new Date().toISOString()}] ${u[i]}: ${e}`;switch(i){case u.Critical:case u.Error:this.out.error(t);break;case u.Warning:this.out.warn(t);break;case u.Information:this.out.info(t);break;default:this.out.log(t);break}}}};function rt(){let o="X-SignalR-User-Agent";return H.isNode&&(o="User-Agent"),[o,Bl(Ts,Hl(),$l(),zl())]}function Bl(o,i,e,t){let n="Microsoft SignalR/",r=o.split(".");return n+=`${r[0]}.${r[1]}`,n+=` (${o}; `,i&&i!==""?n+=`${i}; `:n+="Unknown OS; ",n+=`${e}`,t?n+=`; ${t}`:n+="; Unknown Runtime Version",n+=")",n}function Hl(){if(H.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function zl(){if(H.isNode)return process.versions.node}function $l(){return H.isNode?"NodeJS":"Browser"}function Tn(o){return o.stack?o.stack:o.message?o.message:`${o}`}function Is(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var kn=class extends nt{constructor(i){if(super(),this._logger=i,typeof fetch>"u"||H.isNode){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;this._jar=new(e("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Is());if(typeof AbortController>"u"){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(i){if(i.abortSignal&&i.abortSignal.aborted)throw new ce;if(!i.method)throw new Error("No method defined.");if(!i.url)throw new Error("No url defined.");let e=new this._abortControllerType,t;i.abortSignal&&(i.abortSignal.onabort=()=>{e.abort(),t=new ce});let n=null;if(i.timeout){let d=i.timeout;n=setTimeout(()=>{e.abort(),this._logger.log(u.Warning,"Timeout from HTTP request."),t=new xt},d)}i.content===""&&(i.content=void 0),i.content&&(i.headers=i.headers||{},je(i.content)?i.headers["Content-Type"]="application/octet-stream":i.headers["Content-Type"]="text/plain;charset=UTF-8");let r;try{r=await this._fetchType(i.url,{body:i.content,cache:"no-cache",credentials:i.withCredentials===!0?"include":"same-origin",headers:M({"X-Requested-With":"XMLHttpRequest"},i.headers),method:i.method,mode:"cors",redirect:"follow",signal:e.signal})}catch(d){throw t||(this._logger.log(u.Warning,`Error from HTTP request. ${d}.`),d)}finally{n&&clearTimeout(n),i.abortSignal&&(i.abortSignal.onabort=null)}if(!r.ok){let d=await Rs(r,"text");throw new ve(d||r.statusText,r.status)}let a=await Rs(r,i.responseType);return new ci(r.status,r.statusText,a)}getCookieString(i){let e="";return H.isNode&&this._jar&&this._jar.getCookies(i,(t,n)=>e=n.join("; ")),e}};function Rs(o,i){let e;switch(i){case"arraybuffer":e=o.arrayBuffer();break;case"text":e=o.text();break;case"blob":case"document":case"json":throw new Error(`${i} is not supported.`);default:e=o.text();break}return e}var In=class extends nt{constructor(i){super(),this._logger=i}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new ce):i.method?i.url?new Promise((e,t)=>{let n=new XMLHttpRequest;n.open(i.method,i.url,!0),n.withCredentials=i.withCredentials===void 0?!0:i.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.content===""&&(i.content=void 0),i.content&&(je(i.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let r=i.headers;r&&Object.keys(r).forEach(s=>{n.setRequestHeader(s,r[s])}),i.responseType&&(n.responseType=i.responseType),i.abortSignal&&(i.abortSignal.onabort=()=>{n.abort(),t(new ce)}),i.timeout&&(n.timeout=i.timeout),n.onload=()=>{i.abortSignal&&(i.abortSignal.onabort=null),n.status>=200&&n.status<300?e(new ci(n.status,n.statusText,n.response||n.responseText)):t(new ve(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(u.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),t(new ve(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(u.Warning,"Timeout from HTTP request."),t(new xt)},n.send(i.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var Rn=class extends nt{constructor(i){if(super(),typeof fetch<"u"||H.isNode)this._httpClient=new kn(i);else if(typeof XMLHttpRequest<"u")this._httpClient=new In(i);else throw new Error("No usable HttpClient found.")}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new ce):i.method?i.url?this._httpClient.send(i):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(i){return this._httpClient.getCookieString(i)}};var be=class o{static write(i){return`${i}${o.RecordSeparator}`}static parse(i){if(i[i.length-1]!==o.RecordSeparator)throw new Error("Message is incomplete.");let e=i.split(o.RecordSeparator);return e.pop(),e}};be.RecordSeparatorCode=30;be.RecordSeparator=String.fromCharCode(be.RecordSeparatorCode);var An=class{writeHandshakeRequest(i){return be.write(JSON.stringify(i))}parseHandshakeResponse(i){let e,t;if(je(i)){let a=new Uint8Array(i),d=a.indexOf(be.RecordSeparatorCode);if(d===-1)throw new Error("Message is incomplete.");let g=d+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,g))),t=a.byteLength>g?a.slice(g).buffer:null}else{let a=i,d=a.indexOf(be.RecordSeparator);if(d===-1)throw new Error("Message is incomplete.");let g=d+1;e=a.substring(0,g),t=a.length>g?a.substring(g):null}let n=be.parse(e),r=JSON.parse(n[0]);if(r.type)throw new Error("Expected a handshake response from the server.");return[t,r]}};var E=(function(o){return o[o.Invocation=1]="Invocation",o[o.StreamItem=2]="StreamItem",o[o.Completion=3]="Completion",o[o.StreamInvocation=4]="StreamInvocation",o[o.CancelInvocation=5]="CancelInvocation",o[o.Ping=6]="Ping",o[o.Close=7]="Close",o[o.Ack=8]="Ack",o[o.Sequence=9]="Sequence",o})(E||{});var Ln=class{constructor(){this.observers=[]}next(i){for(let e of this.observers)e.next(i)}error(i){for(let e of this.observers)e.error&&e.error(i)}complete(){for(let i of this.observers)i.complete&&i.complete()}subscribe(i){return this.observers.push(i),new Dn(this,i)}};var Fn=class{constructor(i,e,t){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=i,this._connection=e,this._bufferSize=t}async _send(i){let e=this._protocol.writeMessage(i),t=Promise.resolve();if(this._isInvocationMessage(i)){this._totalMessageCount++;let n=()=>{},r=()=>{};je(e)?this._bufferedByteCount+=e.byteLength:this._bufferedByteCount+=e.length,this._bufferedByteCount>=this._bufferSize&&(t=new Promise((s,a)=>{n=s,r=a})),this._messages.push(new xo(e,this._totalMessageCount,n,r))}try{this._reconnectInProgress||await this._connection.send(e)}catch{this._disconnected()}await t}_ack(i){let e=-1;for(let t=0;t<this._messages.length;t++){let n=this._messages[t];if(n._id<=i.sequenceId)e=t,je(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else if(this._bufferedByteCount<this._bufferSize)n._resolver();else break}e!==-1&&(this._messages=this._messages.slice(e+1))}_shouldProcessMessage(i){if(this._waitForSequenceMessage)return i.type!==E.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(i))return!0;let e=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,e<=this._latestReceivedSequenceId?(e===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=e,this._ackTimer(),!0)}_resetSequence(i){if(i.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=i.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){let i=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:E.Sequence,sequenceId:i}));let e=this._messages;for(let t of e)await this._connection.send(t._message);this._reconnectInProgress=!1}_dispose(i){i??(i=new Error("Unable to reconnect to server."));for(let e of this._messages)e._rejector(i)}_isInvocationMessage(i){switch(i.type){case E.Invocation:case E.StreamItem:case E.Completion:case E.StreamInvocation:case E.CancelInvocation:return!0;case E.Close:case E.Sequence:case E.Ping:case E.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:E.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}},xo=class{constructor(i,e,t,n){this._message=i,this._id=e,this._resolver=t,this._rejector=n}};var Ul=30*1e3,Wl=15*1e3,ql=1e5,X=(function(o){return o.Disconnected="Disconnected",o.Connecting="Connecting",o.Connected="Connected",o.Disconnecting="Disconnecting",o.Reconnecting="Reconnecting",o})(X||{}),Vn=class o{static create(i,e,t,n,r,s,a){return new o(i,e,t,n,r,s,a)}constructor(i,e,t,n,r,s,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(u.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},N.isRequired(i,"connection"),N.isRequired(e,"logger"),N.isRequired(t,"protocol"),this.serverTimeoutInMilliseconds=r??Ul,this.keepAliveIntervalInMilliseconds=s??Wl,this._statefulReconnectBufferSize=a??ql,this._logger=e,this._protocol=t,this.connection=i,this._reconnectPolicy=n,this._handshakeProtocol=new An,this.connection.onreceive=d=>this._processIncomingData(d),this.connection.onclose=d=>this._connectionClosed(d),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=X.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:E.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(i){if(this._connectionState!==X.Disconnected&&this._connectionState!==X.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!i)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=i}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==X.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=X.Connecting,this._logger.log(u.Debug,"Starting HubConnection.");try{await this._startInternal(),H.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=X.Connected,this._connectionStarted=!0,this._logger.log(u.Debug,"HubConnection connected successfully.")}catch(i){return this._connectionState=X.Disconnected,this._logger.log(u.Debug,`HubConnection failed to start successfully because of error '${i}'.`),Promise.reject(i)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let i=new Promise((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t});await this.connection.start(this._protocol.transferFormat);try{let e=this._protocol.version;this.connection.features.reconnect||(e=1);let t={protocol:this._protocol.name,version:e};if(this._logger.log(u.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(u.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await i,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new Fn(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(u.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){let i=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await i}catch{}}_stopInternal(i){if(this._connectionState===X.Disconnected)return this._logger.log(u.Debug,`Call to HubConnection.stop(${i}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===X.Disconnecting)return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let e=this._connectionState;return this._connectionState=X.Disconnecting,this._logger.log(u.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(u.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(e===X.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=i||new ce("The connection was stopped before the hub handshake could complete."),this.connection.stop(i))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(i,...e){let[t,n]=this._replaceStreamingParams(e),r=this._createStreamInvocation(i,e,n),s,a=new Ln;return a.cancelCallback=()=>{let d=this._createCancelInvocation(r.invocationId);return delete this._callbacks[r.invocationId],s.then(()=>this._sendWithProtocol(d))},this._callbacks[r.invocationId]=(d,g)=>{if(g){a.error(g);return}else d&&(d.type===E.Completion?d.error?a.error(new Error(d.error)):a.complete():a.next(d.item))},s=this._sendWithProtocol(r).catch(d=>{a.error(d),delete this._callbacks[r.invocationId]}),this._launchStreams(t,s),a}_sendMessage(i){return this._resetKeepAliveInterval(),this.connection.send(i)}_sendWithProtocol(i){return this._messageBuffer?this._messageBuffer._send(i):this._sendMessage(this._protocol.writeMessage(i))}send(i,...e){let[t,n]=this._replaceStreamingParams(e),r=this._sendWithProtocol(this._createInvocation(i,e,!0,n));return this._launchStreams(t,r),r}invoke(i,...e){let[t,n]=this._replaceStreamingParams(e),r=this._createInvocation(i,e,!1,n);return new Promise((a,d)=>{this._callbacks[r.invocationId]=(b,z)=>{if(z){d(z);return}else b&&(b.type===E.Completion?b.error?d(new Error(b.error)):a(b.result):d(new Error(`Unexpected message type: ${b.type}`)))};let g=this._sendWithProtocol(r).catch(b=>{d(b),delete this._callbacks[r.invocationId]});this._launchStreams(t,g)})}on(i,e){!i||!e||(i=i.toLowerCase(),this._methods[i]||(this._methods[i]=[]),this._methods[i].indexOf(e)===-1&&this._methods[i].push(e))}off(i,e){if(!i)return;i=i.toLowerCase();let t=this._methods[i];if(t)if(e){let n=t.indexOf(e);n!==-1&&(t.splice(n,1),t.length===0&&delete this._methods[i])}else delete this._methods[i]}onclose(i){i&&this._closedCallbacks.push(i)}onreconnecting(i){i&&this._reconnectingCallbacks.push(i)}onreconnected(i){i&&this._reconnectedCallbacks.push(i)}_processIncomingData(i){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(i=this._processHandshakeResponse(i),this._receivedHandshakeResponse=!0),i){let e=this._protocol.parseMessages(i,this._logger);for(let t of e)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(t)))switch(t.type){case E.Invocation:this._invokeClientMethod(t).catch(n=>{this._logger.log(u.Error,`Invoke client method threw error: ${Tn(n)}`)});break;case E.StreamItem:case E.Completion:{let n=this._callbacks[t.invocationId];if(n){t.type===E.Completion&&delete this._callbacks[t.invocationId];try{n(t)}catch(r){this._logger.log(u.Error,`Stream callback threw error: ${Tn(r)}`)}}break}case E.Ping:break;case E.Close:{this._logger.log(u.Information,"Close message received from server.");let n=t.error?new Error("Server returned an error on close: "+t.error):void 0;t.allowReconnect===!0?this.connection.stop(n):this._stopPromise=this._stopInternal(n);break}case E.Ack:this._messageBuffer&&this._messageBuffer._ack(t);break;case E.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(t);break;default:this._logger.log(u.Warning,`Invalid message type: ${t.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(i){let e,t;try{[t,e]=this._handshakeProtocol.parseHandshakeResponse(i)}catch(n){let r="Error parsing handshake response: "+n;this._logger.log(u.Error,r);let s=new Error(r);throw this._handshakeRejecter(s),s}if(e.error){let n="Server returned handshake error: "+e.error;this._logger.log(u.Error,n);let r=new Error(n);throw this._handshakeRejecter(r),r}else this._logger.log(u.Debug,"Server handshake complete.");return this._handshakeResolver(),t}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds);let i=this._nextKeepAlive-new Date().getTime();if(i<0){this._connectionState===X.Connected&&this._trySendPingMessage();return}this._pingServerHandle===void 0&&(i<0&&(i=0),this._pingServerHandle=setTimeout(async()=>{this._connectionState===X.Connected&&await this._trySendPingMessage()},i))}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(i){let e=i.target.toLowerCase(),t=this._methods[e];if(!t){this._logger.log(u.Warning,`No client method with the name '${e}' found.`),i.invocationId&&(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${i.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)));return}let n=t.slice(),r=!!i.invocationId,s,a,d;for(let g of n)try{let b=s;s=await g.apply(this,i.arguments),r&&s&&b&&(this._logger.log(u.Error,`Multiple results provided for '${e}'. Sending error to server.`),d=this._createCompletionMessage(i.invocationId,"Client provided multiple results.",null)),a=void 0}catch(b){a=b,this._logger.log(u.Error,`A callback for the method '${e}' threw error '${b}'.`)}d?await this._sendWithProtocol(d):r?(a?d=this._createCompletionMessage(i.invocationId,`${a}`,null):s!==void 0?d=this._createCompletionMessage(i.invocationId,null,s):(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${i.invocationId}'.`),d=this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(d)):s&&this._logger.log(u.Error,`Result given for '${e}' method but server is not expecting a result.`)}_connectionClosed(i){this._logger.log(u.Debug,`HubConnection.connectionClosed(${i}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||i||new ce("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(i||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===X.Disconnecting?this._completeClose(i):this._connectionState===X.Connected&&this._reconnectPolicy?this._reconnect(i):this._connectionState===X.Connected&&this._completeClose(i)}_completeClose(i){if(this._connectionStarted){this._connectionState=X.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(i??new Error("Connection closed.")),this._messageBuffer=void 0),H.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(e=>e.apply(this,[i]))}catch(e){this._logger.log(u.Error,`An onclose callback called with error '${i}' threw error '${e}'.`)}}}async _reconnect(i){let e=Date.now(),t=0,n=i!==void 0?i:new Error("Attempting to reconnect due to a unknown error."),r=this._getNextRetryDelay(t,0,n);if(r===null){this._logger.log(u.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(i);return}if(this._connectionState=X.Reconnecting,i?this._logger.log(u.Information,`Connection reconnecting because of error '${i}'.`):this._logger.log(u.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[i]))}catch(s){this._logger.log(u.Error,`An onreconnecting callback called with error '${i}' threw error '${s}'.`)}if(this._connectionState!==X.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;r!==null;){if(this._logger.log(u.Information,`Reconnect attempt number ${t+1} will start in ${r} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,r)}),this._reconnectDelayHandle=void 0,this._connectionState!==X.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=X.Connected,this._logger.log(u.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(u.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(u.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==X.Reconnecting){this._logger.log(u.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===X.Disconnecting&&this._completeClose();return}t++,n=s instanceof Error?s:new Error(s.toString()),r=this._getNextRetryDelay(t,Date.now()-e,n)}}this._logger.log(u.Information,`Reconnect retries have been exhausted after ${Date.now()-e} ms and ${t} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(i,e,t){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:i,retryReason:t})}catch(n){return this._logger.log(u.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${i}, ${e}) threw error '${n}'.`),null}}_cancelCallbacksWithError(i){let e=this._callbacks;this._callbacks={},Object.keys(e).forEach(t=>{let n=e[t];try{n(null,i)}catch(r){this._logger.log(u.Error,`Stream 'error' callback called with '${i}' threw error: ${Tn(r)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(i,e,t,n){if(t)return n.length!==0?{target:i,arguments:e,streamIds:n,type:E.Invocation}:{target:i,arguments:e,type:E.Invocation};{let r=this._invocationId;return this._invocationId++,n.length!==0?{target:i,arguments:e,invocationId:r.toString(),streamIds:n,type:E.Invocation}:{target:i,arguments:e,invocationId:r.toString(),type:E.Invocation}}}_launchStreams(i,e){if(i.length!==0){e||(e=Promise.resolve());for(let t in i)i[t].subscribe({complete:()=>{e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(t)))},error:n=>{let r;n instanceof Error?r=n.message:n&&n.toString?r=n.toString():r="Unknown error",e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(t,r)))},next:n=>{e=e.then(()=>this._sendWithProtocol(this._createStreamItemMessage(t,n)))}})}}_replaceStreamingParams(i){let e=[],t=[];for(let n=0;n<i.length;n++){let r=i[n];if(this._isObservable(r)){let s=this._invocationId;this._invocationId++,e[s]=r,t.push(s.toString()),i.splice(n,1)}}return[e,t]}_isObservable(i){return i&&i.subscribe&&typeof i.subscribe=="function"}_createStreamInvocation(i,e,t){let n=this._invocationId;return this._invocationId++,t.length!==0?{target:i,arguments:e,invocationId:n.toString(),streamIds:t,type:E.StreamInvocation}:{target:i,arguments:e,invocationId:n.toString(),type:E.StreamInvocation}}_createCancelInvocation(i){return{invocationId:i,type:E.CancelInvocation}}_createStreamItemMessage(i,e){return{invocationId:i,item:e,type:E.StreamItem}}_createCompletionMessage(i,e,t){return e?{error:e,invocationId:i,type:E.Completion}:{invocationId:i,result:t,type:E.Completion}}_createCloseMessage(){return{type:E.Close}}async _trySendPingMessage(){try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}};var Gl=[0,2e3,1e4,3e4,null],Di=class{constructor(i){this._retryDelays=i!==void 0?[...i,null]:Gl}nextRetryDelayInMilliseconds(i){return this._retryDelays[i.previousRetryCount]}};var Lt=(()=>{class o{}return o.Authorization="Authorization",o.Cookie="Cookie",o})();var Nn=class extends nt{constructor(i,e){super(),this._innerClient=i,this._accessTokenFactory=e}async send(i){let e=!0;this._accessTokenFactory&&(!this._accessToken||i.url&&i.url.indexOf("/negotiate?")>0)&&(e=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(i);let t=await this._innerClient.send(i);return e&&t.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(i),await this._innerClient.send(i)):t}_setAuthorizationHeader(i){i.headers||(i.headers={}),this._accessToken?i.headers[Lt.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&i.headers[Lt.Authorization]&&delete i.headers[Lt.Authorization]}getCookieString(i){return this._innerClient.getCookieString(i)}};var ie=(function(o){return o[o.None=0]="None",o[o.WebSockets=1]="WebSockets",o[o.ServerSentEvents=2]="ServerSentEvents",o[o.LongPolling=4]="LongPolling",o})(ie||{}),oe=(function(o){return o[o.Text=1]="Text",o[o.Binary=2]="Binary",o})(oe||{});var jn=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var Oi=class{get pollAborted(){return this._pollAbort.aborted}constructor(i,e,t){this._httpClient=i,this._logger=e,this._pollAbort=new jn,this._options=t,this._running=!1,this.onreceive=null,this.onclose=null}async connect(i,e){if(N.isRequired(i,"url"),N.isRequired(e,"transferFormat"),N.isIn(e,oe,"transferFormat"),this._url=i,this._logger.log(u.Trace,"(LongPolling transport) Connecting."),e===oe.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[t,n]=rt(),r=M({[t]:n},this._options.headers),s={abortSignal:this._pollAbort.signal,headers:r,timeout:1e5,withCredentials:this._options.withCredentials};e===oe.Binary&&(s.responseType="arraybuffer");let a=`${i}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${a}.`);let d=await this._httpClient.get(a,s);d.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),this._closeError=new ve(d.statusText||"",d.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(i,e){try{for(;this._running;)try{let t=`${i}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${t}.`);let n=await this._httpClient.get(t,e);n.statusCode===204?(this._logger.log(u.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):n.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new ve(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(u.Trace,`(LongPolling transport) data received. ${Pt(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(t){this._running?t instanceof xt?this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=t,this._running=!1):this._logger.log(u.Trace,`(LongPolling transport) Poll errored after shutdown: ${t.message}`)}}finally{this._logger.log(u.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(i){return this._running?On(this._logger,"LongPolling",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(u.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(u.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let i={},[e,t]=rt();i[e]=t;let n={headers:M(M({},i),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials},r;try{await this._httpClient.delete(this._url,n)}catch(s){r=s}r?r instanceof ve&&(r.statusCode===404?this._logger.log(u.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(u.Trace,`(LongPolling transport) Error sending a DELETE request: ${r}`)):this._logger.log(u.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(u.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let i="(LongPolling transport) Firing onclose event.";this._closeError&&(i+=" Error: "+this._closeError),this._logger.log(u.Trace,i),this.onclose(this._closeError)}}};var Bn=class{constructor(i,e,t,n){this._httpClient=i,this._accessToken=e,this._logger=t,this._options=n,this.onreceive=null,this.onclose=null}async connect(i,e){return N.isRequired(i,"url"),N.isRequired(e,"transferFormat"),N.isIn(e,oe,"transferFormat"),this._logger.log(u.Trace,"(SSE transport) Connecting."),this._url=i,this._accessToken&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((t,n)=>{let r=!1;if(e!==oe.Text){n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let s;if(H.isBrowser||H.isWebWorker)s=new this._options.EventSource(i,{withCredentials:this._options.withCredentials});else{let a=this._httpClient.getCookieString(i),d={};d.Cookie=a;let[g,b]=rt();d[g]=b,s=new this._options.EventSource(i,{withCredentials:this._options.withCredentials,headers:M(M({},d),this._options.headers)})}try{s.onmessage=a=>{if(this.onreceive)try{this._logger.log(u.Trace,`(SSE transport) data received. ${Pt(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(d){this._close(d);return}},s.onerror=a=>{r?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},s.onopen=()=>{this._logger.log(u.Information,`SSE connected to ${this._url}`),this._eventSource=s,r=!0,t()}}catch(a){n(a);return}})}async send(i){return this._eventSource?On(this._logger,"SSE",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(i){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(i))}};var Hn=class{constructor(i,e,t,n,r,s){this._logger=t,this._accessTokenFactory=e,this._logMessageContent=n,this._webSocketConstructor=r,this._httpClient=i,this.onreceive=null,this.onclose=null,this._headers=s}async connect(i,e){N.isRequired(i,"url"),N.isRequired(e,"transferFormat"),N.isIn(e,oe,"transferFormat"),this._logger.log(u.Trace,"(WebSockets transport) Connecting.");let t;return this._accessTokenFactory&&(t=await this._accessTokenFactory()),new Promise((n,r)=>{i=i.replace(/^http/,"ws");let s,a=this._httpClient.getCookieString(i),d=!1;if(H.isNode||H.isReactNative){let g={},[b,z]=rt();g[b]=z,t&&(g[Lt.Authorization]=`Bearer ${t}`),a&&(g[Lt.Cookie]=a),s=new this._webSocketConstructor(i,void 0,{headers:M(M({},g),this._headers)})}else t&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(t)}`);s||(s=new this._webSocketConstructor(i)),e===oe.Binary&&(s.binaryType="arraybuffer"),s.onopen=g=>{this._logger.log(u.Information,`WebSocket connected to ${i}.`),this._webSocket=s,d=!0,n()},s.onerror=g=>{let b=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?b=g.error:b="There was an error with the transport",this._logger.log(u.Information,`(WebSockets transport) ${b}.`)},s.onmessage=g=>{if(this._logger.log(u.Trace,`(WebSockets transport) data received. ${Pt(g.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(g.data)}catch(b){this._close(b);return}},s.onclose=g=>{if(d)this._close(g);else{let b=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?b=g.error:b="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(b))}}})}send(i){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(u.Trace,`(WebSockets transport) sending data. ${Pt(i,this._logMessageContent)}.`),this._webSocket.send(i),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(i){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(u.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(i)&&(i.wasClean===!1||i.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${i.code} (${i.reason||"no reason given"}).`)):i instanceof Error?this.onclose(i):this.onclose())}_isCloseEvent(i){return i&&typeof i.wasClean=="boolean"&&typeof i.code=="number"}};var As=100,zn=class{constructor(i,e={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,N.isRequired(i,"url"),this._logger=ks(e.logger),this.baseUrl=this._resolveUrl(i),e=e||{},e.logMessageContent=e.logMessageContent===void 0?!1:e.logMessageContent,typeof e.withCredentials=="boolean"||e.withCredentials===void 0)e.withCredentials=e.withCredentials===void 0?!0:e.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.timeout=e.timeout===void 0?100*1e3:e.timeout;let t=null,n=null;if(H.isNode&&typeof Ft<"u"){let r=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;t=r("ws"),n=r("eventsource")}!H.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:H.isNode&&!e.WebSocket&&t&&(e.WebSocket=t),!H.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:H.isNode&&!e.EventSource&&typeof n<"u"&&(e.EventSource=n),this._httpClient=new Nn(e.httpClient||new Rn(this._logger),e.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=e,this.onreceive=null,this.onclose=null}async start(i){if(i=i||oe.Binary,N.isIn(i,oe,"transferFormat"),this._logger.log(u.Debug,`Starting connection with transfer format '${oe[i]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(i),await this._startInternalPromise,this._connectionState==="Disconnecting"){let e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(u.Error,e),await this._stopPromise,Promise.reject(new ce(e))}else if(this._connectionState!=="Connected"){let e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(u.Error,e),Promise.reject(new ce(e))}this._connectionStarted=!0}send(i){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Po(this.transport)),this._sendQueue.send(i))}async stop(i){if(this._connectionState==="Disconnected")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(e=>{this._stopPromiseResolver=e}),await this._stopInternal(i),await this._stopPromise}async _stopInternal(i){this._stopError=i;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(u.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(u.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(i){let e=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===ie.WebSockets)this.transport=this._constructTransport(ie.WebSockets),await this._startTransport(e,i);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let t=null,n=0;do{if(t=await this._getNegotiationResponse(e),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ce("The connection was stopped during negotiation.");if(t.error)throw new Error(t.error);if(t.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(t.url&&(e=t.url),t.accessToken){let r=t.accessToken;this._accessTokenFactory=()=>r,this._httpClient._accessToken=r,this._httpClient._accessTokenFactory=void 0}n++}while(t.url&&n<As);if(n===As&&t.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(e,this._options.transport,t,i)}this.transport instanceof Oi&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(u.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(t){return this._logger.log(u.Error,"Failed to start the connection: "+t),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(t)}}async _getNegotiationResponse(i){let e={},[t,n]=rt();e[t]=n;let r=this._resolveNegotiateUrl(i);this._logger.log(u.Debug,`Sending negotiation request: ${r}.`);try{let s=await this._httpClient.post(r,{content:"",headers:M(M({},e),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));let a=JSON.parse(s.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new Ei("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(s){let a="Failed to complete negotiation with the server: "+s;return s instanceof ve&&s.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(u.Error,a),Promise.reject(new Ei(a))}}_createConnectUrl(i,e){return e?i+(i.indexOf("?")===-1?"?":"&")+`id=${e}`:i}async _createTransport(i,e,t,n){let r=this._createConnectUrl(i,t.connectionToken);if(this._isITransport(e)){this._logger.log(u.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,await this._startTransport(r,n),this.connectionId=t.connectionId;return}let s=[],a=t.availableTransports||[],d=t;for(let g of a){let b=this._resolveTransportOrError(g,e,n,d?.useStatefulReconnect===!0);if(b instanceof Error)s.push(`${g.transport} failed:`),s.push(b);else if(this._isITransport(b)){if(this.transport=b,!d){try{d=await this._getNegotiationResponse(i)}catch(z){return Promise.reject(z)}r=this._createConnectUrl(i,d.connectionToken)}try{await this._startTransport(r,n),this.connectionId=d.connectionId;return}catch(z){if(this._logger.log(u.Error,`Failed to start the transport '${g.transport}': ${z}`),d=void 0,s.push(new Mn(`${g.transport} failed: ${z}`,ie[g.transport])),this._connectionState!=="Connecting"){let Ce="Failed to select transport before stop() was called.";return this._logger.log(u.Debug,Ce),Promise.reject(new ce(Ce))}}}}return s.length>0?Promise.reject(new En(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(i){switch(i){case ie.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Hn(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ie.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Bn(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ie.LongPolling:return new Oi(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${i}.`)}}_startTransport(i,e){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async t=>{let n=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(i,e),await this.features.resend()}catch{n=!0}else{this._stopConnection(t);return}n&&this._stopConnection(t)}:this.transport.onclose=t=>this._stopConnection(t),this.transport.connect(i,e)}_resolveTransportOrError(i,e,t,n){let r=ie[i.transport];if(r==null)return this._logger.log(u.Debug,`Skipping transport '${i.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${i.transport}' because it is not supported by this client.`);if(Kl(e,r))if(i.transferFormats.map(a=>oe[a]).indexOf(t)>=0){if(r===ie.WebSockets&&!this._options.WebSocket||r===ie.ServerSentEvents&&!this._options.EventSource)return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it is not supported in your environment.'`),new xn(`'${ie[r]}' is not supported in your environment.`,r);this._logger.log(u.Debug,`Selecting transport '${ie[r]}'.`);try{return this.features.reconnect=r===ie.WebSockets?n:void 0,this._constructTransport(r)}catch(a){return a}}else return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it does not support the requested transfer format '${oe[t]}'.`),new Error(`'${ie[r]}' does not support ${oe[t]}.`);else return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it was disabled by the client.`),new Pn(`'${ie[r]}' is disabled by the client.`,r)}_isITransport(i){return i&&typeof i=="object"&&"connect"in i}_stopConnection(i){if(this._logger.log(u.Debug,`HttpConnection.stopConnection(${i}) called while in state ${this._connectionState}.`),this.transport=void 0,i=this._stopError||i,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(u.Debug,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(u.Warning,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${i}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),i?this._logger.log(u.Error,`Connection disconnected with error '${i}'.`):this._logger.log(u.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(u.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(i)}catch(e){this._logger.log(u.Error,`HttpConnection.onclose(${i}) threw error '${e}'.`)}}}_resolveUrl(i){if(i.lastIndexOf("https://",0)===0||i.lastIndexOf("http://",0)===0)return i;if(!H.isBrowser)throw new Error(`Cannot resolve '${i}'.`);let e=window.document.createElement("a");return e.href=i,this._logger.log(u.Information,`Normalizing '${i}' to '${e.href}'.`),e.href}_resolveNegotiateUrl(i){let e=new URL(i);e.pathname.endsWith("/")?e.pathname+="negotiate":e.pathname+="/negotiate";let t=new URLSearchParams(e.searchParams);return t.has("negotiateVersion")||t.append("negotiateVersion",this._negotiateVersion.toString()),t.has("useStatefulReconnect")?t.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&t.append("useStatefulReconnect","true"),e.search=t.toString(),e.toString()}};function Kl(o,i){return!o||(i&o)!==0}var Po=class o{constructor(i){this._transport=i,this._buffer=[],this._executing=!0,this._sendBufferedData=new di,this._transportResult=new di,this._sendLoopPromise=this._sendLoop()}send(i){return this._bufferData(i),this._transportResult||(this._transportResult=new di),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(i){if(this._buffer.length&&typeof this._buffer[0]!=typeof i)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof i}`);this._buffer.push(i),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new di;let i=this._transportResult;this._transportResult=void 0;let e=typeof this._buffer[0]=="string"?this._buffer.join(""):o._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(e),i.resolve()}catch(t){i.reject(t)}}}static _concatBuffers(i){let e=i.map(r=>r.byteLength).reduce((r,s)=>r+s),t=new Uint8Array(e),n=0;for(let r of i)t.set(new Uint8Array(r),n),n+=r.byteLength;return t.buffer}},di=class{constructor(){this.promise=new Promise((i,e)=>[this._resolver,this._rejecter]=[i,e])}resolve(){this._resolver()}reject(i){this._rejecter(i)}};var Zl="json",$n=class{constructor(){this.name=Zl,this.version=2,this.transferFormat=oe.Text}parseMessages(i,e){if(typeof i!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!i)return[];e===null&&(e=ot.instance);let t=be.parse(i),n=[];for(let r of t){let s=JSON.parse(r);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case E.Invocation:this._isInvocationMessage(s);break;case E.StreamItem:this._isStreamItemMessage(s);break;case E.Completion:this._isCompletionMessage(s);break;case E.Ping:break;case E.Close:break;case E.Ack:this._isAckMessage(s);break;case E.Sequence:this._isSequenceMessage(s);break;default:e.log(u.Information,"Unknown message type '"+s.type+"' ignored.");continue}n.push(s)}return n}writeMessage(i){return be.write(JSON.stringify(i))}_isInvocationMessage(i){this._assertNotEmptyString(i.target,"Invalid payload for Invocation message."),i.invocationId!==void 0&&this._assertNotEmptyString(i.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(i){if(this._assertNotEmptyString(i.invocationId,"Invalid payload for StreamItem message."),i.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(i){if(i.result&&i.error)throw new Error("Invalid payload for Completion message.");!i.result&&i.error&&this._assertNotEmptyString(i.error,"Invalid payload for Completion message."),this._assertNotEmptyString(i.invocationId,"Invalid payload for Completion message.")}_isAckMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(i,e){if(typeof i!="string"||i==="")throw new Error(e)}};var Ql={trace:u.Trace,debug:u.Debug,info:u.Information,information:u.Information,warn:u.Warning,warning:u.Warning,error:u.Error,critical:u.Critical,none:u.None};function Xl(o){let i=Ql[o.toLowerCase()];if(typeof i<"u")return i;throw new Error(`Unknown log level: ${o}`)}var Ti=class{configureLogging(i){if(N.isRequired(i,"logging"),Yl(i))this.logger=i;else if(typeof i=="string"){let e=Xl(i);this.logger=new At(e)}else this.logger=new At(i);return this}withUrl(i,e){return N.isRequired(i,"url"),N.isNotEmpty(i,"url"),this.url=i,typeof e=="object"?this.httpConnectionOptions=M(M({},this.httpConnectionOptions),e):this.httpConnectionOptions=ae(M({},this.httpConnectionOptions),{transport:e}),this}withHubProtocol(i){return N.isRequired(i,"protocol"),this.protocol=i,this}withAutomaticReconnect(i){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return i?Array.isArray(i)?this.reconnectPolicy=new Di(i):this.reconnectPolicy=i:this.reconnectPolicy=new Di,this}withServerTimeout(i){return N.isRequired(i,"milliseconds"),this._serverTimeoutInMilliseconds=i,this}withKeepAliveInterval(i){return N.isRequired(i,"milliseconds"),this._keepAliveIntervalInMilliseconds=i,this}withStatefulReconnect(i){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=i?.bufferSize,this}build(){let i=this.httpConnectionOptions||{};if(i.logger===void 0&&(i.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let e=new zn(this.url,i);return Vn.create(e,this.logger||ot.instance,this.protocol||new $n,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};function Yl(o){return o.log!==void 0}var Ls="https://localhost:7113",ec="https://localhost:7113/api";function Fs(){return`${ec}/Mosaic/PolygonTriangulationMesh`}var Un=class o{getVertices(){return[this.a,this.b,this.c]}static restore(i){Object.setPrototypeOf(i,o.prototype),i.getVertices().forEach(e=>R.restore(e))}};var Wn=class{static restore(i){i.parts.forEach(e=>ki.restore(e))}},ki=class{static restore(i){i.triangles.forEach(e=>Un.restore(e)),i.contour.forEach(e=>R.restore(e))}};var Vs=(()=>{class o{constructor(){this.sectionsMeshReceivedSub=new P,this.sectionsMeshReceived$=this.sectionsMeshReceivedSub.asObservable(),this.sectionGeneratedSub=new P,this.sectionGenerated$=this.sectionGeneratedSub.asObservable(),this.generationFinishedSub=new P,this.generationFinished$=this.generationFinishedSub.asObservable(),this.generationAbortedWithErrorSub=new P,this.generationAbortedWithError$=this.generationAbortedWithErrorSub.asObservable(),this.isClosed=!1,this.hubConnection=new Ti().withUrl(`${Ls}/process-hub`,{skipNegotiation:!0,transport:ie.WebSockets}).build(),this.subscribeOnSectionGenerated(),this.subscribeOnFinishGeneration(),this.subscribeOnSectionsMeshReceived(),this.subscribeOnAbortGenerationInErrorCase()}subscribeOnSectionGenerated(){this.hubConnection.on("ReceiveMosaicSectionTiles",e=>this.sectionGeneratedSub.next(e))}subscribeOnFinishGeneration(){this.hubConnection.on("ReceiveFinishNotification",()=>this.generationFinishedSub.next())}subscribeOnAbortGenerationInErrorCase(){this.hubConnection.on("AbortGenerationInErrorCase",()=>this.generationAbortedWithErrorSub.next())}subscribeOnSectionsMeshReceived(){this.hubConnection.on("ReceiveMosaicSectorsMesh",e=>{e.forEach(t=>Wn.restore(t)),this.sectionsMeshReceivedSub.next(e)})}startLongRunningTask(e){return this.hubConnection.invoke("StartMosaicGeneration",e).catch(t=>{if(!this.isClosed)throw t})}initMosaicTriangulation(e){return this.hubConnection.invoke("InitMosaicTriangulation",e).catch(t=>{if(!this.isClosed)throw t})}startConnection(){return this.hubConnection.start()}stopConnection(){return this.isClosed=!0,this.hubConnection.stop()}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var qn=class{constructor(i){this.visualObjects=[],this.sections=[],this.tilesSub=new He([]),this.tiles$=this.tilesSub.asObservable(),this.areTilesVisible=!0,this.schema=i}addSection(i){this.sections.push(i),i.tiles.forEach(e=>e.tileObject.setVisibility(this.areTilesVisible)),this.tilesSub.next(this.sections.flatMap(e=>e.tiles))}setSectorMeshVisibility(i){for(let e of this.visualObjects)e.setVisibility(i)}setSectorVisualObjects(i){this.visualObjects.forEach(e=>e.removeObject()),this.visualObjects=i}setTilesVisibility(i){this.areTilesVisible=i;let e=this.tilesSub.value;e.length&&(e.forEach(t=>t.tileObject.setVisibility(this.areTilesVisible)),e[0].tileObject.parentCanvas.redraw())}};var Ii=(()=>{class o{constructor(){this.sectorsInfo=new Map,this.sectorsSub=new P,this.sectors$=this.sectorsSub.asObservable()}buildInitMosaicRequest(e,t,n){return{base64Image:e,mosaicWidth:t.width,sectorsGenerationParams:n.map(r=>({id:r.id,tileMargin:r.properties.tilesMargin,tileMinRadius:r.properties.minTileRadius,tileMaxRadius:r.properties.maxTileRadius,triangulationData:{polygonVertices:r.vertices,sectionMaxArea:r.properties.sectionMaxArea,sectionMinAngle:r.properties.sectionMinAngle},evaluationParams:r.properties.evaluationParams,populationParams:r.properties.populationParams}))}}initGeneratedSectorsData(e){for(let t of e)this.sectorsInfo.set(t.id,new qn(t));this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}fillSectorsGenerationInfo(e){for(let t of e){let n=this.sectorsInfo.get(t.sectorId);n.countOfSections=t.parts.flatMap(r=>r.triangles).length}this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}addSectionTilesObjects(e,t){this.sectorsInfo.get(e).addSection({tiles:t})}getSectorById(e){return this.sectorsInfo.get(e)}getSectors(){return Array.from(this.sectorsInfo.values())}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac})}}return o})();function tc(o,i){if(o&1&&(h(0,"div",10)(1,"span",11),m(2),p()()),o&2){let e=i.$implicit;l(2),D(" ",e.tileTransform.tileId," ")}}function ic(o,i){if(o&1&&(h(0,"app-scrollable-list",8),pt(1,tc,3,1,"ng-template",null,0,qi),p()),o&2){x();let e=_i(11);y("items",e)}}function nc(o,i){o&1&&(h(0,"span",9),m(1),_(2,"translate"),p()),o&2&&(l(),f(v(2,1,"tool.generation.sectorList.noTiles")))}var Ns=(()=>{class o{constructor(){this.sector=J.required(),this.isOpen=O(!1),this.items$=V(()=>this.sector().tiles$),this.areTilesVisible=O(!0),this.translate=c(ee)}toggleTilesList(){this.isOpen.update(e=>!e)}toggleTilesVisibility(){this.areTilesVisible.update(e=>!e),this.sector().setTilesVisibility(this.areTilesVisible())}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-list-elem"]],inputs:{sector:[1,"sector"]},decls:15,vars:9,consts:[["element",""],[1,"parent-elem"],[1,"sector-actions"],["mat-icon-button","",1,"sector-action",3,"click"],[1,"visibility-icon","material-symbols-outlined"],["mat-icon-button","",1,"sector-action","toggle-action",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"],[3,"items"],[1,"empty"],[1,"tile"],[1,"label"]],template:function(t,n){if(t&1){let r=F();h(0,"div",1)(1,"span"),m(2),p(),h(3,"div",2)(4,"button",3),C("click",function(){return T(r),k(n.toggleTilesVisibility())}),h(5,"mat-icon",4),m(6),p()(),h(7,"button",5),C("click",function(){return T(r),k(n.toggleTilesList())}),h(8,"mat-icon",6),m(9," keyboard_arrow_up "),p()()()(),h(10,"app-expandable-panel",7),Ui(11),_(12,"async"),W(13,ic,3,1,"app-scrollable-list",8)(14,nc,3,3,"span",9),p()}if(t&2){l(2),f(n.sector().schema.name),l(4),D(" ",n.areTilesVisible()?"visibility":"visibility_off"," "),l(2),G("chevron--closed",!n.isOpen()),l(2),y("isOpen",n.isOpen()),l();let r=Wi(v(12,6,n.items$()));l(2),q(r.length?13:14)}},dependencies:[Oe,De,L,ke,ri,$,yn,Zi,Z],styles:["[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .parent-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .visibility-icon[_ngcontent-%COMP%]{font-weight:300;color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]{margin:-6px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap;font-size:12px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{margin-top:6px}"],changeDetection:0})}}return o})();function oc(o,i){if(o&1&&w(0,"app-sector-list-elem",1),o&2){let e=i.$implicit;y("sector",e)}}var js=(()=>{class o{constructor(){this.service=c(Ii)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-mosaic-hierarchy"]],decls:4,vars:2,consts:[[1,"sectors"],[3,"sector"]],template:function(t,n){t&1&&(h(0,"div",0),Pe(1,oc,1,1,"app-sector-list-elem",1,zt),_(3,"async"),p()),t&2&&(l(),Me(v(3,0,n.service.sectors$)))},dependencies:[Ns,Zi],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .sectors[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}"],changeDetection:0})}}return o})();function rc(o,i){if(o&1&&(Dt(0,"span",0),m(1),Ot(),Dt(2,"span",1),m(3),Ot()),o&2){x();let e=_i(0);l(),f(e.sector),l(2),D("",e.percent,"%")}}function sc(o,i){if(o&1&&(Dt(0,"span",0),m(1),Ot()),o&2){x();let e=_i(0);l(),f(e.message)}}var Bs=(()=>{class o{constructor(){this.infoState=J.required()}isProgressInfo(e){return e.type==="progress"}isInitInfo(e){return e.type==="init"}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-progress-info"]],inputs:{infoState:[1,"infoState"]},decls:3,vars:2,consts:[[1,"loading"],[1,"right"]],template:function(t,n){if(t&1&&(Ui(0),W(1,rc,4,2)(2,sc,2,1,"span",0)),t&2){let r=Wi(n.infoState());l(),q(n.isProgressInfo(r)?1:n.isInitInfo(r)?2:-1)}},styles:['.loading[_ngcontent-%COMP%]:after{content:"";animation:_ngcontent-%COMP%_dots 2s linear infinite}@keyframes _ngcontent-%COMP%_dots{0%,20%{content:"."}40%{content:".."}60%{content:"..."}90%,to{content:""}}[_nghost-%COMP%]{display:flex;width:200px;height:auto;font-size:14px;border:1px solid;padding:12px;border-radius:4px;border-color:transparent;background:#ccc;opacity:.75;color:#141414;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .right[_ngcontent-%COMP%]{margin-left:auto}'],changeDetection:0})}}return o})();function ac(o,i){if(o&1&&w(0,"app-progress-info",0),o&2){let e=x();y("infoState",e.progressState())}}var Hs=(()=>{class o{constructor(){this.toolService=c(_e),this.isImageVisible=O(!1),this.isMeshVisible=O(!0),this.showMesh$=new He(!0),this.progressState=O(null),this.ribbonActions=[{iconName:"crop",visibility:O("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"generating_snapshot.png")},{iconName:"recenter",visibility:O("on"),onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}},{iconName:"graph_3",onClick:()=>this.toggleMeshVisibility(),visibility:V(()=>this.isMeshVisible()?"on":"off")},{iconName:"image",onClick:()=>this.toggleImageVisibility(),visibility:V(()=>this.isImageVisible()?"on":"off")}],this.store=c(A),this.translate=c(ee),this.destroyRef=c(Y),this.snackBar=c(it),this.signalRService=c(Vs),this.service=c(Ii)}ngOnInit(){this.subscribeOnGenerationProgress(),this.subscribeOnSectorsMeshReceived(),this.subscribeOnMeshGenerationFinished(),this.subscribeOnMeshVisibilityChange(),this.destroyRef.onDestroy(()=>this.signalRService.stopConnection())}async onCanvasReady(e){let t=this.store.selectSignal(Qe)();this.imageObject=await _e.createImageObject(t),this.imageObject.setVisibility(this.isImageVisible()),this.activeCanvas.addCanvasObject(this.imageObject),e&&this.focusOnImage(),this.activeCanvas.redraw(),this.initSectors(),this.initGeneration(t.base64Image,this.imageObject.size)}initGeneration(e,t){this.signalRService.startConnection().then(()=>{let n=this.store.selectSignal(fe)(),r=this.service.buildInitMosaicRequest(e,t,n);this.availableTiles=this.getAvailableTiles(),this.progressState.set({type:"init",message:this.translate.instant("tool.generation.message.sectorsMeshGeneration")}),this.signalRService.initMosaicTriangulation(r).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnSectorsMeshGeneration")))}).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnServerConnection")))}subscribeOnGenerationProgress(){this.signalRService.sectionGenerated$.pipe(Q(this.destroyRef)).subscribe(e=>{let t=[];for(let r of e.tilesTransforms){let s=this.availableTiles.find(g=>g.id===r.tileId),a=_n(s.vertices,r.position,r.angle),d=new ni(a,s.color);this.activeCanvas.addCanvasObject(d),t.push({tileObject:d,tileTransform:r})}let n=this.service.getSectorById(e.sectorId);this.service.addSectionTilesObjects(e.sectorId,t),this.progressState.set({type:"progress",sector:n.schema.name,percent:Math.floor(n.sections.length/n.countOfSections*100)}),this.activeCanvas.redraw()})}subscribeOnSectorsMeshReceived(){this.signalRService.sectionsMeshReceived$.pipe(Q(this.destroyRef)).subscribe(e=>{let t=this.store.selectSignal(fe)();this.createSectorsMeshCanvasObjects(e,t),this.service.fillSectorsGenerationInfo(e);let n=this.availableTiles.map(r=>({color:r.color,id:r.id,vertices:r.vertices}));this.signalRService.startLongRunningTask(n).catch(()=>this.showMessage(this.translate.instant("tool.generation.message.errorOnStartingMosaicGeneration")))})}subscribeOnMeshGenerationFinished(){this.signalRService.generationFinished$.pipe(Q(this.destroyRef)).subscribe(()=>{this.progressState.set(null),this.showMessage(this.translate.instant("tool.generation.message.generationCompleted"))})}subscribeOnMeshVisibilityChange(){this.showMesh$.pipe(Q(this.destroyRef)).subscribe(e=>{for(let t of this.service.getSectors())t.setSectorMeshVisibility(e);this.activeCanvas.redraw()})}createSectorsMeshCanvasObjects(e,t){for(let n=0;n<t.length;++n){let r=t[n],s=this.service.getSectorById(r.id),a=[];for(let d of e[n].parts){let g=this.createSectorMeshObject(r,d,n);this.activeCanvas.addCanvasObject(g),a.push(g)}s.setSectorVisualObjects(a)}this.activeCanvas.redraw()}initSectors(){let e=this.store.selectSignal(fe)();this.service.initGeneratedSectorsData(e),this.initSectorsMeshes(e)}initSectorsMeshes(e){for(let t=0;t<e.length;++t){let n=this.service.getSectorById(e[t].id),r=this.createSectorContourObject(e[t],t);this.activeCanvas.addCanvasObject(r),n.visualObjects.push(r)}this.activeCanvas.redraw()}createSectorMeshObject(e,t,n){return new ai(t.triangles,t.contour,e.color,10+n)}createSectorContourObject(e,t){return new li([...e.vertices],e.color,10+t)}getAvailableTiles(){return this.store.selectSignal(Xe)().flatMap(t=>t.tiles)}toggleMeshVisibility(){let e=!this.isMeshVisible();this.showMesh$.next(e),this.isMeshVisible.set(e)}toggleImageVisibility(){let e=!this.isImageVisible();this.imageObject.setVisibility(e),this.activeCanvas.redraw(),this.isImageVisible.set(e)}setError(e){this.progressState.set(null),this.showMessage(e)}showMessage(e){this.snackBar.open(e,this.translate.instant("common.ok"),{duration:3e3})}sectionEntered(e,t){return this.activeCanvas=e,this.onCanvasReady(t),{ribbon:this.ribbonActions}}focusOnImage(){let e=_e.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-mosaic-generation"]],features:[de([Ii])],decls:2,vars:1,consts:[[1,"info",3,"infoState"]],template:function(t,n){t&1&&(w(0,"app-mosaic-hierarchy"),W(1,ac,1,1,"app-progress-info",0)),t&2&&(l(),q(n.progressState()?1:-1))},dependencies:[js,Bs],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{position:absolute;left:-250px;bottom:30px}"],changeDetection:0})}}return o})();var zs=()=>c(A).selectSignal(fe)().length?!0:(c(K).navigate([vn]),!1);function Do(o){let i=o.cloneNode(!0),e=i.querySelectorAll("[id]"),t=o.nodeName.toLowerCase();i.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return t==="canvas"?Ws(o,i):(t==="input"||t==="select"||t==="textarea")&&Us(o,i),$s("canvas",o,i,Ws),$s("input, textarea, select",o,i,Us),i}function $s(o,i,e,t){let n=i.querySelectorAll(o);if(n.length){let r=e.querySelectorAll(o);for(let s=0;s<n.length;s++)t(n[s],r[s])}}var lc=0;function Us(o,i){i.type!=="file"&&(i.value=o.value),i.type==="radio"&&i.name&&(i.name=`mat-clone-${i.name}-${lc++}`)}function Ws(o,i){let e=i.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function Ao(o){let i=o.getBoundingClientRect();return{top:i.top,right:i.right,bottom:i.bottom,left:i.left,width:i.width,height:i.height,x:i.x,y:i.y}}function Oo(o,i,e){let{top:t,bottom:n,left:r,right:s}=o;return e>=t&&e<=n&&i>=r&&i<=s}function cc(o,i){let e=i.left<o.left,t=i.left+i.width>o.right,n=i.top<o.top,r=i.top+i.height>o.bottom;return e||t||n||r}function Li(o,i,e){o.top+=i,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function qs(o,i,e,t){let{top:n,right:r,bottom:s,left:a,width:d,height:g}=o,b=d*i,z=g*i;return t>n-z&&t<s+z&&e>a-b&&e<r+b}var Gn=class{_document;positions=new Map;constructor(i){this._document=i}clear(){this.positions.clear()}cache(i){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),i.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Ao(e)})})}handleScroll(i){let e=Tt(i),t=this.positions.get(e);if(!t)return null;let n=t.scrollPosition,r,s;if(e===this._document){let g=this.getViewportScrollPosition();r=g.top,s=g.left}else r=e.scrollTop,s=e.scrollLeft;let a=n.top-r,d=n.left-s;return this.positions.forEach((g,b)=>{g.clientRect&&e!==b&&e.contains(b)&&Li(g.clientRect,a,d)}),n.top=r,n.left=s,{top:a,left:d}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function ra(o,i){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===i.ELEMENT_NODE)return e[0];let t=i.createElement("div");return e.forEach(n=>t.appendChild(n)),t}function Lo(o,i,e){for(let t in i)if(i.hasOwnProperty(t)){let n=i[t];n?o.setProperty(t,n,e?.has(t)?"important":""):o.removeProperty(t)}return o}function hi(o,i){let e=i?"":"none";Lo(o.style,{"touch-action":i?"":"none","-webkit-user-drag":i?"":"none","-webkit-tap-highlight-color":i?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Gs(o,i,e){Lo(o.style,{position:i?"":"fixed",top:i?"":"0",opacity:i?"":"0",left:i?"":"-999em"},e)}function Kn(o,i){return i&&i!="none"?o+" "+i:o}function Ks(o,i){o.style.width=`${i.width}px`,o.style.height=`${i.height}px`,o.style.transform=Fi(i.left,i.top)}function Fi(o,i){return`translate3d(${Math.round(o)}px, ${Math.round(i)}px, 0)`}function Zs(o){let i=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*i}function dc(o){let i=getComputedStyle(o),e=Mo(i,"transition-property"),t=e.find(a=>a==="transform"||a==="all");if(!t)return 0;let n=e.indexOf(t),r=Mo(i,"transition-duration"),s=Mo(i,"transition-delay");return Zs(r[n])+Zs(s[n])}function Mo(o,i){return o.getPropertyValue(i).split(",").map(t=>t.trim())}var hc=new Set(["position"]),To=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(i,e,t,n,r,s,a,d,g,b){this._document=i,this._rootElement=e,this._direction=t,this._initialDomRect=n,this._previewTemplate=r,this._previewClass=s,this._pickupPositionOnPage=a,this._initialTransform=d,this._zIndex=g,this._renderer=b}attach(i){this._preview=this._createPreview(),i.appendChild(this._preview),Qs(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(i){this._preview.style.transform=i}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(i){this._preview.classList.add(i)}getTransitionDuration(){return dc(this._preview)}addEventListener(i,e){return this._renderer.listen(this._preview,i,e)}_createPreview(){let i=this._previewTemplate,e=this._previewClass,t=i?i.template:null,n;if(t&&i){let r=i.matchSize?this._initialDomRect:null,s=i.viewContainer.createEmbeddedView(t,i.context);s.detectChanges(),n=ra(s,this._document),this._previewEmbeddedView=s,i.matchSize?Ks(n,r):n.style.transform=Fi(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=Do(this._rootElement),Ks(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return Lo(n.style,{"pointer-events":"none",margin:Qs(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},hc),hi(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>n.classList.add(r)):n.classList.add(e)),n}};function Qs(o){return"showPopover"in o}var pc={passive:!0},Xs={passive:!1},mc={passive:!1,capture:!0},uc=800,Ys="cdk-drag-placeholder",Js=new Set(["position"]),ko=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=O(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new P;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=Be.EMPTY;_pointerUpSubscription=Be.EMPTY;_scrollSubscription=Be.EMPTY;_resizeSubscription=Be.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(i){i!==this._disabled&&(this._disabled=i,this._toggleNativeDragInteractions(),this._handles.forEach(e=>hi(e,i)))}_disabled=!1;beforeStarted=new P;started=new P;released=new P;ended=new P;entered=new P;exited=new P;dropped=new P;moved=this._moveEvents;data;constrainPosition;constructor(i,e,t,n,r,s,a){this._config=e,this._document=t,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=s,this._renderer=a,this.withRootElement(i).withParent(e.parentDragRef||null),this._parentPositions=new Gn(t),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(i){this._handles=i.map(t=>Te(t)),this._handles.forEach(t=>hi(t,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&e.add(t)}),this._disabledHandles=e,this}withPreviewTemplate(i){return this._previewTemplate=i,this}withPlaceholderTemplate(i){return this._placeholderTemplate=i,this}withRootElement(i){let e=Te(i);if(e!==this._rootElement){this._removeRootElementListeners();let t=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[t.listen(e,"mousedown",this._pointerDown,Xs),t.listen(e,"touchstart",this._pointerDown,pc),t.listen(e,"dragstart",this._nativeDragStart,Xs)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(i){return this._boundaryElement=i?Te(i):null,this._resizeSubscription.unsubscribe(),i&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(i){return this._parentDragRef=i,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&cc(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let i=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),t=0,n=0;e.left<i.left?t=i.left-e.left:e.right>i.right&&(t=i.right-e.right),e.top<i.top?n=i.top-e.top:e.bottom>i.bottom&&(n=i.bottom-e.bottom);let r=this._activeTransform.x,s=this._activeTransform.y,a=r+t,d=s+n;this._rootElement.style.transform=Fi(a,d),this._activeTransform={x:a,y:d},this._passiveTransform={x:a,y:d}}}disableHandle(i){!this._disabledHandles.has(i)&&this._handles.indexOf(i)>-1&&(this._disabledHandles.add(i),hi(i,!0))}enableHandle(i){this._disabledHandles.has(i)&&(this._disabledHandles.delete(i),hi(i,this.disabled))}withDirection(i){return this._direction=i,this}_withDropContainer(i){this._dropContainer=i}getFreeDragPosition(){let i=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:i.x,y:i.y}}setFreeDragPosition(i){return this._activeTransform={x:0,y:0},this._passiveTransform.x=i.x,this._passiveTransform.y=i.y,this._dropContainer||this._applyRootElementTransform(i.x,i.y),this}withPreviewContainer(i){return this._previewContainer=i,this}_sortFromLastPointerPosition(){let i=this._lastKnownPointerPosition;i&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(i),i)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=i=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,i)}else this.disabled||this._initializeDragSequence(this._rootElement,i)};_pointerMove=i=>{let e=this._getPointerPositionOnPage(i);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+r>=this._config.dragStartThreshold){let a=Date.now()>=this._dragStartTime+this._getDragStartDelay(i),d=this._dropContainer;if(!a){this._endDragSequence(i);return}(!d||!d.isDragging()&&!d.isReceiving())&&(i.cancelable&&i.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(i)))}return}i.cancelable&&i.preventDefault();let t=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(t),this._dropContainer)this._updateActiveDropContainer(t,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=t.x-n.x+this._passiveTransform.x,r.y=t.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:t,event:i,distance:this._getDragDistance(t),delta:this._pointerDirectionDelta})})};_pointerUp=i=>{this._endDragSequence(i)};_endDragSequence(i){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:i}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(i),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(i);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:i})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(i){Ri(i)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),t=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",gc,mc)}),t){let n=this._rootElement,r=n.parentNode,s=this._placeholder=this._createPlaceholderElement(),a=this._marker=this._marker||this._document.createComment("");r.insertBefore(a,n),this._initialTransform=n.style.transform||"",this._preview=new To(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),Gs(n,!1,Js),this._document.body.appendChild(r.replaceChild(s,n)),this.started.next({source:this,event:i}),t.start(),this._initialContainer=t,this._initialIndex=t.getItemIndex(this)}else this.started.next({source:this,event:i}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(t?t.getScrollableParents():[])}_initializeDragSequence(i,e){this._parentDragRef&&e.stopPropagation();let t=this.isDragging(),n=Ri(e),r=!n&&e.button!==0,s=this._rootElement,a=Tt(e),d=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+uc>Date.now(),g=n?pr(e):hr(e);if(a&&a.draggable&&e.type==="mousedown"&&e.preventDefault(),t||r||d||g)return;if(this._handles.length){let Ce=s.style;this._rootElementTapHighlight=Ce.webkitTapHighlightColor||"",Ce.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(Ce=>this._updateOnScroll(Ce)),this._boundaryElement&&(this._boundaryRect=Ao(this._boundaryElement));let b=this._previewTemplate;this._pickupPositionInElement=b&&b.template&&!b.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,i,e);let z=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:z.x,y:z.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(i){Gs(this._rootElement,!0,Js),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,t=e.getItemIndex(this),n=this._getPointerPositionOnPage(i),r=this._getDragDistance(n),s=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n,event:i}),this.dropped.next({item:this,currentIndex:t,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:r,dropPoint:n,event:i}),e.drop(this,t,this._initialIndex,this._initialContainer,s,r,n,i),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:i,y:e},{x:t,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,i,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(i,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{let s=this._dropContainer.getItemIndex(this),a=this._dropContainer.getItemAtIndex(s+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(r,this._dropContainer,a),this._dropContainer=r,this._dropContainer.enter(this,i,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(t,n),this._dropContainer._sortItem(this,i,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(i,e):this._applyPreviewTransform(i-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let i=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(i.left,i.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{let n=a=>{(!a||this._preview&&Tt(a)===this._preview.element&&a.propertyName==="transform")&&(s(),t(),clearTimeout(r))},r=setTimeout(n,e*1.5),s=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let i=this._placeholderTemplate,e=i?i.template:null,t;return e?(this._placeholderRef=i.viewContainer.createEmbeddedView(e,i.context),this._placeholderRef.detectChanges(),t=ra(this._placeholderRef,this._document)):t=Do(this._rootElement),t.style.pointerEvents="none",t.classList.add(Ys),t}_getPointerPositionInElement(i,e,t){let n=e===this._rootElement?null:e,r=n?n.getBoundingClientRect():i,s=Ri(t)?t.targetTouches[0]:t,a=this._getViewportScrollPosition(),d=s.pageX-r.left-a.left,g=s.pageY-r.top-a.top;return{x:r.left-i.left+d,y:r.top-i.top+g}}_getPointerPositionOnPage(i){let e=this._getViewportScrollPosition(),t=Ri(i)?i.touches[0]||i.changedTouches[0]||{pageX:0,pageY:0}:i,n=t.pageX-e.left,r=t.pageY-e.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let a=this._ownerSVGElement.createSVGPoint();return a.x=n,a.y=r,a.matrixTransform(s.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(i){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:t,y:n}=this.constrainPosition?this.constrainPosition(i,this,this._initialDomRect,this._pickupPositionInElement):i;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(t=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,a=this._boundaryRect,{width:d,height:g}=this._getPreviewRect(),b=a.top+s,z=a.bottom-(g-s),Ce=a.left+r,eo=a.right-(d-r);t=ea(t,Ce,eo),n=ea(n,b,z)}return{x:t,y:n}}_updatePointerDirectionDelta(i){let{x:e,y:t}=i,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-r.x),a=Math.abs(t-r.y);return s>this._config.pointerDirectionChangeThreshold&&(n.x=e>r.x?1:-1,r.x=e),a>this._config.pointerDirectionChangeThreshold&&(n.y=t>r.y?1:-1,r.y=t),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let i=this._handles.length>0||!this.isDragging();i!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=i,hi(this._rootElement,i))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(i=>i()),this._rootElementCleanups=void 0}_applyRootElementTransform(i,e){let t=1/this.scale,n=Fi(i*t,e*t),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=Kn(n,this._initialTransform)}_applyPreviewTransform(i,e){let t=this._previewTemplate?.template?void 0:this._initialTransform,n=Fi(i,e);this._preview.setTransform(Kn(n,t))}_getDragDistance(i){let e=this._pickupPositionOnPage;return e?{x:i.x-e.x,y:i.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:i,y:e}=this._passiveTransform;if(i===0&&e===0||this.isDragging()||!this._boundaryElement)return;let t=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||t.width===0&&t.height===0)return;let r=n.left-t.left,s=t.right-n.right,a=n.top-t.top,d=t.bottom-n.bottom;n.width>t.width?(r>0&&(i+=r),s>0&&(i-=s)):i=0,n.height>t.height?(a>0&&(e+=a),d>0&&(e-=d)):e=0,(i!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:i})}_getDragStartDelay(i){let e=this.dragStartDelay;return typeof e=="number"?e:Ri(i)?e.touch:e?e.mouse:0}_updateOnScroll(i){let e=this._parentPositions.handleScroll(i);if(e){let t=Tt(i);this._boundaryRect&&t!==this._boundaryElement&&t.contains(this._boundaryElement)&&Li(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Qi(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(i,e){let t=this._previewContainer||"global";if(t==="parent")return i;if(t==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Te(t)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=i=>{if(this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&i.preventDefault()}else this.disabled||i.preventDefault()};_getTargetHandle(i){return this._handles.find(e=>i.target&&(i.target===e||e.contains(i.target)))}_conditionallyInsertAnchor(i,e,t){if(i===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let n=this._anchor??=Do(this._placeholder);n.classList.remove(Ys),n.classList.add("cdk-drag-anchor"),n.style.transform="",t?t.before(n):Te(e.element).appendChild(n)}}};function ea(o,i,e){return Math.max(i,Math.min(e,o))}function Ri(o){return o.type[0]==="t"}function gc(o){o.preventDefault()}function Qn(o,i,e){let t=ta(i,o.length-1),n=ta(e,o.length-1);if(t===n)return;let r=o[t],s=n<t?-1:1;for(let a=t;a!==n;a+=s)o[a]=o[a+s];o[n]=r}function ta(o,i){return Math.max(0,Math.min(i,o))}var Zn=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(i){this._dragDropRegistry=i}_previousSwap={drag:null,delta:0,overlaps:!1};start(i){this.withItems(i)}sort(i,e,t,n){let r=this._itemPositions,s=this._getItemIndexFromPointerPosition(i,e,t,n);if(s===-1&&r.length>0)return null;let a=this.orientation==="horizontal",d=r.findIndex(ye=>ye.drag===i),g=r[s],b=r[d].clientRect,z=g.clientRect,Ce=d>s?1:-1,eo=this._getItemOffsetPx(b,z,Ce),ba=this._getSiblingOffsetPx(d,r,Ce),Ca=r.slice();return Qn(r,d,s),r.forEach((ye,ya)=>{if(Ca[ya]===ye)return;let Vo=ye.drag===i,to=Vo?eo:ba,No=Vo?i.getPlaceholderElement():ye.drag.getRootElement();ye.offset+=to;let jo=Math.round(ye.offset*(1/ye.drag.scale));a?(No.style.transform=Kn(`translate3d(${jo}px, 0, 0)`,ye.initialTransform),Li(ye.clientRect,0,to)):(No.style.transform=Kn(`translate3d(0, ${jo}px, 0)`,ye.initialTransform),Li(ye.clientRect,to,0))}),this._previousSwap.overlaps=Oo(z,e,t),this._previousSwap.drag=g.drag,this._previousSwap.delta=a?n.x:n.y,{previousIndex:d,currentIndex:s}}enter(i,e,t,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(i,e,t):n,s=this._activeDraggables,a=s.indexOf(i),d=i.getPlaceholderElement(),g=s[r];if(g===i&&(g=s[r+1]),!g&&(r==null||r===-1||r<s.length-1)&&this._shouldEnterAsFirstChild(e,t)&&(g=s[0]),a>-1&&s.splice(a,1),g&&!this._dragDropRegistry.isDragging(g)){let b=g.getRootElement();b.parentElement.insertBefore(d,b),s.splice(r,0,i)}else this._element.appendChild(d),s.push(i);d.style.transform="",this._cacheItemPositions()}withItems(i){this._activeDraggables=i.slice(),this._cacheItemPositions()}withSortPredicate(i){this._sortPredicate=i}reset(){this._activeDraggables?.forEach(i=>{let e=i.getRootElement();if(e){let t=this._itemPositions.find(n=>n.drag===i)?.initialTransform;e.style.transform=t||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(i){return this._getVisualItemPositions().findIndex(e=>e.drag===i)}getItemAtIndex(i){return this._getVisualItemPositions()[i]?.drag||null}updateOnScroll(i,e){this._itemPositions.forEach(({clientRect:t})=>{Li(t,i,e)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(i){this._element=i}_cacheItemPositions(){let i=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let t=e.getVisibleElement();return{drag:e,offset:0,initialTransform:t.style.transform||"",clientRect:Ao(t)}}).sort((e,t)=>i?e.clientRect.left-t.clientRect.left:e.clientRect.top-t.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(i,e,t){let n=this.orientation==="horizontal",r=n?e.left-i.left:e.top-i.top;return t===-1&&(r+=n?e.width-i.width:e.height-i.height),r}_getSiblingOffsetPx(i,e,t){let n=this.orientation==="horizontal",r=e[i].clientRect,s=e[i+t*-1],a=r[n?"width":"height"]*t;if(s){let d=n?"left":"top",g=n?"right":"bottom";t===-1?a-=s.clientRect[d]-r[g]:a+=r[d]-s.clientRect[g]}return a}_shouldEnterAsFirstChild(i,e){if(!this._activeDraggables.length)return!1;let t=this._itemPositions,n=this.orientation==="horizontal";if(t[0].drag!==this._activeDraggables[0]){let s=t[t.length-1].clientRect;return n?i>=s.right:e>=s.bottom}else{let s=t[0].clientRect;return n?i<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(i,e,t,n){let r=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:a,clientRect:d})=>{if(a===i)return!1;if(n){let g=r?n.x:n.y;if(a===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return r?e>=Math.floor(d.left)&&e<Math.floor(d.right):t>=Math.floor(d.top)&&t<Math.floor(d.bottom)});return s===-1||!this._sortPredicate(s,i)?-1:s}},Io=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(i,e){this._document=i,this._dragDropRegistry=e}start(i){let e=this._element.childNodes;this._relatedNodes=[];for(let t=0;t<e.length;t++){let n=e[t];this._relatedNodes.push([n,n.nextSibling])}this.withItems(i)}sort(i,e,t,n){let r=this._getItemIndexFromPointerPosition(i,e,t),s=this._previousSwap;if(r===-1||this._activeItems[r]===i)return null;let a=this._activeItems[r];if(s.drag===a&&s.overlaps&&s.deltaX===n.x&&s.deltaY===n.y)return null;let d=this.getItemIndex(i),g=i.getPlaceholderElement(),b=a.getRootElement();r>d?b.after(g):b.before(g),Qn(this._activeItems,d,r);let z=this._getRootNode().elementFromPoint(e,t);return s.deltaX=n.x,s.deltaY=n.y,s.drag=a,s.overlaps=b===z||b.contains(z),{previousIndex:d,currentIndex:r}}enter(i,e,t,n){let r=this._activeItems.indexOf(i);r>-1&&this._activeItems.splice(r,1);let s=n==null||n<0?this._getItemIndexFromPointerPosition(i,e,t):n;s===-1&&(s=this._getClosestItemIndexToPointer(i,e,t));let a=this._activeItems[s];a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(s,0,i),a.getRootElement().before(i.getPlaceholderElement())):(this._activeItems.push(i),this._element.appendChild(i.getPlaceholderElement()))}withItems(i){this._activeItems=i.slice()}withSortPredicate(i){this._sortPredicate=i}reset(){let i=this._element,e=this._previousSwap;for(let t=this._relatedNodes.length-1;t>-1;t--){let[n,r]=this._relatedNodes[t];n.parentNode===i&&n.nextSibling!==r&&(r===null?i.appendChild(n):r.parentNode===i&&i.insertBefore(n,r))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(i){return this._activeItems.indexOf(i)}getItemAtIndex(i){return this._activeItems[i]||null}updateOnScroll(){this._activeItems.forEach(i=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(i){i!==this._element&&(this._element=i,this._rootNode=void 0)}_getItemIndexFromPointerPosition(i,e,t){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(t)),r=n?this._activeItems.findIndex(s=>{let a=s.getRootElement();return n===a||a.contains(n)}):-1;return r===-1||!this._sortPredicate(r,i)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=Qi(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(i,e,t){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,r=-1;for(let s=0;s<this._activeItems.length;s++){let a=this._activeItems[s];if(a!==i){let{x:d,y:g}=a.getRootElement().getBoundingClientRect(),b=Math.hypot(e-d,t-g);b<n&&(n=b,r=s)}}return r}},ia=.05,sa=.05,Re=(function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o})(Re||{}),ge=(function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o})(ge||{}),Ro=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new P;entered=new P;exited=new P;dropped=new P;sorted=new P;receivingStarted=new P;receivingStopped=new P;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=Be.EMPTY;_verticalScrollDirection=Re.NONE;_horizontalScrollDirection=ge.NONE;_scrollNode;_stopScrollTimers=new P;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(i,e,t,n,r){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=r;let s=this.element=Te(i);this._document=t,this.withOrientation("vertical").withElementContainer(s),e.registerDropContainer(this),this._parentPositions=new Gn(t)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(i,e,t,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(i)),this._sortStrategy.enter(i,e,t,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:i,container:this,currentIndex:this.getItemIndex(i)})}exit(i){this._reset(),this.exited.next({item:i,container:this})}drop(i,e,t,n,r,s,a,d={}){this._reset(),this.dropped.next({item:i,currentIndex:e,previousIndex:t,container:this,previousContainer:n,isPointerOverContainer:r,distance:s,dropPoint:a,event:d})}withItems(i){let e=this._draggables;return this._draggables=i,i.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>i.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(i){return this._direction=i,this._sortStrategy instanceof Zn&&(this._sortStrategy.direction=i),this}connectedTo(i){return this._siblings=i.slice(),this}withOrientation(i){if(i==="mixed")this._sortStrategy=new Io(this._document,this._dragDropRegistry);else{let e=new Zn(this._dragDropRegistry);e.direction=this._direction,e.orientation=i,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,t)=>this.sortPredicate(e,t,this)),this}withScrollableParents(i){let e=this._container;return this._scrollableElements=i.indexOf(e)===-1?[e,...i]:i.slice(),this}withElementContainer(i){if(i===this._container)return this;let e=Te(this.element),t=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(i);return t>-1&&this._scrollableElements.splice(t,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(i),this._cachedShadowRoot=null,this._scrollableElements.unshift(i),this._container=i,this}getScrollableParents(){return this._scrollableElements}getItemIndex(i){return this._isDragging?this._sortStrategy.getItemIndex(i):this._draggables.indexOf(i)}getItemAtIndex(i){return this._isDragging?this._sortStrategy.getItemAtIndex(i):this._draggables[i]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(i,e,t,n){if(this.sortingDisabled||!this._domRect||!qs(this._domRect,ia,e,t))return;let r=this._sortStrategy.sort(i,e,t,n);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:i})}_startScrollingIfNecessary(i,e){if(this.autoScrollDisabled)return;let t,n=Re.NONE,r=ge.NONE;if(this._parentPositions.positions.forEach((s,a)=>{a===this._document||!s.clientRect||t||qs(s.clientRect,ia,i,e)&&([n,r]=fc(a,s.clientRect,this._direction,i,e),(n||r)&&(t=a))}),!n&&!r){let{width:s,height:a}=this._viewportRuler.getViewportSize(),d={width:s,height:a,top:0,right:s,bottom:a,left:0};n=aa(d,e),r=la(d,i),t=window}t&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||t!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=t,(n||r)&&t?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let i=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=i.msScrollSnapType||i.scrollSnapType||"",i.scrollSnapType=i.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let i=this._container.style;i.scrollSnapType=i.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),$o(0,Bo).pipe(Mt(this._stopScrollTimers)).subscribe(()=>{let i=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Re.UP?i.scrollBy(0,-e):this._verticalScrollDirection===Re.DOWN&&i.scrollBy(0,e),this._horizontalScrollDirection===ge.LEFT?i.scrollBy(-e,0):this._horizontalScrollDirection===ge.RIGHT&&i.scrollBy(e,0)})};_isOverContainer(i,e){return this._domRect!=null&&Oo(this._domRect,i,e)}_getSiblingContainerFromPosition(i,e,t){return this._siblings.find(n=>n._canReceive(i,e,t))}_canReceive(i,e,t){if(!this._domRect||!Oo(this._domRect,e,t)||!this.enterPredicate(i,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,t);return n?n===this._container||this._container.contains(n):!1}_startReceiving(i,e){let t=this._activeSiblings;!t.has(i)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(t.add(i),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:i,receiver:this,items:e}))}_stopReceiving(i){this._activeSiblings.delete(i),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:i,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(i=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(i);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let i=Qi(this._container);this._cachedShadowRoot=i||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let i=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,i))}};function aa(o,i){let{top:e,bottom:t,height:n}=o,r=n*sa;return i>=e-r&&i<=e+r?Re.UP:i>=t-r&&i<=t+r?Re.DOWN:Re.NONE}function la(o,i){let{left:e,right:t,width:n}=o,r=n*sa;return i>=e-r&&i<=e+r?ge.LEFT:i>=t-r&&i<=t+r?ge.RIGHT:ge.NONE}function fc(o,i,e,t,n){let r=aa(i,n),s=la(i,t),a=Re.NONE,d=ge.NONE;if(r){let g=o.scrollTop;r===Re.UP?g>0&&(a=Re.UP):o.scrollHeight-g>o.clientHeight&&(a=Re.DOWN)}if(s){let g=o.scrollLeft;e==="rtl"?s===ge.RIGHT?g<0&&(d=ge.RIGHT):o.scrollWidth+g>o.clientWidth&&(d=ge.LEFT):s===ge.LEFT?g>0&&(d=ge.LEFT):o.scrollWidth-g>o.clientWidth&&(d=ge.RIGHT)}return[a,d]}var Ai={capture:!0},Eo={passive:!1,capture:!0},_c=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275cmp=S({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(t,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),ca=(()=>{class o{_ngZone=c(Se);_document=c(Bt);_styleLoader=c(Zt);_renderer=c(gi).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new P;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=O([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new P;pointerUp=new P;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,Eo)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,t){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(_c),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=t.type.startsWith("touch"),r=a=>this.pointerUp.next(a),s=[["scroll",a=>this._scroll.next(a),Ai],["selectstart",this._preventDefaultWhileDragging,Eo]];n?s.push(["touchend",r,Ai],["touchcancel",r,Ai]):s.push(["mouseup",r,Ai]),n||s.push(["mousemove",a=>this.pointerMove.next(a),Eo]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=s.map(([a,d,g])=>this._renderer.listen(this._document,a,d,g))})}}stopDragging(e){this._activeDragInstances.update(t=>{let n=t.indexOf(e);return n>-1?(t.splice(n,1),[...t]):t}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let t=[this._scroll];return e&&e!==this._document&&t.push(new Vt(n=>this._ngZone.runOutsideAngular(()=>{let r=this._renderer.listen(e,"scroll",s=>{this._activeDragInstances().length&&n.next(s)},Ai);return()=>{r()}}))),ht(...t)}registerDirectiveNode(e,t){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,t)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),vc={dragStartThreshold:5,pointerDirectionChangeThreshold:5},da=(()=>{class o{_document=c(Bt);_ngZone=c(Se);_viewportRuler=c(nn);_dragDropRegistry=c(ca);_renderer=c(gi).createRenderer(null,null);constructor(){}createDrag(e,t=vc){return new ko(e,t,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Ro(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),na=new re("CDK_DRAG_PARENT");var bc=new re("CdkDragHandle");var ha=new re("CDK_DRAG_CONFIG"),pa=new re("CdkDropList"),Xn=(()=>{class o{element=c(me);dropContainer=c(pa,{optional:!0,skipSelf:!0});_ngZone=c(Se);_viewContainerRef=c(Bi);_dir=c(vi,{optional:!0});_changeDetectorRef=c(Ke);_selfHandle=c(bc,{optional:!0,self:!0});_parentDrag=c(na,{optional:!0,skipSelf:!0});_dragDropRegistry=c(ca);_destroyed=new P;_handles=new He([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new se;released=new se;ended=new se;entered=new se;exited=new se;dropped=new se;moved=new Vt(e=>{let t=this._dragRef.moved.pipe(Vi(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{t.unsubscribe()}});_injector=c($e);constructor(){let e=this.dropContainer,t=c(ha,{optional:!0}),n=c(da);this._dragRef=n.createDrag(this.element,{dragStartThreshold:t&&t.dragStartThreshold!=null?t.dragStartThreshold:5,pointerDirectionChangeThreshold:t&&t.pointerDirectionChangeThreshold!=null?t.pointerDirectionChangeThreshold:5,zIndex:t?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),t&&this._assignDefaults(t),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Mt(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Et(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let t=e.rootElementSelector,n=e.freeDragPosition;t&&!t.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let t=this._handles.getValue();t.push(e),this._handles.next(t)}_removeHandle(e){let t=this._handles.getValue(),n=t.indexOf(e);n>-1&&(t.splice(n,1),this._handles.next(t))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,t=e;this.rootElementSelector&&(t=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(t||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Te(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let t=this._dir,n=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:Xi(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),t&&e.withDirection(t.value)}}),e.beforeStarted.pipe(Ni(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let t=this.element.nativeElement.parentElement;for(;t;){let n=this._dragDropRegistry.getDragDirectiveForNode(t);if(n){e.withParent(n._dragRef);break}t=t.parentElement}})}_handleEvents(e){e.started.subscribe(t=>{this.started.emit({source:this,event:t.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(t=>{this.released.emit({source:this,event:t.event})}),e.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),e.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),e.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event})})}_assignDefaults(e){let{lockAxis:t,dragStartDelay:n,constrainPosition:r,previewClass:s,boundaryElement:a,draggingDisabled:d,rootElementSelector:g,previewContainer:b}=e;this.disabled=d??!1,this.dragStartDelay=n||0,this.lockAxis=t||null,r&&(this.constrainPosition=r),s&&(this.previewClass=s),a&&(this.boundaryElement=a),g&&(this.rootElementSelector=g),b&&(this.previewContainer=b)}_setupHandlesListener(){this._handles.pipe(jt(e=>{let t=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&t.push(this.element),this._dragRef.withHandles(t)}),Nt(e=>ht(...e.map(t=>t._stateChanges.pipe(mi(t))))),Mt(this._destroyed)).subscribe(e=>{let t=this._dragRef,n=e.element.nativeElement;e.disabled?t.disableHandle(n):t.enableHandle(n)})}static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(t,n){t&2&&G("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",le],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",sr]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[de([{provide:na,useExisting:o}]),Ht]})}return o})(),oa=new re("CdkDropListGroup");var Yn=(()=>{class o{element=c(me);_changeDetectorRef=c(Ke);_scrollDispatcher=c(fr);_dir=c(vi,{optional:!0});_group=c(oa,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new P;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=c(Ze).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new se;entered=new se;exited=new se;sorted=new se;_unsortedItems=new Set;constructor(){let e=c(da),t=c(ha,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,t&&this._assignDefaults(t),this._dropListRef.enterPredicate=(n,r)=>this.enterPredicate(n.data,r.data),this._dropListRef.sortPredicate=(n,r,s)=>this.sortPredicate(n,r.data,s.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),o._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(t=>t._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let t=this._latestSortedRefs.indexOf(e._dragRef);t>-1&&(this._latestSortedRefs.splice(t,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,t)=>e._dragRef.getVisibleElement().compareDocumentPosition(t._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=o._dropLists.indexOf(this);e>-1&&o._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(mi(this._dir.value),Mt(this._destroyed)).subscribe(t=>e.withDirection(t)),e.beforeStarted.subscribe(()=>{let t=Yi(this.connectedTo).map(n=>{if(typeof n=="string"){let r=o._dropLists.find(s=>s.id===n);return r}return n});if(this._group&&this._group._items.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),!this._scrollableParentsResolved){let n=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(r=>r.getElementRef().nativeElement);this._dropListRef.withScrollableParents(n),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let n=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(n)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Xi(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(t.filter(n=>n&&n!==this).map(n=>n._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(t=>t._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(t=>{this.entered.emit({container:this,item:t.item.data,currentIndex:t.currentIndex})}),e.exited.subscribe(t=>{this.exited.emit({container:this,item:t.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(t=>{this.sorted.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,container:this,item:t.item.data})}),e.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,item:t.item.data,isPointerOverContainer:t.isPointerOverContainer,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),ht(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:t,draggingDisabled:n,sortingDisabled:r,listAutoScrollDisabled:s,listOrientation:a}=e;this.disabled=n??!1,this.sortingDisabled=r??!1,this.autoScrollDisabled=s??!1,this.orientation=a||"vertical",this.lockAxis=t||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(t){return new(t||o)};static \u0275dir=xe({type:o,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(t,n){t&2&&(Ae("id",n.id),G("cdk-drop-list-disabled",n.disabled)("cdk-drop-list-dragging",n._dropListRef.isDragging())("cdk-drop-list-receiving",n._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",le],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",le],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",le],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",le]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[de([{provide:oa,useValue:void 0},{provide:pa,useExisting:o}])]})}return o})();function Cc(o,i){if(o&1){let e=F();h(0,"div",7),C("mousedown",function(){let n=T(e).$implicit,r=x(2);return k(r.onSectorSelected(n))}),m(1),h(2,"button",8),C("mousedown",function(n){return T(e),k(n.stopPropagation())}),h(3,"mat-icon",9),m(4,"more_vert"),p()(),h(5,"mat-menu",10,0)(7,"button",11),C("click",function(){let n=T(e).$implicit,r=x(2);return k(r.navigateToContourPanel(n))}),h(8,"mat-icon",12),m(9,"draw"),p(),m(10),_(11,"translate"),p(),h(12,"button",11),C("click",function(){let n=T(e).$implicit,r=x(2);return k(r.navigateToPropertyPanel(n))}),h(13,"mat-icon",12),m(14,"settings_input_composite"),p(),m(15),_(16,"translate"),p(),h(17,"button",11),C("click",function(){let n=T(e).$implicit,r=x(2);return k(r.openRemoveSectorDialog(n))}),h(18,"mat-icon",12),m(19,"delete"),p(),m(20),_(21,"translate"),p()()()}if(o&2){let e=i.$implicit,t=Ee(6),n=x(2);G("selected",e===n.selectedSector),l(),D(" ",e.name," "),l(),y("matMenuTriggerFor",t),l(8),D(" ",v(11,7,"tool.sectors.contourList.editContour")," "),l(5),D(" ",v(16,9,"tool.sectors.contourList.editProperties")," "),l(5),D(" ",v(21,11,"tool.sectors.contourList.removeSector")," ")}}function yc(o,i){if(o&1){let e=F();h(0,"div",5),C("cdkDropListDropped",function(n){T(e);let r=x();return k(r.dropSectorBox(n))}),Pe(1,Cc,22,13,"div",6,$t),p()}if(o&2){let e=x();l(),Me(e.sectors())}}function Sc(o,i){o&1&&(h(0,"div",4),m(1),_(2,"translate"),p()),o&2&&(l(),f(v(2,1,"tool.sectors.contourList.noSectors")))}var ma=(()=>{class o{constructor(){this.store=c(A),this.translate=c(ee),this.dialog=c(bt),this.router=c(K),this.destroyRef=c(Y),this.sectors=this.store.selectSignal(fe),this.sectorsContoursService=c(ct)}openRemoveSectorDialog(e){let t={title:this.translate.instant("tool.sectors.contourList.removeSector"),message:this.translate.instant("tool.sectors.contourList.removeSectorMessage",{sectorName:e.name})};this.dialog.open(wt,{data:t}).afterClosed().pipe(Q(this.destroyRef)).subscribe(n=>{n&&(this.store.dispatch(ue.sectorRemoved({sector:e})),this.selectedSector===e&&this.resetSelectedSector(),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector}))})}emitSectorToEditContour(e){this.sectorsContoursService.emitEditedSectorContour({sector:ae(M({},e),{vertices:[...e.vertices]}),selectedVertex:e.vertices.at(-1)})}navigateToNewSectorPanel(){this.router.navigate(["/tool/sectors/contour"])}navigateToContourPanel(e){this.router.navigate([`/tool/sectors/${e.id}/contour`])}navigateToPropertyPanel(e){this.router.navigate([`/tool/sectors/${e.id}/property`])}emitSectorToEditProperty(e){this.sectorsContoursService.emitEditedSectorProperty({sector:e,mesh:null,contour:null})}onSectorSelected(e){this.selectedSector=e,this.sectorsContoursService.emitSectorListChanged({selectedSector:e})}dropSectorBox(e){this.store.dispatch(ue.sectorShifted({prevIndex:e.previousIndex,newIndex:e.currentIndex})),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector})}resetSelectedSector(){let e=this.sectors();this.selectedSector=e.length?e[0]:null}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sectors-contours-list"]],decls:6,vars:4,consts:[["menu","matMenu"],[1,"actions"],["mat-flat-button","","color","accent",3,"click"],["cdkDropList","",1,"sectors-list"],[1,"no-sectors"],["cdkDropList","",1,"sectors-list",3,"cdkDropListDropped"],["cdkDrag","",1,"sector-box",3,"selected"],["cdkDrag","",1,"sector-box",3,"mousedown"],["mat-icon-button","",1,"sector-actions",3,"mousedown","matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(t,n){t&1&&(h(0,"div",1)(1,"button",2),C("click",function(){return n.navigateToNewSectorPanel()}),m(2),_(3,"translate"),p()(),W(4,yc,3,0,"div",3)(5,Sc,3,3,"div",4)),t&2&&(l(2),D(" ",v(3,2,"tool.sectors.contourList.addSector")," "),l(2),q(n.sectors().length?4:5))},dependencies:[L,te,ke,Oe,De,ti,Jt,Yt,ei,Yn,Xn,$,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .no-sectors[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.sectors-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.sectors-list[_ngcontent-%COMP%]   .sector-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{cursor:move}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.sectors-list[_ngcontent-%COMP%]   .sector-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.sectors-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return o})();var wc=["*"],ua=(()=>{class o{constructor(){this.label=J.required(),this.shouldBeOpen=J(!0),this.isOpen=O(!0)}ngOnInit(){this.isOpen.set(this.shouldBeOpen())}toggle(){this.isOpen.update(e=>!e)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-extended-panel"]],inputs:{label:[1,"label"],shouldBeOpen:[1,"shouldBeOpen"]},ngContentSelectors:wc,decls:8,vars:4,consts:[[1,"label"],[1,"label-content"],["mat-icon-button","",1,"toggle-button",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"]],template:function(t,n){t&1&&(mt(),h(0,"div",0)(1,"span",1),m(2),p(),h(3,"button",2),C("click",function(){return n.toggle()}),h(4,"mat-icon",3),m(5," keyboard_arrow_up "),p()()(),h(6,"app-expandable-panel",4),st(7),p()),t&2&&(l(2),f(n.label()),l(2),G("chevron--closed",!n.isOpen()),l(2),y("isOpen",n.isOpen()))},dependencies:[Oe,De,L,ke,ri],styles:["[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .label-content[_ngcontent-%COMP%]{margin-left:15px;font-weight:500}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{margin-left:auto}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}"],changeDetection:0})}}return o})();var ga=(()=>{class o{constructor(){this.http=c(cr)}getPolygonTriangulationMesh(e){let t={headers:new lr({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"})};return this.http.post(Fs(),e,t).pipe(jt(n=>ki.restore(n)))}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=ne({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var fa=(()=>{class o{constructor(){this.store=c(A),this.dataService=c(ga),this.snackBar=c(it),this.service=c(ct),this.translate=c(ee),this.route=c(ft),this.router=c(K),this.destroyRef=c(Y),this.errorLabels={required:()=>this.translate.instant("common.fieldRequired"),valueToSmall:()=>this.translate.instant("tool.sectors.sectorProperty.valueToSmall"),sectionMinAngleOutOfRange:()=>this.translate.instant("tool.sectors.sectorProperty.sectionMinAngleOutOfRange"),valueCannotBeNegative:()=>this.translate.instant("tool.sectors.sectorProperty.valueCannotBeNegative")},this.formData=O({sectionMaxArea:0,sectionMinAngle:0,minTileRadius:0,maxTileRadius:0,tilesMargin:0,populationParams:{initialPopulationSize:0,countOfTriesToInsertTile:0,countOfTrianglePositionDraws:0,countOfColorMatchingAttempts:0,iterationsCount:0,populationSize:0},evaluationParams:{singleSectionPopulation:0,overlappingAreaOutsideSector:0,additionalPopulationOfNeighboringSectors:0,overlappingNotPopulatedSections:0,tileColorMismatch:0}}),this.form=Ct(this.formData,e=>{U(e.sectionMaxArea),Le(e.sectionMaxArea,.01,{error:{kind:"valueToSmall"}}),U(e.sectionMinAngle),Le(e.sectionMinAngle,10,{error:{kind:"sectionMinAngleOutOfRange"}}),It(e.sectionMinAngle,90,{error:{kind:"sectionMinAngleOutOfRange"}}),Le(e.minTileRadius,0,{error:{kind:"valueCannotBeNegative"}}),Le(e.maxTileRadius,.01,{error:{kind:"valueToSmall"}}),Le(e.tilesMargin,.01,{error:{kind:"valueToSmall"}}),U(e.tilesMargin),U(e.populationParams.initialPopulationSize),U(e.populationParams.countOfTriesToInsertTile),U(e.populationParams.countOfTrianglePositionDraws),U(e.populationParams.countOfColorMatchingAttempts),U(e.populationParams.iterationsCount),U(e.populationParams.populationSize),U(e.evaluationParams.singleSectionPopulation),U(e.evaluationParams.overlappingAreaOutsideSector),U(e.evaluationParams.additionalPopulationOfNeighboringSectors),U(e.evaluationParams.overlappingNotPopulatedSections),U(e.evaluationParams.tileColorMismatch)}),this.triangulationMeshEffect=we(()=>{let e={polygonVertices:this.sector.vertices,sectionMaxArea:this.form.sectionMaxArea().value(),sectionMinAngle:this.form.sectionMinAngle().value()};this.dataService.getPolygonTriangulationMesh(e).pipe(Q(this.destroyRef)).subscribe({next:t=>this.service.emitEditedSectorProperty({sector:this.sector,mesh:t.triangles,contour:t.contour}),error:()=>this.showPolygonTriangulationError()})})}ngOnInit(){this.prepareSector()}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){this.sector=this.store.selectSignal(fe)().find(n=>n.id===e);let t=this.sector.properties;this.formData.set(ae(M({},t),{populationParams:M({},t.populationParams),evaluationParams:M({},t.evaluationParams)}))}}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.service.emitEditedSectorProperty(null),this.navigateToSectorList()}getFieldErrorLabel(e){return Ne.getFieldErrorLabel(e,this.errorLabels)}save(){pn(this.form,async()=>{let e=this.formData();this.store.dispatch(ue.sectorModified({modifiedSector:ae(M({},this.sector),{properties:e})})),this.service.emitEditedSectorProperty(null),this.navigateToSectorList()})}showPolygonTriangulationError(){this.snackBar.open(this.translate.instant("tool.sectors.sectorProperty.errorOnSectorMeshRequesting"),this.translate.instant("common.ok"),{duration:2e3})}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-property-editor"]],features:[de([{provide:po,useFactory:e=>ae(M({},e),{subscriptSizing:"dynamic"}),deps:[[new Ko,new Zo,po]]}])],decls:128,vars:124,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"sector-property-form"],[3,"label"],[1,"form-group"],["matTooltipPosition","left",1,"density-3",3,"matTooltip"],["matInput","","type","number",3,"field"],[3,"label","shouldBeOpen"]],template:function(t,n){t&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.cancel()}),m(2),_(3,"translate"),p(),h(4,"button",2),C("click",function(){return n.save()}),m(5),_(6,"translate"),p()(),h(7,"div",3)(8,"app-extended-panel",4)(9,"div",5)(10,"mat-form-field",6)(11,"mat-label"),m(12),_(13,"translate"),p(),w(14,"input",7),j(),h(15,"mat-error"),m(16),p()(),h(17,"mat-form-field",6)(18,"mat-label"),m(19),_(20,"translate"),p(),w(21,"input",7),j(),h(22,"mat-error"),m(23),p()()()(),h(24,"app-extended-panel",4)(25,"div",5)(26,"mat-form-field",6)(27,"mat-label"),m(28),_(29,"translate"),p(),w(30,"input",7),j(),h(31,"mat-error"),m(32),p()(),h(33,"mat-form-field",6)(34,"mat-label"),m(35),_(36,"translate"),p(),w(37,"input",7),j(),h(38,"mat-error"),m(39),p()(),h(40,"mat-form-field",6)(41,"mat-label"),m(42),_(43,"translate"),p(),w(44,"input",7),j(),h(45,"mat-error"),m(46),p()()()(),h(47,"app-extended-panel",8)(48,"div",5)(49,"mat-form-field",6)(50,"mat-label"),m(51),_(52,"translate"),p(),w(53,"input",7),j(),h(54,"mat-error"),m(55),p()(),h(56,"mat-form-field",6)(57,"mat-label"),m(58),_(59,"translate"),p(),w(60,"input",7),j(),h(61,"mat-error"),m(62),p()(),h(63,"mat-form-field",6)(64,"mat-label"),m(65),_(66,"translate"),p(),w(67,"input",7),j(),h(68,"mat-error"),m(69),p()(),h(70,"mat-form-field",6)(71,"mat-label"),m(72),_(73,"translate"),p(),w(74,"input",7),j(),h(75,"mat-error"),m(76),p()(),h(77,"mat-form-field",6)(78,"mat-label"),m(79),_(80,"translate"),p(),w(81,"input",7),j(),h(82,"mat-error"),m(83),p()(),h(84,"mat-form-field",6)(85,"mat-label"),m(86),_(87,"translate"),p(),w(88,"input",7),j(),h(89,"mat-error"),m(90),p()()()(),h(91,"app-extended-panel",8)(92,"div",5)(93,"mat-form-field",6)(94,"mat-label"),m(95),_(96,"translate"),p(),w(97,"input",7),j(),h(98,"mat-error"),m(99),p()(),h(100,"mat-form-field",6)(101,"mat-label"),m(102),_(103,"translate"),p(),w(104,"input",7),j(),h(105,"mat-error"),m(106),p()(),h(107,"mat-form-field",6)(108,"mat-label"),m(109),_(110,"translate"),p(),w(111,"input",7),j(),h(112,"mat-error"),m(113),p()(),h(114,"mat-form-field",6)(115,"mat-label"),m(116),_(117,"translate"),p(),w(118,"input",7),j(),h(119,"mat-error"),m(120),p()(),h(121,"mat-form-field",6)(122,"mat-label"),m(123),_(124,"translate"),p(),w(125,"input",7),j(),h(126,"mat-error"),m(127),p()()()()()),t&2&&(l(2),D(" ",v(3,88,"common.cancel")," "),l(3),D(" ",v(6,90,"common.confirm")," "),l(3),y("label",n.translate.instant("tool.sectors.sectorProperty.sectorsSize")),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.maxAreaHint")),l(2),f(v(13,92,"tool.sectors.sectorProperty.maxArea")),l(2),B(n.form.sectionMaxArea),l(2),f(n.getFieldErrorLabel(n.form.sectionMaxArea())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minAngleHint")),l(2),f(v(20,94,"tool.sectors.sectorProperty.minAngle")),l(2),B(n.form.sectionMinAngle),l(2),f(n.getFieldErrorLabel(n.form.sectionMinAngle())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.tilesLimitations")),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minRadiusHint")),l(2),f(v(29,96,"tool.sectors.sectorProperty.minRadius")),l(2),B(n.form.minTileRadius),l(2),f(n.getFieldErrorLabel(n.form.minTileRadius())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.maxRadiusHint")),l(2),f(v(36,98,"tool.sectors.sectorProperty.maxRadius")),l(2),B(n.form.maxTileRadius),l(2),f(n.getFieldErrorLabel(n.form.maxTileRadius())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minMarginHint")),l(2),f(v(43,100,"tool.sectors.sectorProperty.minMargin")),l(2),B(n.form.tilesMargin),l(2),f(n.getFieldErrorLabel(n.form.tilesMargin())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.populationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.initialPopulationSizeHint")),l(2),f(v(52,102,"tool.sectors.sectorProperty.initialPopulationSize")),l(2),B(n.form.populationParams.initialPopulationSize),l(2),f(n.getFieldErrorLabel(n.form.populationParams.initialPopulationSize())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.populationSizeHint")),l(2),f(v(59,104,"tool.sectors.sectorProperty.populationSize")),l(2),B(n.form.populationParams.populationSize),l(2),f(n.getFieldErrorLabel(n.form.populationParams.populationSize())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.iterationsCountHint")),l(2),f(v(66,106,"tool.sectors.sectorProperty.iterationsCount")),l(2),B(n.form.populationParams.iterationsCount),l(2),f(n.getFieldErrorLabel(n.form.populationParams.iterationsCount())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfTrianglePositionDrawsHint")),l(2),f(v(73,108,"tool.sectors.sectorProperty.countOfTrianglePositionDraws")),l(2),B(n.form.populationParams.countOfTrianglePositionDraws),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfTrianglePositionDraws())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfTriesToInsertTileHint")),l(2),f(v(80,110,"tool.sectors.sectorProperty.countOfTriesToInsertTile")),l(2),B(n.form.populationParams.countOfTriesToInsertTile),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfTriesToInsertTile())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfColorMatchingAttemptsHint")),l(2),f(v(87,112,"tool.sectors.sectorProperty.countOfColorMatchingAttempts")),l(2),B(n.form.populationParams.countOfColorMatchingAttempts),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfColorMatchingAttempts())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.evaluationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.singleSectionPopulationHint")),l(2),f(v(96,114,"tool.sectors.sectorProperty.singleSectionPopulation")),l(2),B(n.form.evaluationParams.singleSectionPopulation),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.singleSectionPopulation())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(v(103,116,"tool.sectors.sectorProperty.overlappingAreaOutsideSector")),l(2),B(n.form.evaluationParams.overlappingAreaOutsideSector),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.overlappingAreaOutsideSector())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(v(110,118,"tool.sectors.sectorProperty.additionalPopulationOfNeighboringSectors")),l(2),B(n.form.evaluationParams.additionalPopulationOfNeighboringSectors),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.additionalPopulationOfNeighboringSectors())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingNotPopulatedSectionsHint")),l(2),f(v(117,120,"tool.sectors.sectorProperty.overlappingNotPopulatedSections")),l(2),B(n.form.evaluationParams.overlappingNotPopulatedSections),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.overlappingNotPopulatedSections())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.tileColorMismatchHint")),l(2),f(v(124,122,"tool.sectors.sectorProperty.tileColorMismatch")),l(2),B(n.form.evaluationParams.tileColorMismatch),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.tileColorMismatch())))},dependencies:[L,te,Fe,Je,Ye,St,tt,et,xr,wr,ua,$,yt,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;width:100%}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:18px;margin-top:12px}"],changeDetection:0})}}return o})();function _a(o){return({value:i})=>o().includes(i())?at({kind:"nonUnique"}):null}var Jn=class{static isPointInsidePolygon(i,e){if(i.length<3)return!1;let t=new R(Number.MAX_VALUE,e.y),n=new dt(e,t),r=0,s=0;do{let a=new dt(i[s],i[(s+1)%i.length]);if(this.areLineIntersecting(a,n)){if(this.getDirection(a.start,e,a.end)==0)return this.isPointOnLine(a,e);r++}s=(s+1)%i.length}while(s!=0);return(r&1)==1}static areLineIntersecting(i,e){let t=this.getDirection(i.start,i.end,e.start),n=this.getDirection(i.start,i.end,e.end),r=this.getDirection(e.start,e.end,i.start),s=this.getDirection(e.start,e.end,i.end);return!!(t!=n&&r!=s||t==0&&this.isPointOnLine(i,e.start)||n==0&&this.isPointOnLine(i,e.end)||r==0&&this.isPointOnLine(e,i.start)||s==0&&this.isPointOnLine(e,i.end))}static isPointOnLine(i,e){return e.x<=Math.max(i.start.x,i.end.x)&&e.x>=Math.min(i.start.x,i.end.x)&&e.y<=Math.max(i.start.y,i.end.y)&&e.y>=Math.min(i.start.y,i.end.y)}static getDirection(i,e,t){let n=(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y);return n==0?0:n<0?2:1}};function va({value:o}){return o().length<3?at({kind:"tooFewVertices"}):xc(o())?at({kind:"edgesIntersect"}):null}function xc(o){let i=[];for(let e=0;e<o.length;++e)i.push(new dt(o[e],o.at(e-1)));for(let e=0;e<o.length;++e)for(let t=0;t<o.length;++t)if(!(e===t||(e+1)%o.length===t||(t+1)%o.length===e)&&Jn.areLineIntersecting(i[e],i[t]))return!0;return!1}function Pc(o,i){if(o&1){let e=F();h(0,"div",11),C("mousedown",function(){let n=T(e).$implicit,r=x(2);return k(r.onBoxSelected(n))}),m(1),h(2,"button",12),C("click",function(){let n=T(e).$implicit,r=x(2);return k(r.removeVertex(n))})("mousedown",function(n){return T(e),k(n.stopPropagation())}),h(3,"mat-icon",13),m(4,"close"),p()()()}if(o&2){let e=i.$implicit,t=x(2);G("selected",e===t.selectedVertex()),l(),D(" ",t.getVertexLabel(e)," ")}}function Mc(o,i){if(o&1){let e=F();h(0,"div",9),C("cdkDropListDropped",function(n){T(e);let r=x();return k(r.dropVertexBox(n))}),Pe(1,Pc,5,3,"div",10,$t),p()}if(o&2){let e=x();l(),Me(e.form.vertices().value())}}function Ec(o,i){o&1&&(h(0,"div",8),m(1),_(2,"translate"),p()),o&2&&(l(),f(v(2,1,"tool.sectors.sectorContour.addSectorVertices")))}var Fo=(()=>{class o{constructor(){this.selectedVertex=O(null),this.store=c(A),this.snackbarService=c(it),this.sectorsContoursService=c(ct),this.translate=c(ee),this.route=c(ft),this.router=c(K),this.destroyRef=c(Y),this.existingSectors=this.store.selectSignal(fe),this.errorLabels={edgesIntersect:()=>this.translate.instant("tool.sectors.sectorContour.linesCannotIntersecting"),tooFewVertices:()=>this.translate.instant("tool.sectors.sectorContour.tooFewVertices"),nonUnique:()=>this.translate.instant("tool.sectors.sectorContour.nameAlreadyInUse"),required:()=>this.translate.instant("tool.sectors.sectorContour.nameRequired")},this.formData=O({id:null,name:null,color:null,vertices:[],properties:null}),this.usedSectorNames=V(()=>this.existingSectors().filter(e=>e.id!==this.formData().id).map(e=>e.name)),this.form=Ct(this.formData,e=>{U(e.name),kt(e.name,_a(this.usedSectorNames)),U(e.color),kt(e.vertices,va)}),this.onContourChangeEffect=we(()=>{this.sectorsContoursService.emitEditedSectorContour({sector:this.formData(),selectedVertex:this.selectedVertex()})})}ngOnInit(){this.prepareSector(),this.subscribeOnCanvasClicked()}subscribeOnCanvasClicked(){this.sectorsContoursService.canvasClicked$.pipe(Q(this.destroyRef)).subscribe(e=>this.addVertex(new R(e.x,e.y)))}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){let t=this.existingSectors().find(n=>n.id===e);this.formData.set(ae(M({},t),{vertices:t.vertices.map(n=>new R(n.x,n.y))})),this.selectedVertex.set(this.formData().vertices[0])}else{let t=ct.createNewSector();this.formData.set(t)}}addVertex(e){let t=[...this.form.vertices().value()],n=t.indexOf(this.selectedVertex());t.splice(n+1,0,e),this.form.vertices().setControlValue(t),this.selectedVertex.set(e)}removeVertex(e){let t=this.form.vertices().value().filter(n=>n!==e);this.form.vertices().setControlValue(t),e===this.selectedVertex()&&this.resetSelectedVertex()}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()}save(){this.form().valid()?(this.store.dispatch(ue.sectorModified({modifiedSector:this.formData()})),this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()):this.showWarning(this.showValidationError())}showValidationError(){let e=this.form().errorSummary();return Ne.getErrorLabel(e,this.errorLabels)}getFieldErrorLabel(e){return Ne.getErrorLabel(e.errorSummary(),this.errorLabels)}showWarning(e){this.snackbarService.open(e,this.translate.instant("common.ok"),{duration:3e3})}onBoxSelected(e){this.selectedVertex.set(e)}dropVertexBox(e){let t=this.form.vertices().value();Qn(t,e.previousIndex,e.currentIndex),this.form.vertices().setControlValue(t)}getVertexLabel(e){return`(${e.x.toFixed(2)}, ${e.y.toFixed(2)})`}resetSelectedVertex(){let e=this.form.vertices().value();this.selectedVertex.set(e.at(-1)??null)}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-contour-edition"]],decls:18,vars:16,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"info"],["subscriptSizing","dynamic",1,"density-3"],["matInput","",3,"field"],[3,"label","field"],["cdkDropList","",1,"vertices-list"],[1,"no-vertices"],["cdkDropList","",1,"vertices-list",3,"cdkDropListDropped"],["cdkDrag","",1,"vertex-box",3,"selected"],["cdkDrag","",1,"vertex-box",3,"mousedown"],["mat-icon-button","",1,"vertex-remove",3,"click","mousedown"],["matListIcon",""]],template:function(t,n){t&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.cancel()}),m(2),_(3,"translate"),p(),h(4,"button",2),C("click",function(){return n.save()}),m(5),_(6,"translate"),p()(),h(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),m(10),_(11,"translate"),p(),w(12,"input",5),j(),h(13,"mat-error"),m(14),p()(),w(15,"app-color-picker",6),j(),W(16,Mc,3,0,"div",7)(17,Ec,3,3,"div",8),p()),t&2&&(l(2),f(v(3,10,"common.cancel")),l(3),f(v(6,12,"common.confirm")),l(5),f(v(11,14,"tool.sectors.sectorContour.sectorName")),l(2),B(n.form.name),l(2),f(n.getFieldErrorLabel(n.form.name())),l(),y("label",n.translate.instant("tool.sectors.sectorContour.sectorColor")),B(n.form.color),l(),q(n.form.vertices().value().length?16:17))},dependencies:[L,te,ke,Yn,Xn,Fe,Je,Ye,St,tt,et,Oe,De,Sn,$,yt,Z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .no-vertices[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.vertices-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.vertices-list[_ngcontent-%COMP%]   .vertex-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{cursor:move}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.vertices-list[_ngcontent-%COMP%]   .vertex-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.vertices-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return o})();var Ub=[{path:"",redirectTo:"config",pathMatch:"full"},{path:"config",component:Zr,children:[{path:"",component:Qr},{path:"project",component:os}]},{path:"tray",component:ss,canActivate:[bn],children:[{path:"",component:_s},{path:"random",component:yo},{path:"random/:id",component:yo},{path:"tile/:id",component:ys}]},{path:"sectors",component:Os,canActivate:[bn],children:[{path:"",component:ma},{path:":id/property",component:fa},{path:":id/contour",component:Fo},{path:"contour",component:Fo}]},{path:"generating",component:Hs,canActivate:[bn,zs]}];export{Ub as toolRoutes};
