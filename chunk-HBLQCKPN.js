import{$ as Hi,$a as cr,$c as fn,$d as ei,A as Bi,Aa as Ut,Ab as Ct,Ac as xr,Ad as fo,B as oe,Ba as C,Bb as Gt,Bc as Mr,Bd as _o,C as qe,Ca as M,Cb as X,Cc as ao,Cd as it,D as re,Da as _t,Dc as Pr,Dd as vo,Ea as ct,Ec as Er,Ed as dt,F as c,Fa as cn,Fc as Ci,Fd as qr,G as Yn,Ga as vt,Gc as Dr,Gd as kt,H as T,Ha as Ze,Hc as Or,Hd as ot,I as k,Ia as Xe,Ib as te,Id as It,J as Ge,Ja as nr,Jb as G,Jd as He,K as Bt,Ka as Ui,Kc as Tr,Kd as Gr,L as J,La as Wt,Lb as B,Lc as kr,Ld as H,M as se,Ma as Oe,Mb as bi,Mc as lo,N as xe,Na as Qe,Nb as Kt,Nc as Ir,Nd as Kr,O as D,Oa as K,Ob as Zt,Oc as Rr,Od as _e,P as Me,Pa as rr,Pb as gr,Pc as Ar,Pd as Zr,Q as Jn,Qa as m,Qc as co,Qd as me,R as er,Ra as f,Rb as Te,Rc as Lr,Rd as nt,S as Ht,Sa as w,Sb as ke,Sc as ho,Sd as rt,Ta as dn,Tb as fr,Tc as Fr,Td as bo,U as ue,Ua as sr,Ub as _r,Uc as po,Ud as Xr,Va as ar,Vb as Qi,Vc as Nr,Vd as Co,W as l,Wa as lr,Wb as vr,Wc as Vr,Wd as _n,X as Et,Xa as Wi,Xb as Tt,Xc as jr,Xd as Ae,Y as gi,Ya as qi,Yb as yt,Yc as Z,Yd as ve,Z as fi,Za as vi,Zb as Yi,Zc as Br,Zd as Yt,_ as _i,_a as de,_b as Ie,_c as Hr,_d as Jt,a as E,aa as S,ab as _,ac as Ji,ad as F,ae as ti,b as ae,ba as Ke,bb as v,bc as eo,be as Qr,c as Ft,ca as Pe,cb as Gi,d as Ue,db as j,e as Nt,ea as tr,eb as Ki,f as P,fa as ft,fd as zr,g as We,ga as ir,gb as qt,gc as br,gd as et,h as Wn,ha as zi,hb as ee,hc as Je,hd as $r,i as qn,ia as Be,ib as Zi,ic as Xt,id as tt,j as mi,ja as N,jb as dr,jc as Cr,jd as fe,k as Vi,ka as V,kb as bt,kc as hn,kd as Re,l as Gn,la as W,lb as Ye,lc as to,ld as Q,ma as q,mb as le,mc as io,md as A,n as Kn,na as zt,nb as hr,nc as pn,o as gt,oa as $t,oc as yr,od as St,p as ln,pa as Ee,pb as pr,pd as pe,qa as De,qb as Xi,qc as oo,qd as R,r as ji,ra as y,rc as mn,rd as Ur,sa as d,sc as no,t as Zn,ta as p,tc as Qt,u as Xn,ua as x,ub as mr,uc as un,v as Qn,va as Dt,vc as ro,vd as mo,w as ui,wa as Ot,wb as ur,wc as Sr,wd as wt,x as Vt,xa as $i,xc as gn,xd as uo,y as Pt,ya as or,yc as wr,yd as go,z as jt,za as L,zc as so,zd as Wr}from"./chunk-BF2QF7IX.js";var Rt=(()=>{class n{constructor(){this._imageChange=D({mosaicConfig:null,shouldFocus:!1}),this.imageChange=this._imageChange.asReadonly()}emitImageChange(e,t){this._imageChange.set({mosaicConfig:e,shouldFocus:t})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac})}}return n})();var Yr=(()=>{class n{constructor(){this.store=c(F),this.destroyRef=c(J),this.configService=c(Rt),this.toolService=c(_e),this.mosaicConfig=this.store.selectSignal(et),this.imageObject=D(null),this.imageChanged$=Hr(this.configService.imageChange),this.ribbonActions=[{iconName:"crop",tooltipKey:"tool.ribbon.takeSnapshot",visibility:D("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"configuration_snapshot.png")},{iconName:"recenter",tooltipKey:"tool.ribbon.focusOnImage",visibility:j(()=>this.imageObject()?"on":"disabled"),onClick:()=>{this.focusOnImage(this.imageObject()),this.activeCanvas.redraw()}}]}sectionEntered(e,t){return this.activeCanvas=e,this.imageChanged$.pipe(Z(this.destroyRef),Qn(1)).subscribe(o=>{let r=o.shouldFocus||t;this.drawImage(o.mosaicConfig,r)}),{ribbon:this.ribbonActions}}async drawImage(e,t){let o=this.imageObject();o?.removeObject(),o=null,e&&(o=await _e.createImageObject(e),this.activeCanvas.addCanvasObject(o,!1),t&&this.focusOnImage(o)),this.imageObject.set(o),this.activeCanvas.redraw()}focusOnImage(e){let t=_e.calculateZoomForImage(e.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(t,R.zero)}onRouterChange(){this.configService.emitImageChange(this.mosaicConfig(),!1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-configuration"]],features:[de([Rt])],decls:1,vars:0,consts:[[3,"activate"]],template:function(t,o){t&1&&(d(0,"router-outlet",0),C("activate",function(){return o.onRouterChange()}),p())},dependencies:[A,B,Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return n})();var ht=(()=>{class n{constructor(){this.translate=c(te),this.data=c(mo),this.noLabel=this.data.noCustomLabel??this.translate.instant("common.no"),this.yesLabel=this.data.yesCustomLabel??this.translate.instant("common.yes")}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-dialog"]],decls:10,vars:5,consts:[[1,"dialog-content"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"]],template:function(t,o){t&1&&(d(0,"div",0)(1,"h1",1),m(2),p(),d(3,"div",2),m(4),p(),d(5,"div",3)(6,"button",4),m(7),p(),d(8,"button",5),m(9),p()()()),t&2&&(l(2),f(o.data.title),l(2),f(o.data.message),l(3),f(o.noLabel),l(),y("mat-dialog-close",!0),l(),f(o.yesLabel))},dependencies:[_o,uo,go,fo,Wr,A,Q],styles:[".dialog-content[_ngcontent-%COMP%]{max-width:400px}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding-bottom:0}"],changeDetection:0})}}return n})();function Ea(n,i){if(n&1){let e=L();d(0,"div",1)(1,"button",2),C("click",function(){T(e);let o=M();return k(o.action())}),m(2),p()()}if(n&2){let e=M();l(2),w(" ",e.data.action," ")}}var Da=["label"];function Oa(n,i){}var Ta=Math.pow(2,31)-1,yi=class{_overlayRef;instance;containerInstance;_afterDismissed=new P;_afterOpened=new P;_onAction=new P;_durationTimeoutId;_dismissedByAction=!1;constructor(i,e){this._overlayRef=e,this.containerInstance=i,i._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(i){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(i,Ta))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},Jr=new re("MatSnackBarData"),ii=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},ka=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return n})(),Ia=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return n})(),Ra=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return n})(),Aa=(()=>{class n{snackBarRef=c(yi);data=c(Jr);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(t,o){t&1&&(d(0,"div",0),m(1),p(),W(2,Ea,3,1,"div",1)),t&2&&(l(),w(" ",o.data.message,`
`),l(),q(o.hasAction?2:-1))},dependencies:[Q,ka,Ia,Ra],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return n})(),vn="_mat-snack-bar-enter",bn="_mat-snack-bar-exit",La=(()=>{class n extends Sr{_ngZone=c(xe);_elementRef=c(ue);_changeDetectorRef=c(Ye);_platform=c(yt);_animationsDisabled=Qt();snackBarConfig=c(ii);_document=c(Bt);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=c(Ge);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new P;_onExit=new P;_onEnter=new P;_animationState="void";_live;_label;_role;_liveElementId=c(Je).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let t=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),t}attachTemplatePortal(e){this._assertNotAttached();let t=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),t}attachDomPortal=e=>{this._assertNotAttached();let t=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),t};onAnimationEnd(e){e===bn?this._completeExit():e===vn&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?Et(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(vn)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(vn)},200)))}exit(){return this._destroyed?mi(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?Et(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(bn)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(bn),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,t=this.snackBarConfig.panelClass;t&&(Array.isArray(t)?t.forEach(s=>e.classList.add(s)):e.classList.add(t)),this._exposeToModals();let o=this._label.nativeElement,r="mdc-snackbar__label";o.classList.toggle(r,!o.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,t=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let o=0;o<t.length;o++){let r=t[o],s=r.getAttribute("aria-owns");this._trackedModals.add(r),s?s.indexOf(e)===-1&&r.setAttribute("aria-owns",s+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let t=e.getAttribute("aria-owns");if(t){let o=t.replace(this._liveElementId,"").trim();o.length>0?e.setAttribute("aria-owns",o):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,t=e.querySelector("[aria-hidden]"),o=e.querySelector("[aria-live]");if(t&&o){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&t.contains(document.activeElement)&&(r=document.activeElement),t.removeAttribute("aria-hidden"),o.appendChild(t),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["mat-snack-bar-container"]],viewQuery:function(t,o){if(t&1&&(vt(gn,7),vt(Da,7)),t&2){let r;Ze(r=Xe())&&(o._portalOutlet=r.first),Ze(r=Xe())&&(o._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(t,o){t&1&&C("animationend",function(s){return o.onAnimationEnd(s.animationName)})("animationcancel",function(s){return o.onAnimationEnd(s.animationName)}),t&2&&K("mat-snack-bar-container-enter",o._animationState==="visible")("mat-snack-bar-container-exit",o._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!o._animationsDisabled)},features:[tr],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(t,o){t&1&&(d(0,"div",1)(1,"div",2,0)(3,"div",3),ft(4,Oa,0,0,"ng-template",4),p(),x(5,"div"),p()()),t&2&&(l(5),Be("aria-live",o._live)("role",o._role)("id",o._liveElementId))},dependencies:[gn],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return n})(),Fa=new re("mat-snack-bar-default-options",{providedIn:"root",factory:()=>new ii}),Le=(()=>{class n{_live=c(br);_injector=c(Ge);_breakpointObserver=c(eo);_parentSnackBar=c(n,{optional:!0,skipSelf:!0});_defaultConfig=c(Fa);_animationsDisabled=Qt();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=Aa;snackBarContainerComponent=La;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,t){return this._attach(e,t)}openFromTemplate(e,t){return this._attach(e,t)}open(e,t="",o){let r=E(E({},this._defaultConfig),o);return r.data={message:e,action:t},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,t){let o=t&&t.viewContainerRef&&t.viewContainerRef.injector,r=Ge.create({parent:o||this._injector,providers:[{provide:ii,useValue:t}]}),s=new un(this.snackBarContainerComponent,t.viewContainerRef,r),a=e.attach(s);return a.instance.snackBarConfig=t,a.instance}_attach(e,t){let o=E(E(E({},new ii),this._defaultConfig),t),r=this._createOverlay(o),s=this._attachSnackBarContainer(r,o),a=new yi(s,r);if(e instanceof gi){let h=new ro(e,null,{$implicit:o.data,snackBarRef:a});a.instance=s.attachTemplatePortal(h)}else{let h=this._createInjector(o,a),g=new un(e,void 0,h),b=s.attachComponentPortal(g);a.instance=b.instance}return this._breakpointObserver.observe(no.HandsetPortrait).pipe(Pt(r.detachments())).subscribe(h=>{r.overlayElement.classList.toggle(this.handsetCssClass,h.matches)}),o.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(o.announcementMessage,o.politeness)}),this._animateSnackBar(a,o),this._openedSnackBarRef=a,this._openedSnackBarRef}_animateSnackBar(e,t){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),t.announcementMessage&&this._live.clear()}),t.duration&&t.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(t.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let t=new so;t.direction=e.direction;let o=Mr(this._injector),r=e.direction==="rtl",s=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,a=!s&&e.horizontalPosition!=="center";return s?o.left("0"):a?o.right("0"):o.centerHorizontally(),e.verticalPosition==="top"?o.top("0"):o.bottom("0"),t.positionStrategy=o,t.disableAnimations=this._animationsDisabled,ao(this._injector,t)}_createInjector(e,t){let o=e&&e.viewContainerRef&&e.viewContainerRef.injector;return Ge.create({parent:o||this._injector,providers:[{provide:yi,useValue:t},{provide:Jr,useValue:e.data}]})}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Na=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-text-field-style-loader",""],decls:0,vars:0,template:function(t,o){},styles:[`textarea.cdk-textarea-autosize{resize:none}textarea.cdk-textarea-autosize-measuring{padding:2px 0 !important;box-sizing:content-box !important;height:auto !important;overflow:hidden !important}textarea.cdk-textarea-autosize-measuring-firefox{padding:2px 0 !important;box-sizing:content-box !important;height:0 !important}@keyframes cdk-text-field-autofill-start{/*!*/}@keyframes cdk-text-field-autofill-end{/*!*/}.cdk-text-field-autofill-monitored:-webkit-autofill{animation:cdk-text-field-autofill-start 0s 1ms}.cdk-text-field-autofill-monitored:not(:-webkit-autofill){animation:cdk-text-field-autofill-end 0s 1ms}
`],encapsulation:2,changeDetection:0})}return n})(),Va={passive:!0},es=(()=>{class n{_platform=c(yt);_ngZone=c(xe);_renderer=c(fi).createRenderer(null,null);_styleLoader=c(Zt);_monitoredElements=new Map;constructor(){}monitor(e){if(!this._platform.isBrowser)return qn;this._styleLoader.load(Na);let t=Ie(e),o=this._monitoredElements.get(t);if(o)return o.subject;let r=new P,s="cdk-text-field-autofilled",a=g=>{g.animationName==="cdk-text-field-autofill-start"&&!t.classList.contains(s)?(t.classList.add(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!0}))):g.animationName==="cdk-text-field-autofill-end"&&t.classList.contains(s)&&(t.classList.remove(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!1})))},h=this._ngZone.runOutsideAngular(()=>(t.classList.add("cdk-text-field-autofill-monitored"),this._renderer.listen(t,"animationstart",a,Va)));return this._monitoredElements.set(t,{subject:r,unlisten:h}),r}stopMonitoring(e){let t=Ie(e),o=this._monitoredElements.get(t);o&&(o.unlisten(),o.subject.complete(),t.classList.remove("cdk-text-field-autofill-monitored"),t.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(t))}ngOnDestroy(){this._monitoredElements.forEach((e,t)=>this.stopMonitoring(t))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var ts=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Ke({type:n});static \u0275inj=qe({})}return n})();var is=new re("MAT_INPUT_VALUE_ACCESSOR");var os=(()=>{class n{isErrorState(e,t){return!!(e&&e.invalid&&(e.touched||t&&t.submitted))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var yo=class{_defaultMatcher;ngControl;_parentFormGroup;_parentForm;_stateChanges;errorState=!1;matcher;constructor(i,e,t,o,r){this._defaultMatcher=i,this.ngControl=e,this._parentFormGroup=t,this._parentForm=o,this._stateChanges=r}updateErrorState(){let i=this.errorState,e=this._parentFormGroup||this._parentForm,t=this.matcher||this._defaultMatcher,o=this.ngControl?this.ngControl.control:null,r=t?.isErrorState(o,e)??!1;r!==i&&(this.errorState=r,this._stateChanges.next())}};var ja=["button","checkbox","file","hidden","image","radio","range","reset","submit"],Ba=new re("MAT_INPUT_CONFIG"),Fe=(()=>{class n{_elementRef=c(ue);_platform=c(yt);ngControl=c(Ar,{optional:!0,self:!0});_autofillMonitor=c(es);_ngZone=c(xe);_formField=c(Co,{optional:!0});_renderer=c(_i);_uid=c(Je).getId("mat-input-");_previousNativeValue;_inputValueAccessor;_signalBasedValueAccessor;_previousPlaceholder;_errorStateTracker;_config=c(Ba,{optional:!0});_cleanupIosKeyup;_cleanupWebkitWheel;_isServer;_isNativeSelect;_isTextarea;_isInFormField;focused=!1;stateChanges=new P;controlType="mat-input";autofilled=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=io(e),this.focused&&(this.focused=!1,this.stateChanges.next())}_disabled=!1;get id(){return this._id}set id(e){this._id=e||this._uid}_id;placeholder;name;get required(){return this._required??this.ngControl?.control?.hasValidator(Rr.required)??!1}set required(e){this._required=io(e)}_required;get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&pn().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}_type="text";get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(e){this._errorStateTracker.matcher=e}userAriaDescribedBy;get value(){return this._signalBasedValueAccessor?this._signalBasedValueAccessor.value():this._inputValueAccessor.value}set value(e){e!==this.value&&(this._signalBasedValueAccessor?this._signalBasedValueAccessor.value.set(e):this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=io(e)}_readonly=!1;disabledInteractive;get errorState(){return this._errorStateTracker.errorState}set errorState(e){this._errorStateTracker.errorState=e}_neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(e=>pn().has(e));constructor(){let e=c(Lr,{optional:!0}),t=c(Fr,{optional:!0}),o=c(os),r=c(is,{optional:!0,self:!0}),s=this._elementRef.nativeElement,a=s.nodeName.toLowerCase();r?zi(r.value)?this._signalBasedValueAccessor=r:this._inputValueAccessor=r:this._inputValueAccessor=s,this._previousNativeValue=this.value,this.id=this.id,this._platform.IOS&&this._ngZone.runOutsideAngular(()=>{this._cleanupIosKeyup=this._renderer.listen(s,"keyup",this._iOSKeyupListener)}),this._errorStateTracker=new yo(o,this.ngControl,t,e,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=a==="select",this._isTextarea=a==="textarea",this._isInFormField=!!this._formField,this.disabledInteractive=this._config?.disabledInteractive||!1,this._isNativeSelect&&(this.controlType=s.multiple?"mat-native-select-multiple":"mat-native-select"),this._signalBasedValueAccessor&&Me(()=>{this._signalBasedValueAccessor.value(),this.stateChanges.next()})}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._cleanupIosKeyup?.(),this._cleanupWebkitWheel?.()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(e){if(e!==this.focused){if(!this._isNativeSelect&&e&&this.disabled&&this.disabledInteractive){let t=this._elementRef.nativeElement;t.type==="number"?(t.type="text",t.setSelectionRange(0,0),t.type="number"):t.setSelectionRange(0,0)}this.focused=e,this.stateChanges.next()}}_onInput(){}_dirtyCheckNativeValue(){let e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_dirtyCheckPlaceholder(){let e=this._getPlaceholder();if(e!==this._previousPlaceholder){let t=this._elementRef.nativeElement;this._previousPlaceholder=e,e?t.setAttribute("placeholder",e):t.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){ja.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let e=this._elementRef.nativeElement,t=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&t&&t.label)}else return this.focused&&!this.disabled||!this.empty}get describedByIds(){return this._elementRef.nativeElement.getAttribute("aria-describedby")?.split(" ")||[]}setDescribedByIds(e){let t=this._elementRef.nativeElement;e.length?t.setAttribute("aria-describedby",e.join(" ")):t.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}_iOSKeyupListener=e=>{let t=e.target;!t.value&&t.selectionStart===0&&t.selectionEnd===0&&(t.setSelectionRange(1,1),t.setSelectionRange(0,0))};_getReadonlyAttribute(){return this._isNativeSelect?null:this.readonly||this.disabled&&this.disabledInteractive?"true":null}static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:21,hostBindings:function(t,o){t&1&&C("focus",function(){return o._focusChanged(!0)})("blur",function(){return o._focusChanged(!1)})("input",function(){return o._onInput()}),t&2&&(Ut("id",o.id)("disabled",o.disabled&&!o.disabledInteractive)("required",o.required),Be("name",o.name||null)("readonly",o._getReadonlyAttribute())("aria-disabled",o.disabled&&o.disabledInteractive?"true":null)("aria-invalid",o.empty&&o.required?null:o.errorState)("aria-required",o.required)("id",o.id),K("mat-input-server",o._isServer)("mat-mdc-form-field-textarea-control",o._isInFormField&&o._isTextarea)("mat-mdc-form-field-input-control",o._isInFormField)("mat-mdc-input-disabled-interactive",o.disabledInteractive)("mdc-text-field__input",o._isInFormField)("mat-mdc-native-select-inline",o._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly",disabledInteractive:[2,"disabledInteractive","disabledInteractive",le]},exportAs:["matInput"],features:[de([{provide:Xr,useExisting:n}]),Ht]})}return n})(),Ne=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Ke({type:n});static \u0275inj=qe({imports:[ve,ve,ts,Kt]})}return n})();var ns=(()=>{class n{constructor(){this.data=c(mo),this.value=D({name:this.data.defaultName}),this.form=it(this.value,e=>{H(e.name),Gr(e.name,/^(?!(?:CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(?:\.[^.]*)?$)[^<>:"/\\|?*\x00-\x1F]+$/i)})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-project-name-dialog"]],decls:16,vars:16,consts:[["mat-dialog-title",""],[1,"form"],["subscriptSizing","dynamic",1,"density-3"],["matInput","",3,"field"],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(t,o){t&1&&(d(0,"h2",0),m(1),_(2,"translate"),p(),d(3,"div",1)(4,"mat-form-field",2),x(5,"input",3),N(),d(6,"mat-error"),m(7),_(8,"translate"),p()()(),d(9,"div",4)(10,"button",5),m(11),_(12,"translate"),p(),d(13,"button",6),m(14),_(15,"translate"),p()()),t&2&&(l(),f(v(2,8,"tool.config.menu.chooseFileName")),l(4),V(o.form.name),l(2),f(v(8,10,"tool.config.menu.enterValidName")),l(4),w(" ",v(12,12,"common.cancel")," "),l(2),y("mat-dialog-close",o.form.name().value())("disabled",!o.form().valid()),l(),w(" ",v(15,14,"common.save")," "))},dependencies:[ve,Ae,rt,Ne,Fe,_o,uo,go,fo,A,Q,B,ot,G],styles:[".form[_ngcontent-%COMP%]{margin:6px 24px;width:300px;display:flex}.form[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})}}return n})();function Ha(n,i){if(n&1){let e=L();d(0,"button",2),C("click",function(){T(e);let o=M();return k(o.navigateToProjectConfiguration())}),m(1),_(2,"translate"),p(),d(3,"button",0),C("click",function(){T(e);let o=M();return k(o.saveProject())}),m(4),_(5,"translate"),p()}n&2&&(l(),w(" ",v(2,2,"tool.config.menu.projectSettings")," "),l(3),w(" ",v(5,4,"tool.config.menu.saveProject")," "))}function za(n,i){if(n&1){let e=L();d(0,"button",0),C("click",function(){T(e);let o=M();return k(o.navigateToProjectConfiguration())}),m(1),_(2,"translate"),p(),d(3,"button",3),m(4),_(5,"translate"),p()}n&2&&(l(),w(" ",v(2,2,"tool.config.menu.newProject")," "),l(3),w(" ",v(5,4,"tool.config.menu.exampleProjects")," "))}function $a(n,i){if(n&1){let e=L();d(0,"button",4),C("click",function(){T(e);let o=M();return k(o.rejectProject())}),m(1),_(2,"translate"),p()}n&2&&(l(),w(" ",v(2,1,"tool.config.menu.rejectProject")," "))}var Ua="irrtirer_project",rs=(()=>{class n{constructor(){this.store=c(F),this.translate=c(te),this.mosaicConfig=this.store.selectSignal(et),this.dialog=c(wt),this.router=c(X),this.configService=c(Rt),this.projectImportService=c(Zr),this.destroyRef=c(J),this.snackBar=c(Le)}navigateToProjectConfiguration(){this.router.navigate(["/tool/config/project"])}rejectProject(){let e={title:this.translate.instant("tool.config.menu.rejectProject"),message:this.translate.instant("tool.config.menu.rejectProjectWarning")};this.dialog.open(ht,{data:e}).afterClosed().pipe(Z(this.destroyRef)).subscribe(t=>{t&&(this.store.dispatch(me.projectCanceled()),this.configService.emitImageChange(null,!1))})}saveProject(){this.dialog.open(ns,{data:{defaultName:Ua}}).afterClosed().subscribe(t=>{if(t){this.projectImportService.saveProject(t);let o=this.translate.instant("tool.config.menu.projectSavedMessage",{projectName:t});this.snackBar.open(o,this.translate.instant("common.ok"),{duration:3e3})}})}loadNewProject(){this.mosaicConfig()?this.confirmDiscardAndLoadNewProject():this.selectProjectToLoad()}confirmDiscardAndLoadNewProject(){let e={title:this.translate.instant("tool.config.menu.loadProjectDialogTitle"),message:this.translate.instant("tool.config.menu.loadProjectDialogMessage")};this.dialog.open(ht,{data:e}).afterClosed().pipe(Z(this.destroyRef)).subscribe(t=>{t&&this.selectProjectToLoad()})}selectProjectToLoad(){Kr(".irr",t=>{this.projectImportService.loadProject(t).then(o=>{this.store.dispatch(me.projectCreated({project:o})),this.configService.emitImageChange(o.config,!0)}).catch(()=>{this.snackBar.open(this.translate.instant("tool.config.menu.loadProjectError"))})})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-config-menu"]],decls:6,vars:5,consts:[["mat-flat-button","","color","accent",3,"click"],["mat-flat-button","","color","warn"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","warn",3,"click"]],template:function(t,o){if(t&1){let r=L();W(0,Ha,6,6)(1,za,6,6),d(2,"button",0),C("click",function(){return T(r),k(o.loadNewProject())}),m(3),_(4,"translate"),p(),W(5,$a,3,3,"button",1)}if(t&2){let r=!!o.mosaicConfig();q(r?0:1),l(3),w(" ",v(4,3,"tool.config.menu.loadProject"),`
`),l(2),q(r?5:-1)}},dependencies:[A,Q,B,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:10px}"],changeDetection:0})}}return n})();var ze=class{static getFieldErrorLabel(i,e){return this.getErrorLabel(i.errors(),e)}static getErrorLabel(i,e){for(let{kind:t}of i)if(t in e)return e[t]();return null}};var ss=1,as=1e3,ls=(()=>{class n{constructor(){this.snackBar=c(Le),this.router=c(X),this.configService=c(Rt),this.store=c(F),this.translate=c(te),this.mosaicConfig=this.store.selectSignal(et),this.isReadOnlyMode=j(()=>!!this.mosaicConfig()),this.errorLabels={min:()=>this.translate.instant("tool.config.project.mosaicMinWidthErrorMessage",{width:ss}),max:()=>this.translate.instant("tool.config.project.mosaicMaxWidthErrorMessage",{width:as}),required:()=>this.translate.instant("tool.config.project.mosaicWidthRequiredErrorMessage")},this.formData=D({mosaicWidth:this.mosaicConfig()?.mosaicWidth??100,mosaicImage:null}),this.form=it(this.formData,e=>{H(e.mosaicWidth),He(e.mosaicWidth,ss),It(e.mosaicWidth,as),qr(e.mosaicWidth,()=>this.isReadOnlyMode()),H(e.mosaicImage)}),this.formValueChangedEffect=Me(()=>{if(this.form().valid()){let e=new FileReader;e.readAsDataURL(this.form.mosaicImage().value()),e.onload=t=>{this.configService.emitImageChange({base64Image:t?.target?.result,mosaicWidth:this.form.mosaicWidth().value()},!0)}}else this.configService.emitImageChange(null,!1)})}navigateToConfiguration(){this.router.navigate(["/tool/config"])}trySave(){if(this.form().valid())this.save();else{let e=this.getErrorMessage();this.snackBar.open(e,this.translate.instant("common.ok"),{duration:2e3})}}save(){let e=this.formData(),t=new FileReader;t.readAsDataURL(e.mosaicImage),t.onload=o=>{let s={config:{base64Image:o?.target?.result,mosaicWidth:e.mosaicWidth},tilesSets:[],sectors:[]};this.createNewProject(s),this.snackBar.open(this.translate.instant("tool.config.project.projectCreated"),this.translate.instant("common.ok"),{duration:2e3}),this.navigateToConfiguration()}}createNewProject(e){this.store.dispatch(me.projectCreated({project:e}))}getErrorMessage(){if(this.form.mosaicImage().valid()){if(!this.form.mosaicWidth().valid())return this.getFieldErrorLabel(this.form.mosaicWidth())}else return this.translate.instant("tool.config.project.selectImageErrorMessage");return null}getFieldErrorLabel(e){return ze.getFieldErrorLabel(e,this.errorLabels)}onImageSelected(e){let o=e.target.files?.item(0)??null;this.formData.update(r=>ae(E({},r),{mosaicImage:o}))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-config-project"]],decls:23,vars:21,consts:[["imageUploader",""],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click","hidden"],[1,"form"],["hidden","","type","file","accept",".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*",3,"change"],["mat-flat-button","","type","button",3,"click","color","hidden"],[1,"density-3"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(t,o){if(t&1){let r=L();d(0,"div",1)(1,"button",2),C("click",function(){return T(r),k(o.navigateToConfiguration())}),m(2),_(3,"translate"),p(),d(4,"button",3),C("click",function(){return T(r),k(o.trySave())}),m(5),_(6,"translate"),p()(),d(7,"form",4)(8,"input",5,0),C("change",function(a){return T(r),k(o.onImageSelected(a))}),p(),d(10,"button",6),C("click",function(){T(r);let a=Oe(9);return k(a.click())}),m(11),_(12,"translate"),p(),d(13,"mat-form-field",7)(14,"mat-label"),m(15),_(16,"translate"),p(),x(17,"input",8),N(),d(18,"span",9),m(19),_(20,"translate"),p(),d(21,"mat-error"),m(22),p()()()}t&2&&(l(2),w(" ",v(3,11,"common.return")," "),l(2),y("hidden",o.isReadOnlyMode()),l(),w(" ",v(6,13,"common.confirm")," "),l(5),y("color",o.form.mosaicImage().valid()?"":"accent")("hidden",o.isReadOnlyMode()),l(),w(" ",v(12,15,o.form.mosaicImage().valid()?"tool.config.project.changeImage":"tool.config.project.chooseImage")," "),l(4),f(v(16,17,"tool.config.project.mosaicWidth")),l(2),V(o.form.mosaicWidth),l(2),f(v(20,19,"common.cm")),l(3),f(o.getFieldErrorLabel(o.form.mosaicWidth())))},dependencies:[B,A,Q,ve,Ae,nt,rt,bo,Ne,Fe,ot,G],styles:[".actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;margin-top:20px}"],changeDetection:0})}}return n})();var ni=class extends St{constructor(i,e){super(),this.vertices=i,this.hexColor=e}drawObject(i,e){i.beginPath();let t=e.getViewportPosition(this.vertices[0]);i.moveTo(t.x,t.y);for(let o=1;o<this.vertices.length;++o)t=e.getViewportPosition(this.vertices[o]),i.lineTo(t.x,t.y);i.closePath(),i.fillStyle=this.hexColor,i.fill()}getOrder(){return 100}};var Wa=Math.PI/180;function qa(n,i,e){e*=Wa;let t=Math.cos(e)*(n.x-i.x)-Math.sin(e)*(n.y-i.y)+i.x,o=Math.sin(e)*(n.x-i.x)+Math.cos(e)*(n.y-i.y)+i.y;return new R(t,o)}function So(n,i,e=0,t=1){return n.map(o=>qa(o,R.zero,e).multiply(t).add(i))}var cs=(()=>{class n{static drawTiles(e,t){let o=this.sortAndMapTilesBySize(e),r=this.getTreeMapChartArray(o),s={width:r.size.width,height:r.size.height,x:-r.size.width/2,y:-r.size.height/2};this.drawChart(r,s,t)}static drawChart(e,t,o){if(e.type==="group"){let r=e.left.size.width+e.right.size.width,s=e.left.size.height+e.right.size.height;this.drawChart(e.left,{x:t.x,y:t.y,width:t.width*(e.split==="horizontal"?e.left.size.width/r:1),height:t.height*(e.split==="horizontal"?1:e.left.size.height/s)},o),this.drawChart(e.right,{x:t.x+(e.split==="horizontal"?t.width*(e.left.size.width/r):0),y:t.y+(e.split==="horizontal"?0:t.height*(e.left.size.height/s)),width:t.width*(e.split==="horizontal"?e.right.size.width/r:1),height:t.height*(e.split==="horizontal"?1:e.right.size.height/s)},o)}else{let r=So(e.value.vertices,new R(t.x+t.width/2,t.y+t.height/2),0),s=new ni(r,e.value.color);o.addCanvasObject(s)}}static getTreeMapChartArray(e){if(e.length>1){let t=this.splitTileArrayInHalf(e),o=this.getTreeMapChartArray(t[0]),r=this.getTreeMapChartArray(t[1]),s=(o.size.height+r.size.height)*1.5<o.size.width+r.size.width?"vertical":"horizontal";return{type:"group",split:s,size:{width:s==="horizontal"?o.size.width+r.size.width:Math.max(o.size.width,r.size.width),height:s==="horizontal"?Math.max(o.size.height,r.size.height):o.size.height+r.size.height},left:o,right:r}}else return{type:"leaf",size:this.getTileSize(e[0].tile),value:e[0].tile}}static sortAndMapTilesBySize(e){return e.map(t=>{let o=this.getTileSize(t),r=o.height*o.height+o.width*o.width;return{tile:t,size:o,radius:r}}).sort((t,o)=>o.radius-t.radius)}static splitTileArrayInHalf(e){let o=e.reduce((a,h)=>a+h.size.width,0)/2,r=e.length-1,s=e[r].size.width;for(let a=e.length-2;a>0;a--){let h=e[a];if(s+=h.size.width,s>o){r=a;break}}return[e.slice(0,r),e.slice(r)]}static getTileSize(e){return{width:Math.max(...e.vertices.map(t=>t.x))-Math.min(...e.vertices.map(t=>t.x)),height:Math.max(...e.vertices.map(t=>t.y))-Math.min(...e.vertices.map(t=>t.y))}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac})}}return n})();var ds=(()=>{class n{constructor(){this.store=c(F),this.destroyRef=c(J),this.toolService=c(_e),this.tilesSets$=this.store.select(tt)}ngAfterViewInit(){queueMicrotask(()=>this.subscribeOnTilesSetsChange())}subscribeOnTilesSetsChange(){this.tilesSets$.pipe(Z(this.destroyRef)).subscribe(e=>this.drawTiles(e.flatMap(t=>t.tiles)))}sectionEntered(e){return this.activeCanvas=e,{ribbon:[{iconName:"crop",visibility:D("on"),tooltipKey:"tool.ribbon.takeSnapshot",onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")}]}}drawTiles(e){this.activeCanvas.removeObjects(),e.length&&cs.drawTiles(e,this.activeCanvas),this.activeCanvas.redraw()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-tray"]],decls:1,vars:0,template:function(t,o){t&1&&x(0,"router-outlet")},dependencies:[Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return n})();var wo="/tool";var xo=()=>c(F).selectSignal($r)()?!0:(c(X).navigate([wo]),!1);var Ka=["text"],Za=[[["mat-icon"]],"*"],Xa=["mat-icon","*"];function Qa(n,i){if(n&1&&x(0,"mat-pseudo-checkbox",1),n&2){let e=M();y("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function Ya(n,i){if(n&1&&x(0,"mat-pseudo-checkbox",3),n&2){let e=M();y("disabled",e.disabled)}}function Ja(n,i){if(n&1&&(d(0,"span",4),m(1),p()),n&2){let e=M();l(),w("(",e.group.label,")")}}var yn=new re("MAT_OPTION_PARENT_COMPONENT"),Sn=new re("MatOptgroup");var wi=class{source;isUserInput;constructor(i,e=!1){this.source=i,this.isUserInput=e}},ri=(()=>{class n{_element=c(ue);_changeDetectorRef=c(Ye);_parent=c(yn,{optional:!0});group=c(Sn,{optional:!0});_signalDisableRipple=!1;_selected=!1;_active=!1;_mostRecentViewValue="";get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}value;id=c(Je).getId("mat-option-");get disabled(){return this.group&&this.group.disabled||this._disabled()}set disabled(e){this._disabled.set(e)}_disabled=D(!1);get disableRipple(){return this._signalDisableRipple?this._parent.disableRipple():!!this._parent?.disableRipple}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}onSelectionChange=new se;_text;_stateChanges=new P;constructor(){let e=c(Zt);e.load(kr),e.load(gr),this._signalDisableRipple=!!this._parent&&zi(this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(e=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}deselect(e=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}focus(e,t){let o=this._getHostElement();typeof o.focus=="function"&&o.focus(t)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!Xt(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=e)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new wi(this,e))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["mat-option"]],viewQuery:function(t,o){if(t&1&&vt(Ka,7),t&2){let r;Ze(r=Xe())&&(o._text=r.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(t,o){t&1&&C("click",function(){return o._selectViaInteraction()})("keydown",function(s){return o._handleKeydown(s)}),t&2&&(Ut("id",o.id),Be("aria-selected",o.selected)("aria-disabled",o.disabled.toString()),K("mdc-list-item--selected",o.selected)("mat-mdc-option-multiple",o.multiple)("mat-mdc-option-active",o.active)("mdc-list-item--disabled",o.disabled))},inputs:{value:"value",id:"id",disabled:[2,"disabled","disabled",le]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],ngContentSelectors:Xa,decls:8,vars:5,consts:[["text",""],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"]],template:function(t,o){t&1&&(_t(Za),W(0,Qa,1,2,"mat-pseudo-checkbox",1),ct(1),d(2,"span",2,0),ct(4,1),p(),W(5,Ya,1,1,"mat-pseudo-checkbox",3),W(6,Ja,2,1,"span",4),x(7,"div",5)),t&2&&(q(o.multiple?0:-1),l(5),q(!o.multiple&&o.selected&&!o.hideSingleSelectionIndicator?5:-1),l(),q(o.group&&o.group._inert?6:-1),l(),y("matRippleTrigger",o._getHostElement())("matRippleDisabled",o.disabled||o.disableRipple))},dependencies:[Nr,Tr],styles:[`.mat-mdc-option{-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;min-height:48px;padding:0 16px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-option-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-option-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-option-label-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-option-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-option-label-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));outline:0}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover){background-color:var(--mat-option-selected-state-layer-color, var(--mat-sys-secondary-container))}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option .mat-pseudo-checkbox{--mat-pseudo-checkbox-minimal-selected-checkmark-color: var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}@media(forced-colors: active){.mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{right:auto;left:16px}}.mat-mdc-option-multiple{--mat-list-list-item-selected-container-color: var(--mat-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-focus-indicator::before{content:""}
`],encapsulation:2,changeDetection:0})}return n})();function hs(n,i,e){if(e.length){let t=i.toArray(),o=e.toArray(),r=0;for(let s=0;s<n+1;s++)t[s].group&&t[s].group===o[r]&&r++;return r}return 0}function ps(n,i,e,t){return n<e?n:n+i>e+t?Math.max(0,n-t+i):e}var wn=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Ke({type:n});static \u0275inj=qe({imports:[jr,Vr,ri,Kt]})}return n})();var il=["panel"],ol=["*"];function nl(n,i){if(n&1&&(Dt(0,"div",1,0),ct(2),Ot()),n&2){let e=i.id,t=M();rr(t._classList),K("mat-mdc-autocomplete-visible",t.showPanel)("mat-mdc-autocomplete-hidden",!t.showPanel)("mat-autocomplete-panel-animations-enabled",!t._animationsDisabled)("mat-primary",t._color==="primary")("mat-accent",t._color==="accent")("mat-warn",t._color==="warn"),Ut("id",t.id),Be("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby(e))}}var xn=class{source;option;constructor(i,e){this.source=i,this.option=e}},gs=new re("mat-autocomplete-default-options",{providedIn:"root",factory:()=>({autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1})}),fs=(()=>{class n{_changeDetectorRef=c(Ye);_elementRef=c(ue);_defaults=c(gs);_animationsDisabled=Qt();_activeOptionChanges=Ue.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new se;opened=new se;closed=new se;optionActivated=new se;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=c(Je).getId("mat-autocomplete-");inertGroups;constructor(){let e=c(yt);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new Cr(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let t=new xn(this,e);this.optionSelected.emit(t)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let t=e?e+" ":"";return this.ariaLabelledby?t+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["mat-autocomplete"]],contentQueries:function(t,o,r){if(t&1&&(cn(r,ri,5),cn(r,Sn,5)),t&2){let s;Ze(s=Xe())&&(o.options=s),Ze(s=Xe())&&(o.optionGroups=s)}},viewQuery:function(t,o){if(t&1&&(vt(gi,7),vt(il,5)),t&2){let r;Ze(r=Xe())&&(o.template=r.first),Ze(r=Xe())&&(o.panel=r.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",le],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",le],requireSelection:[2,"requireSelection","requireSelection",le],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",le],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",le]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[de([{provide:yn,useExisting:n}])],ngContentSelectors:ol,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(t,o){t&1&&(_t(),ir(0,nl,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden,.cdk-overlay-pane:has(>.mat-mdc-autocomplete-hidden){visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return n})();var rl={provide:lo,useExisting:Bi(()=>Mn),multi:!0};var sl=new re("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let n=c(Ge);return()=>wr(n)}}),Mn=(()=>{class n{_environmentInjector=c(Yn);_element=c(ue);_injector=c(Ge);_viewContainerRef=c(Hi);_zone=c(xe);_changeDetectorRef=c(Ye);_dir=c(bi,{optional:!0});_formField=c(Co,{optional:!0,host:!0});_viewportRuler=c(oo);_scrollStrategy=c(sl);_renderer=c(_i);_animationsDisabled=Qt();_defaults=c(gs,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new P;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=Ue.EMPTY;_breakpointObserver=c(eo);_handsetLandscapeSubscription=Ue.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new P;_overlayPanelClass=Ji(this._defaults?.overlayPanelClass||[]);_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&to(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return gt(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(ln(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(ln(()=>this._overlayAttached)):mi()).pipe(Vi(e=>e instanceof wi?e:null))}optionSelections=Gn(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(ui(e),Vt(()=>gt(...e.map(t=>t.onSelectionChange)))):this._initialized.pipe(Vt(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new Nt(e=>{let t=r=>{let s=Tt(r),a=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,h=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&s!==this._element.nativeElement&&!this._hasFocus()&&(!a||!a.contains(s))&&(!h||!h.contains(s))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(s)&&e.next(r)},o=[this._renderer.listen("document","click",t),this._renderer.listen("document","auxclick",t),this._renderer.listen("document","touchend",t)];return()=>{o.forEach(r=>r())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let t=e,o=t.keyCode,r=Xt(t);if(o===27&&!r&&t.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&o===13&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){let s=this.autocomplete._keyManager.activeItem,a=o===38||o===40;o===9||a&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(t):a&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(a||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let t=e.target,o=t.value;if(t.type==="number"&&(o=o==""?null:parseFloat(o)),this._previousValue!==o){if(this._previousValue=o,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(o),!o)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let r=this.autocomplete.options?.find(s=>s.selected);if(r){let s=this._getDisplayValue(r.value);o!==s&&r.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let r=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(r)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return vr()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new Nt(o=>{Et(()=>{o.next()},{injector:this._environmentInjector})}),t=this.autocomplete.options?.changes.pipe(jt(()=>this._positionStrategy.reapplyLastPosition()),Zn(0))??mi();return gt(e,t).pipe(Vt(()=>this._zone.run(()=>{let o=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),o!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),ji(1)).subscribe(o=>this._setValueAndClose(o))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let t=this.autocomplete;return t&&t.displayWith?t.displayWith(e):e}_assignOptionValue(e){let t=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(t??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let t=this.autocomplete,o=e?e.source:this._pendingAutoselectedOption;o?(this._clearPreviousSelectedOption(o),this._assignOptionValue(o.value),this._onChange(o.value),t._emitSelectEvent(o),this._element.nativeElement.focus()):t.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,t){this.autocomplete?.options?.forEach(o=>{o!==e&&o.selected&&o.deselect(t)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let t=this.autocomplete.id;hn(this._trackedModal,"aria-owns",t)}}_attachOverlay(e){if(!this.autocomplete)return;let t=this._overlayRef;t?(this._positionStrategy.setOrigin(this._getConnectedElement()),t.updateSize({width:this._getPanelWidth()})):(this._portal=new ro(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),t=ao(this._injector,this._getOverlayConfig()),this._overlayRef=t,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&t&&t.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(no.HandsetLandscape).subscribe(r=>{r.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),t&&!t.hasAttached()&&(t.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let o=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&o!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!Xt(e)||e.keyCode===38&&Xt(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new so({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:this._overlayPanelClass,disableAnimations:this._animationsDisabled})}_getOverlayPosition(){let e=xr(this._injector,this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1).withPopoverLocation("inline");return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let t=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],o=this._aboveClass,r=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:o},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:o}],s;this.position==="above"?s=r:this.position==="below"?s=t:s=[...t,...r],e.withPositions(s)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let t=-1;for(let o=0;o<e.options.length;o++)if(!e.options.get(o).disabled){t=o;break}e._keyManager.setActiveItem(t)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let t=this.autocomplete,o=hs(e,t.options,t.optionGroups);if(e===0&&o===1)t._setScrollTop(0);else if(t.panel){let r=t.options.toArray()[e];if(r){let s=r._getHostElement(),a=ps(s.offsetTop,s.offsetHeight,t._getScrollTop(),t.panel.nativeElement.offsetHeight);t._setScrollTop(a)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let t=this.autocomplete.id;this._trackedModal&&to(this._trackedModal,"aria-owns",t),hn(e,"aria-owns",t),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;to(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(t,o){t&1&&C("focusin",function(){return o._handleFocus()})("blur",function(){return o._onTouched()})("input",function(s){return o._handleInput(s)})("keydown",function(s){return o._handleKeydown(s)})("click",function(){return o._handleClick()}),t&2&&Be("autocomplete",o.autocompleteAttribute)("role",o.autocompleteDisabled?null:"combobox")("aria-autocomplete",o.autocompleteDisabled?null:"list")("aria-activedescendant",o.panelOpen&&o.activeOption?o.activeOption.id:null)("aria-expanded",o.autocompleteDisabled?null:o.panelOpen.toString())("aria-controls",o.autocompleteDisabled||!o.panelOpen||o.autocomplete==null?null:o.autocomplete.id)("aria-haspopup",o.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",le]},exportAs:["matAutocompleteTrigger"],features:[de([rl]),Ht]})}return n})(),_s=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=Ke({type:n});static \u0275inj=qe({imports:[Ci,wn,mn,wn,Kt]})}return n})();var xi=class{static calculateConvexityFactor(i){let e=this.calculatePolygonArea(i),t=this.calculatePolygonCircumference(i);return Math.sqrt(e)/t}static calculatePolygonArea(i){if(i.length<3)throw new Error("polygon should have at least 3 vertices");let e=i.at(-1).x*i[0].y,t=i.at(-1).y*i[0].x;for(let o=0,r=i.length-1;o<r;++o)e+=i[o].x*i[o+1].y,t+=i[o].y*i[o+1].x;return(e-t)/2}static calculatePolygonCircumference(i){let e=R.distance(i[0],i.at(-1));for(let t=1;t<i.length;++t)e+=R.distance(i[t],i[t-1]);return e}static calculatePolygonCentroid(i){let e=0,t=0,o=0,r=i.at(-1);for(let s of i){let a=s.y*r.x-s.x*r.y;o+=a,e+=(s.x+r.x)*a,t+=(s.y+r.y)*a,r=s}return o*=3,o==0?R.zero:new R(e/o,t/o)}static calculateOuterRadius(i){let e=0;for(let t of i){let o=R.distance(R.zero,t);o>e&&(e=o)}return e}};var pt=class{static nextInt(i,e){return Math.floor(Math.random()*(e-i+1)+i)}static nextFloat(i,e){return Math.random()*(e-i)+i}};var Mo=class{constructor(i){this.imagePixelArray=i}generateTileSet(i,e){let t=[];for(let o=0;o<e;++o)t.push(this.generateTile(i));return t}generateTile(i){let e;do e=this.generateVertices(i);while(xi.calculateConvexityFactor([...e].reverse())<.18);let t=this.rotatePolygonToHorizontal(e),o=xi.calculatePolygonCentroid(t),r=this.normalizeVertices(t,o);return{id:crypto.randomUUID(),vertices:r,color:this.randomColor().hex()}}generateVertices(i){let e=pt.nextInt(4,6),t=[];for(let o=0;o<e;++o){let r=pt.nextFloat(i.min,i.max);t.push(this.generateVertex(o,e,r))}return t}generateVertex(i,e,t){let r=(360/e*i+pt.nextFloat(0,30))%360*Math.PI/180;return new R(Math.sin(r),Math.cos(r)).multiply(t)}randomColor(){let i=this.imagePixelArray.length/4,e=pt.nextInt(0,i-1);return pe({r:this.imagePixelArray[e*4],g:this.imagePixelArray[e*4+1],b:this.imagePixelArray[e*4+2]})}normalizeVertices(i,e){return i.map(t=>this.roundVertexCoords(t.sub(e)))}roundVertexCoords(i){return new R(Math.round((i.x+Number.EPSILON)*100)/100,Math.round((i.y+Number.EPSILON)*100)/100)}rotatePolygonToHorizontal(i){let e=0,t=i[0],o=i[1];for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++){let h=i[a].x-i[s].x,g=i[a].y-i[s].y,b=h*h+g*g;b>e&&(e=b,t=i[s],o=i[a])}let r=Math.atan2(o.y-t.y,o.x-t.x);return i.map(s=>{let a=s.x-t.x,h=s.y-t.y,g=a*Math.cos(-r)-h*Math.sin(-r),b=a*Math.sin(-r)+h*Math.cos(-r);return new R(g+t.x,b+t.y)})}};function ll(n,i){if(n&1&&(d(0,"mat-option",7),m(1),p()),n&2){let e=i.$implicit,t=M();y("value",e)("disabled",t.immutableSeriesNames().includes(e)),l(),w(" ",e," ")}}var Pn=(()=>{class n{constructor(){this.router=c(X),this.route=c(Ct),this.store=c(F),this.snackBar=c(Le),this.translate=c(te),this.dialog=c(wt),this.tilesSetsSignal=this.store.selectSignal(tt),this.existingSeriesNames=j(()=>this.tilesSetsSignal().filter(e=>e.source==="generated").map(e=>e.name)),this.immutableSeriesNames=j(()=>this.tilesSetsSignal().filter(e=>e.source!=="generated").map(e=>e.name)),this.errorLabels={min:()=>this.translate.instant("tool.tiles.random.radiusTooSmall"),max:()=>this.translate.instant("tool.tiles.random.radiusTooLarge"),required:()=>this.translate.instant("common.fieldRequired"),minGreaterThenMax:()=>this.translate.instant("tool.tiles.random.maxRadiusLargerThanMin"),cannotNowOverrideOtherTilesSet:()=>this.translate.instant("tool.tiles.random.cannotNowOverrideOtherTilesSet"),cannotOverrideTilesSet:()=>this.translate.instant("tool.tiles.random.cannotOverrideTilesSet")},this.formData=D({name:"",minRadius:null,maxRadius:null,count:null}),this.editedTilesSet=null,this.form=it(this.formData,e=>{H(e.name),kt(e.name,({value:t})=>this.immutableSeriesNames().includes(t())?dt({kind:"cannotOverrideTilesSet"}):null),kt(e.name,({value:t})=>this.editedTilesSet&&this.existingSeriesNames().some(r=>r===t()&&r!==this.editedTilesSet.name)?dt({kind:"cannotNowOverrideOtherTilesSet"}):null),H(e.minRadius),He(e.minRadius,.01),It(e.minRadius,1e3),H(e.maxRadius),He(e.maxRadius,.01),It(e.maxRadius,1e3),kt(e.maxRadius,({value:t,valueOf:o})=>Number(t())<Number(o(e.minRadius))?dt({kind:"minGreaterThenMax"}):null),H(e.count)})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.initFormForEditedTilesSet(e)}initFormForEditedTilesSet(e){let t=this.tilesSetsSignal().find(o=>o.id===e);t&&this.isGeneratedTilesSet(t)&&(this.editedTilesSet=t,this.formData.set({name:t.name,count:t.tiles.length,minRadius:t.minRadius,maxRadius:t.maxRadius}))}getFieldErrorLabel(e){return ze.getFieldErrorLabel(e,this.errorLabels)}trySaveTileSet(){vo(this.form,async()=>{let e=this.getIdOfEditedTilesSet();e?this.openWarningDialog().subscribe(async t=>{t&&await this.saveTileSet(e)}):await this.saveTileSet(null)})}getIdOfEditedTilesSet(){let{name:e}=this.formData();return this.editedTilesSet?.id??this.getTileSetByName(e)?.id??null}getTileSetByName(e){return this.existingSeriesNames().includes(e)?this.tilesSetsSignal().filter(t=>this.isGeneratedTilesSet(t)).find(t=>t.name===e):null}async saveTileSet(e){this.snackBar.open(this.translate.instant("tool.tiles.random.tilesSeriesGenerated"),this.translate.instant("common.ok"),{duration:3e3}),this.store.dispatch(me.tilesSetCommitted({tilesSet:await this.buildTileSet(e)})),this.navigateToMenu()}async buildTileSet(e){let{name:t,minRadius:o,maxRadius:r,count:s}=this.formData(),a=Number(o),h=Number(r),g=new Mo(await this.getImagePixelArray());return{id:e??crypto.randomUUID(),name:t,source:"generated",tiles:g.generateTileSet({min:a,max:h},Number(s)),minRadius:a,maxRadius:h}}async getImagePixelArray(){let e=this.store.selectSignal(zr)();return Ur.getImageSrcPixelArray(e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}isGeneratedTilesSet(e){return e.source==="generated"}openWarningDialog(){let e={title:this.translate.instant("common.warning"),message:this.translate.instant("tool.tiles.random.overrideTileSetWarning")};return this.dialog.open(ht,{data:e}).afterClosed()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-random-tiles"]],decls:46,vars:37,consts:[["auto","matAutocomplete"],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"form"],["subscriptSizing","dynamic",1,"density-3"],["matInput","","type","text",3,"field","matAutocomplete"],[3,"value","disabled"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(t,o){if(t&1){let r=L();d(0,"div",1)(1,"button",2),C("click",function(){return T(r),k(o.navigateToMenu())}),m(2),_(3,"translate"),p(),d(4,"button",3),C("click",function(){return T(r),k(o.trySaveTileSet())}),m(5),_(6,"translate"),p()(),d(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),m(10),_(11,"translate"),p(),x(12,"input",6),N(),d(13,"mat-autocomplete",null,0),Ee(15,ll,2,3,"mat-option",7,$t),p(),d(17,"mat-error"),m(18),p()(),d(19,"mat-form-field",5)(20,"mat-label"),m(21),_(22,"translate"),p(),x(23,"input",8),N(),d(24,"span",9),m(25),_(26,"translate"),p(),d(27,"mat-error"),m(28),p()(),d(29,"mat-form-field",5)(30,"mat-label"),m(31),_(32,"translate"),p(),x(33,"input",8),N(),d(34,"span",9),m(35),_(36,"translate"),p(),d(37,"mat-error"),m(38),p()(),d(39,"mat-form-field",5)(40,"mat-label"),m(41),_(42,"translate"),p(),x(43,"input",8),N(),d(44,"mat-error"),m(45),p()()()}if(t&2){let r=Oe(14);l(2),w(" ",v(3,21,"common.return")," "),l(3),w(" ",v(6,23,"tool.tiles.random.randomTiles")," "),l(5),f(v(11,25,"tool.tiles.random.seriesName")),l(2),V(o.form.name),y("matAutocomplete",r),l(3),De(o.existingSeriesNames()),l(3),f(o.getFieldErrorLabel(o.form.name())),l(3),f(v(22,27,"tool.tiles.random.minRadius")),l(2),V(o.form.minRadius),l(2),f(v(26,29,"common.cm")),l(3),f(o.getFieldErrorLabel(o.form.minRadius())),l(3),f(v(32,31,"tool.tiles.random.maxRadius")),l(2),V(o.form.maxRadius),l(2),f(v(36,33,"common.cm")),l(3),f(o.getFieldErrorLabel(o.form.maxRadius())),l(3),f(v(42,35,"tool.tiles.random.count")),l(2),V(o.form.count),l(2),f(o.getFieldErrorLabel(o.form.count()))}},dependencies:[ve,Ae,nt,rt,bo,Ne,Fe,B,A,Q,_s,fs,ri,Mn,ot,G],styles:["[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px;gap:18px}"],changeDetection:0})}}return n})();var cl=["*"],si=(()=>{class n{constructor(){this.isOpen=ee.required(),this.elementRef=c(ue),this.expandDuration=j(()=>{let e=this.elementRef.nativeElement.scrollHeight,t=150+Math.sqrt(e)*5;return this.isOpen()?t:t*.66})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-expandable-panel"]],hostVars:4,hostBindings:function(t,o){t&2&&(Qe("--expand-duration",o.expandDuration()+"ms"),K("open",o.isOpen()))},inputs:{isOpen:[1,"isOpen"]},ngContentSelectors:cl,decls:1,vars:0,template:function(t,o){t&1&&(_t(),ct(0))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden;height:0;interpolate-size:allow-keywords;transition:height var(--expand-duration, .3s) ease-out}.open[_nghost-%COMP%]{height:auto}"],changeDetection:0})}}return n})();var bs=(()=>{class n{constructor(){this.tile=ee.required(),this.router=c(X)}navigateToTileDetails(){this.router.navigate([`/tool/tray/tile/${this.tile().id}`])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-tile-list-elem"]],inputs:{tile:[1,"tile"]},decls:13,vars:5,consts:[["menu","matMenu"],[1,"label"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(t,o){if(t&1){let r=L();d(0,"span",1),m(1),p(),d(2,"div",2)(3,"button",3)(4,"mat-icon",4),m(5," more_vert "),p()(),d(6,"mat-menu",5,0)(8,"button",6),C("click",function(){return T(r),k(o.navigateToTileDetails())}),d(9,"mat-icon",7),m(10," page_info "),p(),m(11),_(12,"translate"),p()()()}if(t&2){let r=Oe(7);l(),w(" ",o.tile().id,`
`),l(2),y("matMenuTriggerFor",r),l(8),w(" ",v(12,3,"common.details")," ")}},dependencies:[ke,Te,A,Re,ti,Jt,Yt,ei,B,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.selected[_nghost-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;margin-left:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}"],changeDetection:0})}}return n})();var dl=["element"],hl=n=>({$implicit:n});function pl(n,i){if(n&1){let e=L();d(0,"button",3),C("click",function(){T(e);let o=M();return k(o.goToPreviousPage())}),m(1),_(2,"translate"),p()}if(n&2){let e=M().previousPageNumbers();l(),dn(" ",v(2,3,"common.previousElements")," ",e.from,"-",e.to," ")}}function ml(n,i){if(n&1&&or(0,1),n&2){let e=i.$implicit,t=M();y("ngTemplateOutlet",t.template())("ngTemplateOutletContext",cr(2,hl,e))}}function ul(n,i){if(n&1){let e=L();d(0,"button",4),C("click",function(){T(e);let o=M();return k(o.goToNextPage())}),m(1),_(2,"translate"),p()}if(n&2){let e=M().nextPageNumbers();l(),dn(" ",v(2,3,"common.nextElements")," ",e.from,"-",e.to," ")}}var Po=(()=>{class n{constructor(){this.template=dr.required("element"),this.pageSize=ee(50),this.items=ee.required(),this.page=D(1),this.itemsToShow=j(()=>{let e=this.pageSize(),t=(this.page()-1)*e;return this.items().slice(t,t+e)}),this.hasPreviousPage=j(()=>this.page()>1),this.previousPageNumbers=j(()=>{let e=(this.page()-2)*this.pageSize()+1,t=(this.page()-1)*this.pageSize();return{from:Math.max(e,1),to:Math.min(t,this.items().length)}}),this.hasNextPage=j(()=>this.page()*this.pageSize()<this.items().length),this.nextPageNumbers=j(()=>{let e=this.page()*this.pageSize()+1,t=(this.page()+1)*this.pageSize();return{from:Math.min(e,this.items().length),to:Math.min(t,this.items().length)}})}goToPreviousPage(){this.hasPreviousPage()&&this.page.update(e=>e-1)}goToNextPage(){this.hasNextPage()&&this.page.update(e=>e+1)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-scrollable-list"]],contentQueries:function(t,o,r){t&1&&nr(r,o.template,dl,5),t&2&&Wt()},inputs:{pageSize:[1,"pageSize"],items:[1,"items"]},decls:4,vars:2,consts:[["mat-flat-button","",1,"page-button","previous"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-flat-button","",1,"page-button","next"],["mat-flat-button","",1,"page-button","previous",3,"click"],["mat-flat-button","",1,"page-button","next",3,"click"]],template:function(t,o){t&1&&(W(0,pl,3,5,"button",0),Ee(1,ml,1,4,"ng-container",1,zt),W(3,ul,3,5,"button",2)),t&2&&(q(o.hasPreviousPage()?0:-1),l(),De(o.itemsToShow()),l(2),q(o.hasNextPage()?3:-1))},dependencies:[pr,Q,B,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .page-button[_ngcontent-%COMP%]{--mat-button-filled-container-height: 28px;--mat-button-filled-container-shape: 4px}"],changeDetection:0})}}return n})();function gl(n,i){if(n&1){let e=L();d(0,"button",10),C("click",function(){T(e);let o=M();return k(o.navigateToRandomSetAgain())}),d(1,"mat-icon",11),m(2," shuffle "),p(),m(3),_(4,"translate"),p()}n&2&&(l(3),w(" ",v(4,1,"tool.tiles.menu.generateAgain")," "))}function fl(n,i){if(n&1&&x(0,"app-tile-list-elem",14),n&2){let e=i.$implicit;y("tile",e)}}var Cs=(()=>{class n{constructor(){this.tilesSet=ee.required(),this.isOpen=D(!1),this.store=c(F),this.dialog=c(wt),this.translate=c(te),this.destroyRef=c(J),this.router=c(X)}toggleTilesList(){this.isOpen.update(e=>!e)}removeTilesSet(){this.showRemoveTilesSetWarning().pipe(Z(this.destroyRef)).subscribe(e=>{e&&this.store.dispatch(me.tilesSetRemoved({removedTilesSet:this.tilesSet()}))})}showRemoveTilesSetWarning(){let e={title:this.translate.instant("tool.tiles.menu.removeTilesSet"),message:this.translate.instant("tool.tiles.menu.removeTilesSetQuery",{name:this.tilesSet().name})};return this.dialog.open(ht,{data:e}).afterClosed()}navigateToRandomSetAgain(){this.router.navigate([`/tool/tray/random/${this.tilesSet().id}`])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-tiles-set-list-elem"]],inputs:{tilesSet:[1,"tilesSet"]},decls:22,vars:10,consts:[["menu","matMenu"],["element",""],[1,"list-elem"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["mat-icon-button","",1,"elem-action","toggle-action",3,"click"],[1,"chevron"],["classList","paddingless"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"],[1,"panel",3,"isOpen"],[3,"items"],[3,"tile"]],template:function(t,o){if(t&1){let r=L();d(0,"div",2)(1,"span"),m(2),p(),d(3,"div",3)(4,"button",4)(5,"mat-icon",5),m(6," more_vert "),p()(),d(7,"button",6),C("click",function(){return T(r),k(o.toggleTilesList())}),d(8,"mat-icon",7),m(9," keyboard_arrow_up "),p()(),d(10,"mat-menu",8,0),W(12,gl,5,3,"button",9),d(13,"button",10),C("click",function(){return T(r),k(o.removeTilesSet())}),d(14,"mat-icon",11),m(15," delete "),p(),m(16),_(17,"translate"),p()()()(),d(18,"app-expandable-panel",12)(19,"app-scrollable-list",13),ft(20,fl,1,1,"ng-template",null,1,Gi),p()()}if(t&2){let r=Oe(11),s=o.tilesSet();l(2),f(s.name),l(2),y("matMenuTriggerFor",r),l(4),K("chevron--closed",!o.isOpen()),l(4),q(s.source==="generated"?12:-1),l(4),w(" ",v(17,8,"tool.tiles.menu.removeTilesSet")," "),l(2),y("isOpen",o.isOpen()),l(),y("items",s.tiles)}},dependencies:[si,A,Re,ke,Te,ti,Jt,Yt,ei,bs,B,Po,G],styles:["[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .list-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:first-child{margin-top:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:#666}"],changeDetection:0})}}return n})();function _l(n,i){if(n&1&&x(0,"app-tiles-set-list-elem",4),n&2){let e=i.$implicit;y("tilesSet",e)}}function vl(n,i){n&1&&(d(0,"span",5),m(1),_(2,"translate"),p()),n&2&&(l(),w(" ",v(2,1,"tool.tiles.menu.noTiles")," "))}var ys=(()=>{class n{constructor(){this.router=c(X),this.store=c(F),this.tilesSets=this.store.selectSignal(tt)}navigateToRandomTiles(){this.router.navigate(["/tool/tray/random"])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-tray-menu"]],decls:14,vars:10,consts:[[1,"actions"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","accent",3,"click"],[1,"tiles-sets"],[3,"tilesSet"],[1,"no-sets"]],template:function(t,o){t&1&&(d(0,"div",0)(1,"button",1),m(2),_(3,"translate"),p(),d(4,"button",1),m(5),_(6,"translate"),p(),d(7,"button",2),C("click",function(){return o.navigateToRandomTiles()}),m(8),_(9,"translate"),p()(),d(10,"div",3),Ee(11,_l,1,1,"app-tiles-set-list-elem",4,zt,!1,vl,3,3,"span",5),p()),t&2&&(l(2),w(" ",v(3,4,"tool.tiles.menu.loadFromFile")," "),l(3),w(" ",v(6,6,"tool.tiles.menu.createTile")," "),l(3),w(" ",v(9,8,"tool.tiles.menu.randomTiles")," "),l(3),De(o.tilesSets()))},dependencies:[A,Q,Cs,B,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;flex:1 1 0}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]   .no-sets[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}"],changeDetection:0})}}return n})();var bl=["canvas"],Ss=(()=>{class n{constructor(){this.value=bt.required(),this.valueChange=qt(),this.canvas=Zi.required("canvas"),this.cursorData=j(()=>{let e=this.value(),t=this.canvas()?.nativeElement.getBoundingClientRect().width??1;return this.computeCursorData(e,t)}),this.destroyRef=c(J),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onSliderMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onSliderMouseInteraction(e)}}onSliderMouseInteraction(e){let t=this.canvas().nativeElement.getBoundingClientRect(),o=(e.clientX-t.x)/t.width;this.value.set(Math.max(0,Math.min(1,o))),this.valueChange.emit(this.value())}ngAfterViewInit(){this.drawSliderCanvas(),this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove)})}drawSliderCanvas(){let e=this.canvas().nativeElement.getContext("2d"),t={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},o=e.createLinearGradient(0,0,t.width,0),r=20;for(let s=0;s<=r;++s){let a=s*(1/r);o.addColorStop(a,pe({h:a*360,s:100,v:100}).hex())}e.fillStyle=o,e.fillRect(0,0,t.width,t.height)}computeCursorData(e,t){let o=t*e-8,r=pe({h:e*360,s:100,v:100}).hex();return{horizontalOffset:`${o}px`,color:r}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-color-slider"]],viewQuery:function(t,o){t&1&&Ui(o.canvas,bl,5),t&2&&Wt()},inputs:{value:[1,"value"]},outputs:{value:"valueChange",valueChange:"valueChange"},decls:3,vars:4,consts:[["canvas",""],["width","250","height","8",1,"slider"],[1,"cursor"]],template:function(t,o){if(t&1&&$i(0,"canvas",1,0)(2,"div",2),t&2){let r=o.cursorData();l(2),Qe("left",r.horizontalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{width:100%;position:relative;cursor:pointer}[_nghost-%COMP%]   .slider[_ngcontent-%COMP%]{display:block;width:100%;height:8px;border-radius:5px}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;top:-5px;pointer-events:none}"],changeDetection:0})}}return n})();var Cl=["canvas"],ws=(()=>{class n{constructor(){this.hValue=ee.required(),this.sValue=bt.required(),this.vValue=bt.required(),this.colorChange=qt(),this.canvas=Zi.required("canvas"),this.cursorData=j(()=>this.computeCursorData()),this.destroyRef=c(J),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onCanvasMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onCanvasMouseInteraction(e)},Me(()=>this.drawColorCanvas())}onCanvasMouseInteraction(e){let t=this.canvas().nativeElement.getBoundingClientRect(),o=(e.clientX-t.x)/t.width,r=(e.clientY-t.y)/t.height;this.sValue.set(Math.min(1,Math.max(0,o))),this.vValue.set(Math.min(1,Math.max(0,1-r))),this.colorChange.emit(pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}))}ngAfterViewInit(){this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove)})}drawColorCanvas(){let e={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},t=this.canvas().nativeElement.getContext("2d"),o=t.createLinearGradient(0,0,e.width,0);o.addColorStop(0,"#FFFFFF");let r=pe({h:this.hValue()*360,s:100,v:100}).hex();o.addColorStop(1,r);let s=t.createLinearGradient(0,0,0,e.height);s.addColorStop(0,"#00000000"),s.addColorStop(1,"#000000"),t.fillStyle=o,t.fillRect(0,0,e.width,e.height),t.fillStyle=s,t.fillRect(0,0,e.width,e.height)}computeCursorData(){let e=this.canvas().nativeElement.getBoundingClientRect(),t=e.width*this.sValue()-8,o=e.height*(1-this.vValue())-8;return{horizontalOffset:`${t}px`,verticalOffset:`${o}px`,color:pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex()}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-color-canvas"]],viewQuery:function(t,o){t&1&&Ui(o.canvas,Cl,5),t&2&&Wt()},inputs:{hValue:[1,"hValue"],sValue:[1,"sValue"],vValue:[1,"vValue"]},outputs:{sValue:"sValueChange",vValue:"vValueChange",colorChange:"colorChange"},decls:3,vars:6,consts:[["canvas",""],["width","250","height","150",1,"panel"],[1,"cursor"]],template:function(t,o){if(t&1&&$i(0,"canvas",1,0)(2,"div",2),t&2){let r=o.cursorData();l(2),Qe("left",r.horizontalOffset)("top",r.verticalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{position:relative;cursor:pointer;overflow:hidden;display:block}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{display:block;width:100%}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;pointer-events:none}"],changeDetection:0})}}return n})();var Sl=/^#([0-9a-f]{3}){1,2}$/i,xs=(()=>{class n{constructor(){this.color=ee.required({transform:e=>pe(e)}),this.colorChange=qt(),this.hValue=Ki({source:this.color,computation:e=>e.hue()/360}),this.sValue=Ki({source:this.color,computation:e=>e.saturationv()/100}),this.vValue=Ki({source:this.color,computation:e=>e.value()/100}),this.hexColor=j(()=>pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex())}ngOnDestroy(){let e=pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100});this.colorChange.emit(e)}onHexCodeChange(e){let t=e.currentTarget;if(Sl.test(t.value)){let o=pe(t.value);this.hValue.set(o.hue()/360),this.sValue.set(o.saturationv()/100),this.vValue.set(o.value()/100)}}onColorCanvasChanged(e){this.sValue.set(e.saturationv()/100),this.vValue.set(e.value()/100)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-color-selection-panel"]],inputs:{color:[1,"color"]},outputs:{colorChange:"colorChange"},decls:10,vars:7,consts:[[1,"sv-preview"],[3,"colorChange","hValue","sValue","vValue"],[1,"slider-container"],[3,"valueChange","value"],[1,"result-wrapper"],["role","presentation",1,"color-preview"],[1,"density-3","code-input"],["matInput","",3,"change","ngModel"]],template:function(t,o){t&1&&(d(0,"div",0)(1,"app-color-canvas",1),C("colorChange",function(s){return o.onColorCanvasChanged(s)}),p()(),d(2,"div",2)(3,"app-color-slider",3),lr("valueChange",function(s){return ar(o.hValue,s)||(o.hValue=s),s}),p()(),d(4,"div",4),x(5,"div",5),d(6,"mat-form-field",6)(7,"mat-label"),m(8,"Hex"),p(),d(9,"input",7),C("change",function(s){return o.onHexCodeChange(s)}),p()()()),t&2&&(l(),y("hValue",o.hValue())("sValue",o.sValue())("vValue",o.vValue()),l(2),sr("value",o.hValue),l(2),Qe("background",o.hexColor()),l(4),y("ngModel",o.hexColor()))},dependencies:[Ne,Fe,Ae,nt,po,Ir,co,ho,Ss,ws],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;background-color:var(--irr-contrast-lightest);border-radius:5px;overflow:hidden;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{padding:20px 10px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:0 10px 15px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;min-width:40px;height:40px;border-radius:50%;box-shadow:0 0 4px 1px #0003}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]{width:auto}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}}return n})();function wl(n,i){if(n&1){let e=L();d(0,"app-color-selection-panel",6),C("colorChange",function(o){T(e);let r=M();return k(r.onColorChanged(o))}),p()}if(n&2){let e=M();y("color",e.value())}}var Eo=(()=>{class n{constructor(){this.label=ee.required(),this.value=bt("#000000"),this.disabled=bt(!1),this.isOpen=D(!1),this.onChange=()=>{},this.onTouched=()=>{},this.valueChangedEffect=Me(()=>{this.onChange(this.value())})}toggleColorPanel(){this.disabled()||this.isOpen.update(e=>!e)}onColorChanged(e){this.value.set(e.hex())}writeValue(e){this.value.set(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled.set(e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-color-picker"]],inputs:{label:[1,"label"],value:[1,"value"],disabled:[1,"disabled"]},outputs:{value:"valueChange",disabled:"disabledChange"},features:[de([{provide:lo,useExisting:Bi(()=>n),multi:!0}])],decls:8,vars:10,consts:[["trigger","cdkOverlayOrigin"],[1,"color-label"],[1,"color-label__header"],[1,"color-label__code"],["role","presentation","cdkOverlayOrigin","",1,"color-preview",3,"click"],["cdkConnectedOverlay","",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayBackdropClass"],[3,"colorChange","color"]],template:function(t,o){if(t&1){let r=L();d(0,"div",1)(1,"span",2),m(2),p(),d(3,"span",3),m(4),p()(),d(5,"div",4,0),C("click",function(){return T(r),k(o.toggleColorPanel())}),p(),ft(7,wl,1,1,"ng-template",5),C("backdropClick",function(){return T(r),k(o.toggleColorPanel())})}if(t&2){let r=Oe(6);l(2),f(o.label()),l(2),f(o.value()),l(),Qe("background-color",o.value()),K("disabled",o.disabled()),l(2),y("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",o.isOpen())("cdkConnectedOverlayHasBackdrop",o.isOpen())("cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop-cs")}},dependencies:[Ci,Er,Pr,xs],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;border-radius:4px;padding:10px 15px;background-color:var(--irr-contrast-lightest);box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;width:40px;height:40px;margin-left:auto;border-radius:50%;box-shadow:0 0 4px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}[_nghost-%COMP%]   .color-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .color-label__header[_ngcontent-%COMP%]{color:var(--irr-contrast-highest)}[_nghost-%COMP%]   .color-label__code[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);font-size:15px}"],changeDetection:0})}}return n})();function xl(n,i){if(n&1&&(d(0,"div",5)(1,"div",6),m(2),_(3,"translate"),p(),d(4,"div",7),m(5),p()(),x(6,"app-color-picker",8)),n&2){let e=i,t=M();l(2),w("",v(3,5,"tool.tiles.details.tileId"),":"),l(3),f(e.id),l(),y("disabled",!0)("ngModel",e.color)("label",t.translate.instant("tool.tiles.details.tileColor"))}}function Ml(n,i){n&1&&(d(0,"div",4),m(1),_(2,"translate"),p()),n&2&&(l(),f(v(2,1,"tool.tiles.details.tileNoExist")))}var Ms=(()=>{class n{constructor(){this.tile=D(null),this.route=c(Ct),this.store=c(F),this.router=c(X),this.translate=c(te)}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(e){let t=this.getTileModel(e);t&&this.tile.set(t)}}getTileModel(e){return this.store.selectSignal(tt)().flatMap(o=>o.tiles).find(o=>o.id===e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-tile-detail"]],decls:10,vars:7,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],[1,"details"],[1,"no-exist"],[1,"id"],[1,"label"],[1,"value"],[3,"disabled","ngModel","label"]],template:function(t,o){if(t&1&&(d(0,"div",0)(1,"button",1),C("click",function(){return o.navigateToMenu()}),m(2),_(3,"translate"),p(),d(4,"button",2),m(5),_(6,"translate"),p()(),d(7,"div",3),W(8,xl,7,7)(9,Ml,3,3,"div",4),p()),t&2){let r;l(2),w(" ",v(3,3,"common.return")," "),l(3),w(" ",v(6,5,"common.edit")," "),l(3),q((r=o.tile())?8:9,r)}},dependencies:[B,A,Q,Eo,po,co,ho,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:12px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{padding:2px;color:#e6e6e6}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .no-exist[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:auto}"],changeDetection:0})}}return n})();var mt=(()=>{class n{constructor(){this.sectorForContourEditionChanged=new We(null),this.sectorForContourEdition$=this.sectorForContourEditionChanged.asObservable(),this.sectorListChanged=new We(null),this.sectorListChange$=this.sectorListChanged.asObservable(),this.sectorForPropertyEditionChanged=new We(null),this.sectorForPropertyEdition$=this.sectorForPropertyEditionChanged.asObservable(),this.canvasClickedSub=new P,this.canvasClicked$=this.canvasClickedSub.asObservable()}emitEditedSectorContour(e){this.sectorForContourEditionChanged.next(e)}emitEditedSectorProperty(e){this.sectorForPropertyEditionChanged.next(e)}emitSectorListChanged(e){this.sectorListChanged.next(e)}emitCanvasClicked(e){this.canvasClickedSub.next(e)}static createNewSector(){return{id:crypto.randomUUID(),name:"",color:pe({h:pt.nextFloat(0,360),s:75,v:95}).hex(),vertices:[],properties:{sectionMaxArea:5,sectionMinAngle:35,maxTileRadius:4,minTileRadius:0,tilesMargin:.1,evaluationParams:{singleSectionPopulation:2,overlappingAreaOutsideSector:-2,additionalPopulationOfNeighboringSectors:4,overlappingNotPopulatedSections:-1,tileColorMismatch:-2},populationParams:{initialPopulationSize:100,countOfTriesToInsertTile:30,countOfTrianglePositionDraws:30,countOfColorMatchingAttempts:40,iterationsCount:100,populationSize:10}}}}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Pl=10,El=10,Do=class extends St{constructor(i,e,t,o=100){super(),this.vertices=i,this.selectedIndex=e,this.hexColor=t,this.order=o}drawObject(i,e){if(this.vertices.length>=2){let t=Pl*e.scaleFactor;i.lineWidth=t,i.strokeStyle=this.hexColor,i.setLineDash([t]),i.beginPath(),i.globalAlpha=.25;let o=e.getViewportPosition(this.vertices.at(-1));i.moveTo(o.x,o.y),o=e.getViewportPosition(this.vertices[0]),i.lineTo(o.x,o.y),i.stroke(),i.globalAlpha=.7,i.setLineDash([]),i.beginPath(),i.moveTo(o.x,o.y);for(let r=1;r<this.vertices.length;++r)o=e.getViewportPosition(this.vertices[r]),i.lineTo(o.x,o.y);i.stroke()}i.lineWidth=1,i.globalAlpha=1,this.selectedIndex!==-1&&this.drawPoint(i,e,this.vertices[this.selectedIndex])}drawPoint(i,e,t){let o=e.getViewportPosition(t);i.beginPath();let r=El*e.scaleFactor;i.arc(o.x,o.y,r,0,2*Math.PI),i.fillStyle=this.hexColor,i.fill()}getOrder(){return this.order}};function Dl(n){let i=n.length,e=5381,t=52711,o;for(;i--;)o=n.charCodeAt(i),e=e*33^o,t=t*33^o;return(e>>>0)*4096+(t>>>0)}var Ei="|",Ol=/\[object ([HTML|SVG](.*)Element)\]/,Tl={"[object Arguments]":0,"[object Array]":1,"[object ArrayBuffer]":2,"[object AsyncFunction]":3,"[object AsyncGeneratorFunction]":4,"[object BigInt]":5,"[object BigInt64Array]":6,"[object BigUint64Array]":7,"[object Boolean]":8,"[object DataView]":9,"[object Date]":10,"[object DocumentFragment]":11,"[object Error]":12,"[object Event]":13,"[object Float32Array]":14,"[object Float64Array]":15,"[object Function]":16,"[object Generator]":17,"[object GeneratorFunction]":18,"[object Int8Array]":19,"[object Int16Array]":20,"[object Map]":21,"[object Number]":22,"[object Object]":23,"[object Promise]":24,"[object RegExp]":25,"[object Set]":26,"[object SharedArrayBuffer]":27,"[object String]":28,"[object Uint8Array]":29,"[object Uint8ClampedArray]":30,"[object Uint16Array]":31,"[object Uint32Array]":32,"[object WeakMap]":33,"[object WeakRef]":34,"[object WeakSet]":35,CUSTOM:36,ELEMENT:37},kl={"[object Arguments]":1,"[object Array]":2},Ts={"[object Generator]":1,"[object Promise]":2,"[object WeakMap]":3,"[object WeakRef]":4,"[object WeakSet]":5},Il={"[object AsyncFunction]":1,"[object AsyncGeneratorFunction]":2,"[object Boolean]":3,"[object Function]":4,"[object GeneratorFunction]":5,"[object Number]":6,"[object String]":7},Rl={"[object BigInt64Array]":1,"[object BigUint64Array]":2,"[object Float32Array]":3,"[object Float64Array]":4,"[object Int8Array]":5,"[object Int16Array]":6,"[object Uint8Array]":7,"[object Uint8ClampedArray]":8,"[object Uint16Array]":9,"[object Uint32Array]":10},Al={"[object Arguments]":1,"[object Array]":2,"[object ArrayBuffer]":3,"[object BigInt64Array]":4,"[object BigUint64Array]":5,"[object DataView]":6,"[object Float32Array]":7,"[object Float64Array]":8,"[object Int8Array]":9,"[object Int16Array]":10,"[object Map]":11,"[object Object]":12,"[object Set]":13,"[object SharedArrayBuffer]":14,"[object Uint8Array]":15,"[object Uint8ClampedArray]":16,"[object Uint16Array]":17,"[object Uint32Array]":18,CUSTOM:19},Pi={bigint:"i",boolean:"b",empty:"e",function:"g",number:"n",object:"o",string:"s",symbol:"s"};function he(n,i){return Pi.object+Ei+Tl[n]+Ei+i}var Ps=new WeakMap,Ll=0;function En(n,i){let e=Ps.get(n);if(e)return e;let t=he(i,"NOT_ENUMERABLE"+Ei+Ll++);return Ps.set(n,t),t}function Fl(n,i){return n[0]>i[0]}function ks(n,i){return n>i}function Dn(n,i){let e,t;for(let o=0;o<n.length;++o){for(t=n[o],e=o-1;~e&&i(n[e],t);--e)n[e+1]=n[e];n[e+1]=t}return n}var Nl=Object.prototype.toString;function Vl(n,i,e){if(Al[i])return Es(i,n,e);if(i==="[object Date]")return he(i,n.getTime());if(i==="[object RegExp]")return he(i,n.toString());if(i==="[object Event]")return he(i,[n.bubbles,n.cancelBubble,n.cancelable,n.composed,n.currentTarget,n.defaultPrevented,n.eventPhase,n.isTrusted,n.returnValue,n.target,n.type].join());if(i==="[object Error]")return he(i,n.message+Ei+n.stack);if(i==="[object DocumentFragment]")return he(i,$l(n));let t=i.match(Ol);return t?he("ELEMENT",t[1]+Ei+n.outerHTML):Ts[i]?En(n,i):Il[i]?he(i,n.toString()):Es("CUSTOM",n,e)}function Es(n,i,e){let t=e.cache.get(i);return t?he(n,"RECURSIVE~"+t):(e.cache.set(i,++e.id),n==="[object Object]"?i[Symbol.iterator]?En(i,n):he(n,Os(i,e)):kl[n]?he(n,jl(i,e)):n==="[object Map]"?he(n,Ul(i,e)):n==="[object Set]"?he(n,Wl(i,e)):Rl[n]?he(n,i.join()):n==="[object ArrayBuffer]"?he(n,Ds(i)):n==="[object DataView]"?he(n,Ds(i.buffer)):Ts[n]?En(i,n):he("CUSTOM",Os(i,e)))}function jl(n,i){let e=n.length,t=new Array(e);for(;--e>=0;)t[e]=ai(n[e],i);return t.join()}function Bl(n){return Buffer.from(n).toString("utf8")}function Hl(n){return String.fromCharCode.apply(null,new Uint16Array(n))}function zl(){return"UNSUPPORTED"}function $l(n){let i=n.children,e=i.length,t=new Array(e);for(;--e>=0;)t[e]=i[e].outerHTML;return t.join()}var Ds=typeof Buffer<"u"&&typeof Buffer.from=="function"?Bl:typeof Uint16Array=="function"?Hl:zl;function Ul(n,i){let e=new Array(n.size),t=0;for(n.forEach((o,r)=>{e[t++]=[ai(r,i),ai(o,i)]}),Dn(e,Fl);--t>=0;)e[t]="["+e[t][0]+","+e[t][1]+"]";return"["+e.join()+"]"}function Os(n,i){let e=Dn(Object.getOwnPropertyNames(n),ks),t=e.length,o=new Array(t),r=t;for(;--r>=0;)o[r]=e[r]+":"+ai(n[e[r]],i);return"{"+o.join()+"}"}function Wl(n,i){let e=new Array(n.size),t=0;return n.forEach(o=>{e[t++]=ai(o,i)}),"["+Dn(e,ks).join()+"]"}function ai(n,i){let e=typeof n;return n==null||e==="undefined"?Pi.empty+n:e==="object"?Vl(n,Nl.call(n),i||{cache:new WeakMap,id:1}):e==="function"||e==="symbol"?Pi[e]+n.toString():e==="boolean"?Pi.boolean+ +n:Pi[e]+n}function Is(n){return Dl(ai(n,void 0))}var ut=class{constructor(i,e){this.start=i,this.end=e}hash(){return Is(this)}};var li=class n extends St{constructor(i,e,t,o=100){super(),this.hexColor=t,this.order=o,this.borderThickness=8,this.innerThickness=3,this.outerContour=e,this.innerLines=n.getLines(i)}drawObject(i,e){this.outerContour.length<3||(i.strokeStyle=this.hexColor,this.drawTriangulationMesh(i,e),this.drawBorder(i,e),i.lineWidth=1)}drawBorder(i,e){i.lineWidth=this.borderThickness*e.scaleFactor;let t=e.getViewportPosition(this.outerContour[0]);i.beginPath(),i.moveTo(t.x,t.y);for(let o=1;o<this.outerContour.length;++o)t=e.getViewportPosition(this.outerContour[o]),i.lineTo(t.x,t.y);i.closePath(),i.stroke(),i.globalAlpha=.25,i.fillStyle=this.hexColor,i.fill(),i.globalAlpha=1}drawTriangulationMesh(i,e){i.lineWidth=this.innerThickness*e.scaleFactor,i.globalAlpha=.3;for(let t of this.innerLines){i.beginPath();let o=e.getViewportPosition(t.start);i.moveTo(o.x,o.y);let r=e.getViewportPosition(t.end);i.lineTo(r.x,r.y),i.stroke()}i.globalAlpha=1}static getLines(i){let e=this.collectMeshLines(i),t=[];for(let o of e.values())o.count===2&&t.push(o.line);return t}getOrder(){return this.order}static collectMeshLines(i){let e=new Map;for(let t of i){let o=t.getVertices(),r=o.at(-1);for(let s=0;s<3;++s){let a=o[s],h=r.sqrMagnitude()<a.sqrMagnitude()?[r,a]:[a,r],g=new ut(h[0],h[1]),b=g.hash(),U=e.get(b);U?U.count++:e.set(b,{line:g,count:1}),r=a}}return e}};var ci=class extends St{constructor(i,e,t=10,o=8){super(),this.vertices=i,this.hexColor=e,this.order=t,this.baseLineThickness=o}drawObject(i,e){if(this.vertices.length<3)return;i.beginPath();let t=e.getViewportPosition(this.vertices[0]);i.moveTo(t.x,t.y);for(let o=1;o<this.vertices.length;++o)t=e.getViewportPosition(this.vertices[o]),i.lineTo(t.x,t.y);i.lineWidth=this.baseLineThickness*e.scaleFactor,i.strokeStyle=this.hexColor,i.closePath(),i.globalAlpha=.25,i.fillStyle=this.hexColor,i.fill(),i.globalAlpha=1,i.stroke(),i.lineWidth=1}getOrder(){return this.order}};var Rs=(()=>{class n{constructor(){this.store=c(F),this.service=c(mt),this.destroyRef=c(J),this.toolService=c(_e),this.sectorForContourEdition=fn(this.service.sectorForContourEdition$,{requireSync:!0}),this.sectorForPropertyEdition=fn(this.service.sectorForPropertyEdition$,{requireSync:!0}),this.visualElements=[],this.ribbonActions=[{iconName:"crop",visibility:D("on"),tooltipKey:"tool.ribbon.takeSnapshot",onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")},{iconName:"recenter",visibility:D("on"),tooltipKey:"tool.ribbon.focusOnImage",onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}}]}ngOnInit(){this.service.emitEditedSectorContour(null),this.service.emitEditedSectorProperty(null)}ngAfterViewInit(){this.subscribeOnEditedSectorChange(),this.subscribeOnEditedSectorPropertiesChange(),this.subscribeOnSectorListChange(),Br(this.activeCanvas.clicked).pipe(Z(this.destroyRef)).subscribe(e=>this.service.emitCanvasClicked(e))}subscribeOnEditedSectorChange(){this.service.sectorForContourEdition$.pipe(Z(this.destroyRef)).subscribe(e=>this.onEditedSectorChanged(e))}subscribeOnEditedSectorPropertiesChange(){this.service.sectorForPropertyEdition$.pipe(Z(this.destroyRef)).subscribe(()=>this.redrawSectors())}subscribeOnSectorListChange(){this.service.sectorListChange$.pipe(Z(this.destroyRef)).subscribe(()=>this.redrawSectors())}onEditedSectorChanged(e){this.activeCanvas.options.update(t=>ae(E({},t),{isMovable:!e})),this.redrawSectors()}redrawSectors(){this.visualElements.forEach(e=>e.removeObject()),this.visualElements=this.prepareSectorsContours();for(let e of this.visualElements)this.activeCanvas.addCanvasObject(e);this.activeCanvas.redraw()}prepareSectorsContours(){let e=this.sectorForContourEdition(),t=this.sectorForPropertyEdition(),o,r=this.store.selectSignal(fe)();return e?r=Qr.addOrUpdate([...r],e.sector,s=>s.id===e.sector.id):this.service.sectorListChange$.pipe(Xn()).subscribe(s=>{o=s?.selectedSector}),this.mapSectorsToContours(r,e,t,o)}mapSectorsToContours(e,t,o,r){return e.map((s,a)=>{if(s.id===t?.sector.id)return new Do([...t.sector.vertices],t.sector.vertices.indexOf(t.selectedVertex),t.sector.color);if(o?.mesh&&s.id===o?.sector.id){let h=o.mesh,g=o.contour;return new li(h,g,o.sector.color)}else{let h=s.id===r?.id?10:8;return new ci([...s.vertices],s.color,10+a,h)}})}sectionEntered(e,t){this.activeCanvas=e;let o=this.store.selectSignal(et)();return queueMicrotask(async()=>{this.imageObject=await _e.createImageObject(o),this.activeCanvas.addCanvasObject(this.imageObject),t&&this.focusOnImage(),this.activeCanvas.redraw()}),{ribbon:this.ribbonActions}}focusOnImage(){let e=_e.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-sectors"]],decls:1,vars:0,template:function(t,o){t&1&&x(0,"router-outlet")},dependencies:[Gt],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return n})();var Ce=class extends Error{constructor(i,e){let t=new.target.prototype;super(`${i}: Status code '${e}'`),this.statusCode=e,this.__proto__=t}},xt=class extends Error{constructor(i="A timeout occurred."){let e=new.target.prototype;super(i),this.__proto__=e}},ce=class extends Error{constructor(i="An abort occurred."){let e=new.target.prototype;super(i),this.__proto__=e}},Oo=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=t}},To=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=t}},ko=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=t}},Di=class extends Error{constructor(i){let e=new.target.prototype;super(i),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}},Io=class extends Error{constructor(i,e){let t=new.target.prototype;super(i),this.innerErrors=e,this.__proto__=t}};var di=class{constructor(i,e,t){this.statusCode=i,this.statusText=e,this.content=t}},st=class{get(i,e){return this.send(ae(E({},e),{method:"GET",url:i}))}post(i,e){return this.send(ae(E({},e),{method:"POST",url:i}))}delete(i,e){return this.send(ae(E({},e),{method:"DELETE",url:i}))}getCookieString(i){return""}};var u=(function(n){return n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None",n})(u||{});var at=class{constructor(){}log(i,e){}};at.instance=new at;var As="10.0.0";var z=class{static isRequired(i,e){if(i==null)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(i,e){if(!i||i.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(i,e,t){if(!(i in e))throw new Error(`Unknown ${t} value: ${i}.`)}},$=class n{static get isBrowser(){return!n.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!n.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!n.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};function Mt(n,i){let e="";return $e(n)?(e=`Binary data of length ${n.byteLength}`,i&&(e+=`. Content: '${ql(n)}'`)):typeof n=="string"&&(e=`String data of length ${n.length}`,i&&(e+=`. Content: '${n}'`)),e}function ql(n){let i=new Uint8Array(n),e="";return i.forEach(t=>{let o=t<16?"0":"";e+=`0x${o}${t.toString(16)} `}),e.substring(0,e.length-1)}function $e(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Ao(n,i,e,t,o,r){let s={},[a,h]=lt();s[a]=h,n.log(u.Trace,`(${i} transport) sending data. ${Mt(o,r.logMessageContent)}.`);let g=$e(o)?"arraybuffer":"text",b=await e.post(t,{content:o,headers:E(E({},s),r.headers),responseType:g,timeout:r.timeout,withCredentials:r.withCredentials});n.log(u.Trace,`(${i} transport) request complete. Response status: ${b.statusCode}.`)}function Ls(n){return n===void 0?new At(u.Information):n===null?at.instance:n.log!==void 0?n:new At(n)}var Ro=class{constructor(i,e){this._subject=i,this._observer=e}dispose(){let i=this._subject.observers.indexOf(this._observer);i>-1&&this._subject.observers.splice(i,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}},At=class{constructor(i){this._minLevel=i,this.out=console}log(i,e){if(i>=this._minLevel){let t=`[${new Date().toISOString()}] ${u[i]}: ${e}`;switch(i){case u.Critical:case u.Error:this.out.error(t);break;case u.Warning:this.out.warn(t);break;case u.Information:this.out.info(t);break;default:this.out.log(t);break}}}};function lt(){let n="X-SignalR-User-Agent";return $.isNode&&(n="User-Agent"),[n,Gl(As,Kl(),Xl(),Zl())]}function Gl(n,i,e,t){let o="Microsoft SignalR/",r=n.split(".");return o+=`${r[0]}.${r[1]}`,o+=` (${n}; `,i&&i!==""?o+=`${i}; `:o+="Unknown OS; ",o+=`${e}`,t?o+=`; ${t}`:o+="; Unknown Runtime Version",o+=")",o}function Kl(){if($.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Zl(){if($.isNode)return process.versions.node}function Xl(){return $.isNode?"NodeJS":"Browser"}function Lo(n){return n.stack?n.stack:n.message?n.message:`${n}`}function Fs(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var Fo=class extends st{constructor(i){if(super(),this._logger=i,typeof fetch>"u"||$.isNode){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;this._jar=new(e("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(Fs());if(typeof AbortController>"u"){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(i){if(i.abortSignal&&i.abortSignal.aborted)throw new ce;if(!i.method)throw new Error("No method defined.");if(!i.url)throw new Error("No url defined.");let e=new this._abortControllerType,t;i.abortSignal&&(i.abortSignal.onabort=()=>{e.abort(),t=new ce});let o=null;if(i.timeout){let h=i.timeout;o=setTimeout(()=>{e.abort(),this._logger.log(u.Warning,"Timeout from HTTP request."),t=new xt},h)}i.content===""&&(i.content=void 0),i.content&&(i.headers=i.headers||{},$e(i.content)?i.headers["Content-Type"]="application/octet-stream":i.headers["Content-Type"]="text/plain;charset=UTF-8");let r;try{r=await this._fetchType(i.url,{body:i.content,cache:"no-cache",credentials:i.withCredentials===!0?"include":"same-origin",headers:E({"X-Requested-With":"XMLHttpRequest"},i.headers),method:i.method,mode:"cors",redirect:"follow",signal:e.signal})}catch(h){throw t||(this._logger.log(u.Warning,`Error from HTTP request. ${h}.`),h)}finally{o&&clearTimeout(o),i.abortSignal&&(i.abortSignal.onabort=null)}if(!r.ok){let h=await Ns(r,"text");throw new Ce(h||r.statusText,r.status)}let a=await Ns(r,i.responseType);return new di(r.status,r.statusText,a)}getCookieString(i){let e="";return $.isNode&&this._jar&&this._jar.getCookies(i,(t,o)=>e=o.join("; ")),e}};function Ns(n,i){let e;switch(i){case"arraybuffer":e=n.arrayBuffer();break;case"text":e=n.text();break;case"blob":case"document":case"json":throw new Error(`${i} is not supported.`);default:e=n.text();break}return e}var No=class extends st{constructor(i){super(),this._logger=i}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new ce):i.method?i.url?new Promise((e,t)=>{let o=new XMLHttpRequest;o.open(i.method,i.url,!0),o.withCredentials=i.withCredentials===void 0?!0:i.withCredentials,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.content===""&&(i.content=void 0),i.content&&($e(i.content)?o.setRequestHeader("Content-Type","application/octet-stream"):o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let r=i.headers;r&&Object.keys(r).forEach(s=>{o.setRequestHeader(s,r[s])}),i.responseType&&(o.responseType=i.responseType),i.abortSignal&&(i.abortSignal.onabort=()=>{o.abort(),t(new ce)}),i.timeout&&(o.timeout=i.timeout),o.onload=()=>{i.abortSignal&&(i.abortSignal.onabort=null),o.status>=200&&o.status<300?e(new di(o.status,o.statusText,o.response||o.responseText)):t(new Ce(o.response||o.responseText||o.statusText,o.status))},o.onerror=()=>{this._logger.log(u.Warning,`Error from HTTP request. ${o.status}: ${o.statusText}.`),t(new Ce(o.statusText,o.status))},o.ontimeout=()=>{this._logger.log(u.Warning,"Timeout from HTTP request."),t(new xt)},o.send(i.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var Vo=class extends st{constructor(i){if(super(),typeof fetch<"u"||$.isNode)this._httpClient=new Fo(i);else if(typeof XMLHttpRequest<"u")this._httpClient=new No(i);else throw new Error("No usable HttpClient found.")}send(i){return i.abortSignal&&i.abortSignal.aborted?Promise.reject(new ce):i.method?i.url?this._httpClient.send(i):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(i){return this._httpClient.getCookieString(i)}};var ye=class n{static write(i){return`${i}${n.RecordSeparator}`}static parse(i){if(i[i.length-1]!==n.RecordSeparator)throw new Error("Message is incomplete.");let e=i.split(n.RecordSeparator);return e.pop(),e}};ye.RecordSeparatorCode=30;ye.RecordSeparator=String.fromCharCode(ye.RecordSeparatorCode);var jo=class{writeHandshakeRequest(i){return ye.write(JSON.stringify(i))}parseHandshakeResponse(i){let e,t;if($e(i)){let a=new Uint8Array(i),h=a.indexOf(ye.RecordSeparatorCode);if(h===-1)throw new Error("Message is incomplete.");let g=h+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,g))),t=a.byteLength>g?a.slice(g).buffer:null}else{let a=i,h=a.indexOf(ye.RecordSeparator);if(h===-1)throw new Error("Message is incomplete.");let g=h+1;e=a.substring(0,g),t=a.length>g?a.substring(g):null}let o=ye.parse(e),r=JSON.parse(o[0]);if(r.type)throw new Error("Expected a handshake response from the server.");return[t,r]}};var O=(function(n){return n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence",n})(O||{});var Bo=class{constructor(){this.observers=[]}next(i){for(let e of this.observers)e.next(i)}error(i){for(let e of this.observers)e.error&&e.error(i)}complete(){for(let i of this.observers)i.complete&&i.complete()}subscribe(i){return this.observers.push(i),new Ro(this,i)}};var Ho=class{constructor(i,e,t){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=i,this._connection=e,this._bufferSize=t}async _send(i){let e=this._protocol.writeMessage(i),t=Promise.resolve();if(this._isInvocationMessage(i)){this._totalMessageCount++;let o=()=>{},r=()=>{};$e(e)?this._bufferedByteCount+=e.byteLength:this._bufferedByteCount+=e.length,this._bufferedByteCount>=this._bufferSize&&(t=new Promise((s,a)=>{o=s,r=a})),this._messages.push(new On(e,this._totalMessageCount,o,r))}try{this._reconnectInProgress||await this._connection.send(e)}catch{this._disconnected()}await t}_ack(i){let e=-1;for(let t=0;t<this._messages.length;t++){let o=this._messages[t];if(o._id<=i.sequenceId)e=t,$e(o._message)?this._bufferedByteCount-=o._message.byteLength:this._bufferedByteCount-=o._message.length,o._resolver();else if(this._bufferedByteCount<this._bufferSize)o._resolver();else break}e!==-1&&(this._messages=this._messages.slice(e+1))}_shouldProcessMessage(i){if(this._waitForSequenceMessage)return i.type!==O.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(i))return!0;let e=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,e<=this._latestReceivedSequenceId?(e===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=e,this._ackTimer(),!0)}_resetSequence(i){if(i.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=i.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){let i=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:O.Sequence,sequenceId:i}));let e=this._messages;for(let t of e)await this._connection.send(t._message);this._reconnectInProgress=!1}_dispose(i){i??(i=new Error("Unable to reconnect to server."));for(let e of this._messages)e._rejector(i)}_isInvocationMessage(i){switch(i.type){case O.Invocation:case O.StreamItem:case O.Completion:case O.StreamInvocation:case O.CancelInvocation:return!0;case O.Close:case O.Sequence:case O.Ping:case O.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:O.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}},On=class{constructor(i,e,t,o){this._message=i,this._id=e,this._resolver=t,this._rejector=o}};var Ql=30*1e3,Yl=15*1e3,Jl=1e5,Y=(function(n){return n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting",n})(Y||{}),zo=class n{static create(i,e,t,o,r,s,a){return new n(i,e,t,o,r,s,a)}constructor(i,e,t,o,r,s,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(u.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},z.isRequired(i,"connection"),z.isRequired(e,"logger"),z.isRequired(t,"protocol"),this.serverTimeoutInMilliseconds=r??Ql,this.keepAliveIntervalInMilliseconds=s??Yl,this._statefulReconnectBufferSize=a??Jl,this._logger=e,this._protocol=t,this.connection=i,this._reconnectPolicy=o,this._handshakeProtocol=new jo,this.connection.onreceive=h=>this._processIncomingData(h),this.connection.onclose=h=>this._connectionClosed(h),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:O.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(i){if(this._connectionState!==Y.Disconnected&&this._connectionState!==Y.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!i)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=i}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Y.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Y.Connecting,this._logger.log(u.Debug,"Starting HubConnection.");try{await this._startInternal(),$.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Y.Connected,this._connectionStarted=!0,this._logger.log(u.Debug,"HubConnection connected successfully.")}catch(i){return this._connectionState=Y.Disconnected,this._logger.log(u.Debug,`HubConnection failed to start successfully because of error '${i}'.`),Promise.reject(i)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let i=new Promise((e,t)=>{this._handshakeResolver=e,this._handshakeRejecter=t});await this.connection.start(this._protocol.transferFormat);try{let e=this._protocol.version;this.connection.features.reconnect||(e=1);let t={protocol:this._protocol.name,version:e};if(this._logger.log(u.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(u.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await i,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new Ho(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(u.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){let i=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await i}catch{}}_stopInternal(i){if(this._connectionState===Y.Disconnected)return this._logger.log(u.Debug,`Call to HubConnection.stop(${i}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Y.Disconnecting)return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let e=this._connectionState;return this._connectionState=Y.Disconnecting,this._logger.log(u.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(u.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(e===Y.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=i||new ce("The connection was stopped before the hub handshake could complete."),this.connection.stop(i))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(i,...e){let[t,o]=this._replaceStreamingParams(e),r=this._createStreamInvocation(i,e,o),s,a=new Bo;return a.cancelCallback=()=>{let h=this._createCancelInvocation(r.invocationId);return delete this._callbacks[r.invocationId],s.then(()=>this._sendWithProtocol(h))},this._callbacks[r.invocationId]=(h,g)=>{if(g){a.error(g);return}else h&&(h.type===O.Completion?h.error?a.error(new Error(h.error)):a.complete():a.next(h.item))},s=this._sendWithProtocol(r).catch(h=>{a.error(h),delete this._callbacks[r.invocationId]}),this._launchStreams(t,s),a}_sendMessage(i){return this._resetKeepAliveInterval(),this.connection.send(i)}_sendWithProtocol(i){return this._messageBuffer?this._messageBuffer._send(i):this._sendMessage(this._protocol.writeMessage(i))}send(i,...e){let[t,o]=this._replaceStreamingParams(e),r=this._sendWithProtocol(this._createInvocation(i,e,!0,o));return this._launchStreams(t,r),r}invoke(i,...e){let[t,o]=this._replaceStreamingParams(e),r=this._createInvocation(i,e,!1,o);return new Promise((a,h)=>{this._callbacks[r.invocationId]=(b,U)=>{if(U){h(U);return}else b&&(b.type===O.Completion?b.error?h(new Error(b.error)):a(b.result):h(new Error(`Unexpected message type: ${b.type}`)))};let g=this._sendWithProtocol(r).catch(b=>{h(b),delete this._callbacks[r.invocationId]});this._launchStreams(t,g)})}on(i,e){!i||!e||(i=i.toLowerCase(),this._methods[i]||(this._methods[i]=[]),this._methods[i].indexOf(e)===-1&&this._methods[i].push(e))}off(i,e){if(!i)return;i=i.toLowerCase();let t=this._methods[i];if(t)if(e){let o=t.indexOf(e);o!==-1&&(t.splice(o,1),t.length===0&&delete this._methods[i])}else delete this._methods[i]}onclose(i){i&&this._closedCallbacks.push(i)}onreconnecting(i){i&&this._reconnectingCallbacks.push(i)}onreconnected(i){i&&this._reconnectedCallbacks.push(i)}_processIncomingData(i){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(i=this._processHandshakeResponse(i),this._receivedHandshakeResponse=!0),i){let e=this._protocol.parseMessages(i,this._logger);for(let t of e)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(t)))switch(t.type){case O.Invocation:this._invokeClientMethod(t).catch(o=>{this._logger.log(u.Error,`Invoke client method threw error: ${Lo(o)}`)});break;case O.StreamItem:case O.Completion:{let o=this._callbacks[t.invocationId];if(o){t.type===O.Completion&&delete this._callbacks[t.invocationId];try{o(t)}catch(r){this._logger.log(u.Error,`Stream callback threw error: ${Lo(r)}`)}}break}case O.Ping:break;case O.Close:{this._logger.log(u.Information,"Close message received from server.");let o=t.error?new Error("Server returned an error on close: "+t.error):void 0;t.allowReconnect===!0?this.connection.stop(o):this._stopPromise=this._stopInternal(o);break}case O.Ack:this._messageBuffer&&this._messageBuffer._ack(t);break;case O.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(t);break;default:this._logger.log(u.Warning,`Invalid message type: ${t.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(i){let e,t;try{[t,e]=this._handshakeProtocol.parseHandshakeResponse(i)}catch(o){let r="Error parsing handshake response: "+o;this._logger.log(u.Error,r);let s=new Error(r);throw this._handshakeRejecter(s),s}if(e.error){let o="Server returned handshake error: "+e.error;this._logger.log(u.Error,o);let r=new Error(o);throw this._handshakeRejecter(r),r}else this._logger.log(u.Debug,"Server handshake complete.");return this._handshakeResolver(),t}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds);let i=this._nextKeepAlive-new Date().getTime();if(i<0){this._connectionState===Y.Connected&&this._trySendPingMessage();return}this._pingServerHandle===void 0&&(i<0&&(i=0),this._pingServerHandle=setTimeout(async()=>{this._connectionState===Y.Connected&&await this._trySendPingMessage()},i))}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(i){let e=i.target.toLowerCase(),t=this._methods[e];if(!t){this._logger.log(u.Warning,`No client method with the name '${e}' found.`),i.invocationId&&(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${i.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)));return}let o=t.slice(),r=!!i.invocationId,s,a,h;for(let g of o)try{let b=s;s=await g.apply(this,i.arguments),r&&s&&b&&(this._logger.log(u.Error,`Multiple results provided for '${e}'. Sending error to server.`),h=this._createCompletionMessage(i.invocationId,"Client provided multiple results.",null)),a=void 0}catch(b){a=b,this._logger.log(u.Error,`A callback for the method '${e}' threw error '${b}'.`)}h?await this._sendWithProtocol(h):r?(a?h=this._createCompletionMessage(i.invocationId,`${a}`,null):s!==void 0?h=this._createCompletionMessage(i.invocationId,null,s):(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${i.invocationId}'.`),h=this._createCompletionMessage(i.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(h)):s&&this._logger.log(u.Error,`Result given for '${e}' method but server is not expecting a result.`)}_connectionClosed(i){this._logger.log(u.Debug,`HubConnection.connectionClosed(${i}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||i||new ce("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(i||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Y.Disconnecting?this._completeClose(i):this._connectionState===Y.Connected&&this._reconnectPolicy?this._reconnect(i):this._connectionState===Y.Connected&&this._completeClose(i)}_completeClose(i){if(this._connectionStarted){this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(i??new Error("Connection closed.")),this._messageBuffer=void 0),$.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(e=>e.apply(this,[i]))}catch(e){this._logger.log(u.Error,`An onclose callback called with error '${i}' threw error '${e}'.`)}}}async _reconnect(i){let e=Date.now(),t=0,o=i!==void 0?i:new Error("Attempting to reconnect due to a unknown error."),r=this._getNextRetryDelay(t,0,o);if(r===null){this._logger.log(u.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(i);return}if(this._connectionState=Y.Reconnecting,i?this._logger.log(u.Information,`Connection reconnecting because of error '${i}'.`):this._logger.log(u.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[i]))}catch(s){this._logger.log(u.Error,`An onreconnecting callback called with error '${i}' threw error '${s}'.`)}if(this._connectionState!==Y.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;r!==null;){if(this._logger.log(u.Information,`Reconnect attempt number ${t+1} will start in ${r} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,r)}),this._reconnectDelayHandle=void 0,this._connectionState!==Y.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=Y.Connected,this._logger.log(u.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(u.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(u.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==Y.Reconnecting){this._logger.log(u.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===Y.Disconnecting&&this._completeClose();return}t++,o=s instanceof Error?s:new Error(s.toString()),r=this._getNextRetryDelay(t,Date.now()-e,o)}}this._logger.log(u.Information,`Reconnect retries have been exhausted after ${Date.now()-e} ms and ${t} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(i,e,t){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:i,retryReason:t})}catch(o){return this._logger.log(u.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${i}, ${e}) threw error '${o}'.`),null}}_cancelCallbacksWithError(i){let e=this._callbacks;this._callbacks={},Object.keys(e).forEach(t=>{let o=e[t];try{o(null,i)}catch(r){this._logger.log(u.Error,`Stream 'error' callback called with '${i}' threw error: ${Lo(r)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(i,e,t,o){if(t)return o.length!==0?{target:i,arguments:e,streamIds:o,type:O.Invocation}:{target:i,arguments:e,type:O.Invocation};{let r=this._invocationId;return this._invocationId++,o.length!==0?{target:i,arguments:e,invocationId:r.toString(),streamIds:o,type:O.Invocation}:{target:i,arguments:e,invocationId:r.toString(),type:O.Invocation}}}_launchStreams(i,e){if(i.length!==0){e||(e=Promise.resolve());for(let t in i)i[t].subscribe({complete:()=>{e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(t)))},error:o=>{let r;o instanceof Error?r=o.message:o&&o.toString?r=o.toString():r="Unknown error",e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(t,r)))},next:o=>{e=e.then(()=>this._sendWithProtocol(this._createStreamItemMessage(t,o)))}})}}_replaceStreamingParams(i){let e=[],t=[];for(let o=0;o<i.length;o++){let r=i[o];if(this._isObservable(r)){let s=this._invocationId;this._invocationId++,e[s]=r,t.push(s.toString()),i.splice(o,1)}}return[e,t]}_isObservable(i){return i&&i.subscribe&&typeof i.subscribe=="function"}_createStreamInvocation(i,e,t){let o=this._invocationId;return this._invocationId++,t.length!==0?{target:i,arguments:e,invocationId:o.toString(),streamIds:t,type:O.StreamInvocation}:{target:i,arguments:e,invocationId:o.toString(),type:O.StreamInvocation}}_createCancelInvocation(i){return{invocationId:i,type:O.CancelInvocation}}_createStreamItemMessage(i,e){return{invocationId:i,item:e,type:O.StreamItem}}_createCompletionMessage(i,e,t){return e?{error:e,invocationId:i,type:O.Completion}:{invocationId:i,result:t,type:O.Completion}}_createCloseMessage(){return{type:O.Close}}async _trySendPingMessage(){try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}};var ec=[0,2e3,1e4,3e4,null],Oi=class{constructor(i){this._retryDelays=i!==void 0?[...i,null]:ec}nextRetryDelayInMilliseconds(i){return this._retryDelays[i.previousRetryCount]}};var Lt=(()=>{class n{}return n.Authorization="Authorization",n.Cookie="Cookie",n})();var $o=class extends st{constructor(i,e){super(),this._innerClient=i,this._accessTokenFactory=e}async send(i){let e=!0;this._accessTokenFactory&&(!this._accessToken||i.url&&i.url.indexOf("/negotiate?")>0)&&(e=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(i);let t=await this._innerClient.send(i);return e&&t.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(i),await this._innerClient.send(i)):t}_setAuthorizationHeader(i){i.headers||(i.headers={}),this._accessToken?i.headers[Lt.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&i.headers[Lt.Authorization]&&delete i.headers[Lt.Authorization]}getCookieString(i){return this._innerClient.getCookieString(i)}};var ie=(function(n){return n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling",n})(ie||{}),ne=(function(n){return n[n.Text=1]="Text",n[n.Binary=2]="Binary",n})(ne||{});var Uo=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var Ti=class{get pollAborted(){return this._pollAbort.aborted}constructor(i,e,t){this._httpClient=i,this._logger=e,this._pollAbort=new Uo,this._options=t,this._running=!1,this.onreceive=null,this.onclose=null}async connect(i,e){if(z.isRequired(i,"url"),z.isRequired(e,"transferFormat"),z.isIn(e,ne,"transferFormat"),this._url=i,this._logger.log(u.Trace,"(LongPolling transport) Connecting."),e===ne.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[t,o]=lt(),r=E({[t]:o},this._options.headers),s={abortSignal:this._pollAbort.signal,headers:r,timeout:1e5,withCredentials:this._options.withCredentials};e===ne.Binary&&(s.responseType="arraybuffer");let a=`${i}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${a}.`);let h=await this._httpClient.get(a,s);h.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${h.statusCode}.`),this._closeError=new Ce(h.statusText||"",h.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(i,e){try{for(;this._running;)try{let t=`${i}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${t}.`);let o=await this._httpClient.get(t,e);o.statusCode===204?(this._logger.log(u.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):o.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${o.statusCode}.`),this._closeError=new Ce(o.statusText||"",o.statusCode),this._running=!1):o.content?(this._logger.log(u.Trace,`(LongPolling transport) data received. ${Mt(o.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(o.content)):this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(t){this._running?t instanceof xt?this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=t,this._running=!1):this._logger.log(u.Trace,`(LongPolling transport) Poll errored after shutdown: ${t.message}`)}}finally{this._logger.log(u.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(i){return this._running?Ao(this._logger,"LongPolling",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(u.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(u.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let i={},[e,t]=lt();i[e]=t;let o={headers:E(E({},i),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials},r;try{await this._httpClient.delete(this._url,o)}catch(s){r=s}r?r instanceof Ce&&(r.statusCode===404?this._logger.log(u.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(u.Trace,`(LongPolling transport) Error sending a DELETE request: ${r}`)):this._logger.log(u.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(u.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let i="(LongPolling transport) Firing onclose event.";this._closeError&&(i+=" Error: "+this._closeError),this._logger.log(u.Trace,i),this.onclose(this._closeError)}}};var Wo=class{constructor(i,e,t,o){this._httpClient=i,this._accessToken=e,this._logger=t,this._options=o,this.onreceive=null,this.onclose=null}async connect(i,e){return z.isRequired(i,"url"),z.isRequired(e,"transferFormat"),z.isIn(e,ne,"transferFormat"),this._logger.log(u.Trace,"(SSE transport) Connecting."),this._url=i,this._accessToken&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((t,o)=>{let r=!1;if(e!==ne.Text){o(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let s;if($.isBrowser||$.isWebWorker)s=new this._options.EventSource(i,{withCredentials:this._options.withCredentials});else{let a=this._httpClient.getCookieString(i),h={};h.Cookie=a;let[g,b]=lt();h[g]=b,s=new this._options.EventSource(i,{withCredentials:this._options.withCredentials,headers:E(E({},h),this._options.headers)})}try{s.onmessage=a=>{if(this.onreceive)try{this._logger.log(u.Trace,`(SSE transport) data received. ${Mt(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(h){this._close(h);return}},s.onerror=a=>{r?this._close():o(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},s.onopen=()=>{this._logger.log(u.Information,`SSE connected to ${this._url}`),this._eventSource=s,r=!0,t()}}catch(a){o(a);return}})}async send(i){return this._eventSource?Ao(this._logger,"SSE",this._httpClient,this._url,i,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(i){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(i))}};var qo=class{constructor(i,e,t,o,r,s){this._logger=t,this._accessTokenFactory=e,this._logMessageContent=o,this._webSocketConstructor=r,this._httpClient=i,this.onreceive=null,this.onclose=null,this._headers=s}async connect(i,e){z.isRequired(i,"url"),z.isRequired(e,"transferFormat"),z.isIn(e,ne,"transferFormat"),this._logger.log(u.Trace,"(WebSockets transport) Connecting.");let t;return this._accessTokenFactory&&(t=await this._accessTokenFactory()),new Promise((o,r)=>{i=i.replace(/^http/,"ws");let s,a=this._httpClient.getCookieString(i),h=!1;if($.isNode||$.isReactNative){let g={},[b,U]=lt();g[b]=U,t&&(g[Lt.Authorization]=`Bearer ${t}`),a&&(g[Lt.Cookie]=a),s=new this._webSocketConstructor(i,void 0,{headers:E(E({},g),this._headers)})}else t&&(i+=(i.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(t)}`);s||(s=new this._webSocketConstructor(i)),e===ne.Binary&&(s.binaryType="arraybuffer"),s.onopen=g=>{this._logger.log(u.Information,`WebSocket connected to ${i}.`),this._webSocket=s,h=!0,o()},s.onerror=g=>{let b=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?b=g.error:b="There was an error with the transport",this._logger.log(u.Information,`(WebSockets transport) ${b}.`)},s.onmessage=g=>{if(this._logger.log(u.Trace,`(WebSockets transport) data received. ${Mt(g.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(g.data)}catch(b){this._close(b);return}},s.onclose=g=>{if(h)this._close(g);else{let b=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?b=g.error:b="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(b))}}})}send(i){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(u.Trace,`(WebSockets transport) sending data. ${Mt(i,this._logMessageContent)}.`),this._webSocket.send(i),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(i){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(u.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(i)&&(i.wasClean===!1||i.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${i.code} (${i.reason||"no reason given"}).`)):i instanceof Error?this.onclose(i):this.onclose())}_isCloseEvent(i){return i&&typeof i.wasClean=="boolean"&&typeof i.code=="number"}};var Vs=100,Go=class{constructor(i,e={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,z.isRequired(i,"url"),this._logger=Ls(e.logger),this.baseUrl=this._resolveUrl(i),e=e||{},e.logMessageContent=e.logMessageContent===void 0?!1:e.logMessageContent,typeof e.withCredentials=="boolean"||e.withCredentials===void 0)e.withCredentials=e.withCredentials===void 0?!0:e.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.timeout=e.timeout===void 0?100*1e3:e.timeout;let t=null,o=null;if($.isNode&&typeof Ft<"u"){let r=typeof __webpack_require__=="function"?__non_webpack_require__:Ft;t=r("ws"),o=r("eventsource")}!$.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:$.isNode&&!e.WebSocket&&t&&(e.WebSocket=t),!$.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:$.isNode&&!e.EventSource&&typeof o<"u"&&(e.EventSource=o),this._httpClient=new $o(e.httpClient||new Vo(this._logger),e.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=e,this.onreceive=null,this.onclose=null}async start(i){if(i=i||ne.Binary,z.isIn(i,ne,"transferFormat"),this._logger.log(u.Debug,`Starting connection with transfer format '${ne[i]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(i),await this._startInternalPromise,this._connectionState==="Disconnecting"){let e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(u.Error,e),await this._stopPromise,Promise.reject(new ce(e))}else if(this._connectionState!=="Connected"){let e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(u.Error,e),Promise.reject(new ce(e))}this._connectionStarted=!0}send(i){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Tn(this.transport)),this._sendQueue.send(i))}async stop(i){if(this._connectionState==="Disconnected")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${i}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(e=>{this._stopPromiseResolver=e}),await this._stopInternal(i),await this._stopPromise}async _stopInternal(i){this._stopError=i;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(u.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(u.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(i){let e=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===ie.WebSockets)this.transport=this._constructTransport(ie.WebSockets),await this._startTransport(e,i);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let t=null,o=0;do{if(t=await this._getNegotiationResponse(e),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ce("The connection was stopped during negotiation.");if(t.error)throw new Error(t.error);if(t.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(t.url&&(e=t.url),t.accessToken){let r=t.accessToken;this._accessTokenFactory=()=>r,this._httpClient._accessToken=r,this._httpClient._accessTokenFactory=void 0}o++}while(t.url&&o<Vs);if(o===Vs&&t.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(e,this._options.transport,t,i)}this.transport instanceof Ti&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(u.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(t){return this._logger.log(u.Error,"Failed to start the connection: "+t),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(t)}}async _getNegotiationResponse(i){let e={},[t,o]=lt();e[t]=o;let r=this._resolveNegotiateUrl(i);this._logger.log(u.Debug,`Sending negotiation request: ${r}.`);try{let s=await this._httpClient.post(r,{content:"",headers:E(E({},e),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));let a=JSON.parse(s.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new Di("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(s){let a="Failed to complete negotiation with the server: "+s;return s instanceof Ce&&s.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(u.Error,a),Promise.reject(new Di(a))}}_createConnectUrl(i,e){return e?i+(i.indexOf("?")===-1?"?":"&")+`id=${e}`:i}async _createTransport(i,e,t,o){let r=this._createConnectUrl(i,t.connectionToken);if(this._isITransport(e)){this._logger.log(u.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,await this._startTransport(r,o),this.connectionId=t.connectionId;return}let s=[],a=t.availableTransports||[],h=t;for(let g of a){let b=this._resolveTransportOrError(g,e,o,h?.useStatefulReconnect===!0);if(b instanceof Error)s.push(`${g.transport} failed:`),s.push(b);else if(this._isITransport(b)){if(this.transport=b,!h){try{h=await this._getNegotiationResponse(i)}catch(U){return Promise.reject(U)}r=this._createConnectUrl(i,h.connectionToken)}try{await this._startTransport(r,o),this.connectionId=h.connectionId;return}catch(U){if(this._logger.log(u.Error,`Failed to start the transport '${g.transport}': ${U}`),h=void 0,s.push(new ko(`${g.transport} failed: ${U}`,ie[g.transport])),this._connectionState!=="Connecting"){let Se="Failed to select transport before stop() was called.";return this._logger.log(u.Debug,Se),Promise.reject(new ce(Se))}}}}return s.length>0?Promise.reject(new Io(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(i){switch(i){case ie.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new qo(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case ie.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Wo(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case ie.LongPolling:return new Ti(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${i}.`)}}_startTransport(i,e){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async t=>{let o=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(i,e),await this.features.resend()}catch{o=!0}else{this._stopConnection(t);return}o&&this._stopConnection(t)}:this.transport.onclose=t=>this._stopConnection(t),this.transport.connect(i,e)}_resolveTransportOrError(i,e,t,o){let r=ie[i.transport];if(r==null)return this._logger.log(u.Debug,`Skipping transport '${i.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${i.transport}' because it is not supported by this client.`);if(tc(e,r))if(i.transferFormats.map(a=>ne[a]).indexOf(t)>=0){if(r===ie.WebSockets&&!this._options.WebSocket||r===ie.ServerSentEvents&&!this._options.EventSource)return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it is not supported in your environment.'`),new Oo(`'${ie[r]}' is not supported in your environment.`,r);this._logger.log(u.Debug,`Selecting transport '${ie[r]}'.`);try{return this.features.reconnect=r===ie.WebSockets?o:void 0,this._constructTransport(r)}catch(a){return a}}else return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it does not support the requested transfer format '${ne[t]}'.`),new Error(`'${ie[r]}' does not support ${ne[t]}.`);else return this._logger.log(u.Debug,`Skipping transport '${ie[r]}' because it was disabled by the client.`),new To(`'${ie[r]}' is disabled by the client.`,r)}_isITransport(i){return i&&typeof i=="object"&&"connect"in i}_stopConnection(i){if(this._logger.log(u.Debug,`HttpConnection.stopConnection(${i}) called while in state ${this._connectionState}.`),this.transport=void 0,i=this._stopError||i,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(u.Debug,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(u.Warning,`Call to HttpConnection.stopConnection(${i}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${i}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),i?this._logger.log(u.Error,`Connection disconnected with error '${i}'.`):this._logger.log(u.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(u.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(i)}catch(e){this._logger.log(u.Error,`HttpConnection.onclose(${i}) threw error '${e}'.`)}}}_resolveUrl(i){if(i.lastIndexOf("https://",0)===0||i.lastIndexOf("http://",0)===0)return i;if(!$.isBrowser)throw new Error(`Cannot resolve '${i}'.`);let e=window.document.createElement("a");return e.href=i,this._logger.log(u.Information,`Normalizing '${i}' to '${e.href}'.`),e.href}_resolveNegotiateUrl(i){let e=new URL(i);e.pathname.endsWith("/")?e.pathname+="negotiate":e.pathname+="/negotiate";let t=new URLSearchParams(e.searchParams);return t.has("negotiateVersion")||t.append("negotiateVersion",this._negotiateVersion.toString()),t.has("useStatefulReconnect")?t.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&t.append("useStatefulReconnect","true"),e.search=t.toString(),e.toString()}};function tc(n,i){return!n||(i&n)!==0}var Tn=class n{constructor(i){this._transport=i,this._buffer=[],this._executing=!0,this._sendBufferedData=new hi,this._transportResult=new hi,this._sendLoopPromise=this._sendLoop()}send(i){return this._bufferData(i),this._transportResult||(this._transportResult=new hi),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(i){if(this._buffer.length&&typeof this._buffer[0]!=typeof i)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof i}`);this._buffer.push(i),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new hi;let i=this._transportResult;this._transportResult=void 0;let e=typeof this._buffer[0]=="string"?this._buffer.join(""):n._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(e),i.resolve()}catch(t){i.reject(t)}}}static _concatBuffers(i){let e=i.map(r=>r.byteLength).reduce((r,s)=>r+s),t=new Uint8Array(e),o=0;for(let r of i)t.set(new Uint8Array(r),o),o+=r.byteLength;return t.buffer}},hi=class{constructor(){this.promise=new Promise((i,e)=>[this._resolver,this._rejecter]=[i,e])}resolve(){this._resolver()}reject(i){this._rejecter(i)}};var ic="json",Ko=class{constructor(){this.name=ic,this.version=2,this.transferFormat=ne.Text}parseMessages(i,e){if(typeof i!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!i)return[];e===null&&(e=at.instance);let t=ye.parse(i),o=[];for(let r of t){let s=JSON.parse(r);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case O.Invocation:this._isInvocationMessage(s);break;case O.StreamItem:this._isStreamItemMessage(s);break;case O.Completion:this._isCompletionMessage(s);break;case O.Ping:break;case O.Close:break;case O.Ack:this._isAckMessage(s);break;case O.Sequence:this._isSequenceMessage(s);break;default:e.log(u.Information,"Unknown message type '"+s.type+"' ignored.");continue}o.push(s)}return o}writeMessage(i){return ye.write(JSON.stringify(i))}_isInvocationMessage(i){this._assertNotEmptyString(i.target,"Invalid payload for Invocation message."),i.invocationId!==void 0&&this._assertNotEmptyString(i.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(i){if(this._assertNotEmptyString(i.invocationId,"Invalid payload for StreamItem message."),i.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(i){if(i.result&&i.error)throw new Error("Invalid payload for Completion message.");!i.result&&i.error&&this._assertNotEmptyString(i.error,"Invalid payload for Completion message."),this._assertNotEmptyString(i.invocationId,"Invalid payload for Completion message.")}_isAckMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(i){if(typeof i.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(i,e){if(typeof i!="string"||i==="")throw new Error(e)}};var oc={trace:u.Trace,debug:u.Debug,info:u.Information,information:u.Information,warn:u.Warning,warning:u.Warning,error:u.Error,critical:u.Critical,none:u.None};function nc(n){let i=oc[n.toLowerCase()];if(typeof i<"u")return i;throw new Error(`Unknown log level: ${n}`)}var ki=class{configureLogging(i){if(z.isRequired(i,"logging"),rc(i))this.logger=i;else if(typeof i=="string"){let e=nc(i);this.logger=new At(e)}else this.logger=new At(i);return this}withUrl(i,e){return z.isRequired(i,"url"),z.isNotEmpty(i,"url"),this.url=i,typeof e=="object"?this.httpConnectionOptions=E(E({},this.httpConnectionOptions),e):this.httpConnectionOptions=ae(E({},this.httpConnectionOptions),{transport:e}),this}withHubProtocol(i){return z.isRequired(i,"protocol"),this.protocol=i,this}withAutomaticReconnect(i){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return i?Array.isArray(i)?this.reconnectPolicy=new Oi(i):this.reconnectPolicy=i:this.reconnectPolicy=new Oi,this}withServerTimeout(i){return z.isRequired(i,"milliseconds"),this._serverTimeoutInMilliseconds=i,this}withKeepAliveInterval(i){return z.isRequired(i,"milliseconds"),this._keepAliveIntervalInMilliseconds=i,this}withStatefulReconnect(i){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=i?.bufferSize,this}build(){let i=this.httpConnectionOptions||{};if(i.logger===void 0&&(i.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let e=new Go(this.url,i);return zo.create(e,this.logger||at.instance,this.protocol||new Ko,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};function rc(n){return n.log!==void 0}var js="https://localhost:7113",ac="https://localhost:7113/api";function Bs(){return`${ac}/Mosaic/PolygonTriangulationMesh`}var Zo=class n{constructor(){this.a=R.zero,this.b=R.zero,this.c=R.zero}getVertices(){return[this.a,this.b,this.c]}static restore(i){Object.setPrototypeOf(i,n.prototype),i.getVertices().forEach(e=>R.restore(e))}};var Xo=class{static restore(i){i.parts.forEach(e=>Ii.restore(e))}},Ii=class{static restore(i){i.triangles.forEach(e=>Zo.restore(e)),i.contour.forEach(e=>R.restore(e))}};var Hs=(()=>{class n{constructor(){this.sectionsMeshReceivedSub=new P,this.sectionsMeshReceived$=this.sectionsMeshReceivedSub.asObservable(),this.sectionGeneratedSub=new P,this.sectionGenerated$=this.sectionGeneratedSub.asObservable(),this.generationFinishedSub=new P,this.generationFinished$=this.generationFinishedSub.asObservable(),this.generationAbortedWithErrorSub=new P,this.generationAbortedWithError$=this.generationAbortedWithErrorSub.asObservable(),this.isClosed=!1,this.hubConnection=new ki().withUrl(`${js}/process-hub`,{skipNegotiation:!0,transport:ie.WebSockets}).build(),this.subscribeOnSectionGenerated(),this.subscribeOnFinishGeneration(),this.subscribeOnSectionsMeshReceived(),this.subscribeOnAbortGenerationInErrorCase()}subscribeOnSectionGenerated(){this.hubConnection.on("ReceiveMosaicSectionTiles",e=>this.sectionGeneratedSub.next(e))}subscribeOnFinishGeneration(){this.hubConnection.on("ReceiveFinishNotification",()=>this.generationFinishedSub.next())}subscribeOnAbortGenerationInErrorCase(){this.hubConnection.on("AbortGenerationInErrorCase",()=>this.generationAbortedWithErrorSub.next())}subscribeOnSectionsMeshReceived(){this.hubConnection.on("ReceiveMosaicSectorsMesh",e=>{e.forEach(t=>Xo.restore(t)),this.sectionsMeshReceivedSub.next(e)})}startLongRunningTask(e){return this.hubConnection.invoke("StartMosaicGeneration",e).catch(t=>{if(!this.isClosed)throw t})}initMosaicTriangulation(e){return this.hubConnection.invoke("InitMosaicTriangulation",e).catch(t=>{if(!this.isClosed)throw t})}startConnection(){return this.hubConnection.start()}stopConnection(){return this.isClosed=!0,this.hubConnection.stop()}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Qo=class{constructor(i){this.visualObjects=[],this.sections=[],this.tilesSub=new We([]),this.tiles$=this.tilesSub.asObservable(),this.areTilesVisible=!0,this.schema=i}addSection(i){this.sections.push(i),i.tiles.forEach(e=>e.tileObject.setVisibility(this.areTilesVisible)),this.tilesSub.next(this.sections.flatMap(e=>e.tiles))}setSectorMeshVisibility(i){for(let e of this.visualObjects)e.setVisibility(i)}setSectorVisualObjects(i){this.visualObjects.forEach(e=>e.removeObject()),this.visualObjects=i}setTilesVisibility(i){this.areTilesVisible=i;let e=this.tilesSub.value;e.length&&(e.forEach(t=>t.tileObject.setVisibility(this.areTilesVisible)),e[0].tileObject.parentCanvas.redraw())}};var Ri=(()=>{class n{constructor(){this.sectorsInfo=new Map,this.sectorsSub=new P,this.sectors$=this.sectorsSub.asObservable()}buildInitMosaicRequest(e,t,o){return{base64Image:e,mosaicWidth:t.width,sectorsGenerationParams:o.map(r=>({id:r.id,tileMargin:r.properties.tilesMargin,tileMinRadius:r.properties.minTileRadius,tileMaxRadius:r.properties.maxTileRadius,triangulationData:{polygonVertices:r.vertices,sectionMaxArea:r.properties.sectionMaxArea,sectionMinAngle:r.properties.sectionMinAngle},evaluationParams:r.properties.evaluationParams,populationParams:r.properties.populationParams}))}}initGeneratedSectorsData(e){for(let t of e)this.sectorsInfo.set(t.id,new Qo(t));this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}fillSectorsGenerationInfo(e){for(let t of e){let o=this.sectorsInfo.get(t.sectorId);o.countOfSections=t.parts.flatMap(r=>r.triangles).length}this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}addSectionTilesObjects(e,t){this.sectorsInfo.get(e).addSection({tiles:t})}getSectorById(e){return this.sectorsInfo.get(e)}getSectors(){return Array.from(this.sectorsInfo.values())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac})}}return n})();function lc(n,i){if(n&1&&(d(0,"div",10)(1,"span",11),m(2),p()()),n&2){let e=i.$implicit;l(2),w(" ",e.tileTransform.tileId," ")}}function cc(n,i){if(n&1&&(d(0,"app-scrollable-list",8),ft(1,lc,3,1,"ng-template",null,0,Gi),p()),n&2){M();let e=vi(11);y("items",e)}}function dc(n,i){n&1&&(d(0,"span",9),m(1),_(2,"translate"),p()),n&2&&(l(),f(v(2,1,"tool.generation.sectorList.noTiles")))}var zs=(()=>{class n{constructor(){this.sector=ee.required(),this.isOpen=D(!1),this.items$=j(()=>this.sector().tiles$),this.areTilesVisible=D(!0),this.translate=c(te)}toggleTilesList(){this.isOpen.update(e=>!e)}toggleTilesVisibility(){this.areTilesVisible.update(e=>!e),this.sector().setTilesVisibility(this.areTilesVisible())}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-sector-list-elem"]],inputs:{sector:[1,"sector"]},decls:15,vars:9,consts:[["element",""],[1,"parent-elem"],[1,"sector-actions"],["mat-icon-button","",1,"sector-action",3,"click"],[1,"visibility-icon","material-symbols-outlined"],["mat-icon-button","",1,"sector-action","toggle-action",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"],[3,"items"],[1,"empty"],[1,"tile"],[1,"label"]],template:function(t,o){if(t&1){let r=L();d(0,"div",1)(1,"span"),m(2),p(),d(3,"div",2)(4,"button",3),C("click",function(){return T(r),k(o.toggleTilesVisibility())}),d(5,"mat-icon",4),m(6),p()(),d(7,"button",5),C("click",function(){return T(r),k(o.toggleTilesList())}),d(8,"mat-icon",6),m(9," keyboard_arrow_up "),p()()()(),d(10,"app-expandable-panel",7),Wi(11),_(12,"async"),W(13,cc,3,1,"app-scrollable-list",8)(14,dc,3,3,"span",9),p()}if(t&2){l(2),f(o.sector().schema.name),l(4),w(" ",o.areTilesVisible()?"visibility":"visibility_off"," "),l(2),K("chevron--closed",!o.isOpen()),l(2),y("isOpen",o.isOpen()),l();let r=qi(v(12,6,o.items$()));l(2),q(r.length?13:14)}},dependencies:[ke,Te,A,Re,si,B,Po,Xi,G],styles:["[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .parent-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .visibility-icon[_ngcontent-%COMP%]{font-weight:300;color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]{margin:-6px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap;font-size:12px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{margin-top:6px}"],changeDetection:0})}}return n})();function hc(n,i){if(n&1&&x(0,"app-sector-list-elem",1),n&2){let e=i.$implicit;y("sector",e)}}var $s=(()=>{class n{constructor(){this.service=c(Ri)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-mosaic-hierarchy"]],decls:4,vars:2,consts:[[1,"sectors"],[3,"sector"]],template:function(t,o){t&1&&(d(0,"div",0),Ee(1,hc,1,1,"app-sector-list-elem",1,zt),_(3,"async"),p()),t&2&&(l(),De(v(3,0,o.service.sectors$)))},dependencies:[zs,Xi],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .sectors[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}"],changeDetection:0})}}return n})();function pc(n,i){if(n&1&&(Dt(0,"span",0),m(1),Ot(),Dt(2,"span",1),m(3),Ot()),n&2){M();let e=vi(0);l(),f(e.sector),l(2),w("",e.percent,"%")}}function mc(n,i){if(n&1&&(Dt(0,"span",0),m(1),Ot()),n&2){M();let e=vi(0);l(),f(e.message)}}var Us=(()=>{class n{constructor(){this.infoState=ee.required()}isProgressInfo(e){return e.type==="progress"}isInitInfo(e){return e.type==="init"}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-progress-info"]],inputs:{infoState:[1,"infoState"]},decls:3,vars:2,consts:[[1,"loading"],[1,"right"]],template:function(t,o){if(t&1&&(Wi(0),W(1,pc,4,2)(2,mc,2,1,"span",0)),t&2){let r=qi(o.infoState());l(),q(o.isProgressInfo(r)?1:o.isInitInfo(r)?2:-1)}},styles:['.loading[_ngcontent-%COMP%]:after{content:"";animation:_ngcontent-%COMP%_dots 2s linear infinite}@keyframes _ngcontent-%COMP%_dots{0%,20%{content:"."}40%{content:".."}60%{content:"..."}90%,to{content:""}}[_nghost-%COMP%]{display:flex;width:200px;height:auto;font-size:14px;border:1px solid;padding:12px;border-radius:4px;border-color:transparent;background:#ccc;opacity:.75;color:#141414;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .right[_ngcontent-%COMP%]{margin-left:auto}'],changeDetection:0})}}return n})();function uc(n,i){if(n&1&&x(0,"app-progress-info",0),n&2){let e=M();y("infoState",e.progressState())}}var Ws=(()=>{class n{constructor(){this.toolService=c(_e),this.isImageVisible=D(!1),this.isMeshVisible=D(!0),this.showMesh$=new We(!0),this.progressState=D(null),this.ribbonActions=[{iconName:"crop",visibility:D("on"),tooltipKey:"tool.ribbon.takeSnapshot",onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"generating_snapshot.png")},{iconName:"recenter",visibility:D("on"),tooltipKey:"tool.ribbon.focusOnImage",onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}},{iconName:"graph_3",tooltipKey:"tool.ribbon.toggleMeshVisibility",onClick:()=>this.toggleMeshVisibility(),visibility:j(()=>this.isMeshVisible()?"on":"off")},{iconName:"image",tooltipKey:"tool.ribbon.toggleImageVisibility",onClick:()=>this.toggleImageVisibility(),visibility:j(()=>this.isImageVisible()?"on":"off")}],this.store=c(F),this.translate=c(te),this.destroyRef=c(J),this.snackBar=c(Le),this.signalRService=c(Hs),this.service=c(Ri)}ngOnInit(){this.subscribeOnGenerationProgress(),this.subscribeOnSectorsMeshReceived(),this.subscribeOnMeshGenerationFinished(),this.subscribeOnMeshVisibilityChange(),this.destroyRef.onDestroy(()=>this.signalRService.stopConnection())}async onCanvasReady(e){let t=this.store.selectSignal(et)();this.imageObject=await _e.createImageObject(t),this.imageObject.setVisibility(this.isImageVisible()),this.activeCanvas.addCanvasObject(this.imageObject),e&&this.focusOnImage(),this.activeCanvas.redraw(),this.initSectors(),this.initGeneration(t.base64Image,this.imageObject.size)}initGeneration(e,t){this.signalRService.startConnection().then(()=>{let o=this.store.selectSignal(fe)(),r=this.service.buildInitMosaicRequest(e,t,o);this.availableTiles=this.getAvailableTiles(),this.progressState.set({type:"init",message:this.translate.instant("tool.generation.message.sectorsMeshGeneration")}),this.signalRService.initMosaicTriangulation(r).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnSectorsMeshGeneration")))}).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnServerConnection")))}subscribeOnGenerationProgress(){this.signalRService.sectionGenerated$.pipe(Z(this.destroyRef)).subscribe(e=>{let t=[];for(let r of e.tilesTransforms){let s=this.availableTiles.find(g=>g.id===r.tileId),a=So(s.vertices,r.position,r.angle),h=new ni(a,s.color);this.activeCanvas.addCanvasObject(h),t.push({tileObject:h,tileTransform:r})}let o=this.service.getSectorById(e.sectorId);this.service.addSectionTilesObjects(e.sectorId,t),this.progressState.set({type:"progress",sector:o.schema.name,percent:Math.floor(o.sections.length/o.countOfSections*100)}),this.activeCanvas.redraw()})}subscribeOnSectorsMeshReceived(){this.signalRService.sectionsMeshReceived$.pipe(Z(this.destroyRef)).subscribe(e=>{let t=this.store.selectSignal(fe)();this.createSectorsMeshCanvasObjects(e,t),this.service.fillSectorsGenerationInfo(e);let o=this.availableTiles.map(r=>({color:r.color,id:r.id,vertices:r.vertices}));this.signalRService.startLongRunningTask(o).catch(()=>this.showMessage(this.translate.instant("tool.generation.message.errorOnStartingMosaicGeneration")))})}subscribeOnMeshGenerationFinished(){this.signalRService.generationFinished$.pipe(Z(this.destroyRef)).subscribe(()=>{this.progressState.set(null),this.showMessage(this.translate.instant("tool.generation.message.generationCompleted"))})}subscribeOnMeshVisibilityChange(){this.showMesh$.pipe(Z(this.destroyRef)).subscribe(e=>{for(let t of this.service.getSectors())t.setSectorMeshVisibility(e);this.activeCanvas.redraw()})}createSectorsMeshCanvasObjects(e,t){for(let o=0;o<t.length;++o){let r=t[o],s=this.service.getSectorById(r.id),a=[];for(let h of e[o].parts){let g=this.createSectorMeshObject(r,h,o);this.activeCanvas.addCanvasObject(g),a.push(g)}s.setSectorVisualObjects(a)}this.activeCanvas.redraw()}initSectors(){let e=this.store.selectSignal(fe)();this.service.initGeneratedSectorsData(e),this.initSectorsMeshes(e)}initSectorsMeshes(e){for(let t=0;t<e.length;++t){let o=this.service.getSectorById(e[t].id),r=this.createSectorContourObject(e[t],t);this.activeCanvas.addCanvasObject(r),o.visualObjects.push(r)}this.activeCanvas.redraw()}createSectorMeshObject(e,t,o){return new li(t.triangles,t.contour,e.color,10+o)}createSectorContourObject(e,t){return new ci([...e.vertices],e.color,10+t)}getAvailableTiles(){return this.store.selectSignal(tt)().flatMap(t=>t.tiles)}toggleMeshVisibility(){let e=!this.isMeshVisible();this.showMesh$.next(e),this.isMeshVisible.set(e)}toggleImageVisibility(){let e=!this.isImageVisible();this.imageObject.setVisibility(e),this.activeCanvas.redraw(),this.isImageVisible.set(e)}setError(e){this.progressState.set(null),this.showMessage(e)}showMessage(e){this.snackBar.open(e,this.translate.instant("common.ok"),{duration:3e3})}sectionEntered(e,t){return this.activeCanvas=e,this.onCanvasReady(t),{ribbon:this.ribbonActions}}focusOnImage(){let e=_e.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-mosaic-generation"]],features:[de([Ri])],decls:2,vars:1,consts:[[1,"info",3,"infoState"]],template:function(t,o){t&1&&(x(0,"app-mosaic-hierarchy"),W(1,uc,1,1,"app-progress-info",0)),t&2&&(l(),q(o.progressState()?1:-1))},dependencies:[$s,Us],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{position:absolute;left:-250px;bottom:30px}"],changeDetection:0})}}return n})();var qs=()=>c(F).selectSignal(fe)().length?!0:(c(X).navigate([wo]),!1);function Rn(n){let i=n.cloneNode(!0),e=i.querySelectorAll("[id]"),t=n.nodeName.toLowerCase();i.removeAttribute("id");for(let o=0;o<e.length;o++)e[o].removeAttribute("id");return t==="canvas"?Zs(n,i):(t==="input"||t==="select"||t==="textarea")&&Ks(n,i),Gs("canvas",n,i,Zs),Gs("input, textarea, select",n,i,Ks),i}function Gs(n,i,e,t){let o=i.querySelectorAll(n);if(o.length){let r=e.querySelectorAll(n);for(let s=0;s<o.length;s++)t(o[s],r[s])}}var gc=0;function Ks(n,i){i.type!=="file"&&(i.value=n.value),i.type==="radio"&&i.name&&(i.name=`mat-clone-${i.name}-${gc++}`)}function Zs(n,i){let e=i.getContext("2d");if(e)try{e.drawImage(n,0,0)}catch{}}function jn(n){let i=n.getBoundingClientRect();return{top:i.top,right:i.right,bottom:i.bottom,left:i.left,width:i.width,height:i.height,x:i.x,y:i.y}}function An(n,i,e){let{top:t,bottom:o,left:r,right:s}=n;return e>=t&&e<=o&&i>=r&&i<=s}function fc(n,i){let e=i.left<n.left,t=i.left+i.width>n.right,o=i.top<n.top,r=i.top+i.height>n.bottom;return e||t||o||r}function Fi(n,i,e){n.top+=i,n.bottom=n.top+n.height,n.left+=e,n.right=n.left+n.width}function Xs(n,i,e,t){let{top:o,right:r,bottom:s,left:a,width:h,height:g}=n,b=h*i,U=g*i;return t>o-U&&t<s+U&&e>a-b&&e<r+b}var Yo=class{_document;positions=new Map;constructor(i){this._document=i}clear(){this.positions.clear()}cache(i){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),i.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:jn(e)})})}handleScroll(i){let e=Tt(i),t=this.positions.get(e);if(!t)return null;let o=t.scrollPosition,r,s;if(e===this._document){let g=this.getViewportScrollPosition();r=g.top,s=g.left}else r=e.scrollTop,s=e.scrollLeft;let a=o.top-r,h=o.left-s;return this.positions.forEach((g,b)=>{g.clientRect&&e!==b&&e.contains(b)&&Fi(g.clientRect,a,h)}),o.top=r,o.left=s,{top:a,left:h}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function ca(n,i){let e=n.rootNodes;if(e.length===1&&e[0].nodeType===i.ELEMENT_NODE)return e[0];let t=i.createElement("div");return e.forEach(o=>t.appendChild(o)),t}function Bn(n,i,e){for(let t in i)if(i.hasOwnProperty(t)){let o=i[t];o?n.setProperty(t,o,e?.has(t)?"important":""):n.removeProperty(t)}return n}function pi(n,i){let e=i?"":"none";Bn(n.style,{"touch-action":i?"":"none","-webkit-user-drag":i?"":"none","-webkit-tap-highlight-color":i?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Qs(n,i,e){Bn(n.style,{position:i?"":"fixed",top:i?"":"0",opacity:i?"":"0",left:i?"":"-999em"},e)}function Jo(n,i){return i&&i!="none"?n+" "+i:n}function Ys(n,i){n.style.width=`${i.width}px`,n.style.height=`${i.height}px`,n.style.transform=Ni(i.left,i.top)}function Ni(n,i){return`translate3d(${Math.round(n)}px, ${Math.round(i)}px, 0)`}function Js(n){let i=n.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(n)*i}function _c(n){let i=getComputedStyle(n),e=kn(i,"transition-property"),t=e.find(a=>a==="transform"||a==="all");if(!t)return 0;let o=e.indexOf(t),r=kn(i,"transition-duration"),s=kn(i,"transition-delay");return Js(r[o])+Js(s[o])}function kn(n,i){return n.getPropertyValue(i).split(",").map(t=>t.trim())}var vc=new Set(["position"]),Ln=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(i,e,t,o,r,s,a,h,g,b){this._document=i,this._rootElement=e,this._direction=t,this._initialDomRect=o,this._previewTemplate=r,this._previewClass=s,this._pickupPositionOnPage=a,this._initialTransform=h,this._zIndex=g,this._renderer=b}attach(i){this._preview=this._createPreview(),i.appendChild(this._preview),ea(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(i){this._preview.style.transform=i}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(i){this._preview.classList.add(i)}getTransitionDuration(){return _c(this._preview)}addEventListener(i,e){return this._renderer.listen(this._preview,i,e)}_createPreview(){let i=this._previewTemplate,e=this._previewClass,t=i?i.template:null,o;if(t&&i){let r=i.matchSize?this._initialDomRect:null,s=i.viewContainer.createEmbeddedView(t,i.context);s.detectChanges(),o=ca(s,this._document),this._previewEmbeddedView=s,i.matchSize?Ys(o,r):o.style.transform=Ni(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else o=Rn(this._rootElement),Ys(o,this._initialDomRect),this._initialTransform&&(o.style.transform=this._initialTransform);return Bn(o.style,{"pointer-events":"none",margin:ea(o)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},vc),pi(o,!1),o.classList.add("cdk-drag-preview"),o.setAttribute("popover","manual"),o.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>o.classList.add(r)):o.classList.add(e)),o}};function ea(n){return"showPopover"in n}var bc={passive:!0},ta={passive:!1},Cc={passive:!1,capture:!0},yc=800,ia="cdk-drag-placeholder",oa=new Set(["position"]),Fn=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=D(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new P;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=Ue.EMPTY;_pointerUpSubscription=Ue.EMPTY;_scrollSubscription=Ue.EMPTY;_resizeSubscription=Ue.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(i){i!==this._disabled&&(this._disabled=i,this._toggleNativeDragInteractions(),this._handles.forEach(e=>pi(e,i)))}_disabled=!1;beforeStarted=new P;started=new P;released=new P;ended=new P;entered=new P;exited=new P;dropped=new P;moved=this._moveEvents;data;constrainPosition;constructor(i,e,t,o,r,s,a){this._config=e,this._document=t,this._ngZone=o,this._viewportRuler=r,this._dragDropRegistry=s,this._renderer=a,this.withRootElement(i).withParent(e.parentDragRef||null),this._parentPositions=new Yo(t),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(i){this._handles=i.map(t=>Ie(t)),this._handles.forEach(t=>pi(t,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&e.add(t)}),this._disabledHandles=e,this}withPreviewTemplate(i){return this._previewTemplate=i,this}withPlaceholderTemplate(i){return this._placeholderTemplate=i,this}withRootElement(i){let e=Ie(i);if(e!==this._rootElement){this._removeRootElementListeners();let t=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[t.listen(e,"mousedown",this._pointerDown,ta),t.listen(e,"touchstart",this._pointerDown,bc),t.listen(e,"dragstart",this._nativeDragStart,ta)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(i){return this._boundaryElement=i?Ie(i):null,this._resizeSubscription.unsubscribe(),i&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(i){return this._parentDragRef=i,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&fc(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let i=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),t=0,o=0;e.left<i.left?t=i.left-e.left:e.right>i.right&&(t=i.right-e.right),e.top<i.top?o=i.top-e.top:e.bottom>i.bottom&&(o=i.bottom-e.bottom);let r=this._activeTransform.x,s=this._activeTransform.y,a=r+t,h=s+o;this._rootElement.style.transform=Ni(a,h),this._activeTransform={x:a,y:h},this._passiveTransform={x:a,y:h}}}disableHandle(i){!this._disabledHandles.has(i)&&this._handles.indexOf(i)>-1&&(this._disabledHandles.add(i),pi(i,!0))}enableHandle(i){this._disabledHandles.has(i)&&(this._disabledHandles.delete(i),pi(i,this.disabled))}withDirection(i){return this._direction=i,this}_withDropContainer(i){this._dropContainer=i}getFreeDragPosition(){let i=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:i.x,y:i.y}}setFreeDragPosition(i){return this._activeTransform={x:0,y:0},this._passiveTransform.x=i.x,this._passiveTransform.y=i.y,this._dropContainer||this._applyRootElementTransform(i.x,i.y),this}withPreviewContainer(i){return this._previewContainer=i,this}_sortFromLastPointerPosition(){let i=this._lastKnownPointerPosition;i&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(i),i)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=i=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,i)}else this.disabled||this._initializeDragSequence(this._rootElement,i)};_pointerMove=i=>{let e=this._getPointerPositionOnPage(i);if(!this._hasStartedDragging()){let o=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(o+r>=this._config.dragStartThreshold){let a=Date.now()>=this._dragStartTime+this._getDragStartDelay(i),h=this._dropContainer;if(!a){this._endDragSequence(i);return}(!h||!h.isDragging()&&!h.isReceiving())&&(i.cancelable&&i.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(i)))}return}i.cancelable&&i.preventDefault();let t=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(t),this._dropContainer)this._updateActiveDropContainer(t,e);else{let o=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=t.x-o.x+this._passiveTransform.x,r.y=t.y-o.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:t,event:i,distance:this._getDragDistance(t),delta:this._pointerDirectionDelta})})};_pointerUp=i=>{this._endDragSequence(i)};_endDragSequence(i){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:i}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(i),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(i);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:i})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(i){Ai(i)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),t=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",Sc,Cc)}),t){let o=this._rootElement,r=o.parentNode,s=this._placeholder=this._createPlaceholderElement(),a=this._marker=this._marker||this._document.createComment("");r.insertBefore(a,o),this._initialTransform=o.style.transform||"",this._preview=new Ln(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),Qs(o,!1,oa),this._document.body.appendChild(r.replaceChild(s,o)),this.started.next({source:this,event:i}),t.start(),this._initialContainer=t,this._initialIndex=t.getItemIndex(this)}else this.started.next({source:this,event:i}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(t?t.getScrollableParents():[])}_initializeDragSequence(i,e){this._parentDragRef&&e.stopPropagation();let t=this.isDragging(),o=Ai(e),r=!o&&e.button!==0,s=this._rootElement,a=Tt(e),h=!o&&this._lastTouchEventTime&&this._lastTouchEventTime+yc>Date.now(),g=o?_r(e):fr(e);if(a&&a.draggable&&e.type==="mousedown"&&e.preventDefault(),t||r||h||g)return;if(this._handles.length){let Se=s.style;this._rootElementTapHighlight=Se.webkitTapHighlightColor||"",Se.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(Se=>this._updateOnScroll(Se)),this._boundaryElement&&(this._boundaryRect=jn(this._boundaryElement));let b=this._previewTemplate;this._pickupPositionInElement=b&&b.template&&!b.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,i,e);let U=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:U.x,y:U.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(i){Qs(this._rootElement,!0,oa),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,t=e.getItemIndex(this),o=this._getPointerPositionOnPage(i),r=this._getDragDistance(o),s=e._isOverContainer(o.x,o.y);this.ended.next({source:this,distance:r,dropPoint:o,event:i}),this.dropped.next({item:this,currentIndex:t,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:r,dropPoint:o,event:i}),e.drop(this,t,this._initialIndex,this._initialContainer,s,r,o,i),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:i,y:e},{x:t,y:o}){let r=this._initialContainer._getSiblingContainerFromPosition(this,i,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(i,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{let s=this._dropContainer.getItemIndex(this),a=this._dropContainer.getItemAtIndex(s+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(r,this._dropContainer,a),this._dropContainer=r,this._dropContainer.enter(this,i,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(t,o),this._dropContainer._sortItem(this,i,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(i,e):this._applyPreviewTransform(i-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let i=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(i.left,i.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{let o=a=>{(!a||this._preview&&Tt(a)===this._preview.element&&a.propertyName==="transform")&&(s(),t(),clearTimeout(r))},r=setTimeout(o,e*1.5),s=this._preview.addEventListener("transitionend",o)}))}_createPlaceholderElement(){let i=this._placeholderTemplate,e=i?i.template:null,t;return e?(this._placeholderRef=i.viewContainer.createEmbeddedView(e,i.context),this._placeholderRef.detectChanges(),t=ca(this._placeholderRef,this._document)):t=Rn(this._rootElement),t.style.pointerEvents="none",t.classList.add(ia),t}_getPointerPositionInElement(i,e,t){let o=e===this._rootElement?null:e,r=o?o.getBoundingClientRect():i,s=Ai(t)?t.targetTouches[0]:t,a=this._getViewportScrollPosition(),h=s.pageX-r.left-a.left,g=s.pageY-r.top-a.top;return{x:r.left-i.left+h,y:r.top-i.top+g}}_getPointerPositionOnPage(i){let e=this._getViewportScrollPosition(),t=Ai(i)?i.touches[0]||i.changedTouches[0]||{pageX:0,pageY:0}:i,o=t.pageX-e.left,r=t.pageY-e.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let a=this._ownerSVGElement.createSVGPoint();return a.x=o,a.y=r,a.matrixTransform(s.inverse())}}return{x:o,y:r}}_getConstrainedPointerPosition(i){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:t,y:o}=this.constrainPosition?this.constrainPosition(i,this,this._initialDomRect,this._pickupPositionInElement):i;if(this.lockAxis==="x"||e==="x"?o=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(t=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,a=this._boundaryRect,{width:h,height:g}=this._getPreviewRect(),b=a.top+s,U=a.bottom-(g-s),Se=a.left+r,sn=a.right-(h-r);t=na(t,Se,sn),o=na(o,b,U)}return{x:t,y:o}}_updatePointerDirectionDelta(i){let{x:e,y:t}=i,o=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-r.x),a=Math.abs(t-r.y);return s>this._config.pointerDirectionChangeThreshold&&(o.x=e>r.x?1:-1,r.x=e),a>this._config.pointerDirectionChangeThreshold&&(o.y=t>r.y?1:-1,r.y=t),o}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let i=this._handles.length>0||!this.isDragging();i!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=i,pi(this._rootElement,i))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(i=>i()),this._rootElementCleanups=void 0}_applyRootElementTransform(i,e){let t=1/this.scale,o=Ni(i*t,e*t),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=Jo(o,this._initialTransform)}_applyPreviewTransform(i,e){let t=this._previewTemplate?.template?void 0:this._initialTransform,o=Ni(i,e);this._preview.setTransform(Jo(o,t))}_getDragDistance(i){let e=this._pickupPositionOnPage;return e?{x:i.x-e.x,y:i.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:i,y:e}=this._passiveTransform;if(i===0&&e===0||this.isDragging()||!this._boundaryElement)return;let t=this._rootElement.getBoundingClientRect(),o=this._boundaryElement.getBoundingClientRect();if(o.width===0&&o.height===0||t.width===0&&t.height===0)return;let r=o.left-t.left,s=t.right-o.right,a=o.top-t.top,h=t.bottom-o.bottom;o.width>t.width?(r>0&&(i+=r),s>0&&(i-=s)):i=0,o.height>t.height?(a>0&&(e+=a),h>0&&(e-=h)):e=0,(i!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:i})}_getDragStartDelay(i){let e=this.dragStartDelay;return typeof e=="number"?e:Ai(i)?e.touch:e?e.mouse:0}_updateOnScroll(i){let e=this._parentPositions.handleScroll(i);if(e){let t=Tt(i);this._boundaryRect&&t!==this._boundaryElement&&t.contains(this._boundaryElement)&&Fi(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=Qi(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(i,e){let t=this._previewContainer||"global";if(t==="parent")return i;if(t==="global"){let o=this._document;return e||o.fullscreenElement||o.webkitFullscreenElement||o.mozFullScreenElement||o.msFullscreenElement||o.body}return Ie(t)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=i=>{if(this._handles.length){let e=this._getTargetHandle(i);e&&!this._disabledHandles.has(e)&&!this.disabled&&i.preventDefault()}else this.disabled||i.preventDefault()};_getTargetHandle(i){return this._handles.find(e=>i.target&&(i.target===e||e.contains(i.target)))}_conditionallyInsertAnchor(i,e,t){if(i===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let o=this._anchor??=Rn(this._placeholder);o.classList.remove(ia),o.classList.add("cdk-drag-anchor"),o.style.transform="",t?t.before(o):Ie(e.element).appendChild(o)}}};function na(n,i,e){return Math.max(i,Math.min(e,n))}function Ai(n){return n.type[0]==="t"}function Sc(n){n.preventDefault()}function tn(n,i,e){let t=ra(i,n.length-1),o=ra(e,n.length-1);if(t===o)return;let r=n[t],s=o<t?-1:1;for(let a=t;a!==o;a+=s)n[a]=n[a+s];n[o]=r}function ra(n,i){return Math.max(0,Math.min(i,n))}var en=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(i){this._dragDropRegistry=i}_previousSwap={drag:null,delta:0,overlaps:!1};start(i){this.withItems(i)}sort(i,e,t,o){let r=this._itemPositions,s=this._getItemIndexFromPointerPosition(i,e,t,o);if(s===-1&&r.length>0)return null;let a=this.orientation==="horizontal",h=r.findIndex(we=>we.drag===i),g=r[s],b=r[h].clientRect,U=g.clientRect,Se=h>s?1:-1,sn=this._getItemOffsetPx(b,U,Se),wa=this._getSiblingOffsetPx(h,r,Se),xa=r.slice();return tn(r,h,s),r.forEach((we,Ma)=>{if(xa[Ma]===we)return;let zn=we.drag===i,an=zn?sn:wa,$n=zn?i.getPlaceholderElement():we.drag.getRootElement();we.offset+=an;let Un=Math.round(we.offset*(1/we.drag.scale));a?($n.style.transform=Jo(`translate3d(${Un}px, 0, 0)`,we.initialTransform),Fi(we.clientRect,0,an)):($n.style.transform=Jo(`translate3d(0, ${Un}px, 0)`,we.initialTransform),Fi(we.clientRect,an,0))}),this._previousSwap.overlaps=An(U,e,t),this._previousSwap.drag=g.drag,this._previousSwap.delta=a?o.x:o.y,{previousIndex:h,currentIndex:s}}enter(i,e,t,o){let r=o==null||o<0?this._getItemIndexFromPointerPosition(i,e,t):o,s=this._activeDraggables,a=s.indexOf(i),h=i.getPlaceholderElement(),g=s[r];if(g===i&&(g=s[r+1]),!g&&(r==null||r===-1||r<s.length-1)&&this._shouldEnterAsFirstChild(e,t)&&(g=s[0]),a>-1&&s.splice(a,1),g&&!this._dragDropRegistry.isDragging(g)){let b=g.getRootElement();b.parentElement.insertBefore(h,b),s.splice(r,0,i)}else this._element.appendChild(h),s.push(i);h.style.transform="",this._cacheItemPositions()}withItems(i){this._activeDraggables=i.slice(),this._cacheItemPositions()}withSortPredicate(i){this._sortPredicate=i}reset(){this._activeDraggables?.forEach(i=>{let e=i.getRootElement();if(e){let t=this._itemPositions.find(o=>o.drag===i)?.initialTransform;e.style.transform=t||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(i){return this._getVisualItemPositions().findIndex(e=>e.drag===i)}getItemAtIndex(i){return this._getVisualItemPositions()[i]?.drag||null}updateOnScroll(i,e){this._itemPositions.forEach(({clientRect:t})=>{Fi(t,i,e)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(i){this._element=i}_cacheItemPositions(){let i=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let t=e.getVisibleElement();return{drag:e,offset:0,initialTransform:t.style.transform||"",clientRect:jn(t)}}).sort((e,t)=>i?e.clientRect.left-t.clientRect.left:e.clientRect.top-t.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(i,e,t){let o=this.orientation==="horizontal",r=o?e.left-i.left:e.top-i.top;return t===-1&&(r+=o?e.width-i.width:e.height-i.height),r}_getSiblingOffsetPx(i,e,t){let o=this.orientation==="horizontal",r=e[i].clientRect,s=e[i+t*-1],a=r[o?"width":"height"]*t;if(s){let h=o?"left":"top",g=o?"right":"bottom";t===-1?a-=s.clientRect[h]-r[g]:a+=r[h]-s.clientRect[g]}return a}_shouldEnterAsFirstChild(i,e){if(!this._activeDraggables.length)return!1;let t=this._itemPositions,o=this.orientation==="horizontal";if(t[0].drag!==this._activeDraggables[0]){let s=t[t.length-1].clientRect;return o?i>=s.right:e>=s.bottom}else{let s=t[0].clientRect;return o?i<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(i,e,t,o){let r=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:a,clientRect:h})=>{if(a===i)return!1;if(o){let g=r?o.x:o.y;if(a===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return r?e>=Math.floor(h.left)&&e<Math.floor(h.right):t>=Math.floor(h.top)&&t<Math.floor(h.bottom)});return s===-1||!this._sortPredicate(s,i)?-1:s}},Nn=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(i,e){this._document=i,this._dragDropRegistry=e}start(i){let e=this._element.childNodes;this._relatedNodes=[];for(let t=0;t<e.length;t++){let o=e[t];this._relatedNodes.push([o,o.nextSibling])}this.withItems(i)}sort(i,e,t,o){let r=this._getItemIndexFromPointerPosition(i,e,t),s=this._previousSwap;if(r===-1||this._activeItems[r]===i)return null;let a=this._activeItems[r];if(s.drag===a&&s.overlaps&&s.deltaX===o.x&&s.deltaY===o.y)return null;let h=this.getItemIndex(i),g=i.getPlaceholderElement(),b=a.getRootElement();r>h?b.after(g):b.before(g),tn(this._activeItems,h,r);let U=this._getRootNode().elementFromPoint(e,t);return s.deltaX=o.x,s.deltaY=o.y,s.drag=a,s.overlaps=b===U||b.contains(U),{previousIndex:h,currentIndex:r}}enter(i,e,t,o){let r=this._activeItems.indexOf(i);r>-1&&this._activeItems.splice(r,1);let s=o==null||o<0?this._getItemIndexFromPointerPosition(i,e,t):o;s===-1&&(s=this._getClosestItemIndexToPointer(i,e,t));let a=this._activeItems[s];a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(s,0,i),a.getRootElement().before(i.getPlaceholderElement())):(this._activeItems.push(i),this._element.appendChild(i.getPlaceholderElement()))}withItems(i){this._activeItems=i.slice()}withSortPredicate(i){this._sortPredicate=i}reset(){let i=this._element,e=this._previousSwap;for(let t=this._relatedNodes.length-1;t>-1;t--){let[o,r]=this._relatedNodes[t];o.parentNode===i&&o.nextSibling!==r&&(r===null?i.appendChild(o):r.parentNode===i&&i.insertBefore(o,r))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(i){return this._activeItems.indexOf(i)}getItemAtIndex(i){return this._activeItems[i]||null}updateOnScroll(){this._activeItems.forEach(i=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(i){i!==this._element&&(this._element=i,this._rootNode=void 0)}_getItemIndexFromPointerPosition(i,e,t){let o=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(t)),r=o?this._activeItems.findIndex(s=>{let a=s.getRootElement();return o===a||a.contains(o)}):-1;return r===-1||!this._sortPredicate(r,i)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=Qi(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(i,e,t){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let o=1/0,r=-1;for(let s=0;s<this._activeItems.length;s++){let a=this._activeItems[s];if(a!==i){let{x:h,y:g}=a.getRootElement().getBoundingClientRect(),b=Math.hypot(e-h,t-g);b<o&&(o=b,r=s)}}return r}},sa=.05,da=.05,je=(function(n){return n[n.NONE=0]="NONE",n[n.UP=1]="UP",n[n.DOWN=2]="DOWN",n})(je||{}),ge=(function(n){return n[n.NONE=0]="NONE",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n})(ge||{}),Vn=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new P;entered=new P;exited=new P;dropped=new P;sorted=new P;receivingStarted=new P;receivingStopped=new P;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=Ue.EMPTY;_verticalScrollDirection=je.NONE;_horizontalScrollDirection=ge.NONE;_scrollNode;_stopScrollTimers=new P;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(i,e,t,o,r){this._dragDropRegistry=e,this._ngZone=o,this._viewportRuler=r;let s=this.element=Ie(i);this._document=t,this.withOrientation("vertical").withElementContainer(s),e.registerDropContainer(this),this._parentPositions=new Yo(t)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(i,e,t,o){this._draggingStarted(),o==null&&this.sortingDisabled&&(o=this._draggables.indexOf(i)),this._sortStrategy.enter(i,e,t,o),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:i,container:this,currentIndex:this.getItemIndex(i)})}exit(i){this._reset(),this.exited.next({item:i,container:this})}drop(i,e,t,o,r,s,a,h={}){this._reset(),this.dropped.next({item:i,currentIndex:e,previousIndex:t,container:this,previousContainer:o,isPointerOverContainer:r,distance:s,dropPoint:a,event:h})}withItems(i){let e=this._draggables;return this._draggables=i,i.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(e.filter(o=>o.isDragging()).every(o=>i.indexOf(o)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(i){return this._direction=i,this._sortStrategy instanceof en&&(this._sortStrategy.direction=i),this}connectedTo(i){return this._siblings=i.slice(),this}withOrientation(i){if(i==="mixed")this._sortStrategy=new Nn(this._document,this._dragDropRegistry);else{let e=new en(this._dragDropRegistry);e.direction=this._direction,e.orientation=i,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,t)=>this.sortPredicate(e,t,this)),this}withScrollableParents(i){let e=this._container;return this._scrollableElements=i.indexOf(e)===-1?[e,...i]:i.slice(),this}withElementContainer(i){if(i===this._container)return this;let e=Ie(this.element),t=this._scrollableElements.indexOf(this._container),o=this._scrollableElements.indexOf(i);return t>-1&&this._scrollableElements.splice(t,1),o>-1&&this._scrollableElements.splice(o,1),this._sortStrategy&&this._sortStrategy.withElementContainer(i),this._cachedShadowRoot=null,this._scrollableElements.unshift(i),this._container=i,this}getScrollableParents(){return this._scrollableElements}getItemIndex(i){return this._isDragging?this._sortStrategy.getItemIndex(i):this._draggables.indexOf(i)}getItemAtIndex(i){return this._isDragging?this._sortStrategy.getItemAtIndex(i):this._draggables[i]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(i,e,t,o){if(this.sortingDisabled||!this._domRect||!Xs(this._domRect,sa,e,t))return;let r=this._sortStrategy.sort(i,e,t,o);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:i})}_startScrollingIfNecessary(i,e){if(this.autoScrollDisabled)return;let t,o=je.NONE,r=ge.NONE;if(this._parentPositions.positions.forEach((s,a)=>{a===this._document||!s.clientRect||t||Xs(s.clientRect,sa,i,e)&&([o,r]=wc(a,s.clientRect,this._direction,i,e),(o||r)&&(t=a))}),!o&&!r){let{width:s,height:a}=this._viewportRuler.getViewportSize(),h={width:s,height:a,top:0,right:s,bottom:a,left:0};o=ha(h,e),r=pa(h,i),t=window}t&&(o!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||t!==this._scrollNode)&&(this._verticalScrollDirection=o,this._horizontalScrollDirection=r,this._scrollNode=t,(o||r)&&t?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let i=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=i.msScrollSnapType||i.scrollSnapType||"",i.scrollSnapType=i.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let i=this._container.style;i.scrollSnapType=i.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),Kn(0,Wn).pipe(Pt(this._stopScrollTimers)).subscribe(()=>{let i=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===je.UP?i.scrollBy(0,-e):this._verticalScrollDirection===je.DOWN&&i.scrollBy(0,e),this._horizontalScrollDirection===ge.LEFT?i.scrollBy(-e,0):this._horizontalScrollDirection===ge.RIGHT&&i.scrollBy(e,0)})};_isOverContainer(i,e){return this._domRect!=null&&An(this._domRect,i,e)}_getSiblingContainerFromPosition(i,e,t){return this._siblings.find(o=>o._canReceive(i,e,t))}_canReceive(i,e,t){if(!this._domRect||!An(this._domRect,e,t)||!this.enterPredicate(i,this))return!1;let o=this._getShadowRoot().elementFromPoint(e,t);return o?o===this._container||this._container.contains(o):!1}_startReceiving(i,e){let t=this._activeSiblings;!t.has(i)&&e.every(o=>this.enterPredicate(o,this)||this._draggables.indexOf(o)>-1)&&(t.add(i),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:i,receiver:this,items:e}))}_stopReceiving(i){this._activeSiblings.delete(i),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:i,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(i=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(i);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let i=Qi(this._container);this._cachedShadowRoot=i||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let i=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,i))}};function ha(n,i){let{top:e,bottom:t,height:o}=n,r=o*da;return i>=e-r&&i<=e+r?je.UP:i>=t-r&&i<=t+r?je.DOWN:je.NONE}function pa(n,i){let{left:e,right:t,width:o}=n,r=o*da;return i>=e-r&&i<=e+r?ge.LEFT:i>=t-r&&i<=t+r?ge.RIGHT:ge.NONE}function wc(n,i,e,t,o){let r=ha(i,o),s=pa(i,t),a=je.NONE,h=ge.NONE;if(r){let g=n.scrollTop;r===je.UP?g>0&&(a=je.UP):n.scrollHeight-g>n.clientHeight&&(a=je.DOWN)}if(s){let g=n.scrollLeft;e==="rtl"?s===ge.RIGHT?g<0&&(h=ge.RIGHT):n.scrollWidth+g>n.clientWidth&&(h=ge.LEFT):s===ge.LEFT?g>0&&(h=ge.LEFT):n.scrollWidth-g>n.clientWidth&&(h=ge.RIGHT)}return[a,h]}var Li={capture:!0},In={passive:!1,capture:!0},xc=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275cmp=S({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(t,o){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return n})(),ma=(()=>{class n{_ngZone=c(xe);_document=c(Bt);_styleLoader=c(Zt);_renderer=c(fi).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new P;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=D([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new P;pointerUp=new P;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,In)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,t){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(xc),this._activeDragInstances.update(o=>[...o,e]),this._activeDragInstances().length===1)){let o=t.type.startsWith("touch"),r=a=>this.pointerUp.next(a),s=[["scroll",a=>this._scroll.next(a),Li],["selectstart",this._preventDefaultWhileDragging,In]];o?s.push(["touchend",r,Li],["touchcancel",r,Li]):s.push(["mouseup",r,Li]),o||s.push(["mousemove",a=>this.pointerMove.next(a),In]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=s.map(([a,h,g])=>this._renderer.listen(this._document,a,h,g))})}}stopDragging(e){this._activeDragInstances.update(t=>{let o=t.indexOf(e);return o>-1?(t.splice(o,1),[...t]):t}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let t=[this._scroll];return e&&e!==this._document&&t.push(new Nt(o=>this._ngZone.runOutsideAngular(()=>{let r=this._renderer.listen(e,"scroll",s=>{this._activeDragInstances().length&&o.next(s)},Li);return()=>{r()}}))),gt(...t)}registerDirectiveNode(e,t){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,t)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Mc={dragStartThreshold:5,pointerDirectionChangeThreshold:5},ua=(()=>{class n{_document=c(Bt);_ngZone=c(xe);_viewportRuler=c(oo);_dragDropRegistry=c(ma);_renderer=c(fi).createRenderer(null,null);constructor(){}createDrag(e,t=Mc){return new Fn(e,t,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Vn(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),aa=new re("CDK_DRAG_PARENT");var Pc=new re("CdkDragHandle");var ga=new re("CDK_DRAG_CONFIG"),fa=new re("CdkDropList"),on=(()=>{class n{element=c(ue);dropContainer=c(fa,{optional:!0,skipSelf:!0});_ngZone=c(xe);_viewContainerRef=c(Hi);_dir=c(bi,{optional:!0});_changeDetectorRef=c(Ye);_selfHandle=c(Pc,{optional:!0,self:!0});_parentDrag=c(aa,{optional:!0,skipSelf:!0});_dragDropRegistry=c(ma);_destroyed=new P;_handles=new We([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new se;released=new se;ended=new se;entered=new se;exited=new se;dropped=new se;moved=new Nt(e=>{let t=this._dragRef.moved.pipe(Vi(o=>({source:this,pointerPosition:o.pointerPosition,event:o.event,delta:o.delta,distance:o.distance}))).subscribe(e);return()=>{t.unsubscribe()}});_injector=c(Ge);constructor(){let e=this.dropContainer,t=c(ga,{optional:!0}),o=c(ua);this._dragRef=o.createDrag(this.element,{dragStartThreshold:t&&t.dragStartThreshold!=null?t.dragStartThreshold:5,pointerDirectionChangeThreshold:t&&t.pointerDirectionChangeThreshold!=null?t.pointerDirectionChangeThreshold:5,zIndex:t?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),t&&this._assignDefaults(t),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Pt(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Et(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let t=e.rootElementSelector,o=e.freeDragPosition;t&&!t.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,o&&!o.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let t=this._handles.getValue();t.push(e),this._handles.next(t)}_removeHandle(e){let t=this._handles.getValue(),o=t.indexOf(e);o>-1&&(t.splice(o,1),this._handles.next(t))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,t=e;this.rootElementSelector&&(t=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(t||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Ie(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let t=this._dir,o=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof o=="object"&&o?o:Yi(o),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),t&&e.withDirection(t.value)}}),e.beforeStarted.pipe(ji(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let t=this.element.nativeElement.parentElement;for(;t;){let o=this._dragDropRegistry.getDragDirectiveForNode(t);if(o){e.withParent(o._dragRef);break}t=t.parentElement}})}_handleEvents(e){e.started.subscribe(t=>{this.started.emit({source:this,event:t.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(t=>{this.released.emit({source:this,event:t.event})}),e.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),e.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),e.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint,event:t.event})})}_assignDefaults(e){let{lockAxis:t,dragStartDelay:o,constrainPosition:r,previewClass:s,boundaryElement:a,draggingDisabled:h,rootElementSelector:g,previewContainer:b}=e;this.disabled=h??!1,this.dragStartDelay=o||0,this.lockAxis=t||null,r&&(this.constrainPosition=r),s&&(this.previewClass=s),a&&(this.boundaryElement=a),g&&(this.rootElementSelector=g),b&&(this.previewContainer=b)}_setupHandlesListener(){this._handles.pipe(jt(e=>{let t=e.map(o=>o.element);this._selfHandle&&this.rootElementSelector&&t.push(this.element),this._dragRef.withHandles(t)}),Vt(e=>gt(...e.map(t=>t._stateChanges.pipe(ui(t))))),Pt(this._destroyed)).subscribe(e=>{let t=this._dragRef,o=e.element.nativeElement;e.disabled?t.disableHandle(o):t.enableHandle(o)})}static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(t,o){t&2&&K("cdk-drag-disabled",o.disabled)("cdk-drag-dragging",o._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",le],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",hr]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[de([{provide:aa,useExisting:n}]),Ht]})}return n})(),la=new re("CdkDropListGroup");var nn=(()=>{class n{element=c(ue);_changeDetectorRef=c(Ye);_scrollDispatcher=c(yr);_dir=c(bi,{optional:!0});_group=c(la,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new P;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=c(Je).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new se;entered=new se;exited=new se;sorted=new se;_unsortedItems=new Set;constructor(){let e=c(ua),t=c(ga,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,t&&this._assignDefaults(t),this._dropListRef.enterPredicate=(o,r)=>this.enterPredicate(o.data,r.data),this._dropListRef.sortPredicate=(o,r,s)=>this.sortPredicate(o,r.data,s.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),n._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(t=>t._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let t=this._latestSortedRefs.indexOf(e._dragRef);t>-1&&(this._latestSortedRefs.splice(t,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,t)=>e._dragRef.getVisibleElement().compareDocumentPosition(t._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=n._dropLists.indexOf(this);e>-1&&n._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(ui(this._dir.value),Pt(this._destroyed)).subscribe(t=>e.withDirection(t)),e.beforeStarted.subscribe(()=>{let t=Ji(this.connectedTo).map(o=>{if(typeof o=="string"){let r=n._dropLists.find(s=>s.id===o);return r}return o});if(this._group&&this._group._items.forEach(o=>{t.indexOf(o)===-1&&t.push(o)}),!this._scrollableParentsResolved){let o=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(r=>r.getElementRef().nativeElement);this._dropListRef.withScrollableParents(o),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let o=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(o)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Yi(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(t.filter(o=>o&&o!==this).map(o=>o._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(t=>t._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(t=>{this.entered.emit({container:this,item:t.item.data,currentIndex:t.currentIndex})}),e.exited.subscribe(t=>{this.exited.emit({container:this,item:t.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(t=>{this.sorted.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,container:this,item:t.item.data})}),e.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,item:t.item.data,isPointerOverContainer:t.isPointerOverContainer,distance:t.distance,dropPoint:t.dropPoint,event:t.event}),this._changeDetectorRef.markForCheck()}),gt(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:t,draggingDisabled:o,sortingDisabled:r,listAutoScrollDisabled:s,listOrientation:a}=e;this.disabled=o??!1,this.sortingDisabled=r??!1,this.autoScrollDisabled=s??!1,this.orientation=a||"vertical",this.lockAxis=t||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(t){return new(t||n)};static \u0275dir=Pe({type:n,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(t,o){t&2&&(Be("id",o.id),K("cdk-drop-list-disabled",o.disabled)("cdk-drop-list-dragging",o._dropListRef.isDragging())("cdk-drop-list-receiving",o._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",le],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",le],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",le],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",le]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[de([{provide:la,useValue:void 0},{provide:fa,useExisting:n}])]})}return n})();function Ec(n,i){if(n&1){let e=L();d(0,"div",7),C("mousedown",function(){let o=T(e).$implicit,r=M(2);return k(r.onSectorSelected(o))}),m(1),d(2,"button",8),C("mousedown",function(o){return T(e),k(o.stopPropagation())}),d(3,"mat-icon",9),m(4,"more_vert"),p()(),d(5,"mat-menu",10,0)(7,"button",11),C("click",function(){let o=T(e).$implicit,r=M(2);return k(r.navigateToContourPanel(o))}),d(8,"mat-icon",12),m(9,"draw"),p(),m(10),_(11,"translate"),p(),d(12,"button",11),C("click",function(){let o=T(e).$implicit,r=M(2);return k(r.navigateToPropertyPanel(o))}),d(13,"mat-icon",12),m(14,"settings_input_composite"),p(),m(15),_(16,"translate"),p(),d(17,"button",11),C("click",function(){let o=T(e).$implicit,r=M(2);return k(r.openRemoveSectorDialog(o))}),d(18,"mat-icon",12),m(19,"delete"),p(),m(20),_(21,"translate"),p()()()}if(n&2){let e=i.$implicit,t=Oe(6),o=M(2);K("selected",e===o.selectedSector),l(),w(" ",e.name," "),l(),y("matMenuTriggerFor",t),l(8),w(" ",v(11,7,"tool.sectors.contourList.editContour")," "),l(5),w(" ",v(16,9,"tool.sectors.contourList.editProperties")," "),l(5),w(" ",v(21,11,"tool.sectors.contourList.removeSector")," ")}}function Dc(n,i){if(n&1){let e=L();d(0,"div",5),C("cdkDropListDropped",function(o){T(e);let r=M();return k(r.dropSectorBox(o))}),Ee(1,Ec,22,13,"div",6,$t),p()}if(n&2){let e=M();l(),De(e.sectors())}}function Oc(n,i){n&1&&(d(0,"div",4),m(1),_(2,"translate"),p()),n&2&&(l(),f(v(2,1,"tool.sectors.contourList.noSectors")))}var _a=(()=>{class n{constructor(){this.store=c(F),this.translate=c(te),this.dialog=c(wt),this.router=c(X),this.destroyRef=c(J),this.selectedSector=null,this.sectors=this.store.selectSignal(fe),this.sectorsContoursService=c(mt)}openRemoveSectorDialog(e){let t={title:this.translate.instant("tool.sectors.contourList.removeSector"),message:this.translate.instant("tool.sectors.contourList.removeSectorMessage",{sectorName:e.name})};this.dialog.open(ht,{data:t}).afterClosed().pipe(Z(this.destroyRef)).subscribe(o=>{o&&(this.store.dispatch(me.sectorRemoved({sector:e})),this.selectedSector===e&&this.resetSelectedSector(),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector}))})}emitSectorToEditContour(e){this.sectorsContoursService.emitEditedSectorContour({sector:ae(E({},e),{vertices:[...e.vertices]}),selectedVertex:e.vertices.at(-1)})}navigateToNewSectorPanel(){this.router.navigate(["/tool/sectors/contour"])}navigateToContourPanel(e){this.router.navigate([`/tool/sectors/${e.id}/contour`])}navigateToPropertyPanel(e){this.router.navigate([`/tool/sectors/${e.id}/property`])}emitSectorToEditProperty(e){this.sectorsContoursService.emitEditedSectorProperty({sector:e,mesh:null,contour:null})}onSectorSelected(e){this.selectedSector=e,this.sectorsContoursService.emitSectorListChanged({selectedSector:e})}dropSectorBox(e){this.store.dispatch(me.sectorShifted({prevIndex:e.previousIndex,newIndex:e.currentIndex})),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector})}resetSelectedSector(){let e=this.sectors();this.selectedSector=e.length?e[0]:null}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-sectors-contours-list"]],decls:6,vars:4,consts:[["menu","matMenu"],[1,"actions"],["mat-flat-button","","color","accent",3,"click"],["cdkDropList","",1,"sectors-list"],[1,"no-sectors"],["cdkDropList","",1,"sectors-list",3,"cdkDropListDropped"],["cdkDrag","",1,"sector-box",3,"selected"],["cdkDrag","",1,"sector-box",3,"mousedown"],["mat-icon-button","",1,"sector-actions",3,"mousedown","matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(t,o){t&1&&(d(0,"div",1)(1,"button",2),C("click",function(){return o.navigateToNewSectorPanel()}),m(2),_(3,"translate"),p()(),W(4,Dc,3,0,"div",3)(5,Oc,3,3,"div",4)),t&2&&(l(2),w(" ",v(3,2,"tool.sectors.contourList.addSector")," "),l(2),q(o.sectors().length?4:5))},dependencies:[A,Q,Re,ke,Te,ti,Jt,Yt,ei,nn,on,B,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .no-sectors[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.sectors-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.sectors-list[_ngcontent-%COMP%]   .sector-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{cursor:move}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.sectors-list[_ngcontent-%COMP%]   .sector-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.sectors-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return n})();var Tc=["*"],va=(()=>{class n{constructor(){this.label=ee.required(),this.shouldBeOpen=ee(!0),this.isOpen=D(!0)}ngOnInit(){this.isOpen.set(this.shouldBeOpen())}toggle(){this.isOpen.update(e=>!e)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-extended-panel"]],inputs:{label:[1,"label"],shouldBeOpen:[1,"shouldBeOpen"]},ngContentSelectors:Tc,decls:8,vars:4,consts:[[1,"label"],[1,"label-content"],["mat-icon-button","",1,"toggle-button",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"]],template:function(t,o){t&1&&(_t(),d(0,"div",0)(1,"span",1),m(2),p(),d(3,"button",2),C("click",function(){return o.toggle()}),d(4,"mat-icon",3),m(5," keyboard_arrow_up "),p()()(),d(6,"app-expandable-panel",4),ct(7),p()),t&2&&(l(2),f(o.label()),l(2),K("chevron--closed",!o.isOpen()),l(2),y("isOpen",o.isOpen()))},dependencies:[ke,Te,A,Re,si],styles:["[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .label-content[_ngcontent-%COMP%]{margin-left:15px;font-weight:500}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{margin-left:auto}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}"],changeDetection:0})}}return n})();var ba=(()=>{class n{constructor(){this.http=c(ur)}getPolygonTriangulationMesh(e){let t={headers:new mr({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"})};return this.http.post(Bs(),e,t).pipe(jt(o=>Ii.restore(o)))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=oe({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ca=(()=>{class n{constructor(){this.store=c(F),this.dataService=c(ba),this.snackBar=c(Le),this.service=c(mt),this.translate=c(te),this.route=c(Ct),this.router=c(X),this.destroyRef=c(J),this.errorLabels={required:()=>this.translate.instant("common.fieldRequired"),valueToSmall:()=>this.translate.instant("tool.sectors.sectorProperty.valueToSmall"),sectionMinAngleOutOfRange:()=>this.translate.instant("tool.sectors.sectorProperty.sectionMinAngleOutOfRange"),valueCannotBeNegative:()=>this.translate.instant("tool.sectors.sectorProperty.valueCannotBeNegative")},this.formData=D({sectionMaxArea:0,sectionMinAngle:0,minTileRadius:0,maxTileRadius:0,tilesMargin:0,populationParams:{initialPopulationSize:0,countOfTriesToInsertTile:0,countOfTrianglePositionDraws:0,countOfColorMatchingAttempts:0,iterationsCount:0,populationSize:0},evaluationParams:{singleSectionPopulation:0,overlappingAreaOutsideSector:0,additionalPopulationOfNeighboringSectors:0,overlappingNotPopulatedSections:0,tileColorMismatch:0}}),this.form=it(this.formData,e=>{H(e.sectionMaxArea),He(e.sectionMaxArea,.01,{error:{kind:"valueToSmall"}}),H(e.sectionMinAngle),He(e.sectionMinAngle,10,{error:{kind:"sectionMinAngleOutOfRange"}}),It(e.sectionMinAngle,90,{error:{kind:"sectionMinAngleOutOfRange"}}),He(e.minTileRadius,0,{error:{kind:"valueCannotBeNegative"}}),He(e.maxTileRadius,.01,{error:{kind:"valueToSmall"}}),He(e.tilesMargin,.01,{error:{kind:"valueToSmall"}}),H(e.tilesMargin),H(e.populationParams.initialPopulationSize),H(e.populationParams.countOfTriesToInsertTile),H(e.populationParams.countOfTrianglePositionDraws),H(e.populationParams.countOfColorMatchingAttempts),H(e.populationParams.iterationsCount),H(e.populationParams.populationSize),H(e.evaluationParams.singleSectionPopulation),H(e.evaluationParams.overlappingAreaOutsideSector),H(e.evaluationParams.additionalPopulationOfNeighboringSectors),H(e.evaluationParams.overlappingNotPopulatedSections),H(e.evaluationParams.tileColorMismatch)}),this.triangulationMeshEffect=Me(()=>{let e={polygonVertices:this.sector.vertices,sectionMaxArea:this.form.sectionMaxArea().value(),sectionMinAngle:this.form.sectionMinAngle().value()};this.dataService.getPolygonTriangulationMesh(e).pipe(Z(this.destroyRef)).subscribe({next:t=>this.service.emitEditedSectorProperty({sector:this.sector,mesh:t.triangles,contour:t.contour}),error:()=>this.showPolygonTriangulationError()})})}ngOnInit(){this.prepareSector()}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){this.sector=this.store.selectSignal(fe)().find(o=>o.id===e);let t=this.sector.properties;this.formData.set(ae(E({},t),{populationParams:E({},t.populationParams),evaluationParams:E({},t.evaluationParams)}))}}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.service.emitEditedSectorProperty(null),this.navigateToSectorList()}getFieldErrorLabel(e){return ze.getFieldErrorLabel(e,this.errorLabels)}save(){vo(this.form,async()=>{let e=this.formData();this.store.dispatch(me.sectorModified({modifiedSector:ae(E({},this.sector),{properties:e})})),this.service.emitEditedSectorProperty(null),this.navigateToSectorList()})}showPolygonTriangulationError(){this.snackBar.open(this.translate.instant("tool.sectors.sectorProperty.errorOnSectorMeshRequesting"),this.translate.instant("common.ok"),{duration:2e3})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-sector-property-editor"]],features:[de([{provide:_n,useFactory:e=>ae(E({},e),{subscriptSizing:"dynamic"}),deps:[[new Jn,new er,_n]]}])],decls:128,vars:124,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"sector-property-form"],[3,"label"],[1,"form-group"],["matTooltipPosition","left",1,"density-3",3,"matTooltip"],["matInput","","type","number",3,"field"],[3,"label","shouldBeOpen"]],template:function(t,o){t&1&&(d(0,"div",0)(1,"button",1),C("click",function(){return o.cancel()}),m(2),_(3,"translate"),p(),d(4,"button",2),C("click",function(){return o.save()}),m(5),_(6,"translate"),p()(),d(7,"div",3)(8,"app-extended-panel",4)(9,"div",5)(10,"mat-form-field",6)(11,"mat-label"),m(12),_(13,"translate"),p(),x(14,"input",7),N(),d(15,"mat-error"),m(16),p()(),d(17,"mat-form-field",6)(18,"mat-label"),m(19),_(20,"translate"),p(),x(21,"input",7),N(),d(22,"mat-error"),m(23),p()()()(),d(24,"app-extended-panel",4)(25,"div",5)(26,"mat-form-field",6)(27,"mat-label"),m(28),_(29,"translate"),p(),x(30,"input",7),N(),d(31,"mat-error"),m(32),p()(),d(33,"mat-form-field",6)(34,"mat-label"),m(35),_(36,"translate"),p(),x(37,"input",7),N(),d(38,"mat-error"),m(39),p()(),d(40,"mat-form-field",6)(41,"mat-label"),m(42),_(43,"translate"),p(),x(44,"input",7),N(),d(45,"mat-error"),m(46),p()()()(),d(47,"app-extended-panel",8)(48,"div",5)(49,"mat-form-field",6)(50,"mat-label"),m(51),_(52,"translate"),p(),x(53,"input",7),N(),d(54,"mat-error"),m(55),p()(),d(56,"mat-form-field",6)(57,"mat-label"),m(58),_(59,"translate"),p(),x(60,"input",7),N(),d(61,"mat-error"),m(62),p()(),d(63,"mat-form-field",6)(64,"mat-label"),m(65),_(66,"translate"),p(),x(67,"input",7),N(),d(68,"mat-error"),m(69),p()(),d(70,"mat-form-field",6)(71,"mat-label"),m(72),_(73,"translate"),p(),x(74,"input",7),N(),d(75,"mat-error"),m(76),p()(),d(77,"mat-form-field",6)(78,"mat-label"),m(79),_(80,"translate"),p(),x(81,"input",7),N(),d(82,"mat-error"),m(83),p()(),d(84,"mat-form-field",6)(85,"mat-label"),m(86),_(87,"translate"),p(),x(88,"input",7),N(),d(89,"mat-error"),m(90),p()()()(),d(91,"app-extended-panel",8)(92,"div",5)(93,"mat-form-field",6)(94,"mat-label"),m(95),_(96,"translate"),p(),x(97,"input",7),N(),d(98,"mat-error"),m(99),p()(),d(100,"mat-form-field",6)(101,"mat-label"),m(102),_(103,"translate"),p(),x(104,"input",7),N(),d(105,"mat-error"),m(106),p()(),d(107,"mat-form-field",6)(108,"mat-label"),m(109),_(110,"translate"),p(),x(111,"input",7),N(),d(112,"mat-error"),m(113),p()(),d(114,"mat-form-field",6)(115,"mat-label"),m(116),_(117,"translate"),p(),x(118,"input",7),N(),d(119,"mat-error"),m(120),p()(),d(121,"mat-form-field",6)(122,"mat-label"),m(123),_(124,"translate"),p(),x(125,"input",7),N(),d(126,"mat-error"),m(127),p()()()()()),t&2&&(l(2),w(" ",v(3,88,"common.cancel")," "),l(3),w(" ",v(6,90,"common.confirm")," "),l(3),y("label",o.translate.instant("tool.sectors.sectorProperty.sectorsSize")),l(2),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.maxAreaHint")),l(2),f(v(13,92,"tool.sectors.sectorProperty.maxArea")),l(2),V(o.form.sectionMaxArea),l(2),f(o.getFieldErrorLabel(o.form.sectionMaxArea())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.minAngleHint")),l(2),f(v(20,94,"tool.sectors.sectorProperty.minAngle")),l(2),V(o.form.sectionMinAngle),l(2),f(o.getFieldErrorLabel(o.form.sectionMinAngle())),l(),y("label",o.translate.instant("tool.sectors.sectorProperty.tilesLimitations")),l(2),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.minRadiusHint")),l(2),f(v(29,96,"tool.sectors.sectorProperty.minRadius")),l(2),V(o.form.minTileRadius),l(2),f(o.getFieldErrorLabel(o.form.minTileRadius())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.maxRadiusHint")),l(2),f(v(36,98,"tool.sectors.sectorProperty.maxRadius")),l(2),V(o.form.maxTileRadius),l(2),f(o.getFieldErrorLabel(o.form.maxTileRadius())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.minMarginHint")),l(2),f(v(43,100,"tool.sectors.sectorProperty.minMargin")),l(2),V(o.form.tilesMargin),l(2),f(o.getFieldErrorLabel(o.form.tilesMargin())),l(),y("label",o.translate.instant("tool.sectors.sectorProperty.populationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.initialPopulationSizeHint")),l(2),f(v(52,102,"tool.sectors.sectorProperty.initialPopulationSize")),l(2),V(o.form.populationParams.initialPopulationSize),l(2),f(o.getFieldErrorLabel(o.form.populationParams.initialPopulationSize())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.populationSizeHint")),l(2),f(v(59,104,"tool.sectors.sectorProperty.populationSize")),l(2),V(o.form.populationParams.populationSize),l(2),f(o.getFieldErrorLabel(o.form.populationParams.populationSize())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.iterationsCountHint")),l(2),f(v(66,106,"tool.sectors.sectorProperty.iterationsCount")),l(2),V(o.form.populationParams.iterationsCount),l(2),f(o.getFieldErrorLabel(o.form.populationParams.iterationsCount())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.countOfTrianglePositionDrawsHint")),l(2),f(v(73,108,"tool.sectors.sectorProperty.countOfTrianglePositionDraws")),l(2),V(o.form.populationParams.countOfTrianglePositionDraws),l(2),f(o.getFieldErrorLabel(o.form.populationParams.countOfTrianglePositionDraws())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.countOfTriesToInsertTileHint")),l(2),f(v(80,110,"tool.sectors.sectorProperty.countOfTriesToInsertTile")),l(2),V(o.form.populationParams.countOfTriesToInsertTile),l(2),f(o.getFieldErrorLabel(o.form.populationParams.countOfTriesToInsertTile())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.countOfColorMatchingAttemptsHint")),l(2),f(v(87,112,"tool.sectors.sectorProperty.countOfColorMatchingAttempts")),l(2),V(o.form.populationParams.countOfColorMatchingAttempts),l(2),f(o.getFieldErrorLabel(o.form.populationParams.countOfColorMatchingAttempts())),l(),y("label",o.translate.instant("tool.sectors.sectorProperty.evaluationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.singleSectionPopulationHint")),l(2),f(v(96,114,"tool.sectors.sectorProperty.singleSectionPopulation")),l(2),V(o.form.evaluationParams.singleSectionPopulation),l(2),f(o.getFieldErrorLabel(o.form.evaluationParams.singleSectionPopulation())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(v(103,116,"tool.sectors.sectorProperty.overlappingAreaOutsideSector")),l(2),V(o.form.evaluationParams.overlappingAreaOutsideSector),l(2),f(o.getFieldErrorLabel(o.form.evaluationParams.overlappingAreaOutsideSector())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(v(110,118,"tool.sectors.sectorProperty.additionalPopulationOfNeighboringSectors")),l(2),V(o.form.evaluationParams.additionalPopulationOfNeighboringSectors),l(2),f(o.getFieldErrorLabel(o.form.evaluationParams.additionalPopulationOfNeighboringSectors())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.overlappingNotPopulatedSectionsHint")),l(2),f(v(117,120,"tool.sectors.sectorProperty.overlappingNotPopulatedSections")),l(2),V(o.form.evaluationParams.overlappingNotPopulatedSections),l(2),f(o.getFieldErrorLabel(o.form.evaluationParams.overlappingNotPopulatedSections())),l(),y("matTooltip",o.translate.instant("tool.sectors.sectorProperty.tileColorMismatchHint")),l(2),f(v(124,122,"tool.sectors.sectorProperty.tileColorMismatch")),l(2),V(o.form.evaluationParams.tileColorMismatch),l(2),f(o.getFieldErrorLabel(o.form.evaluationParams.tileColorMismatch())))},dependencies:[A,Q,ve,Ae,nt,rt,Ne,Fe,Or,Dr,va,B,ot,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;width:100%}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:18px;margin-top:12px}"],changeDetection:0})}}return n})();function ya(n){return({value:i})=>n().includes(i())?dt({kind:"nonUnique"}):null}var rn=class{static isPointInsidePolygon(i,e){if(i.length<3)return!1;let t=new R(Number.MAX_VALUE,e.y),o=new ut(e,t),r=0,s=0;do{let a=new ut(i[s],i[(s+1)%i.length]);if(this.areLineIntersecting(a,o)){if(this.getDirection(a.start,e,a.end)==0)return this.isPointOnLine(a,e);r++}s=(s+1)%i.length}while(s!=0);return(r&1)==1}static areLineIntersecting(i,e){let t=this.getDirection(i.start,i.end,e.start),o=this.getDirection(i.start,i.end,e.end),r=this.getDirection(e.start,e.end,i.start),s=this.getDirection(e.start,e.end,i.end);return!!(t!=o&&r!=s||t==0&&this.isPointOnLine(i,e.start)||o==0&&this.isPointOnLine(i,e.end)||r==0&&this.isPointOnLine(e,i.start)||s==0&&this.isPointOnLine(e,i.end))}static isPointOnLine(i,e){return e.x<=Math.max(i.start.x,i.end.x)&&e.x>=Math.min(i.start.x,i.end.x)&&e.y<=Math.max(i.start.y,i.end.y)&&e.y>=Math.min(i.start.y,i.end.y)}static getDirection(i,e,t){let o=(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y);return o==0?0:o<0?2:1}};function Sa({value:n}){return n().length<3?dt({kind:"tooFewVertices"}):kc(n())?dt({kind:"edgesIntersect"}):null}function kc(n){let i=[];for(let e=0;e<n.length;++e)i.push(new ut(n[e],n.at(e-1)));for(let e=0;e<n.length;++e)for(let t=0;t<n.length;++t)if(!(e===t||(e+1)%n.length===t||(t+1)%n.length===e)&&rn.areLineIntersecting(i[e],i[t]))return!0;return!1}function Ic(n,i){if(n&1){let e=L();d(0,"div",11),C("mousedown",function(){let o=T(e).$implicit,r=M(2);return k(r.onBoxSelected(o))}),m(1),d(2,"button",12),C("click",function(){let o=T(e).$implicit,r=M(2);return k(r.removeVertex(o))})("mousedown",function(o){return T(e),k(o.stopPropagation())}),d(3,"mat-icon",13),m(4,"close"),p()()()}if(n&2){let e=i.$implicit,t=M(2);K("selected",e===t.selectedVertex()),l(),w(" ",t.getVertexLabel(e)," ")}}function Rc(n,i){if(n&1){let e=L();d(0,"div",9),C("cdkDropListDropped",function(o){T(e);let r=M();return k(r.dropVertexBox(o))}),Ee(1,Ic,5,3,"div",10,$t),p()}if(n&2){let e=M();l(),De(e.form.vertices().value())}}function Ac(n,i){n&1&&(d(0,"div",8),m(1),_(2,"translate"),p()),n&2&&(l(),f(v(2,1,"tool.sectors.sectorContour.addSectorVertices")))}var Hn=(()=>{class n{constructor(){this.selectedVertex=D(null),this.store=c(F),this.snackbarService=c(Le),this.sectorsContoursService=c(mt),this.translate=c(te),this.route=c(Ct),this.router=c(X),this.destroyRef=c(J),this.existingSectors=this.store.selectSignal(fe),this.errorLabels={edgesIntersect:()=>this.translate.instant("tool.sectors.sectorContour.linesCannotIntersecting"),tooFewVertices:()=>this.translate.instant("tool.sectors.sectorContour.tooFewVertices"),nonUnique:()=>this.translate.instant("tool.sectors.sectorContour.nameAlreadyInUse"),required:()=>this.translate.instant("tool.sectors.sectorContour.nameRequired")},this.formData=D({id:"",name:"",color:"",vertices:[],properties:null}),this.usedSectorNames=j(()=>this.existingSectors().filter(e=>e.id!==this.formData().id).map(e=>e.name)),this.form=it(this.formData,e=>{H(e.name),kt(e.name,ya(this.usedSectorNames)),H(e.color),kt(e.vertices,Sa)}),this.onContourChangeEffect=Me(()=>{this.sectorsContoursService.emitEditedSectorContour({sector:this.formData(),selectedVertex:this.selectedVertex()})})}ngOnInit(){this.prepareSector(),this.subscribeOnCanvasClicked()}subscribeOnCanvasClicked(){this.sectorsContoursService.canvasClicked$.pipe(Z(this.destroyRef)).subscribe(e=>this.addVertex(new R(e.x,e.y)))}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){let t=this.existingSectors().find(o=>o.id===e);this.formData.set(ae(E({},t),{vertices:t.vertices.map(o=>new R(o.x,o.y))})),this.selectedVertex.set(this.formData().vertices[0])}else{let t=mt.createNewSector();this.formData.set(t)}}addVertex(e){let t=[...this.form.vertices().value()],o=t.indexOf(this.selectedVertex());t.splice(o+1,0,e),this.form.vertices().setControlValue(t),this.selectedVertex.set(e)}removeVertex(e){let t=this.form.vertices().value().filter(o=>o!==e);this.form.vertices().setControlValue(t),e===this.selectedVertex()&&this.resetSelectedVertex()}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()}save(){this.form().valid()?(this.store.dispatch(me.sectorModified({modifiedSector:this.formData()})),this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()):this.showWarning(this.showValidationError())}showValidationError(){let e=this.form().errorSummary();return ze.getErrorLabel(e,this.errorLabels)}getFieldErrorLabel(e){return ze.getErrorLabel(e.errorSummary(),this.errorLabels)}showWarning(e){this.snackbarService.open(e,this.translate.instant("common.ok"),{duration:3e3})}onBoxSelected(e){this.selectedVertex.set(e)}dropVertexBox(e){let t=this.form.vertices().value();tn(t,e.previousIndex,e.currentIndex),this.form.vertices().setControlValue(t)}getVertexLabel(e){return`(${e.x.toFixed(2)}, ${e.y.toFixed(2)})`}resetSelectedVertex(){let e=this.form.vertices().value();this.selectedVertex.set(e.at(-1)??null)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=S({type:n,selectors:[["app-sector-contour-edition"]],decls:18,vars:16,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"info"],["subscriptSizing","dynamic",1,"density-3"],["matInput","",3,"field"],[3,"label","field"],["cdkDropList","",1,"vertices-list"],[1,"no-vertices"],["cdkDropList","",1,"vertices-list",3,"cdkDropListDropped"],["cdkDrag","",1,"vertex-box",3,"selected"],["cdkDrag","",1,"vertex-box",3,"mousedown"],["mat-icon-button","",1,"vertex-remove",3,"click","mousedown"],["matListIcon",""]],template:function(t,o){t&1&&(d(0,"div",0)(1,"button",1),C("click",function(){return o.cancel()}),m(2),_(3,"translate"),p(),d(4,"button",2),C("click",function(){return o.save()}),m(5),_(6,"translate"),p()(),d(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),m(10),_(11,"translate"),p(),x(12,"input",5),N(),d(13,"mat-error"),m(14),p()(),x(15,"app-color-picker",6),N(),W(16,Rc,3,0,"div",7)(17,Ac,3,3,"div",8),p()),t&2&&(l(2),f(v(3,10,"common.cancel")),l(3),f(v(6,12,"common.confirm")),l(5),f(v(11,14,"tool.sectors.sectorContour.sectorName")),l(2),V(o.form.name),l(2),f(o.getFieldErrorLabel(o.form.name())),l(),y("label",o.translate.instant("tool.sectors.sectorContour.sectorColor")),V(o.form.color),l(),q(o.form.vertices().value().length?16:17))},dependencies:[A,Q,Re,nn,on,ve,Ae,nt,rt,Ne,Fe,ke,Te,Eo,B,ot,G],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .no-vertices[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.vertices-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.vertices-list[_ngcontent-%COMP%]   .vertex-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{cursor:move}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.vertices-list[_ngcontent-%COMP%]   .vertex-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.vertices-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return n})();var dC=[{path:"",redirectTo:"config",pathMatch:"full"},{path:"config",component:Yr,children:[{path:"",component:rs},{path:"project",component:ls}]},{path:"tray",component:ds,canActivate:[xo],children:[{path:"",component:ys},{path:"random",component:Pn},{path:"random/:id",component:Pn},{path:"tile/:id",component:Ms}]},{path:"sectors",component:Rs,canActivate:[xo],children:[{path:"",component:_a},{path:":id/property",component:Ca},{path:":id/contour",component:Hn},{path:"contour",component:Hn}]},{path:"generating",component:Ws,canActivate:[xo,qs]}];export{dC as toolRoutes};
