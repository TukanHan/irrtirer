import{$ as Vi,$a as $i,$b as sr,$c as Ze,A as Fi,Aa as C,Ac as fr,Ad as Ct,B as J,Ba as O,Bb as X,Bd as Tt,C as Ne,Ca as mt,Cb as Y,Cd as Ae,D as oe,Da as st,Dc as _r,Dd as H,Ea as Qn,Eb as U,Ec as vr,F as c,Fa as ut,Fb as gi,Fc as on,Fd as be,G as zo,Ga as Ue,Gb as Wt,Gc as br,Gd as ue,H as T,Ha as We,Hb as qt,Hc as Cr,Hd as Ye,I,Ia as Hi,Ib as ir,Ic as yr,Id as yt,J as He,Ja as zi,Jc as rn,Jd as cn,K as Bt,Ka as Pe,Kb as Ee,Kc as Sr,Kd as Br,L as K,La as qe,Lb as De,Lc as sn,Ld as dn,M as re,Ma as z,Mb as nr,Mc as wr,Md as so,N as xe,Na as Go,Nb as or,Nc as an,Nd as Qe,O as P,Oa as m,Ob as qi,Oc as xr,Od as Le,P as ze,Pa as f,Pb as rr,Pc as Mr,Pd as Zt,Q as $o,Qa as D,Qb as Ot,Qc as Pr,Qd as Xt,R as Uo,Ra as Ko,Rb as ft,Rc as W,Rd as Yt,S as Nt,Sa as Zo,Sb as Gi,Sc as Er,Sd as Qt,Ta as Xo,Tb as Oe,Tc as Dr,Td as Nr,U as me,Ua as Yo,Uc as ro,Va as Qo,Vb as Ki,Vc as A,W as l,Wa as Jn,Wb as Zi,X as Pt,Xa as de,Y as hi,Ya as v,Z as pi,Za as b,_ as mi,_a as Z,_c as Or,a as M,aa as S,ac as Ke,ad as kr,b as ae,ba as $e,bb as $t,bc as Gt,bd as Xe,c as Lt,ca as Me,cb as se,cc as ar,cd as ve,d as je,db as Ui,dc as eo,dd as ke,e as Ft,ea as Wo,eb as ui,ec as Xi,ed as ne,f as x,fa as ji,fb as Ge,fc as Yi,fd as L,g as Be,ga as qo,gb as le,gc as to,h as Lo,ha as Bi,hb as Jo,hc as lr,hd as _t,i as Fo,ia as Re,id as pe,j as ci,ja as V,jb as Wi,jc as Qi,jd as R,k as Ai,ka as j,kc as io,kd as Tr,l as Vo,la as te,lc as Ji,ma as ie,mc as Kt,n as jo,na as pt,nb as er,nc as no,o as ht,oa as Ht,oc as en,od as Ir,p as Yn,pa as fe,pb as tr,pc as cr,pd as vt,qa as _e,qc as oo,qd as Rr,r as Li,ra as y,rc as dr,rd as Ar,sa as h,sc as tn,sd as Lr,t as Bo,ta as p,tb as gt,tc as hr,td as Fr,u as No,ua as w,ub as Ut,uc as pr,ud as Vr,v as Ho,va as Et,vb as $,vc as nn,vd as bt,w as di,wa as Dt,wc as mr,wd as ln,x as Vt,xa as Ni,xc as ur,xd as at,y as Mt,ya as G,yc as fi,yd as jr,z as jt,za as zt,zc as gr,zd as kt}from"./chunk-353KDBW2.js";var It=(()=>{class o{constructor(){this._imageChange=P({mosaicConfig:null,shouldFocus:!1}),this.imageChange=this._imageChange.asReadonly()}emitImageChange(e,i){this._imageChange.set({mosaicConfig:e,shouldFocus:i})}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac})}}return o})();var Hr=(()=>{class o{constructor(){this.store=c(A),this.destroyRef=c(K),this.configService=c(It),this.toolService=c(be),this.mosaicConfig=this.store.selectSignal(Ze),this.imageObject=P(null),this.imageChanged$=Dr(this.configService.imageChange),this.ribbonActions=[{iconName:"crop",visibility:P("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"configuration_snapshot.png")},{iconName:"recenter",visibility:Z(()=>this.imageObject()?"on":"disabled"),onClick:()=>{this.focusOnImage(this.imageObject()),this.activeCanvas.redraw()}}]}sectionEntered(e,i){return this.activeCanvas=e,this.imageChanged$.pipe(W(this.destroyRef),Ho(1)).subscribe(n=>{let r=n.shouldFocus||i;this.drawImage(n.mosaicConfig,r)}),{ribbon:this.ribbonActions}}async drawImage(e,i){let n=this.imageObject();n?.removeObject(),n=null,e&&(n=await be.createImageObject(e),this.activeCanvas.addCanvasObject(n,!1),i&&this.focusOnImage(n)),this.imageObject.set(n),this.activeCanvas.redraw()}focusOnImage(e){let i=be.calculateZoomForImage(e.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(i,R.zero)}onRouterChange(){this.configService.emitImageChange(this.mosaicConfig(),!1)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-configuration"]],features:[de([It])],decls:1,vars:0,consts:[[3,"activate"]],template:function(i,n){i&1&&(h(0,"router-outlet",0),C("activate",function(){return n.onRouterChange()}),p())},dependencies:[L,U,Ut],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var St=(()=>{class o{constructor(){this.translate=c(X),this.data=c(Ir),this.noLabel=this.data.noCustomLabel??this.translate.instant("common.no"),this.yesLabel=this.data.yesCustomLabel??this.translate.instant("common.yes")}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-dialog"]],decls:10,vars:5,consts:[[1,"dialog-content"],["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","align","end"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"]],template:function(i,n){i&1&&(h(0,"div",0)(1,"h1",1),m(2),p(),h(3,"div",2),m(4),p(),h(5,"div",3)(6,"button",4),m(7),p(),h(8,"button",5),m(9),p()()()),i&2&&(l(2),f(n.data.title),l(2),f(n.data.message),l(3),f(n.noLabel),l(),y("mat-dialog-close",!0),l(),f(n.yesLabel))},dependencies:[Vr,Rr,Ar,Fr,Lr,L,ne],styles:[".dialog-content[_ngcontent-%COMP%]{max-width:400px}.dialog-content[_ngcontent-%COMP%]   .mat-mdc-dialog-content[_ngcontent-%COMP%]{padding-bottom:0}"],changeDetection:0})}}return o})();function ua(o,t){if(o&1){let e=G();h(0,"button",0),C("click",function(){T(e);let n=O();return I(n.navigateToProjectConfiguration())}),m(1),v(2,"translate"),p(),h(3,"button",1),m(4),v(5,"translate"),p(),h(6,"button",1),m(7),v(8,"translate"),p(),h(9,"button",2),C("click",function(){T(e);let n=O();return I(n.rejectProject())}),m(10),v(11,"translate"),p()}o&2&&(l(),f(b(2,4,"tool.config.menu.projectSettings")),l(3),f(b(5,6,"tool.config.menu.saveProject")),l(3),f(b(8,8,"tool.config.menu.loadProject")),l(3),f(b(11,10,"tool.config.menu.rejectProject")))}function ga(o,t){if(o&1){let e=G();h(0,"button",3),C("click",function(){T(e);let n=O();return I(n.navigateToProjectConfiguration())}),m(1),v(2,"translate"),p(),h(3,"button",1),m(4),v(5,"translate"),p(),h(6,"button",1),m(7),v(8,"translate"),p()}o&2&&(l(),f(b(2,3,"tool.config.menu.newProject")),l(3),f(b(5,5,"tool.config.menu.exampleProjects")),l(3),f(b(8,7,"tool.config.menu.loadProject")))}var zr=(()=>{class o{constructor(){this.store=c(A),this.translate=c(X),this.mosaicConfig=this.store.selectSignal(Ze),this.dialog=c(vt),this.router=c($),this.configService=c(It),this.destroyRef=c(K)}navigateToProjectConfiguration(){this.router.navigate(["/tool/config/project"])}rejectProject(){let e={title:this.translate.instant("tool.config.menu.rejectProject"),message:this.translate.instant("tool.config.menu.rejectProjectWarning")};this.dialog.open(St,{data:e}).afterClosed().pipe(W(this.destroyRef)).subscribe(i=>{i&&(this.store.dispatch(ue.projectCanceled()),this.configService.emitImageChange(null,!1))})}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-config-menu"]],decls:2,vars:1,consts:[["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","accent",3,"click"]],template:function(i,n){i&1&&te(0,ua,12,12)(1,ga,9,9),i&2&&ie(n.mosaicConfig()?0:1)},dependencies:[L,ne,U,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:10px}"],changeDetection:0})}}return o})();var fa=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-text-field-style-loader",""],decls:0,vars:0,template:function(i,n){},styles:[`textarea.cdk-textarea-autosize{resize:none}textarea.cdk-textarea-autosize-measuring{padding:2px 0 !important;box-sizing:content-box !important;height:auto !important;overflow:hidden !important}textarea.cdk-textarea-autosize-measuring-firefox{padding:2px 0 !important;box-sizing:content-box !important;height:0 !important}@keyframes cdk-text-field-autofill-start{/*!*/}@keyframes cdk-text-field-autofill-end{/*!*/}.cdk-text-field-autofill-monitored:-webkit-autofill{animation:cdk-text-field-autofill-start 0s 1ms}.cdk-text-field-autofill-monitored:not(:-webkit-autofill){animation:cdk-text-field-autofill-end 0s 1ms}
`],encapsulation:2,changeDetection:0})}return o})(),_a={passive:!0},$r=(()=>{class o{_platform=c(ft);_ngZone=c(xe);_renderer=c(pi).createRenderer(null,null);_styleLoader=c(qt);_monitoredElements=new Map;constructor(){}monitor(e){if(!this._platform.isBrowser)return Fo;this._styleLoader.load(fa);let i=Oe(e),n=this._monitoredElements.get(i);if(n)return n.subject;let r=new x,s="cdk-text-field-autofilled",a=g=>{g.animationName==="cdk-text-field-autofill-start"&&!i.classList.contains(s)?(i.classList.add(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!0}))):g.animationName==="cdk-text-field-autofill-end"&&i.classList.contains(s)&&(i.classList.remove(s),this._ngZone.run(()=>r.next({target:g.target,isAutofilled:!1})))},d=this._ngZone.runOutsideAngular(()=>(i.classList.add("cdk-text-field-autofill-monitored"),this._renderer.listen(i,"animationstart",a,_a)));return this._monitoredElements.set(i,{subject:r,unlisten:d}),r}stopMonitoring(e){let i=Oe(e),n=this._monitoredElements.get(i);n&&(n.unlisten(),n.subject.complete(),i.classList.remove("cdk-text-field-autofill-monitored"),i.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(i))}ngOnDestroy(){this._monitoredElements.forEach((e,i)=>this.stopMonitoring(i))}static \u0275fac=function(i){return new(i||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ur=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=$e({type:o});static \u0275inj=Ne({})}return o})();var Wr=new oe("MAT_INPUT_VALUE_ACCESSOR");var qr=(()=>{class o{isErrorState(e,i){return!!(e&&e.invalid&&(e.touched||i&&i.submitted))}static \u0275fac=function(i){return new(i||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var hn=class{_defaultMatcher;ngControl;_parentFormGroup;_parentForm;_stateChanges;errorState=!1;matcher;constructor(t,e,i,n,r){this._defaultMatcher=t,this.ngControl=e,this._parentFormGroup=i,this._parentForm=n,this._stateChanges=r}updateErrorState(){let t=this.errorState,e=this._parentFormGroup||this._parentForm,i=this.matcher||this._defaultMatcher,n=this.ngControl?this.ngControl.control:null,r=i?.isErrorState(n,e)??!1;r!==t&&(this.errorState=r,this._stateChanges.next())}};var va=["button","checkbox","file","hidden","image","radio","range","reset","submit"],ba=new oe("MAT_INPUT_CONFIG"),et=(()=>{class o{_elementRef=c(me);_platform=c(ft);ngControl=c(yr,{optional:!0,self:!0});_autofillMonitor=c($r);_ngZone=c(xe);_formField=c(dn,{optional:!0});_renderer=c(mi);_uid=c(Ke).getId("mat-input-");_previousNativeValue;_inputValueAccessor;_signalBasedValueAccessor;_previousPlaceholder;_errorStateTracker;_config=c(ba,{optional:!0});_cleanupIosKeyup;_cleanupWebkitWheel;_isServer;_isNativeSelect;_isTextarea;_isInFormField;focused=!1;stateChanges=new x;controlType="mat-input";autofilled=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=Yi(e),this.focused&&(this.focused=!1,this.stateChanges.next())}_disabled=!1;get id(){return this._id}set id(e){this._id=e||this._uid}_id;placeholder;name;get required(){return this._required??this.ngControl?.control?.hasValidator(Cr.required)??!1}set required(e){this._required=Yi(e)}_required;get type(){return this._type}set type(e){this._type=e||"text",this._validateType(),!this._isTextarea&&to().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}_type="text";get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(e){this._errorStateTracker.matcher=e}userAriaDescribedBy;get value(){return this._signalBasedValueAccessor?this._signalBasedValueAccessor.value():this._inputValueAccessor.value}set value(e){e!==this.value&&(this._signalBasedValueAccessor?this._signalBasedValueAccessor.value.set(e):this._inputValueAccessor.value=e,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(e){this._readonly=Yi(e)}_readonly=!1;disabledInteractive;get errorState(){return this._errorStateTracker.errorState}set errorState(e){this._errorStateTracker.errorState=e}_neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(e=>to().has(e));constructor(){let e=c(Sr,{optional:!0}),i=c(wr,{optional:!0}),n=c(qr),r=c(Wr,{optional:!0,self:!0}),s=this._elementRef.nativeElement,a=s.nodeName.toLowerCase();r?Bi(r.value)?this._signalBasedValueAccessor=r:this._inputValueAccessor=r:this._inputValueAccessor=s,this._previousNativeValue=this.value,this.id=this.id,this._platform.IOS&&this._ngZone.runOutsideAngular(()=>{this._cleanupIosKeyup=this._renderer.listen(s,"keyup",this._iOSKeyupListener)}),this._errorStateTracker=new hn(n,this.ngControl,i,e,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=a==="select",this._isTextarea=a==="textarea",this._isInFormField=!!this._formField,this.disabledInteractive=this._config?.disabledInteractive||!1,this._isNativeSelect&&(this.controlType=s.multiple?"mat-native-select-multiple":"mat-native-select"),this._signalBasedValueAccessor&&ze(()=>{this._signalBasedValueAccessor.value(),this.stateChanges.next()})}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(e=>{this.autofilled=e.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._cleanupIosKeyup?.(),this._cleanupWebkitWheel?.()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(e){this._elementRef.nativeElement.focus(e)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(e){if(e!==this.focused){if(!this._isNativeSelect&&e&&this.disabled&&this.disabledInteractive){let i=this._elementRef.nativeElement;i.type==="number"?(i.type="text",i.setSelectionRange(0,0),i.type="number"):i.setSelectionRange(0,0)}this.focused=e,this.stateChanges.next()}}_onInput(){}_dirtyCheckNativeValue(){let e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}_dirtyCheckPlaceholder(){let e=this._getPlaceholder();if(e!==this._previousPlaceholder){let i=this._elementRef.nativeElement;this._previousPlaceholder=e,e?i.setAttribute("placeholder",e):i.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){va.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let e=this._elementRef.nativeElement.validity;return e&&e.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let e=this._elementRef.nativeElement,i=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&i&&i.label)}else return this.focused&&!this.disabled||!this.empty}get describedByIds(){return this._elementRef.nativeElement.getAttribute("aria-describedby")?.split(" ")||[]}setDescribedByIds(e){let i=this._elementRef.nativeElement;e.length?i.setAttribute("aria-describedby",e.join(" ")):i.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let e=this._elementRef.nativeElement;return this._isNativeSelect&&(e.multiple||e.size>1)}_iOSKeyupListener=e=>{let i=e.target;!i.value&&i.selectionStart===0&&i.selectionEnd===0&&(i.setSelectionRange(1,1),i.setSelectionRange(0,0))};_getReadonlyAttribute(){return this._isNativeSelect?null:this.readonly||this.disabled&&this.disabledInteractive?"true":null}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:21,hostBindings:function(i,n){i&1&&C("focus",function(){return n._focusChanged(!0)})("blur",function(){return n._focusChanged(!1)})("input",function(){return n._onInput()}),i&2&&(zt("id",n.id)("disabled",n.disabled&&!n.disabledInteractive)("required",n.required),Re("name",n.name||null)("readonly",n._getReadonlyAttribute())("aria-disabled",n.disabled&&n.disabledInteractive?"true":null)("aria-invalid",n.empty&&n.required?null:n.errorState)("aria-required",n.required)("id",n.id),z("mat-input-server",n._isServer)("mat-mdc-form-field-textarea-control",n._isInFormField&&n._isTextarea)("mat-mdc-form-field-input-control",n._isInFormField)("mat-mdc-input-disabled-interactive",n.disabledInteractive)("mdc-text-field__input",n._isInFormField)("mat-mdc-native-select-inline",n._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly",disabledInteractive:[2,"disabledInteractive","disabledInteractive",le]},exportAs:["matInput"],features:[de([{provide:Br,useExisting:o}]),Nt]})}return o})(),tt=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=$e({type:o});static \u0275inj=Ne({imports:[Le,Le,Ur,Wt]})}return o})();function Ca(o,t){if(o&1){let e=G();h(0,"div",1)(1,"button",2),C("click",function(){T(e);let n=O();return I(n.action())}),m(2),p()()}if(o&2){let e=O();l(2),D(" ",e.data.action," ")}}var ya=["label"];function Sa(o,t){}var wa=Math.pow(2,31)-1,vi=class{_overlayRef;instance;containerInstance;_afterDismissed=new x;_afterOpened=new x;_onAction=new x;_durationTimeoutId;_dismissedByAction=!1;constructor(t,e){this._overlayRef=e,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,wa))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},Gr=new oe("MatSnackBarData"),Jt=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},xa=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return o})(),Ma=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return o})(),Pa=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return o})(),Ea=(()=>{class o{snackBarRef=c(vi);data=c(Gr);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(i,n){i&1&&(h(0,"div",0),m(1),p(),te(2,Ca,3,1,"div",1)),i&2&&(l(),D(" ",n.data.message,`
`),l(),ie(n.hasAction?2:-1))},dependencies:[ne,xa,Ma,Pa],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return o})(),ao="_mat-snack-bar-enter",lo="_mat-snack-bar-exit",Da=(()=>{class o extends cr{_ngZone=c(xe);_elementRef=c(me);_changeDetectorRef=c(Ge);_platform=c(ft);_animationsDisabled=Kt();snackBarConfig=c(Jt);_document=c(Bt);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=c(He);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new x;_onExit=new x;_onEnter=new x;_animationState="void";_live;_label;_role;_liveElementId=c(Ke).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();let i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}attachDomPortal=e=>{this._assertNotAttached();let i=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),i};onAnimationEnd(e){e===lo?this._completeExit():e===ao&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?Pt(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(ao)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(ao)},200)))}exit(){return this._destroyed?ci(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?Pt(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(lo)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(lo),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,i=this.snackBarConfig.panelClass;i&&(Array.isArray(i)?i.forEach(s=>e.classList.add(s)):e.classList.add(i)),this._exposeToModals();let n=this._label.nativeElement,r="mdc-snackbar__label";n.classList.toggle(r,!n.querySelector(`.${r}`))}_exposeToModals(){let e=this._liveElementId,i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let n=0;n<i.length;n++){let r=i[n],s=r.getAttribute("aria-owns");this._trackedModals.add(r),s?s.indexOf(e)===-1&&r.setAttribute("aria-owns",s+" "+e):r.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let i=e.getAttribute("aria-owns");if(i){let n=i.replace(this._liveElementId,"").trim();n.length>0?e.setAttribute("aria-owns",n):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,i=e.querySelector("[aria-hidden]"),n=e.querySelector("[aria-live]");if(i&&n){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(r=document.activeElement),i.removeAttribute("aria-hidden"),n.appendChild(i),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["mat-snack-bar-container"]],viewQuery:function(i,n){if(i&1&&(ut(oo,7),ut(ya,7)),i&2){let r;Ue(r=We())&&(n._portalOutlet=r.first),Ue(r=We())&&(n._label=r.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(i,n){i&1&&C("animationend",function(s){return n.onAnimationEnd(s.animationName)})("animationcancel",function(s){return n.onAnimationEnd(s.animationName)}),i&2&&z("mat-snack-bar-container-enter",n._animationState==="visible")("mat-snack-bar-container-exit",n._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!n._animationsDisabled)},features:[Wo],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(i,n){i&1&&(h(0,"div",1)(1,"div",2,0)(3,"div",3),ji(4,Sa,0,0,"ng-template",4),p(),w(5,"div"),p()()),i&2&&(l(5),Re("aria-live",n._live)("role",n._role)("id",n._liveElementId))},dependencies:[oo],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return o})(),Oa=new oe("mat-snack-bar-default-options",{providedIn:"root",factory:()=>new Jt}),it=(()=>{class o{_live=c(sr);_injector=c(He);_breakpointObserver=c(Zi);_parentSnackBar=c(o,{optional:!0,skipSelf:!0});_defaultConfig=c(Oa);_animationsDisabled=Kt();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=Ea;snackBarContainerComponent=Da;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i="",n){let r=M(M({},this._defaultConfig),n);return r.data={message:e,action:i},r.announcementMessage===e&&(r.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,r)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,i){let n=i&&i.viewContainerRef&&i.viewContainerRef.injector,r=He.create({parent:n||this._injector,providers:[{provide:Jt,useValue:i}]}),s=new no(this.snackBarContainerComponent,i.viewContainerRef,r),a=e.attach(s);return a.instance.snackBarConfig=i,a.instance}_attach(e,i){let n=M(M(M({},new Jt),this._defaultConfig),i),r=this._createOverlay(n),s=this._attachSnackBarContainer(r,n),a=new vi(s,r);if(e instanceof hi){let d=new en(e,null,{$implicit:n.data,snackBarRef:a});a.instance=s.attachTemplatePortal(d)}else{let d=this._createInjector(n,a),g=new no(e,void 0,d),_=s.attachComponentPortal(g);a.instance=_.instance}return this._breakpointObserver.observe(Ji.HandsetPortrait).pipe(Mt(r.detachments())).subscribe(d=>{r.overlayElement.classList.toggle(this.handsetCssClass,d.matches)}),n.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(n.announcementMessage,n.politeness)}),this._animateSnackBar(a,n),this._openedSnackBarRef=a,this._openedSnackBarRef}_animateSnackBar(e,i){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),i.announcementMessage&&this._live.clear()}),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let i=new tn;i.direction=e.direction;let n=pr(this._injector),r=e.direction==="rtl",s=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!r||e.horizontalPosition==="end"&&r,a=!s&&e.horizontalPosition!=="center";return s?n.left("0"):a?n.right("0"):n.centerHorizontally(),e.verticalPosition==="top"?n.top("0"):n.bottom("0"),i.positionStrategy=n,i.disableAnimations=this._animationsDisabled,nn(this._injector,i)}_createInjector(e,i){let n=e&&e.viewContainerRef&&e.viewContainerRef.injector;return He.create({parent:n||this._injector,providers:[{provide:vi,useValue:i},{provide:Gr,useValue:e.data}]})}static \u0275fac=function(i){return new(i||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Fe=class{static getFieldErrorLabel(t,e){return this.getErrorLabel(t.errors(),e)}static getErrorLabel(t,e){for(let{kind:i}of t)if(i in e)return e[i]();return null}};var Kr=1,Zr=1e3,Xr=(()=>{class o{constructor(){this.snackBar=c(it),this.router=c($),this.configService=c(It),this.store=c(A),this.translate=c(X),this.mosaicConfig=this.store.selectSignal(Ze),this.isReadOnlyMode=Z(()=>!!this.mosaicConfig()),this.errorLabels={min:()=>this.translate.instant("tool.config.project.mosaicMinWidthErrorMessage",{width:Kr}),max:()=>this.translate.instant("tool.config.project.mosaicMaxWidthErrorMessage",{width:Zr}),required:()=>this.translate.instant("tool.config.project.mosaicWidthRequiredErrorMessage")},this.formData=P({mosaicWidth:this.mosaicConfig()?.mosaicWidth??100,mosaicImage:null}),this.form=bt(this.formData,e=>{H(e.mosaicWidth),Ae(e.mosaicWidth,Kr),Tt(e.mosaicWidth,Zr),jr(e.mosaicWidth,()=>this.isReadOnlyMode()),H(e.mosaicImage)}),this.formValueChangedEffect=ze(()=>{if(this.form().valid()){let e=new FileReader;e.readAsDataURL(this.form.mosaicImage().value()),e.onload=i=>{this.configService.emitImageChange({base64Image:i?.target?.result,mosaicWidth:this.form.mosaicWidth().value()},!0)}}else this.configService.emitImageChange(null,!1)})}navigateToConfiguration(){this.router.navigate(["/tool/config"])}trySave(){if(this.form().valid())this.save();else{let e=this.getErrorMessage();this.snackBar.open(e,this.translate.instant("common.ok"),{duration:2e3})}}save(){let e=this.formData(),i=new FileReader;i.readAsDataURL(e.mosaicImage),i.onload=n=>{let s={config:{base64Image:n?.target?.result,mosaicWidth:e.mosaicWidth},tilesSets:[],sectors:[]};this.createNewProject(s),this.snackBar.open(this.translate.instant("tool.config.project.projectCreated"),this.translate.instant("common.ok"),{duration:2e3}),this.navigateToConfiguration()}}createNewProject(e){this.store.dispatch(ue.projectCreated({project:e}))}getErrorMessage(){if(this.form.mosaicImage().valid()){if(!this.form.mosaicWidth().valid())return this.getFieldErrorLabel(this.form.mosaicWidth())}else return this.translate.instant("tool.config.project.selectImageErrorMessage");return null}getFieldErrorLabel(e){return Fe.getFieldErrorLabel(e,this.errorLabels)}onImageSelected(e){let n=e.target.files?.item(0);this.formData.update(r=>ae(M({},r),{mosaicImage:n}))}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-config-project"]],decls:23,vars:21,consts:[["imageUploader",""],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click","hidden"],[1,"form"],["hidden","","type","file","accept",".jpg, .png, .jpeg, .gif, .bmp, .tif, .tiff|image/*",3,"change"],["mat-flat-button","","type","button",3,"click","color","hidden"],[1,"density-3"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(i,n){if(i&1){let r=G();h(0,"div",1)(1,"button",2),C("click",function(){return T(r),I(n.navigateToConfiguration())}),m(2),v(3,"translate"),p(),h(4,"button",3),C("click",function(){return T(r),I(n.trySave())}),m(5),v(6,"translate"),p()(),h(7,"form",4)(8,"input",5,0),C("change",function(a){return T(r),I(n.onImageSelected(a))}),p(),h(10,"button",6),C("click",function(){T(r);let a=Pe(9);return I(a.click())}),m(11),v(12,"translate"),p(),h(13,"mat-form-field",7)(14,"mat-label"),m(15),v(16,"translate"),p(),w(17,"input",8),V(),h(18,"span",9),m(19),v(20,"translate"),p(),h(21,"mat-error"),m(22),p()()()}i&2&&(l(2),D(" ",b(3,11,"common.return")," "),l(2),y("hidden",n.isReadOnlyMode()),l(),D(" ",b(6,13,"common.confirm")," "),l(5),y("color",n.form.mosaicImage().valid()?"":"accent")("hidden",n.isReadOnlyMode()),l(),D(" ",b(12,15,n.form.mosaicImage().valid()?"tool.config.project.changeImage":"tool.config.project.chooseImage")," "),l(4),f(b(16,17,"tool.config.project.mosaicWidth")),l(2),j(n.form.mosaicWidth),l(2),f(b(20,19,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.mosaicWidth())))},dependencies:[U,L,ne,Le,Qe,Ye,yt,cn,tt,et,Ct,Y],styles:[".actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;margin-top:20px}"],changeDetection:0})}}return o})();var ei=class extends _t{constructor(t,e){super(),this.vertices=t,this.hexColor=e}drawObject(t,e){t.beginPath();let i=e.getViewportPosition(this.vertices[0]);t.moveTo(i.x,i.y);for(let n=1;n<this.vertices.length;++n)i=e.getViewportPosition(this.vertices[n]),t.lineTo(i.x,i.y);t.closePath(),t.fillStyle=this.hexColor,t.fill()}getOrder(){return 100}};var ka=Math.PI/180;function Ta(o,t,e){e*=ka;let i=Math.cos(e)*(o.x-t.x)-Math.sin(e)*(o.y-t.y)+t.x,n=Math.sin(e)*(o.x-t.x)+Math.cos(e)*(o.y-t.y)+t.y;return new R(i,n)}function mn(o,t,e=0,i=1){return o.map(n=>Ta(n,R.zero,e).multiply(i).add(t))}var Yr=(()=>{class o{static drawTiles(e,i){let n=this.sortAndMapTilesBySize(e),r=this.getTreeMapChartArray(n),s={width:r.size.width,height:r.size.height,x:-r.size.width/2,y:-r.size.height/2};this.drawChart(r,s,i)}static drawChart(e,i,n){if(e.type==="group"){let r=e.left.size.width+e.right.size.width,s=e.left.size.height+e.right.size.height;this.drawChart(e.left,{x:i.x,y:i.y,width:i.width*(e.split==="horizontal"?e.left.size.width/r:1),height:i.height*(e.split==="horizontal"?1:e.left.size.height/s)},n),this.drawChart(e.right,{x:i.x+(e.split==="horizontal"?i.width*(e.left.size.width/r):0),y:i.y+(e.split==="horizontal"?0:i.height*(e.left.size.height/s)),width:i.width*(e.split==="horizontal"?e.right.size.width/r:1),height:i.height*(e.split==="horizontal"?1:e.right.size.height/s)},n)}else{let r=mn(e.value.vertices,new R(i.x+i.width/2,i.y+i.height/2),0),s=new ei(r,e.value.color);n.addCanvasObject(s)}}static getTreeMapChartArray(e){if(e.length>1){let i=this.splitTileArrayInHalf(e),n=this.getTreeMapChartArray(i[0]),r=this.getTreeMapChartArray(i[1]),s=(n.size.height+r.size.height)*1.5<n.size.width+r.size.width?"vertical":"horizontal";return{type:"group",split:s,size:{width:s==="horizontal"?n.size.width+r.size.width:Math.max(n.size.width,r.size.width),height:s==="horizontal"?Math.max(n.size.height,r.size.height):n.size.height+r.size.height},left:n,right:r}}else return{type:"leaf",size:this.getTileSize(e[0].tile),value:e[0].tile}}static sortAndMapTilesBySize(e){return e.map(i=>{let n=this.getTileSize(i),r=n.height*n.height+n.width*n.width;return{tile:i,size:n,radius:r}}).sort((i,n)=>n.radius-i.radius)}static splitTileArrayInHalf(e){let n=e.reduce((a,d)=>a+d.size.width,0)/2,r=e.length-1,s=e[r].size.width;for(let a=e.length-2;a>0;a--){let d=e[a];if(s+=d.size.width,s>n){r=a;break}}return[e.slice(0,r),e.slice(r)]}static getTileSize(e){return{width:Math.max(...e.vertices.map(i=>i.x))-Math.min(...e.vertices.map(i=>i.x)),height:Math.max(...e.vertices.map(i=>i.y))-Math.min(...e.vertices.map(i=>i.y))}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac})}}return o})();var Qr=(()=>{class o{constructor(){this.store=c(A),this.destroyRef=c(K),this.toolService=c(be),this.tilesSets$=this.store.select(Xe)}ngAfterViewInit(){queueMicrotask(()=>this.subscribeOnTilesSetsChange())}subscribeOnTilesSetsChange(){this.tilesSets$.pipe(W(this.destroyRef)).subscribe(e=>this.drawTiles(e.flatMap(i=>i.tiles)))}sectionEntered(e){return this.activeCanvas=e,{ribbon:[{iconName:"crop",visibility:P("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")}]}}drawTiles(e){this.activeCanvas.removeObjects(),e.length&&Yr.drawTiles(e,this.activeCanvas),this.activeCanvas.redraw()}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tray"]],decls:1,vars:0,template:function(i,n){i&1&&w(0,"router-outlet")},dependencies:[Ut],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var un="/tool";var gn=()=>c(A).selectSignal(kr)()?!0:(c($).navigate([un]),!1);var Ra=["text"],Aa=[[["mat-icon"]],"*"],La=["mat-icon","*"];function Fa(o,t){if(o&1&&w(0,"mat-pseudo-checkbox",1),o&2){let e=O();y("disabled",e.disabled)("state",e.selected?"checked":"unchecked")}}function Va(o,t){if(o&1&&w(0,"mat-pseudo-checkbox",3),o&2){let e=O();y("disabled",e.disabled)}}function ja(o,t){if(o&1&&(h(0,"span",4),m(1),p()),o&2){let e=O();l(),D("(",e.group.label,")")}}var ho=new oe("MAT_OPTION_PARENT_COMPONENT"),po=new oe("MatOptgroup");var bi=class{source;isUserInput;constructor(t,e=!1){this.source=t,this.isUserInput=e}},ti=(()=>{class o{_element=c(me);_changeDetectorRef=c(Ge);_parent=c(ho,{optional:!0});group=c(po,{optional:!0});_signalDisableRipple=!1;_selected=!1;_active=!1;_mostRecentViewValue="";get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}value;id=c(Ke).getId("mat-option-");get disabled(){return this.group&&this.group.disabled||this._disabled()}set disabled(e){this._disabled.set(e)}_disabled=P(!1);get disableRipple(){return this._signalDisableRipple?this._parent.disableRipple():!!this._parent?.disableRipple}get hideSingleSelectionIndicator(){return!!(this._parent&&this._parent.hideSingleSelectionIndicator)}onSelectionChange=new re;_text;_stateChanges=new x;constructor(){let e=c(qt);e.load(vr),e.load(ir),this._signalDisableRipple=!!this._parent&&Bi(this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._text?.nativeElement.textContent||"").trim()}select(e=!0){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}deselect(e=!0){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),e&&this._emitSelectionChangeEvent())}focus(e,i){let n=this._getHostElement();typeof n.focus=="function"&&n.focus(i)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!Gt(e)&&(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=this.multiple?!this._selected:!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){let e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue&&this._stateChanges.next(),this._mostRecentViewValue=e)}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new bi(this,e))}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["mat-option"]],viewQuery:function(i,n){if(i&1&&ut(Ra,7),i&2){let r;Ue(r=We())&&(n._text=r.first)}},hostAttrs:["role","option",1,"mat-mdc-option","mdc-list-item"],hostVars:11,hostBindings:function(i,n){i&1&&C("click",function(){return n._selectViaInteraction()})("keydown",function(s){return n._handleKeydown(s)}),i&2&&(zt("id",n.id),Re("aria-selected",n.selected)("aria-disabled",n.disabled.toString()),z("mdc-list-item--selected",n.selected)("mat-mdc-option-multiple",n.multiple)("mat-mdc-option-active",n.active)("mdc-list-item--disabled",n.disabled))},inputs:{value:"value",id:"id",disabled:[2,"disabled","disabled",le]},outputs:{onSelectionChange:"onSelectionChange"},exportAs:["matOption"],ngContentSelectors:La,decls:8,vars:5,consts:[["text",""],["aria-hidden","true",1,"mat-mdc-option-pseudo-checkbox",3,"disabled","state"],[1,"mdc-list-item__primary-text"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"cdk-visually-hidden"],["aria-hidden","true","mat-ripple","",1,"mat-mdc-option-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled"]],template:function(i,n){i&1&&(mt(Aa),te(0,Fa,1,2,"mat-pseudo-checkbox",1),st(1),h(2,"span",2,0),st(4,1),p(),te(5,Va,1,1,"mat-pseudo-checkbox",3),te(6,ja,2,1,"span",4),w(7,"div",5)),i&2&&(ie(n.multiple?0:-1),l(5),ie(!n.multiple&&n.selected&&!n.hideSingleSelectionIndicator?5:-1),l(),ie(n.group&&n.group._inert?6:-1),l(),y("matRippleTrigger",n._getHostElement())("matRippleDisabled",n.disabled||n.disableRipple))},dependencies:[xr,_r],styles:[`.mat-mdc-option{-webkit-user-select:none;user-select:none;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;display:flex;position:relative;align-items:center;justify-content:flex-start;overflow:hidden;min-height:48px;padding:0 16px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);color:var(--mat-option-label-text-color, var(--mat-sys-on-surface));font-family:var(--mat-option-label-text-font, var(--mat-sys-label-large-font));line-height:var(--mat-option-label-text-line-height, var(--mat-sys-label-large-line-height));font-size:var(--mat-option-label-text-size, var(--mat-sys-body-large-size));letter-spacing:var(--mat-option-label-text-tracking, var(--mat-sys-label-large-tracking));font-weight:var(--mat-option-label-text-weight, var(--mat-sys-body-large-weight))}.mat-mdc-option:hover:not(.mdc-list-item--disabled){background-color:var(--mat-option-hover-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-hover-state-layer-opacity) * 100%), transparent))}.mat-mdc-option:focus.mdc-list-item,.mat-mdc-option.mat-mdc-option-active.mdc-list-item{background-color:var(--mat-option-focus-state-layer-color, color-mix(in srgb, var(--mat-sys-on-surface) calc(var(--mat-sys-focus-state-layer-opacity) * 100%), transparent));outline:0}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover){background-color:var(--mat-option-selected-state-layer-color, var(--mat-sys-secondary-container))}.mat-mdc-option.mdc-list-item--selected:not(.mdc-list-item--disabled):not(.mat-mdc-option-active,.mat-mdc-option-multiple,:focus,:hover) .mdc-list-item__primary-text{color:var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option .mat-pseudo-checkbox{--mat-pseudo-checkbox-minimal-selected-checkmark-color: var(--mat-option-selected-state-label-text-color, var(--mat-sys-on-secondary-container))}.mat-mdc-option.mdc-list-item{align-items:center;background:rgba(0,0,0,0)}.mat-mdc-option.mdc-list-item--disabled{cursor:default;pointer-events:none}.mat-mdc-option.mdc-list-item--disabled .mat-mdc-option-pseudo-checkbox,.mat-mdc-option.mdc-list-item--disabled .mdc-list-item__primary-text,.mat-mdc-option.mdc-list-item--disabled>mat-icon{opacity:.38}.mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:32px}[dir=rtl] .mat-mdc-optgroup .mat-mdc-option:not(.mat-mdc-option-multiple){padding-left:16px;padding-right:32px}.mat-mdc-option .mat-icon,.mat-mdc-option .mat-pseudo-checkbox-full{margin-right:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-icon,[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-full{margin-right:0;margin-left:16px}.mat-mdc-option .mat-pseudo-checkbox-minimal{margin-left:16px;flex-shrink:0}[dir=rtl] .mat-mdc-option .mat-pseudo-checkbox-minimal{margin-right:16px;margin-left:0}.mat-mdc-option .mat-mdc-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-mdc-option .mdc-list-item__primary-text{white-space:normal;font-size:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;font-family:inherit;text-decoration:inherit;text-transform:inherit;margin-right:auto}[dir=rtl] .mat-mdc-option .mdc-list-item__primary-text{margin-right:0;margin-left:auto}@media(forced-colors: active){.mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .mat-mdc-option.mdc-list-item--selected:not(:has(.mat-mdc-option-pseudo-checkbox))::after{right:auto;left:16px}}.mat-mdc-option-multiple{--mat-list-list-item-selected-container-color: var(--mat-list-list-item-container-color, transparent)}.mat-mdc-option-active .mat-focus-indicator::before{content:""}
`],encapsulation:2,changeDetection:0})}return o})();function Jr(o,t,e){if(e.length){let i=t.toArray(),n=e.toArray(),r=0;for(let s=0;s<o+1;s++)i[s].group&&i[s].group===n[r]&&r++;return r}return 0}function es(o,t,e,i){return o<e?o:o+t>e+i?Math.max(0,o-i+t):e}var mo=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=$e({type:o});static \u0275inj=Ne({imports:[Pr,Mr,ti,Wt]})}return o})();var Ha=["panel"],za=["*"];function $a(o,t){if(o&1&&(Et(0,"div",1,0),st(2),Dt()),o&2){let e=t.id,i=O();Go(i._classList),z("mat-mdc-autocomplete-visible",i.showPanel)("mat-mdc-autocomplete-hidden",!i.showPanel)("mat-autocomplete-panel-animations-enabled",!i._animationsDisabled)("mat-primary",i._color==="primary")("mat-accent",i._color==="accent")("mat-warn",i._color==="warn"),zt("id",i.id),Re("aria-label",i.ariaLabel||null)("aria-labelledby",i._getPanelAriaLabelledby(e))}}var uo=class{source;option;constructor(t,e){this.source=t,this.option=e}},ns=new oe("mat-autocomplete-default-options",{providedIn:"root",factory:()=>({autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1,hasBackdrop:!1})}),os=(()=>{class o{_changeDetectorRef=c(Ge);_elementRef=c(me);_defaults=c(ns);_animationsDisabled=Kt();_activeOptionChanges=je.EMPTY;_keyManager;showPanel=!1;get isOpen(){return this._isOpen&&this.showPanel}_isOpen=!1;_latestOpeningTrigger;_setColor(e){this._color=e,this._changeDetectorRef.markForCheck()}_color;template;panel;options;optionGroups;ariaLabel;ariaLabelledby;displayWith=null;autoActiveFirstOption;autoSelectActiveOption;requireSelection;panelWidth;disableRipple;optionSelected=new re;opened=new re;closed=new re;optionActivated=new re;set classList(e){this._classList=e,this._elementRef.nativeElement.className=""}_classList;get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_hideSingleSelectionIndicator;_syncParentProperties(){if(this.options)for(let e of this.options)e._changeDetectorRef.markForCheck()}id=c(Ke).getId("mat-autocomplete-");inertGroups;constructor(){let e=c(ft);this.inertGroups=e?.SAFARI||!1,this.autoActiveFirstOption=!!this._defaults.autoActiveFirstOption,this.autoSelectActiveOption=!!this._defaults.autoSelectActiveOption,this.requireSelection=!!this._defaults.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new ar(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options?.length,this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){let i=new uo(this,e);this.optionSelected.emit(i)}_getPanelAriaLabelledby(e){if(this.ariaLabel)return null;let i=e?e+" ":"";return this.ariaLabelledby?i+this.ariaLabelledby:e}_skipPredicate(){return!1}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["mat-autocomplete"]],contentQueries:function(i,n,r){if(i&1&&(Qn(r,ti,5),Qn(r,po,5)),i&2){let s;Ue(s=We())&&(n.options=s),Ue(s=We())&&(n.optionGroups=s)}},viewQuery:function(i,n){if(i&1&&(ut(hi,7),ut(Ha,5)),i&2){let r;Ue(r=We())&&(n.template=r.first),Ue(r=We())&&(n.panel=r.first)}},hostAttrs:[1,"mat-mdc-autocomplete"],inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:[2,"autoActiveFirstOption","autoActiveFirstOption",le],autoSelectActiveOption:[2,"autoSelectActiveOption","autoSelectActiveOption",le],requireSelection:[2,"requireSelection","requireSelection",le],panelWidth:"panelWidth",disableRipple:[2,"disableRipple","disableRipple",le],classList:[0,"class","classList"],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",le]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[de([{provide:ho,useExisting:o}])],ngContentSelectors:za,decls:1,vars:0,consts:[["panel",""],["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id"]],template:function(i,n){i&1&&(mt(),qo(0,$a,3,17,"ng-template"))},styles:[`div.mat-mdc-autocomplete-panel{width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;box-sizing:border-box;position:relative;border-radius:var(--mat-autocomplete-container-shape, var(--mat-sys-corner-extra-small));box-shadow:var(--mat-autocomplete-container-elevation-shadow, 0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12));background-color:var(--mat-autocomplete-background-color, var(--mat-sys-surface-container))}@media(forced-colors: active){div.mat-mdc-autocomplete-panel{outline:solid 1px}}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden,.cdk-overlay-pane:has(>.mat-mdc-autocomplete-hidden){visibility:hidden;pointer-events:none}@keyframes _mat-autocomplete-enter{from{opacity:0;transform:scaleY(0.8)}to{opacity:1;transform:none}}.mat-autocomplete-panel-animations-enabled{animation:_mat-autocomplete-enter 120ms cubic-bezier(0, 0, 0.2, 1)}mat-autocomplete{display:none}
`],encapsulation:2,changeDetection:0})}return o})();var Ua={provide:on,useExisting:Fi(()=>go),multi:!0};var Wa=new oe("mat-autocomplete-scroll-strategy",{providedIn:"root",factory:()=>{let o=c(He);return()=>dr(o)}}),go=(()=>{class o{_environmentInjector=c(zo);_element=c(me);_injector=c(He);_viewContainerRef=c(Vi);_zone=c(xe);_changeDetectorRef=c(Ge);_dir=c(gi,{optional:!0});_formField=c(dn,{optional:!0,host:!0});_viewportRuler=c(Qi);_scrollStrategy=c(Wa);_renderer=c(mi);_animationsDisabled=Kt();_defaults=c(ns,{optional:!0});_overlayRef;_portal;_componentDestroyed=!1;_initialized=new x;_keydownSubscription;_outsideClickSubscription;_cleanupWindowBlur;_previousValue;_valueOnAttach;_valueOnLastKeydown;_positionStrategy;_manuallyFloatingLabel=!1;_closingActionsSubscription;_viewportSubscription=je.EMPTY;_breakpointObserver=c(Zi);_handsetLandscapeSubscription=je.EMPTY;_canOpenOnNextFocus=!0;_valueBeforeAutoSelection;_pendingAutoselectedOption;_closeKeyEventStream=new x;_overlayPanelClass=Ki(this._defaults?.overlayPanelClass||[]);_windowBlurHandler=()=>{this._canOpenOnNextFocus=this.panelOpen||!this._hasFocus()};_onChange=()=>{};_onTouched=()=>{};autocomplete;position="auto";connectedTo;autocompleteAttribute="off";autocompleteDisabled;constructor(){}_aboveClass="mat-mdc-autocomplete-panel-above";ngAfterViewInit(){this._initialized.next(),this._initialized.complete(),this._cleanupWindowBlur=this._renderer.listen("window","blur",this._windowBlurHandler)}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){this._cleanupWindowBlur?.(),this._handsetLandscapeSubscription.unsubscribe(),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}_overlayAttached=!1;openPanel(){this._openPanelInternal()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._latestOpeningTrigger===this&&(this.autocomplete._isOpen=!1,this.autocomplete._latestOpeningTrigger=null),this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal&&Xi(this._trackedModal,"aria-owns",this.autocomplete.id))}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return ht(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Yn(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Yn(()=>this._overlayAttached)):ci()).pipe(Ai(e=>e instanceof bi?e:null))}optionSelections=Vo(()=>{let e=this.autocomplete?this.autocomplete.options:null;return e?e.changes.pipe(di(e),Vt(()=>ht(...e.map(i=>i.onSelectionChange)))):this._initialized.pipe(Vt(()=>this.optionSelections))});get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return new Ft(e=>{let i=r=>{let s=Ot(r),a=this._formField?this._formField.getConnectedOverlayOrigin().nativeElement:null,d=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;this._overlayAttached&&s!==this._element.nativeElement&&!this._hasFocus()&&(!a||!a.contains(s))&&(!d||!d.contains(s))&&this._overlayRef&&!this._overlayRef.overlayElement.contains(s)&&e.next(r)},n=[this._renderer.listen("document","click",i),this._renderer.listen("document","auxclick",i),this._renderer.listen("document","touchend",i)];return()=>{n.forEach(r=>r())}})}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){let i=e,n=i.keyCode,r=Gt(i);if(n===27&&!r&&i.preventDefault(),this._valueOnLastKeydown=this._element.nativeElement.value,this.activeOption&&n===13&&this.panelOpen&&!r)this.activeOption._selectViaInteraction(),this._resetActiveItem(),i.preventDefault();else if(this.autocomplete){let s=this.autocomplete._keyManager.activeItem,a=n===38||n===40;n===9||a&&!r&&this.panelOpen?this.autocomplete._keyManager.onKeydown(i):a&&this._canOpen()&&this._openPanelInternal(this._valueOnLastKeydown),(a||this.autocomplete._keyManager.activeItem!==s)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._valueOnLastKeydown),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let i=e.target,n=i.value;if(i.type==="number"&&(n=n==""?null:parseFloat(n)),this._previousValue!==n){if(this._previousValue=n,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(n),!n)this._clearPreviousSelectedOption(null,!1);else if(this.panelOpen&&!this.autocomplete.requireSelection){let r=this.autocomplete.options?.find(s=>s.selected);if(r){let s=this._getDisplayValue(r.value);n!==s&&r.deselect(!1)}}if(this._canOpen()&&this._hasFocus()){let r=this._valueOnLastKeydown??this._element.nativeElement.value;this._valueOnLastKeydown=null,this._openPanelInternal(r)}}}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(this._previousValue),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this._openPanelInternal()}_hasFocus(){return rr()===this._element.nativeElement}_floatLabel(e=!1){this._formField&&this._formField.floatLabel==="auto"&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){let e=new Ft(n=>{Pt(()=>{n.next()},{injector:this._environmentInjector})}),i=this.autocomplete.options?.changes.pipe(jt(()=>this._positionStrategy.reapplyLastPosition()),Bo(0))??ci();return ht(e,i).pipe(Vt(()=>this._zone.run(()=>{let n=this.panelOpen;return this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),n!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit()),this.panelClosingActions})),Li(1)).subscribe(n=>this._setValueAndClose(n))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_getDisplayValue(e){let i=this.autocomplete;return i&&i.displayWith?i.displayWith(e):e}_assignOptionValue(e){let i=this._getDisplayValue(e);e==null&&this._clearPreviousSelectedOption(null,!1),this._updateNativeInputValue(i??"")}_updateNativeInputValue(e){this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){let i=this.autocomplete,n=e?e.source:this._pendingAutoselectedOption;n?(this._clearPreviousSelectedOption(n),this._assignOptionValue(n.value),this._onChange(n.value),i._emitSelectEvent(n),this._element.nativeElement.focus()):i.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,i){this.autocomplete?.options?.forEach(n=>{n!==e&&n.selected&&n.deselect(i)})}_openPanelInternal(e=this._element.nativeElement.value){if(this._attachOverlay(e),this._floatLabel(),this._trackedModal){let i=this.autocomplete.id;eo(this._trackedModal,"aria-owns",i)}}_attachOverlay(e){if(!this.autocomplete)return;let i=this._overlayRef;i?(this._positionStrategy.setOrigin(this._getConnectedElement()),i.updateSize({width:this._getPanelWidth()})):(this._portal=new en(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),i=nn(this._injector,this._getOverlayConfig()),this._overlayRef=i,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&i&&i.updateSize({width:this._getPanelWidth()})}),this._handsetLandscapeSubscription=this._breakpointObserver.observe(Ji.HandsetLandscape).subscribe(r=>{r.matches?this._positionStrategy.withFlexibleDimensions(!0).withGrowAfterOpen(!0).withViewportMargin(8):this._positionStrategy.withFlexibleDimensions(!1).withGrowAfterOpen(!1).withViewportMargin(0)})),i&&!i.hasAttached()&&(i.attach(this._portal),this._valueOnAttach=e,this._valueOnLastKeydown=null,this._closingActionsSubscription=this._subscribeToClosingActions());let n=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._latestOpeningTrigger=this,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&n!==this.panelOpen&&this._emitOpened()}_handlePanelKeydown=e=>{(e.keyCode===27&&!Gt(e)||e.keyCode===38&&Gt(e,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),e.stopPropagation(),e.preventDefault())};_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){let e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new tn({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,hasBackdrop:this._defaults?.hasBackdrop,backdropClass:this._defaults?.backdropClass||"cdk-overlay-transparent-backdrop",panelClass:this._overlayPanelClass,disableAnimations:this._animationsDisabled})}_getOverlayPosition(){let e=hr(this._injector,this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1).withPopoverLocation("inline");return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){let i=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],n=this._aboveClass,r=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:n},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:n}],s;this.position==="above"?s=r:this.position==="below"?s=i:s=[...i,...r],e.withPositions(s)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){let e=this.autocomplete;if(e.autoActiveFirstOption){let i=-1;for(let n=0;n<e.options.length;n++)if(!e.options.get(n).disabled){i=n;break}e._keyManager.setActiveItem(i)}else e._keyManager.setActiveItem(-1)}_canOpen(){let e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_scrollToOption(e){let i=this.autocomplete,n=Jr(e,i.options,i.optionGroups);if(e===0&&n===1)i._setScrollTop(0);else if(i.panel){let r=i.options.toArray()[e];if(r){let s=r._getHostElement(),a=es(s.offsetTop,s.offsetHeight,i._getScrollTop(),i.panel.nativeElement.offsetHeight);i._setScrollTop(a)}}}_trackedModal=null;_applyModalPanelOwnership(){let e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;let i=this.autocomplete.id;this._trackedModal&&Xi(this._trackedModal,"aria-owns",i),eo(e,"aria-owns",i),this._trackedModal=e}_clearFromModal(){if(this._trackedModal){let e=this.autocomplete.id;Xi(this._trackedModal,"aria-owns",e),this._trackedModal=null}}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(i,n){i&1&&C("focusin",function(){return n._handleFocus()})("blur",function(){return n._onTouched()})("input",function(s){return n._handleInput(s)})("keydown",function(s){return n._handleKeydown(s)})("click",function(){return n._handleClick()}),i&2&&Re("autocomplete",n.autocompleteAttribute)("role",n.autocompleteDisabled?null:"combobox")("aria-autocomplete",n.autocompleteDisabled?null:"list")("aria-activedescendant",n.panelOpen&&n.activeOption?n.activeOption.id:null)("aria-expanded",n.autocompleteDisabled?null:n.panelOpen.toString())("aria-controls",n.autocompleteDisabled||!n.panelOpen||n.autocomplete==null?null:n.autocomplete.id)("aria-haspopup",n.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:[0,"matAutocomplete","autocomplete"],position:[0,"matAutocompletePosition","position"],connectedTo:[0,"matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:[0,"autocomplete","autocompleteAttribute"],autocompleteDisabled:[2,"matAutocompleteDisabled","autocompleteDisabled",le]},exportAs:["matAutocompleteTrigger"],features:[de([Ua]),Nt]})}return o})(),rs=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=$e({type:o});static \u0275inj=Ne({imports:[fi,mo,io,mo,Wt]})}return o})();var Ci=class{static calculateConvexityFactor(t){let e=this.calculatePolygonArea(t),i=this.calculatePolygonCircumference(t);return Math.sqrt(e)/i}static calculatePolygonArea(t){if(t.length<3)throw new Error("polygon should have at least 3 vertices");let e=t.at(-1).x*t[0].y,i=t.at(-1).y*t[0].x;for(let n=0,r=t.length-1;n<r;++n)e+=t[n].x*t[n+1].y,i+=t[n].y*t[n+1].x;return(e-i)/2}static calculatePolygonCircumference(t){let e=R.distance(t[0],t.at(-1));for(let i=1;i<t.length;++i)e+=R.distance(t[i],t[i-1]);return e}static calculatePolygonCentroid(t){let e=0,i=0,n=0,r=t.at(-1);for(let s of t){let a=s.y*r.x-s.x*r.y;n+=a,e+=(s.x+r.x)*a,i+=(s.y+r.y)*a,r=s}return n*=3,n==0?R.zero:new R(e/n,i/n)}static calculateOuterRadius(t){let e=0;for(let i of t){let n=R.distance(R.zero,i);n>e&&(e=n)}return e}};var lt=class{static nextInt(t,e){return Math.floor(Math.random()*(e-t+1)+t)}static nextFloat(t,e){return Math.random()*(e-t)+t}};var fn=class{constructor(t){this.imagePixelArray=t}generateTileSet(t,e){let i=[];for(let n=0;n<e;++n)i.push(this.generateTile(t));return i}generateTile(t){let e;do e=this.generateVertices(t);while(Ci.calculateConvexityFactor([...e].reverse())<.18);let i=this.rotatePolygonToHorizontal(e),n=Ci.calculatePolygonCentroid(i),r=this.normalizeVertices(i,n);return{id:crypto.randomUUID(),vertices:r,color:this.randomColor().hex()}}generateVertices(t){let e=lt.nextInt(4,6),i=[];for(let n=0;n<e;++n){let r=lt.nextFloat(t.min,t.max);i.push(this.generateVertex(n,e,r))}return i}generateVertex(t,e,i){let r=(360/e*t+lt.nextFloat(0,30))%360*Math.PI/180;return new R(Math.sin(r),Math.cos(r)).multiply(i)}randomColor(){let t=this.imagePixelArray.length/4,e=lt.nextInt(0,t-1);return pe({r:this.imagePixelArray[e*4],g:this.imagePixelArray[e*4+1],b:this.imagePixelArray[e*4+2]})}normalizeVertices(t,e){return t.map(i=>this.roundVertexCoords(i.sub(e)))}roundVertexCoords(t){return new R(Math.round((t.x+Number.EPSILON)*100)/100,Math.round((t.y+Number.EPSILON)*100)/100)}rotatePolygonToHorizontal(t){let e=0,i=t[0],n=t[1];for(let s=0;s<t.length;s++)for(let a=s+1;a<t.length;a++){let d=t[a].x-t[s].x,g=t[a].y-t[s].y,_=d*d+g*g;_>e&&(e=_,i=t[s],n=t[a])}let r=Math.atan2(n.y-i.y,n.x-i.x);return t.map(s=>{let a=s.x-i.x,d=s.y-i.y,g=a*Math.cos(-r)-d*Math.sin(-r),_=a*Math.sin(-r)+d*Math.cos(-r);return new R(g+i.x,_+i.y)})}};function Ga(o,t){if(o&1&&(h(0,"mat-option",7),m(1),p()),o&2){let e=t.$implicit,i=O();y("value",e)("disabled",i.immutableSeriesNames().includes(e)),l(),D(" ",e," ")}}var fo=(()=>{class o{constructor(){this.router=c($),this.route=c(gt),this.store=c(A),this.snackBar=c(it),this.translate=c(X),this.dialog=c(vt),this.tilesSetsSignal=this.store.selectSignal(Xe),this.existingSeriesNames=Z(()=>this.tilesSetsSignal().filter(e=>e.source==="generated").map(e=>e.name)),this.immutableSeriesNames=Z(()=>this.tilesSetsSignal().filter(e=>e.source!=="generated").map(e=>e.name)),this.errorLabels={min:()=>this.translate.instant("tool.tiles.random.radiusTooSmall"),max:()=>this.translate.instant("tool.tiles.random.radiusTooLarge"),required:()=>this.translate.instant("common.fieldRequired"),minGreaterThenMax:()=>this.translate.instant("tool.tiles.random.maxRadiusLargerThanMin"),cannotNowOverrideOtherTilesSet:()=>this.translate.instant("tool.tiles.random.cannotNowOverrideOtherTilesSet"),cannotOverrideTilesSet:()=>this.translate.instant("tool.tiles.random.cannotOverrideTilesSet")},this.formData=P({name:"",minRadius:null,maxRadius:null,count:null}),this.editedTilesSet=null,this.form=bt(this.formData,e=>{H(e.name),kt(e.name,({value:i})=>this.immutableSeriesNames().includes(i())?at({kind:"cannotOverrideTilesSet"}):null),kt(e.name,({value:i})=>this.editedTilesSet&&this.existingSeriesNames().some(r=>r===i()&&r!==this.editedTilesSet.name)?at({kind:"cannotNowOverrideOtherTilesSet"}):null),H(e.minRadius),Ae(e.minRadius,.01),Tt(e.minRadius,1e3),H(e.maxRadius),Ae(e.maxRadius,.01),Tt(e.maxRadius,1e3),kt(e.maxRadius,({value:i,valueOf:n})=>Number(i())<Number(n(e.minRadius))?at({kind:"minGreaterThenMax"}):null),H(e.count)})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&this.initFormForEditedTilesSet(e)}initFormForEditedTilesSet(e){let i=this.tilesSetsSignal().find(n=>n.id===e);this.isGeneratedTilesSet(i)&&(this.editedTilesSet=i,this.formData.set({name:i.name,count:i.tiles.length,minRadius:i.minRadius,maxRadius:i.maxRadius}))}getFieldErrorLabel(e){return Fe.getFieldErrorLabel(e,this.errorLabels)}trySaveTileSet(){ln(this.form,async()=>{let e=this.getIdOfEditedTilesSet();e?this.openWarningDialog().subscribe(async i=>{i&&await this.saveTileSet(e)}):await this.saveTileSet(null)})}getIdOfEditedTilesSet(){let{name:e}=this.formData();return this.editedTilesSet?.id??this.getTileSetByName(e)?.id??null}getTileSetByName(e){return this.existingSeriesNames().includes(e)?this.tilesSetsSignal().filter(i=>this.isGeneratedTilesSet(i)).find(i=>i.name===e):null}async saveTileSet(e){let i=this.formData(),n=new fn(await this.getImagePixelArray()),r={id:e??crypto.randomUUID(),name:i.name,source:"generated",tiles:n.generateTileSet({min:i.minRadius,max:i.maxRadius},i.count),minRadius:i.minRadius,maxRadius:i.maxRadius};this.snackBar.open(this.translate.instant("tool.tiles.random.tilesSeriesGenerated"),this.translate.instant("common.ok"),{duration:3e3}),this.store.dispatch(ue.tilesSetCommitted({tilesSet:r})),this.navigateToMenu()}async getImagePixelArray(){let e=this.store.selectSignal(Or)();return Tr.getImageSrcPixelArray(e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}isGeneratedTilesSet(e){return e.source==="generated"}openWarningDialog(){let e={title:this.translate.instant("common.warning"),message:this.translate.instant("tool.tiles.random.overrideTileSetWarning")};return this.dialog.open(St,{data:e}).afterClosed()}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-random-tiles"]],decls:46,vars:37,consts:[["auto","matAutocomplete"],[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"form"],["subscriptSizing","dynamic",1,"density-3"],["matInput","","type","text",3,"field","matAutocomplete"],[3,"value","disabled"],["matInput","","type","number",3,"field"],["matTextSuffix",""]],template:function(i,n){if(i&1){let r=G();h(0,"div",1)(1,"button",2),C("click",function(){return T(r),I(n.navigateToMenu())}),m(2),v(3,"translate"),p(),h(4,"button",3),C("click",function(){return T(r),I(n.trySaveTileSet())}),m(5),v(6,"translate"),p()(),h(7,"form",4)(8,"mat-form-field",5)(9,"mat-label"),m(10),v(11,"translate"),p(),w(12,"input",6),V(),h(13,"mat-autocomplete",null,0),fe(15,Ga,2,3,"mat-option",7,Ht),p(),h(17,"mat-error"),m(18),p()(),h(19,"mat-form-field",5)(20,"mat-label"),m(21),v(22,"translate"),p(),w(23,"input",8),V(),h(24,"span",9),m(25),v(26,"translate"),p(),h(27,"mat-error"),m(28),p()(),h(29,"mat-form-field",5)(30,"mat-label"),m(31),v(32,"translate"),p(),w(33,"input",8),V(),h(34,"span",9),m(35),v(36,"translate"),p(),h(37,"mat-error"),m(38),p()(),h(39,"mat-form-field",5)(40,"mat-label"),m(41),v(42,"translate"),p(),w(43,"input",8),V(),h(44,"mat-error"),m(45),p()()()}if(i&2){let r=Pe(14);l(2),D(" ",b(3,21,"common.return")," "),l(3),D(" ",b(6,23,"tool.tiles.random.randomTiles")," "),l(5),f(b(11,25,"tool.tiles.random.seriesName")),l(2),j(n.form.name),y("matAutocomplete",r),l(3),_e(n.existingSeriesNames()),l(3),f(n.getFieldErrorLabel(n.form.name())),l(3),f(b(22,27,"tool.tiles.random.minRadius")),l(2),j(n.form.minRadius),l(2),f(b(26,29,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.minRadius())),l(3),f(b(32,31,"tool.tiles.random.maxRadius")),l(2),j(n.form.maxRadius),l(2),f(b(36,33,"common.cm")),l(3),f(n.getFieldErrorLabel(n.form.maxRadius())),l(3),f(b(42,35,"tool.tiles.random.count")),l(2),j(n.form.count),l(2),f(n.getFieldErrorLabel(n.form.count()))}},dependencies:[Le,Qe,Ye,yt,cn,tt,et,U,L,ne,rs,os,ti,go,Ct,Y],styles:["[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px;gap:18px}"],changeDetection:0})}}return o})();var Ka=["*"],ii=(()=>{class o{constructor(){this.isOpen=se.required(),this.panelHeight=P(0),this.observer=new MutationObserver(()=>{this.panelHeight.set(this.elementRef.nativeElement.scrollHeight)}),this.elementRef=c(me),this.expandDuration=Z(()=>{let e=this.panelHeight(),i=150+Math.sqrt(e)*5;return this.isOpen()?i:i*.66})}ngOnInit(){this.observer.observe(this.elementRef.nativeElement,{attributeFilter:["scrollHeight"],subtree:!0,childList:!0})}ngOnDestroy(){this.observer.disconnect()}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-expandable-panel"]],hostVars:6,hostBindings:function(i,n){i&2&&(qe("--expand-duration",n.expandDuration()+"ms")("--panel-height",n.panelHeight()+"px"),z("open",n.isOpen()))},inputs:{isOpen:[1,"isOpen"]},ngContentSelectors:Ka,decls:1,vars:0,template:function(i,n){i&1&&(mt(),st(0))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden;max-height:0;transition:max-height var(--expand-duration, .3s) ease-out}.open[_nghost-%COMP%]{max-height:var(--panel-height, 1000px)}"],changeDetection:0})}}return o})();var as=(()=>{class o{constructor(){this.tile=se.required(),this.router=c($)}navigateToTileDetails(){this.router.navigate([`/tool/tray/tile/${this.tile().id}`])}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tile-list-elem"]],inputs:{tile:[1,"tile"]},decls:13,vars:5,consts:[["menu","matMenu"],[1,"label"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(i,n){if(i&1){let r=G();h(0,"span",1),m(1),p(),h(2,"div",2)(3,"button",3)(4,"mat-icon",4),m(5," more_vert "),p()(),h(6,"mat-menu",5,0)(8,"button",6),C("click",function(){return T(r),I(n.navigateToTileDetails())}),h(9,"mat-icon",7),m(10," page_info "),p(),m(11),v(12,"translate"),p()()()}if(i&2){let r=Pe(7);l(),D(" ",n.tile().id,`
`),l(2),y("matMenuTriggerFor",r),l(8),D(" ",b(12,3,"common.details")," ")}},dependencies:[De,Ee,L,ke,Qt,Xt,Zt,Yt,U,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.selected[_nghost-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px;margin-left:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}"],changeDetection:0})}}return o})();function Za(o,t){if(o&1){let e=G();h(0,"button",9),C("click",function(){T(e);let n=O();return I(n.navigateToRandomSetAgain())}),h(1,"mat-icon",10),m(2," shuffle "),p(),m(3),v(4,"translate"),p()}o&2&&(l(3),D(" ",b(4,1,"tool.tiles.menu.generateAgain")," "))}function Xa(o,t){if(o&1&&w(0,"app-tile-list-elem",12),o&2){let e=t.$implicit;y("tile",e)}}var ls=(()=>{class o{constructor(){this.tilesSet=se.required(),this.isOpen=P(!1),this.store=c(A),this.dialog=c(vt),this.translate=c(X),this.destroyRef=c(K),this.router=c($)}toggleTilesList(){this.isOpen.update(e=>!e)}removeTilesSet(){this.showRemoveTilesSetWarning().pipe(W(this.destroyRef)).subscribe(e=>{e&&this.store.dispatch(ue.tilesSetRemoved({removedTilesSet:this.tilesSet()}))})}showRemoveTilesSetWarning(){let e={title:this.translate.instant("tool.tiles.menu.removeTilesSet"),message:this.translate.instant("tool.tiles.menu.removeTilesSetQuery",{name:this.tilesSet().name})};return this.dialog.open(St,{data:e}).afterClosed()}navigateToRandomSetAgain(){this.router.navigate([`/tool/tray/random/${this.tilesSet().id}`])}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tiles-set-list-elem"]],inputs:{tilesSet:[1,"tilesSet"]},decls:21,vars:9,consts:[["menu","matMenu"],[1,"list-elem"],[1,"elem-actions"],["mat-icon-button","",1,"elem-action",3,"matMenuTriggerFor"],["matListIcon",""],["mat-icon-button","",1,"elem-action","toggle-action",3,"click"],[1,"chevron"],["classList","paddingless"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"],[1,"panel",3,"isOpen"],[3,"tile"]],template:function(i,n){if(i&1){let r=G();h(0,"div",1)(1,"span"),m(2),p(),h(3,"div",2)(4,"button",3)(5,"mat-icon",4),m(6," more_vert "),p()(),h(7,"button",5),C("click",function(){return T(r),I(n.toggleTilesList())}),h(8,"mat-icon",6),m(9," keyboard_arrow_up "),p()(),h(10,"mat-menu",7,0),te(12,Za,5,3,"button",8),h(13,"button",9),C("click",function(){return T(r),I(n.removeTilesSet())}),h(14,"mat-icon",10),m(15," delete "),p(),m(16),v(17,"translate"),p()()()(),h(18,"app-expandable-panel",11),fe(19,Xa,1,1,"app-tile-list-elem",12,pt),p()}if(i&2){let r=Pe(11),s=n.tilesSet();l(2),f(s.name),l(2),y("matMenuTriggerFor",r),l(4),z("chevron--closed",!n.isOpen()),l(4),ie(s.source==="generated"?12:-1),l(4),D(" ",b(17,7,"tool.tiles.menu.removeTilesSet")," "),l(2),y("isOpen",n.isOpen()),l(),_e(s.tiles.slice(0,100))}},dependencies:[ii,L,ke,De,Ee,Qt,Xt,Zt,Yt,as,U,Y],styles:["[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .list-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .elem-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:-6px}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .list-elem[_ngcontent-%COMP%]   .elem-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:first-child{margin-top:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:#666}"],changeDetection:0})}}return o})();function Ya(o,t){if(o&1&&w(0,"app-tiles-set-list-elem",4),o&2){let e=t.$implicit;y("tilesSet",e)}}function Qa(o,t){o&1&&(h(0,"span",5),m(1),v(2,"translate"),p()),o&2&&(l(),D(" ",b(2,1,"tool.tiles.menu.noTiles")," "))}var cs=(()=>{class o{constructor(){this.router=c($),this.store=c(A),this.tilesSets=this.store.selectSignal(Xe)}navigateToRandomTiles(){this.router.navigate(["/tool/tray/random"])}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tray-menu"]],decls:14,vars:10,consts:[[1,"actions"],["mat-flat-button","","color","accent","disabled",""],["mat-flat-button","","color","accent",3,"click"],[1,"tiles-sets"],[3,"tilesSet"],[1,"no-sets"]],template:function(i,n){i&1&&(h(0,"div",0)(1,"button",1),m(2),v(3,"translate"),p(),h(4,"button",1),m(5),v(6,"translate"),p(),h(7,"button",2),C("click",function(){return n.navigateToRandomTiles()}),m(8),v(9,"translate"),p()(),h(10,"div",3),fe(11,Ya,1,1,"app-tiles-set-list-elem",4,pt,!1,Qa,3,3,"span",5),p()),i&2&&(l(2),D(" ",b(3,4,"tool.tiles.menu.loadFromFile")," "),l(3),D(" ",b(6,6,"tool.tiles.menu.createTile")," "),l(3),D(" ",b(9,8,"tool.tiles.menu.randomTiles")," "),l(3),_e(n.tilesSets()))},dependencies:[L,ne,ls,U,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px;flex:1 1 0}[_nghost-%COMP%]   .tiles-sets[_ngcontent-%COMP%]   .no-sets[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}"],changeDetection:0})}}return o})();var Ja=["canvas"],ds=(()=>{class o{constructor(){this.value=ui(),this.valueChange=$t(),this.canvas=Ui.required("canvas"),this.cursorData=Z(()=>{let e=this.value(),i=this.canvas()?.nativeElement.getBoundingClientRect().width??1;return this.computeCursorData(e,i)}),this.destroyRef=c(K),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onSliderMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onSliderMouseInteraction(e)}}onSliderMouseInteraction(e){let i=this.canvas().nativeElement.getBoundingClientRect(),n=(e.clientX-i.x)/i.width;this.value.set(Math.max(0,Math.min(1,n))),this.valueChange.emit(this.value())}ngAfterViewInit(){this.drawSliderCanvas(),this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove)})}drawSliderCanvas(){let e=this.canvas().nativeElement.getContext("2d"),i={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},n=e.createLinearGradient(0,0,i.width,0),r=20;for(let s=0;s<=r;++s){let a=s*(1/r);n.addColorStop(a,pe({h:a*360,s:100,v:100}).hex())}e.fillStyle=n,e.fillRect(0,0,i.width,i.height)}computeCursorData(e,i){let n=i*e-8,r=pe({h:e*360,s:100,v:100}).hex();return{horizontalOffset:`${n}px`,color:r}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-slider"]],viewQuery:function(i,n){i&1&&Hi(n.canvas,Ja,5),i&2&&zi()},inputs:{value:[1,"value"]},outputs:{value:"valueChange",valueChange:"valueChange"},decls:3,vars:4,consts:[["canvas",""],["width","250","height","8",1,"slider"],[1,"cursor"]],template:function(i,n){if(i&1&&Ni(0,"canvas",1,0)(2,"div",2),i&2){let r=n.cursorData();l(2),qe("left",r.horizontalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{width:100%;position:relative;cursor:pointer}[_nghost-%COMP%]   .slider[_ngcontent-%COMP%]{display:block;width:100%;height:8px;border-radius:5px}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;top:-5px;pointer-events:none}"],changeDetection:0})}}return o})();var el=["canvas"],hs=(()=>{class o{constructor(){this.hValue=se(),this.sValue=ui(),this.vValue=ui(),this.colorChange=$t(),this.canvas=Ui.required("canvas"),this.cursorData=Z(()=>this.computeCursorData()),this.destroyRef=c(K),this.isDragging=!1,this.onMouseDown=e=>{this.isDragging=!0,document.body.style.cursor="pointer",this.onCanvasMouseInteraction(e)},this.onMouseUp=()=>{this.isDragging=!1,document.body.style.cursor=""},this.onMouseMove=e=>{this.isDragging&&this.onCanvasMouseInteraction(e)},ze(()=>this.drawColorCanvas())}onCanvasMouseInteraction(e){let i=this.canvas().nativeElement.getBoundingClientRect(),n=(e.clientX-i.x)/i.width,r=(e.clientY-i.y)/i.height;this.sValue.set(Math.min(1,Math.max(0,n))),this.vValue.set(Math.min(1,Math.max(0,1-r))),this.colorChange.emit(pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}))}ngAfterViewInit(){this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove),this.destroyRef.onDestroy(()=>{this.canvas().nativeElement.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove)})}drawColorCanvas(){let e={height:this.canvas().nativeElement.height,width:this.canvas().nativeElement.width},i=this.canvas().nativeElement.getContext("2d"),n=i.createLinearGradient(0,0,e.width,0);n.addColorStop(0,"#FFFFFF");let r=pe({h:this.hValue()*360,s:100,v:100}).hex();n.addColorStop(1,r);let s=i.createLinearGradient(0,0,0,e.height);s.addColorStop(0,"#00000000"),s.addColorStop(1,"#000000"),i.fillStyle=n,i.fillRect(0,0,e.width,e.height),i.fillStyle=s,i.fillRect(0,0,e.width,e.height)}computeCursorData(){let e=this.canvas().nativeElement.getBoundingClientRect(),i=e.width*this.sValue()-8,n=e.height*(1-this.vValue())-8;return{horizontalOffset:`${i}px`,verticalOffset:`${n}px`,color:pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex()}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-canvas"]],viewQuery:function(i,n){i&1&&Hi(n.canvas,el,5),i&2&&zi()},inputs:{hValue:[1,"hValue"],sValue:[1,"sValue"],vValue:[1,"vValue"]},outputs:{sValue:"sValueChange",vValue:"vValueChange",colorChange:"colorChange"},decls:3,vars:6,consts:[["canvas",""],["width","250","height","150",1,"panel"],[1,"cursor"]],template:function(i,n){if(i&1&&Ni(0,"canvas",1,0)(2,"div",2),i&2){let r=n.cursorData();l(2),qe("left",r.horizontalOffset)("top",r.verticalOffset)("background-color",r.color)}},styles:["[_nghost-%COMP%]{position:relative;cursor:pointer;overflow:hidden;display:block}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{display:block;width:100%}[_nghost-%COMP%]   .cursor[_ngcontent-%COMP%]{position:absolute;width:18px;height:18px;border-radius:50%;border:2px solid #ffffff;box-sizing:border-box;pointer-events:none}"],changeDetection:0})}}return o})();var il=/^#([0-9a-f]{3}){1,2}$/i,ps=(()=>{class o{constructor(){this.color=se.required({transform:e=>pe(e)}),this.colorChange=$t(),this.hValue=$i({source:this.color,computation:e=>e.hue()/360}),this.sValue=$i({source:this.color,computation:e=>e.saturationv()/100}),this.vValue=$i({source:this.color,computation:e=>e.value()/100}),this.hexColor=Z(()=>pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100}).hex())}ngOnDestroy(){let e=pe({h:this.hValue()*360,s:this.sValue()*100,v:this.vValue()*100});this.colorChange.emit(e)}onHexCodeChange(e){let i=e.currentTarget;if(il.test(i.value)){let n=pe(i.value);this.hValue.set(n.hue()/360),this.sValue.set(n.saturationv()/100),this.vValue.set(n.value()/100)}}onColorCanvasChanged(e){this.sValue.set(e.saturationv()/100),this.vValue.set(e.value()/100)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-selection-panel"]],inputs:{color:[1,"color"]},outputs:{colorChange:"colorChange"},decls:10,vars:7,consts:[[1,"sv-preview"],[3,"colorChange","hValue","sValue","vValue"],[1,"slider-container"],[3,"valueChange","value"],[1,"result-wrapper"],["role","presentation",1,"color-preview"],[1,"density-3","code-input"],["matInput","",3,"change","ngModel"]],template:function(i,n){i&1&&(h(0,"div",0)(1,"app-color-canvas",1),C("colorChange",function(s){return n.onColorCanvasChanged(s)}),p()(),h(2,"div",2)(3,"app-color-slider",3),Xo("valueChange",function(s){return Zo(n.hValue,s)||(n.hValue=s),s}),p()(),h(4,"div",4),w(5,"div",5),h(6,"mat-form-field",6)(7,"mat-label"),m(8,"Hex"),p(),h(9,"input",7),C("change",function(s){return n.onHexCodeChange(s)}),p()()()),i&2&&(l(),y("hValue",n.hValue())("sValue",n.sValue())("vValue",n.vValue()),l(2),Ko("value",n.hValue),l(2),qe("background",n.hexColor()),l(4),y("ngModel",n.hexColor()))},dependencies:[tt,et,Qe,Ye,an,br,rn,sn,ds,hs],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;background-color:var(--irr-contrast-lightest);border-radius:5px;overflow:hidden;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{padding:20px 10px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;gap:10px;padding:0 10px 15px}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;min-width:40px;height:40px;border-radius:50%;box-shadow:0 0 4px 1px #0003}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]{width:auto}[_nghost-%COMP%]   .result-wrapper[_ngcontent-%COMP%]   .code-input[_ngcontent-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}"],changeDetection:0})}}return o})();function nl(o,t){if(o&1){let e=G();h(0,"app-color-selection-panel",6),C("colorChange",function(n){T(e);let r=O();return I(r.onColorChanged(n))}),p()}if(o&2){let e=O();y("color",e.hexColor())}}var _n=(()=>{class o{constructor(){this.label=se.required(),this.hexColor=P("#000000"),this.isOpen=P(!1),this.isDisabled=P(!1),this.onChange=()=>{},this.onTouched=()=>{}}toggleColorPanel(){this.isDisabled()||this.isOpen.update(e=>!e)}onColorChanged(e){this.hexColor.set(e.hex()),this.onChange(e.hex())}writeValue(e){this.hexColor.set(e)}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.isDisabled.set(e)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-color-picker"]],inputs:{label:[1,"label"]},features:[de([{provide:on,useExisting:Fi(()=>o),multi:!0}])],decls:8,vars:10,consts:[["trigger","cdkOverlayOrigin"],[1,"color-label"],[1,"color-label__header"],[1,"color-label__code"],["role","presentation","cdkOverlayOrigin","",1,"color-preview",3,"click"],["cdkConnectedOverlay","",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop","cdkConnectedOverlayBackdropClass"],[3,"colorChange","color"]],template:function(i,n){if(i&1){let r=G();h(0,"div",1)(1,"span",2),m(2),p(),h(3,"span",3),m(4),p()(),h(5,"div",4,0),C("click",function(){return T(r),I(n.toggleColorPanel())}),p(),ji(7,nl,1,1,"ng-template",5),C("backdropClick",function(){return T(r),I(n.toggleColorPanel())})}if(i&2){let r=Pe(6);l(2),f(n.label()),l(2),f(n.hexColor()),l(),qe("background-color",n.hexColor()),z("disabled",n.isDisabled()),l(2),y("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",n.isOpen())("cdkConnectedOverlayHasBackdrop",n.isOpen())("cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop-cs")}},dependencies:[fi,ur,mr,ps],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row;align-items:center;border-radius:4px;padding:10px 15px;background-color:var(--irr-contrast-lightest);box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]{display:block;width:40px;height:40px;margin-left:auto;border-radius:50%;box-shadow:0 0 4px 1px #0000001a}[_nghost-%COMP%]   .color-preview[_ngcontent-%COMP%]:not(.disabled){cursor:pointer}[_nghost-%COMP%]   .color-label[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .color-label__header[_ngcontent-%COMP%]{color:var(--irr-contrast-highest)}[_nghost-%COMP%]   .color-label__code[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);font-size:15px}"],changeDetection:0})}}return o})();function ol(o,t){if(o&1&&(h(0,"div",5)(1,"div",6),m(2),v(3,"translate"),p(),h(4,"div",7),m(5),p()(),w(6,"app-color-picker",8)),o&2){let e=t,i=O();l(2),D("",b(3,4,"tool.tiles.details.tileId"),":"),l(3),f(e.id),l(),y("ngModel",e.color)("label",i.translate.instant("tool.tiles.details.tileColor"))}}function rl(o,t){o&1&&(h(0,"div",4),m(1),v(2,"translate"),p()),o&2&&(l(),f(b(2,1,"tool.tiles.details.tileNoExist")))}var ms=(()=>{class o{constructor(){this.tile=P(null),this.route=c(gt),this.store=c(A),this.router=c($),this.translate=c(X)}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(e){let i=this.getTileModel(e);i&&this.tile.set(i)}}getTileModel(e){return this.store.selectSignal(Xe)().flatMap(n=>n.tiles).find(n=>n.id===e)}navigateToMenu(){this.router.navigate(["/tool/tray"])}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-tile-detail"]],decls:10,vars:7,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent","disabled",""],[1,"details"],[1,"no-exist"],[1,"id"],[1,"label"],[1,"value"],["disabled","true",3,"ngModel","label"]],template:function(i,n){if(i&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.navigateToMenu()}),m(2),v(3,"translate"),p(),h(4,"button",2),m(5),v(6,"translate"),p()(),h(7,"div",3),te(8,ol,7,6)(9,rl,3,3,"div",4),p()),i&2){let r;l(2),D(" ",b(3,3,"common.return")," "),l(3),D(" ",b(6,5,"common.edit")," "),l(3),ie((r=n.tile())?8:9,r)}},dependencies:[U,L,ne,_n,an,rn,sn,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:12px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]{padding:2px;color:#e6e6e6}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .id[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-size:12px;overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap}[_nghost-%COMP%]   .details[_ngcontent-%COMP%]   .no-exist[_ngcontent-%COMP%]{color:var(--irr-contrast-medium);margin:auto}"],changeDetection:0})}}return o})();var ct=(()=>{class o{constructor(){this.sectorForContourEditionChanged=new Be(null),this.sectorForContourEdition$=this.sectorForContourEditionChanged.asObservable(),this.sectorListChanged=new Be(null),this.sectorListChange$=this.sectorListChanged.asObservable(),this.sectorForPropertyEditionChanged=new Be(null),this.sectorForPropertyEdition$=this.sectorForPropertyEditionChanged.asObservable(),this.canvasClickedSub=new x,this.canvasClicked$=this.canvasClickedSub.asObservable()}emitEditedSectorContour(e){this.sectorForContourEditionChanged.next(e)}emitEditedSectorProperty(e){this.sectorForPropertyEditionChanged.next(e)}emitSectorListChanged(e){this.sectorListChanged.next(e)}emitCanvasClicked(e){this.canvasClickedSub.next(e)}static createNewSector(){return{id:crypto.randomUUID(),name:"",color:pe({h:lt.nextFloat(0,360),s:75,v:95}).hex(),vertices:[],properties:{sectionMaxArea:5,sectionMinAngle:35,maxTileRadius:4,minTileRadius:0,tilesMargin:.1,evaluationParams:{singleSectionPopulation:2,overlappingAreaOutsideSector:-2,additionalPopulationOfNeighboringSectors:4,overlappingNotPopulatedSections:-1,tileColorMismatch:-2},populationParams:{initialPopulationSize:100,countOfTriesToInsertTile:30,countOfTrianglePositionDraws:30,countOfColorMatchingAttempts:40,iterationsCount:100,populationSize:10}}}}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var sl=10,al=10,vn=class extends _t{constructor(t,e,i,n=100){super(),this.vertices=t,this.selectedIndex=e,this.hexColor=i,this.order=n}drawObject(t,e){if(this.vertices.length>=2){let i=sl*e.scaleFactor;t.lineWidth=i,t.strokeStyle=this.hexColor,t.setLineDash([i]),t.beginPath(),t.globalAlpha=.25;let n=e.getViewportPosition(this.vertices.at(-1));t.moveTo(n.x,n.y),n=e.getViewportPosition(this.vertices[0]),t.lineTo(n.x,n.y),t.stroke(),t.globalAlpha=.7,t.setLineDash([]),t.beginPath(),t.moveTo(n.x,n.y);for(let r=1;r<this.vertices.length;++r)n=e.getViewportPosition(this.vertices[r]),t.lineTo(n.x,n.y);t.stroke()}t.lineWidth=1,t.globalAlpha=1,this.selectedIndex!==-1&&this.drawPoint(t,e,this.vertices[this.selectedIndex])}drawPoint(t,e,i){let n=e.getViewportPosition(i);t.beginPath();let r=al*e.scaleFactor;t.arc(n.x,n.y,r,0,2*Math.PI),t.fillStyle=this.hexColor,t.fill()}getOrder(){return this.order}};function ll(o){let t=o.length,e=5381,i=52711,n;for(;t--;)n=o.charCodeAt(t),e=e*33^n,i=i*33^n;return(e>>>0)*4096+(i>>>0)}var wi="|",cl=/\[object ([HTML|SVG](.*)Element)\]/,dl={"[object Arguments]":0,"[object Array]":1,"[object ArrayBuffer]":2,"[object AsyncFunction]":3,"[object AsyncGeneratorFunction]":4,"[object BigInt]":5,"[object BigInt64Array]":6,"[object BigUint64Array]":7,"[object Boolean]":8,"[object DataView]":9,"[object Date]":10,"[object DocumentFragment]":11,"[object Error]":12,"[object Event]":13,"[object Float32Array]":14,"[object Float64Array]":15,"[object Function]":16,"[object Generator]":17,"[object GeneratorFunction]":18,"[object Int8Array]":19,"[object Int16Array]":20,"[object Map]":21,"[object Number]":22,"[object Object]":23,"[object Promise]":24,"[object RegExp]":25,"[object Set]":26,"[object SharedArrayBuffer]":27,"[object String]":28,"[object Uint8Array]":29,"[object Uint8ClampedArray]":30,"[object Uint16Array]":31,"[object Uint32Array]":32,"[object WeakMap]":33,"[object WeakRef]":34,"[object WeakSet]":35,CUSTOM:36,ELEMENT:37},hl={"[object Arguments]":1,"[object Array]":2},vs={"[object Generator]":1,"[object Promise]":2,"[object WeakMap]":3,"[object WeakRef]":4,"[object WeakSet]":5},pl={"[object AsyncFunction]":1,"[object AsyncGeneratorFunction]":2,"[object Boolean]":3,"[object Function]":4,"[object GeneratorFunction]":5,"[object Number]":6,"[object String]":7},ml={"[object BigInt64Array]":1,"[object BigUint64Array]":2,"[object Float32Array]":3,"[object Float64Array]":4,"[object Int8Array]":5,"[object Int16Array]":6,"[object Uint8Array]":7,"[object Uint8ClampedArray]":8,"[object Uint16Array]":9,"[object Uint32Array]":10},ul={"[object Arguments]":1,"[object Array]":2,"[object ArrayBuffer]":3,"[object BigInt64Array]":4,"[object BigUint64Array]":5,"[object DataView]":6,"[object Float32Array]":7,"[object Float64Array]":8,"[object Int8Array]":9,"[object Int16Array]":10,"[object Map]":11,"[object Object]":12,"[object Set]":13,"[object SharedArrayBuffer]":14,"[object Uint8Array]":15,"[object Uint8ClampedArray]":16,"[object Uint16Array]":17,"[object Uint32Array]":18,CUSTOM:19},Si={bigint:"i",boolean:"b",empty:"e",function:"g",number:"n",object:"o",string:"s",symbol:"s"};function he(o,t){return Si.object+wi+dl[o]+wi+t}var us=new WeakMap,gl=0;function _o(o,t){let e=us.get(o);if(e)return e;let i=he(t,"NOT_ENUMERABLE"+wi+gl++);return us.set(o,i),i}function fl(o,t){return o[0]>t[0]}function bs(o,t){return o>t}function vo(o,t){let e,i;for(let n=0;n<o.length;++n){for(i=o[n],e=n-1;~e&&t(o[e],i);--e)o[e+1]=o[e];o[e+1]=i}return o}var _l=Object.prototype.toString;function vl(o,t,e){if(ul[t])return gs(t,o,e);if(t==="[object Date]")return he(t,o.getTime());if(t==="[object RegExp]")return he(t,o.toString());if(t==="[object Event]")return he(t,[o.bubbles,o.cancelBubble,o.cancelable,o.composed,o.currentTarget,o.defaultPrevented,o.eventPhase,o.isTrusted,o.returnValue,o.target,o.type].join());if(t==="[object Error]")return he(t,o.message+wi+o.stack);if(t==="[object DocumentFragment]")return he(t,wl(o));let i=t.match(cl);return i?he("ELEMENT",i[1]+wi+o.outerHTML):vs[t]?_o(o,t):pl[t]?he(t,o.toString()):gs("CUSTOM",o,e)}function gs(o,t,e){let i=e.cache.get(t);return i?he(o,"RECURSIVE~"+i):(e.cache.set(t,++e.id),o==="[object Object]"?t[Symbol.iterator]?_o(t,o):he(o,_s(t,e)):hl[o]?he(o,bl(t,e)):o==="[object Map]"?he(o,xl(t,e)):o==="[object Set]"?he(o,Ml(t,e)):ml[o]?he(o,t.join()):o==="[object ArrayBuffer]"?he(o,fs(t)):o==="[object DataView]"?he(o,fs(t.buffer)):vs[o]?_o(t,o):he("CUSTOM",_s(t,e)))}function bl(o,t){let e=o.length,i=new Array(e);for(;--e>=0;)i[e]=ni(o[e],t);return i.join()}function Cl(o){return Buffer.from(o).toString("utf8")}function yl(o){return String.fromCharCode.apply(null,new Uint16Array(o))}function Sl(){return"UNSUPPORTED"}function wl(o){let t=o.children,e=t.length,i=new Array(e);for(;--e>=0;)i[e]=t[e].outerHTML;return i.join()}var fs=typeof Buffer<"u"&&typeof Buffer.from=="function"?Cl:typeof Uint16Array=="function"?yl:Sl;function xl(o,t){let e=new Array(o.size),i=0;for(o.forEach((n,r)=>{e[i++]=[ni(r,t),ni(n,t)]}),vo(e,fl);--i>=0;)e[i]="["+e[i][0]+","+e[i][1]+"]";return"["+e.join()+"]"}function _s(o,t){let e=vo(Object.getOwnPropertyNames(o),bs),i=e.length,n=new Array(i),r=i;for(;--r>=0;)n[r]=e[r]+":"+ni(o[e[r]],t);return"{"+n.join()+"}"}function Ml(o,t){let e=new Array(o.size),i=0;return o.forEach(n=>{e[i++]=ni(n,t)}),"["+vo(e,bs).join()+"]"}function ni(o,t){let e=typeof o;return o==null||e==="undefined"?Si.empty+o:e==="object"?vl(o,_l.call(o),t||{cache:new WeakMap,id:1}):e==="function"||e==="symbol"?Si[e]+o.toString():e==="boolean"?Si.boolean+ +o:Si[e]+o}function Cs(o){return ll(ni(o,void 0))}var dt=class{constructor(t,e){this.start=t,this.end=e}hash(){return Cs(this)}};var oi=class o extends _t{constructor(t,e,i,n=100){super(),this.hexColor=i,this.order=n,this.borderThickness=8,this.innerThickness=3,this.outerContour=e,this.innerLines=o.getLines(t)}drawObject(t,e){this.outerContour.length<3||(t.strokeStyle=this.hexColor,this.drawTriangulationMesh(t,e),this.drawBorder(t,e),t.lineWidth=1)}drawBorder(t,e){t.lineWidth=this.borderThickness*e.scaleFactor;let i=e.getViewportPosition(this.outerContour[0]);t.beginPath(),t.moveTo(i.x,i.y);for(let n=1;n<this.outerContour.length;++n)i=e.getViewportPosition(this.outerContour[n]),t.lineTo(i.x,i.y);t.closePath(),t.stroke(),t.globalAlpha=.25,t.fillStyle=this.hexColor,t.fill(),t.globalAlpha=1}drawTriangulationMesh(t,e){t.lineWidth=this.innerThickness*e.scaleFactor,t.globalAlpha=.3;for(let i of this.innerLines){t.beginPath();let n=e.getViewportPosition(i.start);t.moveTo(n.x,n.y);let r=e.getViewportPosition(i.end);t.lineTo(r.x,r.y),t.stroke()}t.globalAlpha=1}static getLines(t){let e=this.collectMeshLines(t),i=[];for(let n of e.values())n.count===2&&i.push(n.line);return i}getOrder(){return this.order}static collectMeshLines(t){let e=new Map;for(let i of t){let n=i.getVertices(),r=n.at(-1);for(let s=0;s<3;++s){let a=n[s],d=r.sqrMagnitude()<a.sqrMagnitude()?[r,a]:[a,r],g=new dt(d[0],d[1]),_=g.hash(),N=e.get(_);N?N.count++:e.set(_,{line:g,count:1}),r=a}}return e}};var ri=class extends _t{constructor(t,e,i=10,n=8){super(),this.vertices=t,this.hexColor=e,this.order=i,this.baseLineThickness=n}drawObject(t,e){if(this.vertices.length<3)return;t.beginPath();let i=e.getViewportPosition(this.vertices[0]);t.moveTo(i.x,i.y);for(let n=1;n<this.vertices.length;++n)i=e.getViewportPosition(this.vertices[n]),t.lineTo(i.x,i.y);t.lineWidth=this.baseLineThickness*e.scaleFactor,t.strokeStyle=this.hexColor,t.closePath(),t.globalAlpha=.25,t.fillStyle=this.hexColor,t.fill(),t.globalAlpha=1,t.stroke(),t.lineWidth=1}getOrder(){return this.order}};var ys=(()=>{class o{constructor(){this.store=c(A),this.service=c(ct),this.destroyRef=c(K),this.toolService=c(be),this.sectorForContourEdition=ro(this.service.sectorForContourEdition$,{requireSync:!0}),this.sectorForPropertyEdition=ro(this.service.sectorForPropertyEdition$,{requireSync:!0}),this.visualElements=[],this.ribbonActions=[{iconName:"crop",visibility:P("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"sectors_snapshot.png")},{iconName:"recenter",visibility:P("on"),onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}}]}ngOnInit(){this.service.emitEditedSectorContour(null),this.service.emitEditedSectorProperty(null)}ngAfterViewInit(){this.subscribeOnEditedSectorChange(),this.subscribeOnEditedSectorPropertiesChange(),this.subscribeOnSectorListChange(),Er(this.activeCanvas.clicked).pipe(W(this.destroyRef)).subscribe(e=>this.service.emitCanvasClicked(e))}subscribeOnEditedSectorChange(){this.service.sectorForContourEdition$.pipe(W(this.destroyRef)).subscribe(e=>this.onEditedSectorChanged(e))}subscribeOnEditedSectorPropertiesChange(){this.service.sectorForPropertyEdition$.pipe(W(this.destroyRef)).subscribe(()=>this.redrawSectors())}subscribeOnSectorListChange(){this.service.sectorListChange$.pipe(W(this.destroyRef)).subscribe(()=>this.redrawSectors())}onEditedSectorChanged(e){this.activeCanvas.options.update(i=>ae(M({},i),{isMovable:!e})),this.redrawSectors()}redrawSectors(){this.visualElements.forEach(e=>e.removeObject()),this.visualElements=this.prepareSectorsContours();for(let e of this.visualElements)this.activeCanvas.addCanvasObject(e);this.activeCanvas.redraw()}prepareSectorsContours(){let e=this.sectorForContourEdition(),i=this.sectorForPropertyEdition(),n,r=this.store.selectSignal(ve)();return e?r=Nr.addOrUpdate([...r],e.sector,s=>s.id===e.sector.id):this.service.sectorListChange$.pipe(No()).subscribe(s=>{n=s?.selectedSector}),this.mapSectorsToContours(r,e,i,n)}mapSectorsToContours(e,i,n,r){return e.map((s,a)=>{if(s.id===i?.sector.id)return new vn([...i.sector.vertices],i.sector.vertices.indexOf(i.selectedVertex),i.sector.color);if(n?.mesh&&s.id===n?.sector.id){let d=n.mesh,g=n.contour;return new oi(d,g,n.sector.color)}else{let d=s.id===r?.id?10:8;return new ri([...s.vertices],s.color,10+a,d)}})}sectionEntered(e,i){this.activeCanvas=e;let n=this.store.selectSignal(Ze)();return queueMicrotask(async()=>{this.imageObject=await be.createImageObject(n),this.activeCanvas.addCanvasObject(this.imageObject),i&&this.focusOnImage(),this.activeCanvas.redraw()}),{ribbon:this.ribbonActions}}focusOnImage(){let e=be.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sectors"]],decls:1,vars:0,template:function(i,n){i&1&&w(0,"router-outlet")},dependencies:[Ut],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}"],changeDetection:0})}}return o})();var Ce=class extends Error{constructor(t,e){let i=new.target.prototype;super(`${t}: Status code '${e}'`),this.statusCode=e,this.__proto__=i}},wt=class extends Error{constructor(t="A timeout occurred."){let e=new.target.prototype;super(t),this.__proto__=e}},ce=class extends Error{constructor(t="An abort occurred."){let e=new.target.prototype;super(t),this.__proto__=e}},bn=class extends Error{constructor(t,e){let i=new.target.prototype;super(t),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=i}},Cn=class extends Error{constructor(t,e){let i=new.target.prototype;super(t),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=i}},yn=class extends Error{constructor(t,e){let i=new.target.prototype;super(t),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=i}},xi=class extends Error{constructor(t){let e=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}},Sn=class extends Error{constructor(t,e){let i=new.target.prototype;super(t),this.innerErrors=e,this.__proto__=i}};var si=class{constructor(t,e,i){this.statusCode=t,this.statusText=e,this.content=i}},nt=class{get(t,e){return this.send(ae(M({},e),{method:"GET",url:t}))}post(t,e){return this.send(ae(M({},e),{method:"POST",url:t}))}delete(t,e){return this.send(ae(M({},e),{method:"DELETE",url:t}))}getCookieString(t){return""}};var u=(function(o){return o[o.Trace=0]="Trace",o[o.Debug=1]="Debug",o[o.Information=2]="Information",o[o.Warning=3]="Warning",o[o.Error=4]="Error",o[o.Critical=5]="Critical",o[o.None=6]="None",o})(u||{});var ot=class{constructor(){}log(t,e){}};ot.instance=new ot;var Ss="10.0.0";var F=class{static isRequired(t,e){if(t==null)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(t,e){if(!t||t.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(t,e,i){if(!(t in e))throw new Error(`Unknown ${i} value: ${t}.`)}},B=class o{static get isBrowser(){return!o.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!o.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!o.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};function xt(o,t){let e="";return Ve(o)?(e=`Binary data of length ${o.byteLength}`,t&&(e+=`. Content: '${Pl(o)}'`)):typeof o=="string"&&(e=`String data of length ${o.length}`,t&&(e+=`. Content: '${o}'`)),e}function Pl(o){let t=new Uint8Array(o),e="";return t.forEach(i=>{let n=i<16?"0":"";e+=`0x${n}${i.toString(16)} `}),e.substring(0,e.length-1)}function Ve(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}async function xn(o,t,e,i,n,r){let s={},[a,d]=rt();s[a]=d,o.log(u.Trace,`(${t} transport) sending data. ${xt(n,r.logMessageContent)}.`);let g=Ve(n)?"arraybuffer":"text",_=await e.post(i,{content:n,headers:M(M({},s),r.headers),responseType:g,timeout:r.timeout,withCredentials:r.withCredentials});o.log(u.Trace,`(${t} transport) request complete. Response status: ${_.statusCode}.`)}function ws(o){return o===void 0?new Rt(u.Information):o===null?ot.instance:o.log!==void 0?o:new Rt(o)}var wn=class{constructor(t,e){this._subject=t,this._observer=e}dispose(){let t=this._subject.observers.indexOf(this._observer);t>-1&&this._subject.observers.splice(t,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}},Rt=class{constructor(t){this._minLevel=t,this.out=console}log(t,e){if(t>=this._minLevel){let i=`[${new Date().toISOString()}] ${u[t]}: ${e}`;switch(t){case u.Critical:case u.Error:this.out.error(i);break;case u.Warning:this.out.warn(i);break;case u.Information:this.out.info(i);break;default:this.out.log(i);break}}}};function rt(){let o="X-SignalR-User-Agent";return B.isNode&&(o="User-Agent"),[o,El(Ss,Dl(),kl(),Ol())]}function El(o,t,e,i){let n="Microsoft SignalR/",r=o.split(".");return n+=`${r[0]}.${r[1]}`,n+=` (${o}; `,t&&t!==""?n+=`${t}; `:n+="Unknown OS; ",n+=`${e}`,i?n+=`; ${i}`:n+="; Unknown Runtime Version",n+=")",n}function Dl(){if(B.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Ol(){if(B.isNode)return process.versions.node}function kl(){return B.isNode?"NodeJS":"Browser"}function Mn(o){return o.stack?o.stack:o.message?o.message:`${o}`}function xs(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var Pn=class extends nt{constructor(t){if(super(),this._logger=t,typeof fetch>"u"||B.isNode){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Lt;this._jar=new(e("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(xs());if(typeof AbortController>"u"){let e=typeof __webpack_require__=="function"?__non_webpack_require__:Lt;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(t){if(t.abortSignal&&t.abortSignal.aborted)throw new ce;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");let e=new this._abortControllerType,i;t.abortSignal&&(t.abortSignal.onabort=()=>{e.abort(),i=new ce});let n=null;if(t.timeout){let d=t.timeout;n=setTimeout(()=>{e.abort(),this._logger.log(u.Warning,"Timeout from HTTP request."),i=new wt},d)}t.content===""&&(t.content=void 0),t.content&&(t.headers=t.headers||{},Ve(t.content)?t.headers["Content-Type"]="application/octet-stream":t.headers["Content-Type"]="text/plain;charset=UTF-8");let r;try{r=await this._fetchType(t.url,{body:t.content,cache:"no-cache",credentials:t.withCredentials===!0?"include":"same-origin",headers:M({"X-Requested-With":"XMLHttpRequest"},t.headers),method:t.method,mode:"cors",redirect:"follow",signal:e.signal})}catch(d){throw i||(this._logger.log(u.Warning,`Error from HTTP request. ${d}.`),d)}finally{n&&clearTimeout(n),t.abortSignal&&(t.abortSignal.onabort=null)}if(!r.ok){let d=await Ms(r,"text");throw new Ce(d||r.statusText,r.status)}let a=await Ms(r,t.responseType);return new si(r.status,r.statusText,a)}getCookieString(t){let e="";return B.isNode&&this._jar&&this._jar.getCookies(t,(i,n)=>e=n.join("; ")),e}};function Ms(o,t){let e;switch(t){case"arraybuffer":e=o.arrayBuffer();break;case"text":e=o.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`);default:e=o.text();break}return e}var En=class extends nt{constructor(t){super(),this._logger=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new ce):t.method?t.url?new Promise((e,i)=>{let n=new XMLHttpRequest;n.open(t.method,t.url,!0),n.withCredentials=t.withCredentials===void 0?!0:t.withCredentials,n.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.content===""&&(t.content=void 0),t.content&&(Ve(t.content)?n.setRequestHeader("Content-Type","application/octet-stream"):n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let r=t.headers;r&&Object.keys(r).forEach(s=>{n.setRequestHeader(s,r[s])}),t.responseType&&(n.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{n.abort(),i(new ce)}),t.timeout&&(n.timeout=t.timeout),n.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),n.status>=200&&n.status<300?e(new si(n.status,n.statusText,n.response||n.responseText)):i(new Ce(n.response||n.responseText||n.statusText,n.status))},n.onerror=()=>{this._logger.log(u.Warning,`Error from HTTP request. ${n.status}: ${n.statusText}.`),i(new Ce(n.statusText,n.status))},n.ontimeout=()=>{this._logger.log(u.Warning,"Timeout from HTTP request."),i(new wt)},n.send(t.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var Dn=class extends nt{constructor(t){if(super(),typeof fetch<"u"||B.isNode)this._httpClient=new Pn(t);else if(typeof XMLHttpRequest<"u")this._httpClient=new En(t);else throw new Error("No usable HttpClient found.")}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new ce):t.method?t.url?this._httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this._httpClient.getCookieString(t)}};var ye=class o{static write(t){return`${t}${o.RecordSeparator}`}static parse(t){if(t[t.length-1]!==o.RecordSeparator)throw new Error("Message is incomplete.");let e=t.split(o.RecordSeparator);return e.pop(),e}};ye.RecordSeparatorCode=30;ye.RecordSeparator=String.fromCharCode(ye.RecordSeparatorCode);var On=class{writeHandshakeRequest(t){return ye.write(JSON.stringify(t))}parseHandshakeResponse(t){let e,i;if(Ve(t)){let a=new Uint8Array(t),d=a.indexOf(ye.RecordSeparatorCode);if(d===-1)throw new Error("Message is incomplete.");let g=d+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,g))),i=a.byteLength>g?a.slice(g).buffer:null}else{let a=t,d=a.indexOf(ye.RecordSeparator);if(d===-1)throw new Error("Message is incomplete.");let g=d+1;e=a.substring(0,g),i=a.length>g?a.substring(g):null}let n=ye.parse(e),r=JSON.parse(n[0]);if(r.type)throw new Error("Expected a handshake response from the server.");return[i,r]}};var E=(function(o){return o[o.Invocation=1]="Invocation",o[o.StreamItem=2]="StreamItem",o[o.Completion=3]="Completion",o[o.StreamInvocation=4]="StreamInvocation",o[o.CancelInvocation=5]="CancelInvocation",o[o.Ping=6]="Ping",o[o.Close=7]="Close",o[o.Ack=8]="Ack",o[o.Sequence=9]="Sequence",o})(E||{});var kn=class{constructor(){this.observers=[]}next(t){for(let e of this.observers)e.next(t)}error(t){for(let e of this.observers)e.error&&e.error(t)}complete(){for(let t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new wn(this,t)}};var Tn=class{constructor(t,e,i){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=t,this._connection=e,this._bufferSize=i}async _send(t){let e=this._protocol.writeMessage(t),i=Promise.resolve();if(this._isInvocationMessage(t)){this._totalMessageCount++;let n=()=>{},r=()=>{};Ve(e)?this._bufferedByteCount+=e.byteLength:this._bufferedByteCount+=e.length,this._bufferedByteCount>=this._bufferSize&&(i=new Promise((s,a)=>{n=s,r=a})),this._messages.push(new bo(e,this._totalMessageCount,n,r))}try{this._reconnectInProgress||await this._connection.send(e)}catch{this._disconnected()}await i}_ack(t){let e=-1;for(let i=0;i<this._messages.length;i++){let n=this._messages[i];if(n._id<=t.sequenceId)e=i,Ve(n._message)?this._bufferedByteCount-=n._message.byteLength:this._bufferedByteCount-=n._message.length,n._resolver();else if(this._bufferedByteCount<this._bufferSize)n._resolver();else break}e!==-1&&(this._messages=this._messages.slice(e+1))}_shouldProcessMessage(t){if(this._waitForSequenceMessage)return t.type!==E.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(t))return!0;let e=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,e<=this._latestReceivedSequenceId?(e===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=e,this._ackTimer(),!0)}_resetSequence(t){if(t.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=t.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){let t=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:E.Sequence,sequenceId:t}));let e=this._messages;for(let i of e)await this._connection.send(i._message);this._reconnectInProgress=!1}_dispose(t){t??(t=new Error("Unable to reconnect to server."));for(let e of this._messages)e._rejector(t)}_isInvocationMessage(t){switch(t.type){case E.Invocation:case E.StreamItem:case E.Completion:case E.StreamInvocation:case E.CancelInvocation:return!0;case E.Close:case E.Sequence:case E.Ping:case E.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:E.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}},bo=class{constructor(t,e,i,n){this._message=t,this._id=e,this._resolver=i,this._rejector=n}};var Tl=30*1e3,Il=15*1e3,Rl=1e5,q=(function(o){return o.Disconnected="Disconnected",o.Connecting="Connecting",o.Connected="Connected",o.Disconnecting="Disconnecting",o.Reconnecting="Reconnecting",o})(q||{}),In=class o{static create(t,e,i,n,r,s,a){return new o(t,e,i,n,r,s,a)}constructor(t,e,i,n,r,s,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(u.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},F.isRequired(t,"connection"),F.isRequired(e,"logger"),F.isRequired(i,"protocol"),this.serverTimeoutInMilliseconds=r??Tl,this.keepAliveIntervalInMilliseconds=s??Il,this._statefulReconnectBufferSize=a??Rl,this._logger=e,this._protocol=i,this.connection=t,this._reconnectPolicy=n,this._handshakeProtocol=new On,this.connection.onreceive=d=>this._processIncomingData(d),this.connection.onclose=d=>this._connectionClosed(d),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=q.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:E.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this._connectionState!==q.Disconnected&&this._connectionState!==q.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==q.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=q.Connecting,this._logger.log(u.Debug,"Starting HubConnection.");try{await this._startInternal(),B.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=q.Connected,this._connectionStarted=!0,this._logger.log(u.Debug,"HubConnection connected successfully.")}catch(t){return this._connectionState=q.Disconnected,this._logger.log(u.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let t=new Promise((e,i)=>{this._handshakeResolver=e,this._handshakeRejecter=i});await this.connection.start(this._protocol.transferFormat);try{let e=this._protocol.version;this.connection.features.reconnect||(e=1);let i={protocol:this._protocol.name,version:e};if(this._logger.log(u.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(i)),this._logger.log(u.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await t,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new Tn(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(e){throw this._logger.log(u.Debug,`Hub handshake failed with error '${e}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(e),e}}async stop(){let t=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await t}catch{}}_stopInternal(t){if(this._connectionState===q.Disconnected)return this._logger.log(u.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===q.Disconnecting)return this._logger.log(u.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let e=this._connectionState;return this._connectionState=q.Disconnecting,this._logger.log(u.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(u.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(e===q.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=t||new ce("The connection was stopped before the hub handshake could complete."),this.connection.stop(t))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(t,...e){let[i,n]=this._replaceStreamingParams(e),r=this._createStreamInvocation(t,e,n),s,a=new kn;return a.cancelCallback=()=>{let d=this._createCancelInvocation(r.invocationId);return delete this._callbacks[r.invocationId],s.then(()=>this._sendWithProtocol(d))},this._callbacks[r.invocationId]=(d,g)=>{if(g){a.error(g);return}else d&&(d.type===E.Completion?d.error?a.error(new Error(d.error)):a.complete():a.next(d.item))},s=this._sendWithProtocol(r).catch(d=>{a.error(d),delete this._callbacks[r.invocationId]}),this._launchStreams(i,s),a}_sendMessage(t){return this._resetKeepAliveInterval(),this.connection.send(t)}_sendWithProtocol(t){return this._messageBuffer?this._messageBuffer._send(t):this._sendMessage(this._protocol.writeMessage(t))}send(t,...e){let[i,n]=this._replaceStreamingParams(e),r=this._sendWithProtocol(this._createInvocation(t,e,!0,n));return this._launchStreams(i,r),r}invoke(t,...e){let[i,n]=this._replaceStreamingParams(e),r=this._createInvocation(t,e,!1,n);return new Promise((a,d)=>{this._callbacks[r.invocationId]=(_,N)=>{if(N){d(N);return}else _&&(_.type===E.Completion?_.error?d(new Error(_.error)):a(_.result):d(new Error(`Unexpected message type: ${_.type}`)))};let g=this._sendWithProtocol(r).catch(_=>{d(_),delete this._callbacks[r.invocationId]});this._launchStreams(i,g)})}on(t,e){!t||!e||(t=t.toLowerCase(),this._methods[t]||(this._methods[t]=[]),this._methods[t].indexOf(e)===-1&&this._methods[t].push(e))}off(t,e){if(!t)return;t=t.toLowerCase();let i=this._methods[t];if(i)if(e){let n=i.indexOf(e);n!==-1&&(i.splice(n,1),i.length===0&&delete this._methods[t])}else delete this._methods[t]}onclose(t){t&&this._closedCallbacks.push(t)}onreconnecting(t){t&&this._reconnectingCallbacks.push(t)}onreconnected(t){t&&this._reconnectedCallbacks.push(t)}_processIncomingData(t){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(t=this._processHandshakeResponse(t),this._receivedHandshakeResponse=!0),t){let e=this._protocol.parseMessages(t,this._logger);for(let i of e)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(i)))switch(i.type){case E.Invocation:this._invokeClientMethod(i).catch(n=>{this._logger.log(u.Error,`Invoke client method threw error: ${Mn(n)}`)});break;case E.StreamItem:case E.Completion:{let n=this._callbacks[i.invocationId];if(n){i.type===E.Completion&&delete this._callbacks[i.invocationId];try{n(i)}catch(r){this._logger.log(u.Error,`Stream callback threw error: ${Mn(r)}`)}}break}case E.Ping:break;case E.Close:{this._logger.log(u.Information,"Close message received from server.");let n=i.error?new Error("Server returned an error on close: "+i.error):void 0;i.allowReconnect===!0?this.connection.stop(n):this._stopPromise=this._stopInternal(n);break}case E.Ack:this._messageBuffer&&this._messageBuffer._ack(i);break;case E.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(i);break;default:this._logger.log(u.Warning,`Invalid message type: ${i.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(t){let e,i;try{[i,e]=this._handshakeProtocol.parseHandshakeResponse(t)}catch(n){let r="Error parsing handshake response: "+n;this._logger.log(u.Error,r);let s=new Error(r);throw this._handshakeRejecter(s),s}if(e.error){let n="Server returned handshake error: "+e.error;this._logger.log(u.Error,n);let r=new Error(n);throw this._handshakeRejecter(r),r}else this._logger.log(u.Debug,"Server handshake complete.");return this._handshakeResolver(),i}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if(!this.connection.features||!this.connection.features.inherentKeepAlive){this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds);let t=this._nextKeepAlive-new Date().getTime();if(t<0){this._connectionState===q.Connected&&this._trySendPingMessage();return}this._pingServerHandle===void 0&&(t<0&&(t=0),this._pingServerHandle=setTimeout(async()=>{this._connectionState===q.Connected&&await this._trySendPingMessage()},t))}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(t){let e=t.target.toLowerCase(),i=this._methods[e];if(!i){this._logger.log(u.Warning,`No client method with the name '${e}' found.`),t.invocationId&&(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${t.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)));return}let n=i.slice(),r=!!t.invocationId,s,a,d;for(let g of n)try{let _=s;s=await g.apply(this,t.arguments),r&&s&&_&&(this._logger.log(u.Error,`Multiple results provided for '${e}'. Sending error to server.`),d=this._createCompletionMessage(t.invocationId,"Client provided multiple results.",null)),a=void 0}catch(_){a=_,this._logger.log(u.Error,`A callback for the method '${e}' threw error '${_}'.`)}d?await this._sendWithProtocol(d):r?(a?d=this._createCompletionMessage(t.invocationId,`${a}`,null):s!==void 0?d=this._createCompletionMessage(t.invocationId,null,s):(this._logger.log(u.Warning,`No result given for '${e}' method and invocation ID '${t.invocationId}'.`),d=this._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(d)):s&&this._logger.log(u.Error,`Result given for '${e}' method but server is not expecting a result.`)}_connectionClosed(t){this._logger.log(u.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||t||new ce("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===q.Disconnecting?this._completeClose(t):this._connectionState===q.Connected&&this._reconnectPolicy?this._reconnect(t):this._connectionState===q.Connected&&this._completeClose(t)}_completeClose(t){if(this._connectionStarted){this._connectionState=q.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(t??new Error("Connection closed.")),this._messageBuffer=void 0),B.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(e=>e.apply(this,[t]))}catch(e){this._logger.log(u.Error,`An onclose callback called with error '${t}' threw error '${e}'.`)}}}async _reconnect(t){let e=Date.now(),i=0,n=t!==void 0?t:new Error("Attempting to reconnect due to a unknown error."),r=this._getNextRetryDelay(i,0,n);if(r===null){this._logger.log(u.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(t);return}if(this._connectionState=q.Reconnecting,t?this._logger.log(u.Information,`Connection reconnecting because of error '${t}'.`):this._logger.log(u.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[t]))}catch(s){this._logger.log(u.Error,`An onreconnecting callback called with error '${t}' threw error '${s}'.`)}if(this._connectionState!==q.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;r!==null;){if(this._logger.log(u.Information,`Reconnect attempt number ${i+1} will start in ${r} ms.`),await new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,r)}),this._reconnectDelayHandle=void 0,this._connectionState!==q.Reconnecting){this._logger.log(u.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=q.Connected,this._logger.log(u.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(u.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(u.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==q.Reconnecting){this._logger.log(u.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===q.Disconnecting&&this._completeClose();return}i++,n=s instanceof Error?s:new Error(s.toString()),r=this._getNextRetryDelay(i,Date.now()-e,n)}}this._logger.log(u.Information,`Reconnect retries have been exhausted after ${Date.now()-e} ms and ${i} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(t,e,i){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:i})}catch(n){return this._logger.log(u.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${e}) threw error '${n}'.`),null}}_cancelCallbacksWithError(t){let e=this._callbacks;this._callbacks={},Object.keys(e).forEach(i=>{let n=e[i];try{n(null,t)}catch(r){this._logger.log(u.Error,`Stream 'error' callback called with '${t}' threw error: ${Mn(r)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(t,e,i,n){if(i)return n.length!==0?{target:t,arguments:e,streamIds:n,type:E.Invocation}:{target:t,arguments:e,type:E.Invocation};{let r=this._invocationId;return this._invocationId++,n.length!==0?{target:t,arguments:e,invocationId:r.toString(),streamIds:n,type:E.Invocation}:{target:t,arguments:e,invocationId:r.toString(),type:E.Invocation}}}_launchStreams(t,e){if(t.length!==0){e||(e=Promise.resolve());for(let i in t)t[i].subscribe({complete:()=>{e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(i)))},error:n=>{let r;n instanceof Error?r=n.message:n&&n.toString?r=n.toString():r="Unknown error",e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(i,r)))},next:n=>{e=e.then(()=>this._sendWithProtocol(this._createStreamItemMessage(i,n)))}})}}_replaceStreamingParams(t){let e=[],i=[];for(let n=0;n<t.length;n++){let r=t[n];if(this._isObservable(r)){let s=this._invocationId;this._invocationId++,e[s]=r,i.push(s.toString()),t.splice(n,1)}}return[e,i]}_isObservable(t){return t&&t.subscribe&&typeof t.subscribe=="function"}_createStreamInvocation(t,e,i){let n=this._invocationId;return this._invocationId++,i.length!==0?{target:t,arguments:e,invocationId:n.toString(),streamIds:i,type:E.StreamInvocation}:{target:t,arguments:e,invocationId:n.toString(),type:E.StreamInvocation}}_createCancelInvocation(t){return{invocationId:t,type:E.CancelInvocation}}_createStreamItemMessage(t,e){return{invocationId:t,item:e,type:E.StreamItem}}_createCompletionMessage(t,e,i){return e?{error:e,invocationId:t,type:E.Completion}:{invocationId:t,result:i,type:E.Completion}}_createCloseMessage(){return{type:E.Close}}async _trySendPingMessage(){try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}};var Al=[0,2e3,1e4,3e4,null],Mi=class{constructor(t){this._retryDelays=t!==void 0?[...t,null]:Al}nextRetryDelayInMilliseconds(t){return this._retryDelays[t.previousRetryCount]}};var At=(()=>{class o{}return o.Authorization="Authorization",o.Cookie="Cookie",o})();var Rn=class extends nt{constructor(t,e){super(),this._innerClient=t,this._accessTokenFactory=e}async send(t){let e=!0;this._accessTokenFactory&&(!this._accessToken||t.url&&t.url.indexOf("/negotiate?")>0)&&(e=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(t);let i=await this._innerClient.send(t);return e&&i.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(t),await this._innerClient.send(t)):i}_setAuthorizationHeader(t){t.headers||(t.headers={}),this._accessToken?t.headers[At.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&t.headers[At.Authorization]&&delete t.headers[At.Authorization]}getCookieString(t){return this._innerClient.getCookieString(t)}};var Q=(function(o){return o[o.None=0]="None",o[o.WebSockets=1]="WebSockets",o[o.ServerSentEvents=2]="ServerSentEvents",o[o.LongPolling=4]="LongPolling",o})(Q||{}),ee=(function(o){return o[o.Text=1]="Text",o[o.Binary=2]="Binary",o})(ee||{});var An=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var Pi=class{get pollAborted(){return this._pollAbort.aborted}constructor(t,e,i){this._httpClient=t,this._logger=e,this._pollAbort=new An,this._options=i,this._running=!1,this.onreceive=null,this.onclose=null}async connect(t,e){if(F.isRequired(t,"url"),F.isRequired(e,"transferFormat"),F.isIn(e,ee,"transferFormat"),this._url=t,this._logger.log(u.Trace,"(LongPolling transport) Connecting."),e===ee.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[i,n]=rt(),r=M({[i]:n},this._options.headers),s={abortSignal:this._pollAbort.signal,headers:r,timeout:1e5,withCredentials:this._options.withCredentials};e===ee.Binary&&(s.responseType="arraybuffer");let a=`${t}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${a}.`);let d=await this._httpClient.get(a,s);d.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),this._closeError=new Ce(d.statusText||"",d.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)}async _poll(t,e){try{for(;this._running;)try{let i=`${t}&_=${Date.now()}`;this._logger.log(u.Trace,`(LongPolling transport) polling: ${i}.`);let n=await this._httpClient.get(i,e);n.statusCode===204?(this._logger.log(u.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):n.statusCode!==200?(this._logger.log(u.Error,`(LongPolling transport) Unexpected response code: ${n.statusCode}.`),this._closeError=new Ce(n.statusText||"",n.statusCode),this._running=!1):n.content?(this._logger.log(u.Trace,`(LongPolling transport) data received. ${xt(n.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(n.content)):this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(i){this._running?i instanceof wt?this._logger.log(u.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=i,this._running=!1):this._logger.log(u.Trace,`(LongPolling transport) Poll errored after shutdown: ${i.message}`)}}finally{this._logger.log(u.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(t){return this._running?xn(this._logger,"LongPolling",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(u.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(u.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let t={},[e,i]=rt();t[e]=i;let n={headers:M(M({},t),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials},r;try{await this._httpClient.delete(this._url,n)}catch(s){r=s}r?r instanceof Ce&&(r.statusCode===404?this._logger.log(u.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(u.Trace,`(LongPolling transport) Error sending a DELETE request: ${r}`)):this._logger.log(u.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(u.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this._closeError&&(t+=" Error: "+this._closeError),this._logger.log(u.Trace,t),this.onclose(this._closeError)}}};var Ln=class{constructor(t,e,i,n){this._httpClient=t,this._accessToken=e,this._logger=i,this._options=n,this.onreceive=null,this.onclose=null}async connect(t,e){return F.isRequired(t,"url"),F.isRequired(e,"transferFormat"),F.isIn(e,ee,"transferFormat"),this._logger.log(u.Trace,"(SSE transport) Connecting."),this._url=t,this._accessToken&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((i,n)=>{let r=!1;if(e!==ee.Text){n(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let s;if(B.isBrowser||B.isWebWorker)s=new this._options.EventSource(t,{withCredentials:this._options.withCredentials});else{let a=this._httpClient.getCookieString(t),d={};d.Cookie=a;let[g,_]=rt();d[g]=_,s=new this._options.EventSource(t,{withCredentials:this._options.withCredentials,headers:M(M({},d),this._options.headers)})}try{s.onmessage=a=>{if(this.onreceive)try{this._logger.log(u.Trace,`(SSE transport) data received. ${xt(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(d){this._close(d);return}},s.onerror=a=>{r?this._close():n(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},s.onopen=()=>{this._logger.log(u.Information,`SSE connected to ${this._url}`),this._eventSource=s,r=!0,i()}}catch(a){n(a);return}})}async send(t){return this._eventSource?xn(this._logger,"SSE",this._httpClient,this._url,t,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(t){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(t))}};var Fn=class{constructor(t,e,i,n,r,s){this._logger=i,this._accessTokenFactory=e,this._logMessageContent=n,this._webSocketConstructor=r,this._httpClient=t,this.onreceive=null,this.onclose=null,this._headers=s}async connect(t,e){F.isRequired(t,"url"),F.isRequired(e,"transferFormat"),F.isIn(e,ee,"transferFormat"),this._logger.log(u.Trace,"(WebSockets transport) Connecting.");let i;return this._accessTokenFactory&&(i=await this._accessTokenFactory()),new Promise((n,r)=>{t=t.replace(/^http/,"ws");let s,a=this._httpClient.getCookieString(t),d=!1;if(B.isNode||B.isReactNative){let g={},[_,N]=rt();g[_]=N,i&&(g[At.Authorization]=`Bearer ${i}`),a&&(g[At.Cookie]=a),s=new this._webSocketConstructor(t,void 0,{headers:M(M({},g),this._headers)})}else i&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(i)}`);s||(s=new this._webSocketConstructor(t)),e===ee.Binary&&(s.binaryType="arraybuffer"),s.onopen=g=>{this._logger.log(u.Information,`WebSocket connected to ${t}.`),this._webSocket=s,d=!0,n()},s.onerror=g=>{let _=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?_=g.error:_="There was an error with the transport",this._logger.log(u.Information,`(WebSockets transport) ${_}.`)},s.onmessage=g=>{if(this._logger.log(u.Trace,`(WebSockets transport) data received. ${xt(g.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(g.data)}catch(_){this._close(_);return}},s.onclose=g=>{if(d)this._close(g);else{let _=null;typeof ErrorEvent<"u"&&g instanceof ErrorEvent?_=g.error:_="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",r(new Error(_))}}})}send(t){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(u.Trace,`(WebSockets transport) sending data. ${xt(t,this._logMessageContent)}.`),this._webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(t){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(u.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(t)&&(t.wasClean===!1||t.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)):t instanceof Error?this.onclose(t):this.onclose())}_isCloseEvent(t){return t&&typeof t.wasClean=="boolean"&&typeof t.code=="number"}};var Ps=100,Vn=class{constructor(t,e={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,F.isRequired(t,"url"),this._logger=ws(e.logger),this.baseUrl=this._resolveUrl(t),e=e||{},e.logMessageContent=e.logMessageContent===void 0?!1:e.logMessageContent,typeof e.withCredentials=="boolean"||e.withCredentials===void 0)e.withCredentials=e.withCredentials===void 0?!0:e.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.timeout=e.timeout===void 0?100*1e3:e.timeout;let i=null,n=null;if(B.isNode&&typeof Lt<"u"){let r=typeof __webpack_require__=="function"?__non_webpack_require__:Lt;i=r("ws"),n=r("eventsource")}!B.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:B.isNode&&!e.WebSocket&&i&&(e.WebSocket=i),!B.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:B.isNode&&!e.EventSource&&typeof n<"u"&&(e.EventSource=n),this._httpClient=new Rn(e.httpClient||new Dn(this._logger),e.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=e,this.onreceive=null,this.onclose=null}async start(t){if(t=t||ee.Binary,F.isIn(t,ee,"transferFormat"),this._logger.log(u.Debug,`Starting connection with transfer format '${ee[t]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(t),await this._startInternalPromise,this._connectionState==="Disconnecting"){let e="Failed to start the HttpConnection before stop() was called.";return this._logger.log(u.Error,e),await this._stopPromise,Promise.reject(new ce(e))}else if(this._connectionState!=="Connected"){let e="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(u.Error,e),Promise.reject(new ce(e))}this._connectionStarted=!0}send(t){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Co(this.transport)),this._sendQueue.send(t))}async stop(t){if(this._connectionState==="Disconnected")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(u.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(e=>{this._stopPromiseResolver=e}),await this._stopInternal(t),await this._stopPromise}async _stopInternal(t){this._stopError=t;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(e){this._logger.log(u.Error,`HttpConnection.transport.stop() threw error '${e}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(u.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(t){let e=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===Q.WebSockets)this.transport=this._constructTransport(Q.WebSockets),await this._startTransport(e,t);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let i=null,n=0;do{if(i=await this._getNegotiationResponse(e),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ce("The connection was stopped during negotiation.");if(i.error)throw new Error(i.error);if(i.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(i.url&&(e=i.url),i.accessToken){let r=i.accessToken;this._accessTokenFactory=()=>r,this._httpClient._accessToken=r,this._httpClient._accessTokenFactory=void 0}n++}while(i.url&&n<Ps);if(n===Ps&&i.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(e,this._options.transport,i,t)}this.transport instanceof Pi&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(u.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(i){return this._logger.log(u.Error,"Failed to start the connection: "+i),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(i)}}async _getNegotiationResponse(t){let e={},[i,n]=rt();e[i]=n;let r=this._resolveNegotiateUrl(t);this._logger.log(u.Debug,`Sending negotiation request: ${r}.`);try{let s=await this._httpClient.post(r,{content:"",headers:M(M({},e),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));let a=JSON.parse(s.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new xi("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(s){let a="Failed to complete negotiation with the server: "+s;return s instanceof Ce&&s.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(u.Error,a),Promise.reject(new xi(a))}}_createConnectUrl(t,e){return e?t+(t.indexOf("?")===-1?"?":"&")+`id=${e}`:t}async _createTransport(t,e,i,n){let r=this._createConnectUrl(t,i.connectionToken);if(this._isITransport(e)){this._logger.log(u.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=e,await this._startTransport(r,n),this.connectionId=i.connectionId;return}let s=[],a=i.availableTransports||[],d=i;for(let g of a){let _=this._resolveTransportOrError(g,e,n,d?.useStatefulReconnect===!0);if(_ instanceof Error)s.push(`${g.transport} failed:`),s.push(_);else if(this._isITransport(_)){if(this.transport=_,!d){try{d=await this._getNegotiationResponse(t)}catch(N){return Promise.reject(N)}r=this._createConnectUrl(t,d.connectionToken)}try{await this._startTransport(r,n),this.connectionId=d.connectionId;return}catch(N){if(this._logger.log(u.Error,`Failed to start the transport '${g.transport}': ${N}`),d=void 0,s.push(new yn(`${g.transport} failed: ${N}`,Q[g.transport])),this._connectionState!=="Connecting"){let Se="Failed to select transport before stop() was called.";return this._logger.log(u.Debug,Se),Promise.reject(new ce(Se))}}}}return s.length>0?Promise.reject(new Sn(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(t){switch(t){case Q.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new Fn(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case Q.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Ln(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case Q.LongPolling:return new Pi(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${t}.`)}}_startTransport(t,e){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async i=>{let n=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(t,e),await this.features.resend()}catch{n=!0}else{this._stopConnection(i);return}n&&this._stopConnection(i)}:this.transport.onclose=i=>this._stopConnection(i),this.transport.connect(t,e)}_resolveTransportOrError(t,e,i,n){let r=Q[t.transport];if(r==null)return this._logger.log(u.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(Ll(e,r))if(t.transferFormats.map(a=>ee[a]).indexOf(i)>=0){if(r===Q.WebSockets&&!this._options.WebSocket||r===Q.ServerSentEvents&&!this._options.EventSource)return this._logger.log(u.Debug,`Skipping transport '${Q[r]}' because it is not supported in your environment.'`),new bn(`'${Q[r]}' is not supported in your environment.`,r);this._logger.log(u.Debug,`Selecting transport '${Q[r]}'.`);try{return this.features.reconnect=r===Q.WebSockets?n:void 0,this._constructTransport(r)}catch(a){return a}}else return this._logger.log(u.Debug,`Skipping transport '${Q[r]}' because it does not support the requested transfer format '${ee[i]}'.`),new Error(`'${Q[r]}' does not support ${ee[i]}.`);else return this._logger.log(u.Debug,`Skipping transport '${Q[r]}' because it was disabled by the client.`),new Cn(`'${Q[r]}' is disabled by the client.`,r)}_isITransport(t){return t&&typeof t=="object"&&"connect"in t}_stopConnection(t){if(this._logger.log(u.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this._connectionState}.`),this.transport=void 0,t=this._stopError||t,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(u.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(u.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),t?this._logger.log(u.Error,`Connection disconnected with error '${t}'.`):this._logger.log(u.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(u.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(e){this._logger.log(u.Error,`HttpConnection.onclose(${t}) threw error '${e}'.`)}}}_resolveUrl(t){if(t.lastIndexOf("https://",0)===0||t.lastIndexOf("http://",0)===0)return t;if(!B.isBrowser)throw new Error(`Cannot resolve '${t}'.`);let e=window.document.createElement("a");return e.href=t,this._logger.log(u.Information,`Normalizing '${t}' to '${e.href}'.`),e.href}_resolveNegotiateUrl(t){let e=new URL(t);e.pathname.endsWith("/")?e.pathname+="negotiate":e.pathname+="/negotiate";let i=new URLSearchParams(e.searchParams);return i.has("negotiateVersion")||i.append("negotiateVersion",this._negotiateVersion.toString()),i.has("useStatefulReconnect")?i.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&i.append("useStatefulReconnect","true"),e.search=i.toString(),e.toString()}};function Ll(o,t){return!o||(t&o)!==0}var Co=class o{constructor(t){this._transport=t,this._buffer=[],this._executing=!0,this._sendBufferedData=new ai,this._transportResult=new ai,this._sendLoopPromise=this._sendLoop()}send(t){return this._bufferData(t),this._transportResult||(this._transportResult=new ai),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(t){if(this._buffer.length&&typeof this._buffer[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof t}`);this._buffer.push(t),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new ai;let t=this._transportResult;this._transportResult=void 0;let e=typeof this._buffer[0]=="string"?this._buffer.join(""):o._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(e),t.resolve()}catch(i){t.reject(i)}}}static _concatBuffers(t){let e=t.map(r=>r.byteLength).reduce((r,s)=>r+s),i=new Uint8Array(e),n=0;for(let r of t)i.set(new Uint8Array(r),n),n+=r.byteLength;return i.buffer}},ai=class{constructor(){this.promise=new Promise((t,e)=>[this._resolver,this._rejecter]=[t,e])}resolve(){this._resolver()}reject(t){this._rejecter(t)}};var Fl="json",jn=class{constructor(){this.name=Fl,this.version=2,this.transferFormat=ee.Text}parseMessages(t,e){if(typeof t!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];e===null&&(e=ot.instance);let i=ye.parse(t),n=[];for(let r of i){let s=JSON.parse(r);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case E.Invocation:this._isInvocationMessage(s);break;case E.StreamItem:this._isStreamItemMessage(s);break;case E.Completion:this._isCompletionMessage(s);break;case E.Ping:break;case E.Close:break;case E.Ack:this._isAckMessage(s);break;case E.Sequence:this._isSequenceMessage(s);break;default:e.log(u.Information,"Unknown message type '"+s.type+"' ignored.");continue}n.push(s)}return n}writeMessage(t){return ye.write(JSON.stringify(t))}_isInvocationMessage(t){this._assertNotEmptyString(t.target,"Invalid payload for Invocation message."),t.invocationId!==void 0&&this._assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(t){if(this._assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),t.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this._assertNotEmptyString(t.error,"Invalid payload for Completion message."),this._assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}_isAckMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(t){if(typeof t.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(t,e){if(typeof t!="string"||t==="")throw new Error(e)}};var Vl={trace:u.Trace,debug:u.Debug,info:u.Information,information:u.Information,warn:u.Warning,warning:u.Warning,error:u.Error,critical:u.Critical,none:u.None};function jl(o){let t=Vl[o.toLowerCase()];if(typeof t<"u")return t;throw new Error(`Unknown log level: ${o}`)}var Ei=class{configureLogging(t){if(F.isRequired(t,"logging"),Bl(t))this.logger=t;else if(typeof t=="string"){let e=jl(t);this.logger=new Rt(e)}else this.logger=new Rt(t);return this}withUrl(t,e){return F.isRequired(t,"url"),F.isNotEmpty(t,"url"),this.url=t,typeof e=="object"?this.httpConnectionOptions=M(M({},this.httpConnectionOptions),e):this.httpConnectionOptions=ae(M({},this.httpConnectionOptions),{transport:e}),this}withHubProtocol(t){return F.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new Mi(t):this.reconnectPolicy=t:this.reconnectPolicy=new Mi,this}withServerTimeout(t){return F.isRequired(t,"milliseconds"),this._serverTimeoutInMilliseconds=t,this}withKeepAliveInterval(t){return F.isRequired(t,"milliseconds"),this._keepAliveIntervalInMilliseconds=t,this}withStatefulReconnect(t){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=t?.bufferSize,this}build(){let t=this.httpConnectionOptions||{};if(t.logger===void 0&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let e=new Vn(this.url,t);return In.create(e,this.logger||ot.instance,this.protocol||new jn,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};function Bl(o){return o.log!==void 0}var Es="https://localhost:7113",Hl="https://localhost:7113/api";function Ds(){return`${Hl}/Mosaic/PolygonTriangulationMesh`}var Bn=class o{getVertices(){return[this.a,this.b,this.c]}static restore(t){Object.setPrototypeOf(t,o.prototype),t.getVertices().forEach(e=>R.restore(e))}};var Nn=class{static restore(t){t.parts.forEach(e=>Di.restore(e))}},Di=class{static restore(t){t.triangles.forEach(e=>Bn.restore(e)),t.contour.forEach(e=>R.restore(e))}};var Os=(()=>{class o{constructor(){this.sectionsMeshReceivedSub=new x,this.sectionsMeshReceived$=this.sectionsMeshReceivedSub.asObservable(),this.sectionGeneratedSub=new x,this.sectionGenerated$=this.sectionGeneratedSub.asObservable(),this.generationFinishedSub=new x,this.generationFinished$=this.generationFinishedSub.asObservable(),this.generationAbortedWithErrorSub=new x,this.generationAbortedWithError$=this.generationAbortedWithErrorSub.asObservable(),this.isClosed=!1,this.hubConnection=new Ei().withUrl(`${Es}/process-hub`,{skipNegotiation:!0,transport:Q.WebSockets}).build(),this.subscribeOnSectionGenerated(),this.subscribeOnFinishGeneration(),this.subscribeOnSectionsMeshReceived(),this.subscribeOnAbortGenerationInErrorCase()}subscribeOnSectionGenerated(){this.hubConnection.on("ReceiveMosaicSectionTiles",e=>this.sectionGeneratedSub.next(e))}subscribeOnFinishGeneration(){this.hubConnection.on("ReceiveFinishNotification",()=>this.generationFinishedSub.next())}subscribeOnAbortGenerationInErrorCase(){this.hubConnection.on("AbortGenerationInErrorCase",()=>this.generationAbortedWithErrorSub.next())}subscribeOnSectionsMeshReceived(){this.hubConnection.on("ReceiveMosaicSectorsMesh",e=>{e.forEach(i=>Nn.restore(i)),this.sectionsMeshReceivedSub.next(e)})}startLongRunningTask(e){return this.hubConnection.invoke("StartMosaicGeneration",e).catch(i=>{if(!this.isClosed)throw i})}initMosaicTriangulation(e){return this.hubConnection.invoke("InitMosaicTriangulation",e).catch(i=>{if(!this.isClosed)throw i})}startConnection(){return this.hubConnection.start()}stopConnection(){return this.isClosed=!0,this.hubConnection.stop()}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Hn=class{constructor(t){this.visualObjects=[],this.sections=[],this.tilesSub=new Be([]),this.tiles$=this.tilesSub.asObservable(),this.areTilesVisible=!0,this.schema=t}addSection(t){this.sections.push(t),t.tiles.forEach(e=>e.tileObject.setVisibility(this.areTilesVisible)),this.tilesSub.next(this.sections.flatMap(e=>e.tiles))}setSectorMeshVisibility(t){for(let e of this.visualObjects)e.setVisibility(t)}setSectorVisualObjects(t){this.visualObjects.forEach(e=>e.removeObject()),this.visualObjects=t}setTilesVisibility(t){this.areTilesVisible=t;let e=this.tilesSub.value;e.length&&(e.forEach(i=>i.tileObject.setVisibility(this.areTilesVisible)),e[0].tileObject.parentCanvas.redraw())}};var Oi=(()=>{class o{constructor(){this.sectorsInfo=new Map,this.sectorsSub=new x,this.sectors$=this.sectorsSub.asObservable()}buildInitMosaicRequest(e,i,n){return{base64Image:e,mosaicWidth:i.width,sectorsGenerationParams:n.map(r=>({id:r.id,tileMargin:r.properties.tilesMargin,tileMinRadius:r.properties.minTileRadius,tileMaxRadius:r.properties.maxTileRadius,triangulationData:{polygonVertices:r.vertices,sectionMaxArea:r.properties.sectionMaxArea,sectionMinAngle:r.properties.sectionMinAngle},evaluationParams:r.properties.evaluationParams,populationParams:r.properties.populationParams}))}}initGeneratedSectorsData(e){for(let i of e)this.sectorsInfo.set(i.id,new Hn(i));this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}fillSectorsGenerationInfo(e){for(let i of e){let n=this.sectorsInfo.get(i.sectorId);n.countOfSections=i.parts.flatMap(r=>r.triangles).length}this.sectorsSub.next(Array.from(this.sectorsInfo.values()))}addSectionTilesObjects(e,i){this.sectorsInfo.get(e).addSection({tiles:i})}getSectorById(e){return this.sectorsInfo.get(e)}getSectors(){return Array.from(this.sectorsInfo.values())}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac})}}return o})();function zl(o,t){if(o&1&&(h(0,"div",7)(1,"span",9),m(2),p()()),o&2){let e=t.$implicit;l(2),D(" ",e.tileTransform.tileId," ")}}function $l(o,t){o&1&&(h(0,"span",8),m(1),v(2,"translate"),p()),o&2&&(l(),f(b(2,1,"tool.generation.sectorList.noTiles")))}var ks=(()=>{class o{constructor(){this.sector=se.required(),this.isOpen=P(!1),this.items$=Z(()=>this.sector().tiles$),this.areTilesVisible=P(!0),this.translate=c(X)}toggleTilesList(){this.isOpen.update(e=>!e)}toggleTilesVisibility(){this.areTilesVisible.update(e=>!e),this.sector().setTilesVisibility(this.areTilesVisible())}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-list-elem"]],inputs:{sector:[1,"sector"]},decls:15,vars:8,consts:[[1,"parent-elem"],[1,"sector-actions"],["mat-icon-button","",1,"sector-action",3,"click"],[1,"visibility-icon","material-symbols-outlined"],["mat-icon-button","",1,"sector-action","toggle-action",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"],[1,"tile"],[1,"empty"],[1,"label"]],template:function(i,n){i&1&&(h(0,"div",0)(1,"span"),m(2),p(),h(3,"div",1)(4,"button",2),C("click",function(){return n.toggleTilesVisibility()}),h(5,"mat-icon",3),m(6),p()(),h(7,"button",4),C("click",function(){return n.toggleTilesList()}),h(8,"mat-icon",5),m(9," keyboard_arrow_up "),p()()()(),h(10,"app-expandable-panel",6),fe(11,zl,3,1,"div",7,pt,!1,$l,3,3,"span",8),v(14,"async"),p()),i&2&&(l(2),f(n.sector().schema.name),l(4),D(" ",n.areTilesVisible()?"visibility":"visibility_off"," "),l(2),z("chevron--closed",!n.isOpen()),l(2),y("isOpen",n.isOpen()),l(),_e(b(14,6,n.items$())))},dependencies:[De,Ee,L,ke,ii,U,Wi,Y],styles:["[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .parent-elem.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:12px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .visibility-icon[_ngcontent-%COMP%]{font-weight:300;color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .sector-action[_ngcontent-%COMP%]{margin:-6px}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]{color:var(--irr-contrast-medium)}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .parent-elem[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]   .toggle-action[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]{overflow:hidden;display:flex;flex-direction:column;gap:6px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .tile[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap;font-size:12px}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{align-self:center;color:var(--irr-contrast-light)}[_nghost-%COMP%]   .panel[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:first-child{margin-top:6px}"],changeDetection:0})}}return o})();function Ul(o,t){if(o&1&&w(0,"app-sector-list-elem",1),o&2){let e=t.$implicit;y("sector",e)}}var Ts=(()=>{class o{constructor(){this.service=c(Oi)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-mosaic-hierarchy"]],decls:4,vars:2,consts:[[1,"sectors"],[3,"sector"]],template:function(i,n){i&1&&(h(0,"div",0),fe(1,Ul,1,1,"app-sector-list-elem",1,pt),v(3,"async"),p()),i&2&&(l(),_e(b(3,0,n.service.sectors$)))},dependencies:[ks,Wi],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .sectors[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}"],changeDetection:0})}}return o})();function Wl(o,t){if(o&1&&(Et(0,"span",0),m(1),Dt(),Et(2,"span",1),m(3),Dt()),o&2){O();let e=Jn(0);l(),f(e.sector),l(2),D("",e.percent,"%")}}function ql(o,t){if(o&1&&(Et(0,"span",0),m(1),Dt()),o&2){O();let e=Jn(0);l(),f(e.message)}}var Is=(()=>{class o{constructor(){this.infoState=se.required()}isProgressInfo(e){return e.type==="progress"}isInitInfo(e){return e.type==="init"}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-progress-info"]],inputs:{infoState:[1,"infoState"]},decls:3,vars:2,consts:[[1,"loading"],[1,"right"]],template:function(i,n){if(i&1&&(Yo(0),te(1,Wl,4,2)(2,ql,2,1,"span",0)),i&2){let r=Qo(n.infoState());l(),ie(n.isProgressInfo(r)?1:n.isInitInfo(r)?2:-1)}},styles:['.loading[_ngcontent-%COMP%]:after{content:"";animation:_ngcontent-%COMP%_dots 2s linear infinite}@keyframes _ngcontent-%COMP%_dots{0%,20%{content:"."}40%{content:".."}60%{content:"..."}90%,to{content:""}}[_nghost-%COMP%]{display:flex;width:200px;height:auto;font-size:14px;border:1px solid;padding:12px;border-radius:4px;border-color:transparent;background:#ccc;opacity:.75;color:#141414;box-shadow:0 3px 5px -1px #0003,0 6px 10px #00000024,0 1px 18px #0000001f}[_nghost-%COMP%]   .right[_ngcontent-%COMP%]{margin-left:auto}'],changeDetection:0})}}return o})();function Gl(o,t){if(o&1&&w(0,"app-progress-info",0),o&2){let e=O();y("infoState",e.progressState())}}var Rs=(()=>{class o{constructor(){this.toolService=c(be),this.isImageVisible=P(!1),this.isMeshVisible=P(!0),this.showMesh$=new Be(!0),this.progressState=P(null),this.ribbonActions=[{iconName:"crop",visibility:P("on"),onClick:()=>this.toolService.openTakeSnapshotDialog(this.activeCanvas,"generating_snapshot.png")},{iconName:"recenter",visibility:P("on"),onClick:()=>{this.focusOnImage(),this.activeCanvas.redraw()}},{iconName:"graph_3",onClick:()=>this.toggleMeshVisibility(),visibility:Z(()=>this.isMeshVisible()?"on":"off")},{iconName:"image",onClick:()=>this.toggleImageVisibility(),visibility:Z(()=>this.isImageVisible()?"on":"off")}],this.store=c(A),this.translate=c(X),this.destroyRef=c(K),this.snackBar=c(it),this.signalRService=c(Os),this.service=c(Oi)}ngOnInit(){this.subscribeOnGenerationProgress(),this.subscribeOnSectorsMeshReceived(),this.subscribeOnMeshGenerationFinished(),this.subscribeOnMeshVisibilityChange(),this.destroyRef.onDestroy(()=>this.signalRService.stopConnection())}async onCanvasReady(e){let i=this.store.selectSignal(Ze)();this.imageObject=await be.createImageObject(i),this.imageObject.setVisibility(this.isImageVisible()),this.activeCanvas.addCanvasObject(this.imageObject),e&&this.focusOnImage(),this.activeCanvas.redraw(),this.initSectors(),this.initGeneration(i.base64Image,this.imageObject.size)}initGeneration(e,i){this.signalRService.startConnection().then(()=>{let n=this.store.selectSignal(ve)(),r=this.service.buildInitMosaicRequest(e,i,n);this.availableTiles=this.getAvailableTiles(),this.progressState.set({type:"init",message:this.translate.instant("tool.generation.message.sectorsMeshGeneration")}),this.signalRService.initMosaicTriangulation(r).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnSectorsMeshGeneration")))}).catch(()=>this.setError(this.translate.instant("tool.generation.message.errorOnServerConnection")))}subscribeOnGenerationProgress(){this.signalRService.sectionGenerated$.pipe(W(this.destroyRef)).subscribe(e=>{let i=[];for(let r of e.tilesTransforms){let s=this.availableTiles.find(g=>g.id===r.tileId),a=mn(s.vertices,r.position,r.angle),d=new ei(a,s.color);this.activeCanvas.addCanvasObject(d),i.push({tileObject:d,tileTransform:r})}let n=this.service.getSectorById(e.sectorId);this.service.addSectionTilesObjects(e.sectorId,i),this.progressState.set({type:"progress",sector:n.schema.name,percent:Math.floor(n.sections.length/n.countOfSections*100)}),this.activeCanvas.redraw()})}subscribeOnSectorsMeshReceived(){this.signalRService.sectionsMeshReceived$.pipe(W(this.destroyRef)).subscribe(e=>{let i=this.store.selectSignal(ve)();this.createSectorsMeshCanvasObjects(e,i),this.service.fillSectorsGenerationInfo(e);let n=this.availableTiles.map(r=>({color:r.color,id:r.id,vertices:r.vertices}));this.signalRService.startLongRunningTask(n).catch(()=>this.showMessage(this.translate.instant("tool.generation.message.errorOnStartingMosaicGeneration")))})}subscribeOnMeshGenerationFinished(){this.signalRService.generationFinished$.pipe(W(this.destroyRef)).subscribe(()=>{this.progressState.set(null),this.showMessage(this.translate.instant("tool.generation.message.generationCompleted"))})}subscribeOnMeshVisibilityChange(){this.showMesh$.pipe(W(this.destroyRef)).subscribe(e=>{for(let i of this.service.getSectors())i.setSectorMeshVisibility(e);this.activeCanvas.redraw()})}createSectorsMeshCanvasObjects(e,i){for(let n=0;n<i.length;++n){let r=i[n],s=this.service.getSectorById(r.id),a=[];for(let d of e[n].parts){let g=this.createSectorMeshObject(r,d,n);this.activeCanvas.addCanvasObject(g),a.push(g)}s.setSectorVisualObjects(a)}this.activeCanvas.redraw()}initSectors(){let e=this.store.selectSignal(ve)();this.service.initGeneratedSectorsData(e),this.initSectorsMeshes(e)}initSectorsMeshes(e){for(let i=0;i<e.length;++i){let n=this.service.getSectorById(e[i].id),r=this.createSectorContourObject(e[i],i);this.activeCanvas.addCanvasObject(r),n.visualObjects.push(r)}this.activeCanvas.redraw()}createSectorMeshObject(e,i,n){return new oi(i.triangles,i.contour,e.color,10+n)}createSectorContourObject(e,i){return new ri([...e.vertices],e.color,10+i)}getAvailableTiles(){return this.store.selectSignal(Xe)().flatMap(i=>i.tiles)}toggleMeshVisibility(){let e=!this.isMeshVisible();this.showMesh$.next(e),this.isMeshVisible.set(e)}toggleImageVisibility(){let e=!this.isImageVisible();this.imageObject.setVisibility(e),this.activeCanvas.redraw(),this.isImageVisible.set(e)}setError(e){this.progressState.set(null),this.showMessage(e)}showMessage(e){this.snackBar.open(e,this.translate.instant("common.ok"),{duration:3e3})}sectionEntered(e,i){return this.activeCanvas=e,this.onCanvasReady(i),{ribbon:this.ribbonActions}}focusOnImage(){let e=be.calculateZoomForImage(this.imageObject.size,this.activeCanvas.viewport);this.activeCanvas.setViewport(e,R.zero)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-mosaic-generation"]],features:[de([Oi])],decls:2,vars:1,consts:[[1,"info",3,"infoState"]],template:function(i,n){i&1&&(w(0,"app-mosaic-hierarchy"),te(1,Gl,1,1,"app-progress-info",0)),i&2&&(l(),ie(n.progressState()?1:-1))},dependencies:[Ts,Is],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;height:100%;padding:20px 10px;overflow-y:auto;overflow-x:hidden}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{position:absolute;left:-250px;bottom:30px}"],changeDetection:0})}}return o})();var As=()=>c(A).selectSignal(ve)().length?!0:(c($).navigate([un]),!1);function wo(o){let t=o.cloneNode(!0),e=t.querySelectorAll("[id]"),i=o.nodeName.toLowerCase();t.removeAttribute("id");for(let n=0;n<e.length;n++)e[n].removeAttribute("id");return i==="canvas"?Vs(o,t):(i==="input"||i==="select"||i==="textarea")&&Fs(o,t),Ls("canvas",o,t,Vs),Ls("input, textarea, select",o,t,Fs),t}function Ls(o,t,e,i){let n=t.querySelectorAll(o);if(n.length){let r=e.querySelectorAll(o);for(let s=0;s<n.length;s++)i(n[s],r[s])}}var Kl=0;function Fs(o,t){t.type!=="file"&&(t.value=o.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${Kl++}`)}function Vs(o,t){let e=t.getContext("2d");if(e)try{e.drawImage(o,0,0)}catch{}}function Oo(o){let t=o.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function xo(o,t,e){let{top:i,bottom:n,left:r,right:s}=o;return e>=i&&e<=n&&t>=r&&t<=s}function Zl(o,t){let e=t.left<o.left,i=t.left+t.width>o.right,n=t.top<o.top,r=t.top+t.height>o.bottom;return e||i||n||r}function Ii(o,t,e){o.top+=t,o.bottom=o.top+o.height,o.left+=e,o.right=o.left+o.width}function js(o,t,e,i){let{top:n,right:r,bottom:s,left:a,width:d,height:g}=o,_=d*t,N=g*t;return i>n-N&&i<s+N&&e>a-_&&e<r+_}var zn=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Oo(e)})})}handleScroll(t){let e=Ot(t),i=this.positions.get(e);if(!i)return null;let n=i.scrollPosition,r,s;if(e===this._document){let g=this.getViewportScrollPosition();r=g.top,s=g.left}else r=e.scrollTop,s=e.scrollLeft;let a=n.top-r,d=n.left-s;return this.positions.forEach((g,_)=>{g.clientRect&&e!==_&&e.contains(_)&&Ii(g.clientRect,a,d)}),n.top=r,n.left=s,{top:a,left:d}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function Ys(o,t){let e=o.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(n=>i.appendChild(n)),i}function ko(o,t,e){for(let i in t)if(t.hasOwnProperty(i)){let n=t[i];n?o.setProperty(i,n,e?.has(i)?"important":""):o.removeProperty(i)}return o}function li(o,t){let e=t?"":"none";ko(o.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function Bs(o,t,e){ko(o.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function $n(o,t){return t&&t!="none"?o+" "+t:o}function Ns(o,t){o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.style.transform=Ri(t.left,t.top)}function Ri(o,t){return`translate3d(${Math.round(o)}px, ${Math.round(t)}px, 0)`}function Hs(o){let t=o.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(o)*t}function Xl(o){let t=getComputedStyle(o),e=yo(t,"transition-property"),i=e.find(a=>a==="transform"||a==="all");if(!i)return 0;let n=e.indexOf(i),r=yo(t,"transition-duration"),s=yo(t,"transition-delay");return Hs(r[n])+Hs(s[n])}function yo(o,t){return o.getPropertyValue(t).split(",").map(i=>i.trim())}var Yl=new Set(["position"]),Mo=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView;_preview;get element(){return this._preview}constructor(t,e,i,n,r,s,a,d,g,_){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=n,this._previewTemplate=r,this._previewClass=s,this._pickupPositionOnPage=a,this._initialTransform=d,this._zIndex=g,this._renderer=_}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),zs(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return Xl(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,n;if(i&&t){let r=t.matchSize?this._initialDomRect:null,s=t.viewContainer.createEmbeddedView(i,t.context);s.detectChanges(),n=Ys(s,this._document),this._previewEmbeddedView=s,t.matchSize?Ns(n,r):n.style.transform=Ri(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=wo(this._rootElement),Ns(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return ko(n.style,{"pointer-events":"none",margin:zs(n)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Yl),li(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(r=>n.classList.add(r)):n.classList.add(e)),n}};function zs(o){return"showPopover"in o}var Ql={passive:!0},$s={passive:!1},Jl={passive:!1,capture:!0},ec=800,Us="cdk-drag-placeholder",Ws=new Set(["position"]),Po=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview;_previewContainer;_placeholderRef;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=P(!1);_hasMoved;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new x;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement;_rootElementTapHighlight;_pointerMoveSubscription=je.EMPTY;_pointerUpSubscription=je.EMPTY;_scrollSubscription=je.EMPTY;_resizeSubscription=je.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>li(e,t)))}_disabled=!1;beforeStarted=new x;started=new x;released=new x;ended=new x;entered=new x;exited=new x;dropped=new x;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,n,r,s,a){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=s,this._renderer=a,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new zn(i),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>Oe(i)),this._handles.forEach(i=>li(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=Oe(t);if(e!==this._rootElement){this._removeRootElementListeners();let i=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[i.listen(e,"mousedown",this._pointerDown,$s),i.listen(e,"touchstart",this._pointerDown,Ql),i.listen(e,"dragstart",this._nativeDragStart,$s)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Oe(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&Zl(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let t=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),i=0,n=0;e.left<t.left?i=t.left-e.left:e.right>t.right&&(i=t.right-e.right),e.top<t.top?n=t.top-e.top:e.bottom>t.bottom&&(n=t.bottom-e.bottom);let r=this._activeTransform.x,s=this._activeTransform.y,a=r+i,d=s+n;this._rootElement.style.transform=Ri(a,d),this._activeTransform={x:a,y:d},this._passiveTransform={x:a,y:d}}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),li(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),li(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let n=Math.abs(e.x-this._pickupPositionOnPage.x),r=Math.abs(e.y-this._pickupPositionOnPage.y);if(n+r>=this._config.dragStartThreshold){let a=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),d=this._dropContainer;if(!a){this._endDragSequence(t);return}(!d||!d.isDragging()&&!d.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let n=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,r=this._activeTransform;r.x=i.x-n.x+this._passiveTransform.x,r.y=i.y-n.y+this._passiveTransform.y,this._applyRootElementTransform(r.x,r.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){ki(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",tc,Jl)}),i){let n=this._rootElement,r=n.parentNode,s=this._placeholder=this._createPlaceholderElement(),a=this._marker=this._marker||this._document.createComment("");r.insertBefore(a,n),this._initialTransform=n.style.transform||"",this._preview=new Mo(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(r,e)),Bs(n,!1,Ws),this._document.body.appendChild(r.replaceChild(s,n)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),n=ki(e),r=!n&&e.button!==0,s=this._rootElement,a=Ot(e),d=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+ec>Date.now(),g=n?or(e):nr(e);if(a&&a.draggable&&e.type==="mousedown"&&e.preventDefault(),i||r||d||g)return;if(this._handles.length){let Se=s.style;this._rootElementTapHighlight=Se.webkitTapHighlightColor||"",Se.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(Se=>this._updateOnScroll(Se)),this._boundaryElement&&(this._boundaryRect=Oo(this._boundaryElement));let _=this._previewTemplate;this._pickupPositionInElement=_&&_.template&&!_.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let N=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:N.x,y:N.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){Bs(this._rootElement,!0,Ws),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),r=this._getDragDistance(n),s=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:r,dropPoint:n,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,s,r,n,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{let s=this._dropContainer.getItemIndex(this),a=this._dropContainer.getItemAtIndex(s+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(r,this._dropContainer,a),this._dropContainer=r,this._dropContainer.enter(this,t,e,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let n=a=>{(!a||this._preview&&Ot(a)===this._preview.element&&a.propertyName==="transform")&&(s(),i(),clearTimeout(r))},r=setTimeout(n,e*1.5),s=this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=Ys(this._placeholderRef,this._document)):i=wo(this._rootElement),i.style.pointerEvents="none",i.classList.add(Us),i}_getPointerPositionInElement(t,e,i){let n=e===this._rootElement?null:e,r=n?n.getBoundingClientRect():t,s=ki(i)?i.targetTouches[0]:i,a=this._getViewportScrollPosition(),d=s.pageX-r.left-a.left,g=s.pageY-r.top-a.top;return{x:r.left-t.left+d,y:r.top-t.top+g}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=ki(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,r=i.pageY-e.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let a=this._ownerSVGElement.createSVGPoint();return a.x=n,a.y=r,a.matrixTransform(s.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,a=this._boundaryRect,{width:d,height:g}=this._getPreviewRect(),_=a.top+s,N=a.bottom-(g-s),Se=a.left+r,Zn=a.right-(d-r);i=qs(i,Se,Zn),n=qs(n,_,N)}return{x:i,y:n}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-r.x),a=Math.abs(i-r.y);return s>this._config.pointerDirectionChangeThreshold&&(n.x=e>r.x?1:-1,r.x=e),a>this._config.pointerDirectionChangeThreshold&&(n.y=i>r.y?1:-1,r.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,li(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,n=Ri(t*i,e*i),r=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=r.transform&&r.transform!="none"?r.transform:""),r.transform=$n(n,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,n=Ri(t,e);this._preview.setTransform($n(n,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||i.width===0&&i.height===0)return;let r=n.left-i.left,s=i.right-n.right,a=n.top-i.top,d=i.bottom-n.bottom;n.width>i.width?(r>0&&(t+=r),s>0&&(t-=s)):t=0,n.height>i.height?(a>0&&(e+=a),d>0&&(e-=d)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:ki(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=Ot(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&Ii(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=qi(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let n=this._document;return e||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Oe(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}_conditionallyInsertAnchor(t,e,i){if(t===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let n=this._anchor??=wo(this._placeholder);n.classList.remove(Us),n.classList.add("cdk-drag-anchor"),n.style.transform="",i?i.before(n):Oe(e.element).appendChild(n)}}};function qs(o,t,e){return Math.max(t,Math.min(e,o))}function ki(o){return o.type[0]==="t"}function tc(o){o.preventDefault()}function Wn(o,t,e){let i=Gs(t,o.length-1),n=Gs(e,o.length-1);if(i===n)return;let r=o[i],s=n<i?-1:1;for(let a=i;a!==n;a+=s)o[a]=o[a+s];o[n]=r}function Gs(o,t){return Math.max(0,Math.min(t,o))}var Un=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction;constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,n){let r=this._itemPositions,s=this._getItemIndexFromPointerPosition(t,e,i,n);if(s===-1&&r.length>0)return null;let a=this.orientation==="horizontal",d=r.findIndex(we=>we.drag===t),g=r[s],_=r[d].clientRect,N=g.clientRect,Se=d>s?1:-1,Zn=this._getItemOffsetPx(_,N,Se),ha=this._getSiblingOffsetPx(d,r,Se),pa=r.slice();return Wn(r,d,s),r.forEach((we,ma)=>{if(pa[ma]===we)return;let Io=we.drag===t,Xn=Io?Zn:ha,Ro=Io?t.getPlaceholderElement():we.drag.getRootElement();we.offset+=Xn;let Ao=Math.round(we.offset*(1/we.drag.scale));a?(Ro.style.transform=$n(`translate3d(${Ao}px, 0, 0)`,we.initialTransform),Ii(we.clientRect,0,Xn)):(Ro.style.transform=$n(`translate3d(0, ${Ao}px, 0)`,we.initialTransform),Ii(we.clientRect,Xn,0))}),this._previousSwap.overlaps=xo(N,e,i),this._previousSwap.drag=g.drag,this._previousSwap.delta=a?n.x:n.y,{previousIndex:d,currentIndex:s}}enter(t,e,i,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n,s=this._activeDraggables,a=s.indexOf(t),d=t.getPlaceholderElement(),g=s[r];if(g===t&&(g=s[r+1]),!g&&(r==null||r===-1||r<s.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(g=s[0]),a>-1&&s.splice(a,1),g&&!this._dragDropRegistry.isDragging(g)){let _=g.getRootElement();_.parentElement.insertBefore(d,_),s.splice(r,0,t)}else this._element.appendChild(d),s.push(t);d.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(n=>n.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return this._getVisualItemPositions().findIndex(e=>e.drag===t)}getItemAtIndex(t){return this._getVisualItemPositions()[t]?.drag||null}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{Ii(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:Oo(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(t,e,i){let n=this.orientation==="horizontal",r=n?e.left-t.left:e.top-t.top;return i===-1&&(r+=n?e.width-t.width:e.height-t.height),r}_getSiblingOffsetPx(t,e,i){let n=this.orientation==="horizontal",r=e[t].clientRect,s=e[t+i*-1],a=r[n?"width":"height"]*i;if(s){let d=n?"left":"top",g=n?"right":"bottom";i===-1?a-=s.clientRect[d]-r[g]:a+=r[d]-s.clientRect[g]}return a}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,n=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let s=i[i.length-1].clientRect;return n?t>=s.right:e>=s.bottom}else{let s=i[0].clientRect;return n?t<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(t,e,i,n){let r=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:a,clientRect:d})=>{if(a===t)return!1;if(n){let g=r?n.x:n.y;if(a===this._previousSwap.drag&&this._previousSwap.overlaps&&g===this._previousSwap.delta)return!1}return r?e>=Math.floor(d.left)&&e<Math.floor(d.right):i>=Math.floor(d.top)&&i<Math.floor(d.bottom)});return s===-1||!this._sortPredicate(s,t)?-1:s}},Eo=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let n=e[i];this._relatedNodes.push([n,n.nextSibling])}this.withItems(t)}sort(t,e,i,n){let r=this._getItemIndexFromPointerPosition(t,e,i),s=this._previousSwap;if(r===-1||this._activeItems[r]===t)return null;let a=this._activeItems[r];if(s.drag===a&&s.overlaps&&s.deltaX===n.x&&s.deltaY===n.y)return null;let d=this.getItemIndex(t),g=t.getPlaceholderElement(),_=a.getRootElement();r>d?_.after(g):_.before(g),Wn(this._activeItems,d,r);let N=this._getRootNode().elementFromPoint(e,i);return s.deltaX=n.x,s.deltaY=n.y,s.drag=a,s.overlaps=_===N||_.contains(N),{previousIndex:d,currentIndex:r}}enter(t,e,i,n){let r=this._activeItems.indexOf(t);r>-1&&this._activeItems.splice(r,1);let s=n==null||n<0?this._getItemIndexFromPointerPosition(t,e,i):n;s===-1&&(s=this._getClosestItemIndexToPointer(t,e,i));let a=this._activeItems[s];a&&!this._dragDropRegistry.isDragging(a)?(this._activeItems.splice(s,0,t),a.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[n,r]=this._relatedNodes[i];n.parentNode===t&&n.nextSibling!==r&&(r===null?t.appendChild(n):r.parentNode===t&&t.insertBefore(n,r))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}getItemAtIndex(t){return this._activeItems[t]||null}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let n=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),r=n?this._activeItems.findIndex(s=>{let a=s.getRootElement();return n===a||a.contains(n)}):-1;return r===-1||!this._sortPredicate(r,t)?-1:r}_getRootNode(){return this._rootNode||(this._rootNode=qi(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let n=1/0,r=-1;for(let s=0;s<this._activeItems.length;s++){let a=this._activeItems[s];if(a!==t){let{x:d,y:g}=a.getRootElement().getBoundingClientRect(),_=Math.hypot(e-d,i-g);_<n&&(n=_,r=s)}}return r}},Ks=.05,Qs=.05,Ie=(function(o){return o[o.NONE=0]="NONE",o[o.UP=1]="UP",o[o.DOWN=2]="DOWN",o})(Ie||{}),ge=(function(o){return o[o.NONE=0]="NONE",o[o.LEFT=1]="LEFT",o[o.RIGHT=2]="RIGHT",o})(ge||{}),Do=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new x;entered=new x;exited=new x;dropped=new x;sorted=new x;receivingStarted=new x;receivingStopped=new x;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=je.EMPTY;_verticalScrollDirection=Ie.NONE;_horizontalScrollDirection=ge.NONE;_scrollNode;_stopScrollTimers=new x;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,n,r){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=r;let s=this.element=Oe(t);this._document=i,this.withOrientation("vertical").withElementContainer(s),e.registerDropContainer(this),this._parentPositions=new zn(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,r,s,a,d={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:r,distance:s,dropPoint:a,event:d})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(n=>n.isDragging()).every(n=>t.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof Un&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new Eo(this._document,this._dragDropRegistry);else{let e=new Un(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=Oe(this.element),i=this._scrollableElements.indexOf(this._container),n=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),n>-1&&this._scrollableElements.splice(n,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}getItemAtIndex(t){return this._isDragging?this._sortStrategy.getItemAtIndex(t):this._draggables[t]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._domRect||!js(this._domRect,Ks,e,i))return;let r=this._sortStrategy.sort(t,e,i,n);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=Ie.NONE,r=ge.NONE;if(this._parentPositions.positions.forEach((s,a)=>{a===this._document||!s.clientRect||i||js(s.clientRect,Ks,t,e)&&([n,r]=ic(a,s.clientRect,this._direction,t,e),(n||r)&&(i=a))}),!n&&!r){let{width:s,height:a}=this._viewportRuler.getViewportSize(),d={width:s,height:a,top:0,right:s,bottom:a,left:0};n=Js(d,e),r=ea(d,t),i=window}i&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=i,(n||r)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),jo(0,Lo).pipe(Mt(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Ie.UP?t.scrollBy(0,-e):this._verticalScrollDirection===Ie.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===ge.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===ge.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&xo(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!xo(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let n=this._getShadowRoot().elementFromPoint(e,i);return n?n===this._container||this._container.contains(n):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=qi(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function Js(o,t){let{top:e,bottom:i,height:n}=o,r=n*Qs;return t>=e-r&&t<=e+r?Ie.UP:t>=i-r&&t<=i+r?Ie.DOWN:Ie.NONE}function ea(o,t){let{left:e,right:i,width:n}=o,r=n*Qs;return t>=e-r&&t<=e+r?ge.LEFT:t>=i-r&&t<=i+r?ge.RIGHT:ge.NONE}function ic(o,t,e,i,n){let r=Js(t,n),s=ea(t,i),a=Ie.NONE,d=ge.NONE;if(r){let g=o.scrollTop;r===Ie.UP?g>0&&(a=Ie.UP):o.scrollHeight-g>o.clientHeight&&(a=Ie.DOWN)}if(s){let g=o.scrollLeft;e==="rtl"?s===ge.RIGHT?g<0&&(d=ge.RIGHT):o.scrollWidth+g>o.clientWidth&&(d=ge.LEFT):s===ge.LEFT?g>0&&(d=ge.LEFT):o.scrollWidth-g>o.clientWidth&&(d=ge.RIGHT)}return[a,d]}var Ti={capture:!0},So={passive:!1,capture:!0},nc=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275cmp=S({type:o,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,n){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return o})(),ta=(()=>{class o{_ngZone=c(xe);_document=c(Bt);_styleLoader=c(qt);_renderer=c(pi).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new x;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=P([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new x;pointerUp=new x;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,So)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(nc),this._activeDragInstances.update(n=>[...n,e]),this._activeDragInstances().length===1)){let n=i.type.startsWith("touch"),r=a=>this.pointerUp.next(a),s=[["scroll",a=>this._scroll.next(a),Ti],["selectstart",this._preventDefaultWhileDragging,So]];n?s.push(["touchend",r,Ti],["touchcancel",r,Ti]):s.push(["mouseup",r,Ti]),n||s.push(["mousemove",a=>this.pointerMove.next(a),So]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=s.map(([a,d,g])=>this._renderer.listen(this._document,a,d,g))})}}stopDragging(e){this._activeDragInstances.update(i=>{let n=i.indexOf(e);return n>-1?(i.splice(n,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this._scroll];return e&&e!==this._document&&i.push(new Ft(n=>this._ngZone.runOutsideAngular(()=>{let r=this._renderer.listen(e,"scroll",s=>{this._activeDragInstances().length&&n.next(s)},Ti);return()=>{r()}}))),ht(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),oc={dragStartThreshold:5,pointerDirectionChangeThreshold:5},ia=(()=>{class o{_document=c(Bt);_ngZone=c(xe);_viewportRuler=c(Qi);_dragDropRegistry=c(ta);_renderer=c(pi).createRenderer(null,null);constructor(){}createDrag(e,i=oc){return new Po(e,i,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry,this._renderer)}createDropList(e){return new Do(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static \u0275fac=function(i){return new(i||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),Zs=new oe("CDK_DRAG_PARENT");var rc=new oe("CdkDragHandle");var na=new oe("CDK_DRAG_CONFIG"),oa=new oe("CdkDropList"),qn=(()=>{class o{element=c(me);dropContainer=c(oa,{optional:!0,skipSelf:!0});_ngZone=c(xe);_viewContainerRef=c(Vi);_dir=c(gi,{optional:!0});_changeDetectorRef=c(Ge);_selfHandle=c(rc,{optional:!0,self:!0});_parentDrag=c(Zs,{optional:!0,skipSelf:!0});_dragDropRegistry=c(ta);_destroyed=new x;_handles=new Be([]);_previewTemplate;_placeholderTemplate;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled;constrainPosition;previewClass;previewContainer;scale=1;started=new re;released=new re;ended=new re;entered=new re;exited=new re;dropped=new re;moved=new Ft(e=>{let i=this._dragRef.moved.pipe(Ai(n=>({source:this,pointerPosition:n.pointerPosition,event:n.event,delta:n.delta,distance:n.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=c(He);constructor(){let e=this.dropContainer,i=c(na,{optional:!0}),n=c(ia);this._dragRef=n.createDrag(this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Mt(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Pt(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,n=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,n&&!n.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),n=i.indexOf(e);n>-1&&(i.splice(n,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):Oe(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,n=this.dragStartDelay,r=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof n=="object"&&n?n:Gi(n),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(r).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(Li(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let n=this._dragDropRegistry.getDragDirectiveForNode(i);if(n){e.withParent(n._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:n,constrainPosition:r,previewClass:s,boundaryElement:a,draggingDisabled:d,rootElementSelector:g,previewContainer:_}=e;this.disabled=d??!1,this.dragStartDelay=n||0,this.lockAxis=i||null,r&&(this.constrainPosition=r),s&&(this.previewClass=s),a&&(this.boundaryElement=a),g&&(this.rootElementSelector=g),_&&(this.previewContainer=_)}_setupHandlesListener(){this._handles.pipe(jt(e=>{let i=e.map(n=>n.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),Vt(e=>ht(...e.map(i=>i._stateChanges.pipe(di(i))))),Mt(this._destroyed)).subscribe(e=>{let i=this._dragRef,n=e.element.nativeElement;e.disabled?i.disableHandle(n):i.enableHandle(n)})}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,n){i&2&&z("cdk-drag-disabled",n.disabled)("cdk-drag-dragging",n._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",le],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Jo]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[de([{provide:Zs,useExisting:o}]),Nt]})}return o})(),Xs=new oe("CdkDropListGroup");var Gn=(()=>{class o{element=c(me);_changeDetectorRef=c(Ge);_scrollDispatcher=c(lr);_dir=c(gi,{optional:!0});_group=c(Xs,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new x;_scrollableParentsResolved;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation;id=c(Ke).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled;sortingDisabled;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled;autoScrollStep;elementContainerSelector;hasAnchor;dropped=new re;entered=new re;exited=new re;sorted=new re;_unsortedItems=new Set;constructor(){let e=c(ia),i=c(na,{optional:!0});this._dropListRef=e.createDropList(this.element),this._dropListRef.data=this,i&&this._assignDefaults(i),this._dropListRef.enterPredicate=(n,r)=>this.enterPredicate(n.data,r.data),this._dropListRef.sortPredicate=(n,r,s)=>this.sortPredicate(n,r.data,s.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),o._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=o._dropLists.indexOf(this);e>-1&&o._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(di(this._dir.value),Mt(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=Ki(this.connectedTo).map(n=>{if(typeof n=="string"){let r=o._dropLists.find(s=>s.id===n);return r}return n});if(this._group&&this._group._items.forEach(n=>{i.indexOf(n)===-1&&i.push(n)}),!this._scrollableParentsResolved){let n=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(r=>r.getElementRef().nativeElement);this._dropListRef.withScrollableParents(n),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let n=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(n)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Gi(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(i.filter(n=>n&&n!==this).map(n=>n._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),ht(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:n,sortingDisabled:r,listAutoScrollDisabled:s,listOrientation:a}=e;this.disabled=n??!1,this.sortingDisabled=r??!1,this.autoScrollDisabled=s??!1,this.orientation=a||"vertical",this.lockAxis=i||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||o)};static \u0275dir=Me({type:o,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,n){i&2&&(Re("id",n.id),z("cdk-drop-list-disabled",n.disabled)("cdk-drop-list-dragging",n._dropListRef.isDragging())("cdk-drop-list-receiving",n._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",le],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",le],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",le],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",le]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[de([{provide:Xs,useValue:void 0},{provide:oa,useExisting:o}])]})}return o})();function sc(o,t){if(o&1){let e=G();h(0,"div",7),C("mousedown",function(){let n=T(e).$implicit,r=O(2);return I(r.onSectorSelected(n))}),m(1),h(2,"button",8),C("mousedown",function(n){return T(e),I(n.stopPropagation())}),h(3,"mat-icon",9),m(4,"more_vert"),p()(),h(5,"mat-menu",10,0)(7,"button",11),C("click",function(){let n=T(e).$implicit,r=O(2);return I(r.navigateToContourPanel(n))}),h(8,"mat-icon",12),m(9,"draw"),p(),m(10),v(11,"translate"),p(),h(12,"button",11),C("click",function(){let n=T(e).$implicit,r=O(2);return I(r.navigateToPropertyPanel(n))}),h(13,"mat-icon",12),m(14,"settings_input_composite"),p(),m(15),v(16,"translate"),p(),h(17,"button",11),C("click",function(){let n=T(e).$implicit,r=O(2);return I(r.openRemoveSectorDialog(n))}),h(18,"mat-icon",12),m(19,"delete"),p(),m(20),v(21,"translate"),p()()()}if(o&2){let e=t.$implicit,i=Pe(6),n=O(2);z("selected",e===n.selectedSector),l(),D(" ",e.name," "),l(),y("matMenuTriggerFor",i),l(8),D(" ",b(11,7,"tool.sectors.contourList.editContour")," "),l(5),D(" ",b(16,9,"tool.sectors.contourList.editProperties")," "),l(5),D(" ",b(21,11,"tool.sectors.contourList.removeSector")," ")}}function ac(o,t){if(o&1){let e=G();h(0,"div",5),C("cdkDropListDropped",function(n){T(e);let r=O();return I(r.dropSectorBox(n))}),fe(1,sc,22,13,"div",6,Ht),p()}if(o&2){let e=O();l(),_e(e.sectors())}}function lc(o,t){o&1&&(h(0,"div",4),m(1),v(2,"translate"),p()),o&2&&(l(),f(b(2,1,"tool.sectors.contourList.noSectors")))}var ra=(()=>{class o{constructor(){this.store=c(A),this.translate=c(X),this.dialog=c(vt),this.router=c($),this.destroyRef=c(K),this.sectors=this.store.selectSignal(ve),this.sectorsContoursService=c(ct)}openRemoveSectorDialog(e){let i={title:this.translate.instant("tool.sectors.contourList.removeSector"),message:this.translate.instant("tool.sectors.contourList.removeSectorMessage")};this.dialog.open(St,{data:i}).afterClosed().pipe(W(this.destroyRef)).subscribe(n=>{n&&(this.store.dispatch(ue.sectorRemoved({sector:e})),this.selectedSector===e&&this.resetSelectedSector(),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector}))})}emitSectorToEditContour(e){this.sectorsContoursService.emitEditedSectorContour({sector:ae(M({},e),{vertices:[...e.vertices]}),selectedVertex:e.vertices.at(-1)})}navigateToNewSectorPanel(){this.router.navigate(["/tool/sectors/contour"])}navigateToContourPanel(e){this.router.navigate([`/tool/sectors/${e.id}/contour`])}navigateToPropertyPanel(e){this.router.navigate([`/tool/sectors/${e.id}/property`])}emitSectorToEditProperty(e){this.sectorsContoursService.emitEditedSectorProperty({sector:e,mesh:null,contour:null})}onSectorSelected(e){this.selectedSector=e,this.sectorsContoursService.emitSectorListChanged({selectedSector:e})}dropSectorBox(e){this.store.dispatch(ue.sectorShifted({prevIndex:e.previousIndex,newIndex:e.currentIndex})),this.sectorsContoursService.emitSectorListChanged({selectedSector:this.selectedSector})}resetSelectedSector(){let e=this.sectors();this.selectedSector=e.length?e[0]:null}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sectors-contours-list"]],decls:6,vars:4,consts:[["menu","matMenu"],[1,"actions"],["mat-flat-button","","color","accent",3,"click"],["cdkDropList","",1,"sectors-list"],[1,"no-sectors"],["cdkDropList","",1,"sectors-list",3,"cdkDropListDropped"],["cdkDrag","",1,"sector-box",3,"selected"],["cdkDrag","",1,"sector-box",3,"mousedown"],["mat-icon-button","",1,"sector-actions",3,"mousedown","matMenuTriggerFor"],["matListIcon",""],["classList","paddingless"],["mat-menu-item","",3,"click"],["matListIcon","",1,"material-symbols-outlined"]],template:function(i,n){i&1&&(h(0,"div",1)(1,"button",2),C("click",function(){return n.navigateToNewSectorPanel()}),m(2),v(3,"translate"),p()(),te(4,ac,3,0,"div",3)(5,lc,3,3,"div",4)),i&2&&(l(2),D(" ",b(3,2,"tool.sectors.contourList.addSector")," "),l(2),ie(n.sectors().length?4:5))},dependencies:[L,ne,ke,De,Ee,Qt,Xt,Zt,Yt,Gn,qn,U,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .no-sectors[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.sectors-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.sectors-list[_ngcontent-%COMP%]   .sector-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]{cursor:move}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.sectors-list[_ngcontent-%COMP%]   .sector-box[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.sectors-list[_ngcontent-%COMP%]   .sector-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.sectors-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .sector-actions[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return o})();var cc=["*"],sa=(()=>{class o{constructor(){this.label=se.required(),this.shouldBeOpen=se(!0),this.isOpen=P(!0)}ngOnInit(){this.isOpen.set(this.shouldBeOpen())}toggle(){this.isOpen.update(e=>!e)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-extended-panel"]],inputs:{label:[1,"label"],shouldBeOpen:[1,"shouldBeOpen"]},ngContentSelectors:cc,decls:8,vars:4,consts:[[1,"label"],[1,"label-content"],["mat-icon-button","",1,"toggle-button",3,"click"],[1,"chevron"],[1,"panel",3,"isOpen"]],template:function(i,n){i&1&&(mt(),h(0,"div",0)(1,"span",1),m(2),p(),h(3,"button",2),C("click",function(){return n.toggle()}),h(4,"mat-icon",3),m(5," keyboard_arrow_up "),p()()(),h(6,"app-expandable-panel",4),st(7),p()),i&2&&(l(2),f(n.label()),l(2),z("chevron--closed",!n.isOpen()),l(2),y("isOpen",n.isOpen()))},dependencies:[De,Ee,L,ke,ii],styles:["[_nghost-%COMP%]   .label[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .label-content[_ngcontent-%COMP%]{margin-left:15px;font-weight:500}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{margin-left:auto}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron[_ngcontent-%COMP%]{transition:all .25s ease}[_nghost-%COMP%]   .label[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]   .chevron--closed[_ngcontent-%COMP%]{transform:rotate(180deg)}"],changeDetection:0})}}return o})();var aa=(()=>{class o{constructor(){this.http=c(tr)}getPolygonTriangulationMesh(e){let i={headers:new er({"Content-Type":"application/json","Access-Control-Allow-Origin":"*"})};return this.http.post(Ds(),e,i).pipe(jt(n=>Di.restore(n)))}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var la=(()=>{class o{constructor(){this.store=c(A),this.dataService=c(aa),this.snackBar=c(it),this.service=c(ct),this.translate=c(X),this.route=c(gt),this.router=c($),this.destroyRef=c(K),this.errorLabels={required:()=>this.translate.instant("common.fieldRequired"),valueToSmall:()=>this.translate.instant("tool.sectors.sectorProperty.valueToSmall"),sectionMinAngleOutOfRange:()=>this.translate.instant("tool.sectors.sectorProperty.sectionMinAngleOutOfRange"),valueCannotBeNegative:()=>this.translate.instant("tool.sectors.sectorProperty.valueCannotBeNegative")},this.formData=P({sectionMaxArea:0,sectionMinAngle:0,minTileRadius:0,maxTileRadius:0,tilesMargin:0,populationParams:{initialPopulationSize:0,countOfTriesToInsertTile:0,countOfTrianglePositionDraws:0,countOfColorMatchingAttempts:0,iterationsCount:0,populationSize:0},evaluationParams:{singleSectionPopulation:0,overlappingAreaOutsideSector:0,additionalPopulationOfNeighboringSectors:0,overlappingNotPopulatedSections:0,tileColorMismatch:0}}),this.form=bt(this.formData,e=>{H(e.sectionMaxArea),Ae(e.sectionMaxArea,.01,{error:{kind:"valueToSmall"}}),H(e.sectionMinAngle),Ae(e.sectionMinAngle,10,{error:{kind:"sectionMinAngleOutOfRange"}}),Tt(e.sectionMinAngle,90,{error:{kind:"sectionMinAngleOutOfRange"}}),Ae(e.minTileRadius,0,{error:{kind:"valueCannotBeNegative"}}),Ae(e.maxTileRadius,.01,{error:{kind:"valueToSmall"}}),Ae(e.tilesMargin,.01,{error:{kind:"valueToSmall"}}),H(e.tilesMargin),H(e.populationParams.initialPopulationSize),H(e.populationParams.countOfTriesToInsertTile),H(e.populationParams.countOfTrianglePositionDraws),H(e.populationParams.countOfColorMatchingAttempts),H(e.populationParams.iterationsCount),H(e.populationParams.populationSize),H(e.evaluationParams.singleSectionPopulation),H(e.evaluationParams.overlappingAreaOutsideSector),H(e.evaluationParams.additionalPopulationOfNeighboringSectors),H(e.evaluationParams.overlappingNotPopulatedSections),H(e.evaluationParams.tileColorMismatch)}),this.triangulationMeshEffect=ze(()=>{let e={polygonVertices:this.sector.vertices,sectionMaxArea:this.form.sectionMaxArea().value(),sectionMinAngle:this.form.sectionMinAngle().value()};this.dataService.getPolygonTriangulationMesh(e).pipe(W(this.destroyRef)).subscribe({next:i=>this.service.emitEditedSectorProperty({sector:this.sector,mesh:i.triangles,contour:i.contour}),error:()=>this.showPolygonTriangulationError()})})}ngOnInit(){this.prepareSector()}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){this.sector=this.store.selectSignal(ve)().find(n=>n.id===e);let i=this.sector.properties;this.formData.set(ae(M({},i),{populationParams:M({},i.populationParams),evaluationParams:M({},i.evaluationParams)}))}}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.service.emitEditedSectorProperty(null),this.navigateToSectorList()}getFieldErrorLabel(e){return Fe.getFieldErrorLabel(e,this.errorLabels)}save(){ln(this.form,async()=>{let e=this.formData();this.store.dispatch(ue.sectorModified({modifiedSector:ae(M({},this.sector),{properties:e})})),this.service.emitEditedSectorProperty(null),this.navigateToSectorList()})}showPolygonTriangulationError(){this.snackBar.open(this.translate.instant("tool.sectors.sectorProperty.errorOnSectorMeshRequesting"),this.translate.instant("common.ok"),{duration:2e3})}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-property-editor"]],features:[de([{provide:so,useFactory:e=>ae(M({},e),{subscriptSizing:"dynamic"}),deps:[[new $o,new Uo,so]]}])],decls:128,vars:124,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"sector-property-form"],[3,"label"],[1,"form-group"],["matTooltipPosition","left",1,"density-3",3,"matTooltip"],["matInput","","type","number",3,"field"],[3,"label","shouldBeOpen"]],template:function(i,n){i&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.cancel()}),m(2),v(3,"translate"),p(),h(4,"button",2),C("click",function(){return n.save()}),m(5),v(6,"translate"),p()(),h(7,"div",3)(8,"app-extended-panel",4)(9,"div",5)(10,"mat-form-field",6)(11,"mat-label"),m(12),v(13,"translate"),p(),w(14,"input",7),V(),h(15,"mat-error"),m(16),p()(),h(17,"mat-form-field",6)(18,"mat-label"),m(19),v(20,"translate"),p(),w(21,"input",7),V(),h(22,"mat-error"),m(23),p()()()(),h(24,"app-extended-panel",4)(25,"div",5)(26,"mat-form-field",6)(27,"mat-label"),m(28),v(29,"translate"),p(),w(30,"input",7),V(),h(31,"mat-error"),m(32),p()(),h(33,"mat-form-field",6)(34,"mat-label"),m(35),v(36,"translate"),p(),w(37,"input",7),V(),h(38,"mat-error"),m(39),p()(),h(40,"mat-form-field",6)(41,"mat-label"),m(42),v(43,"translate"),p(),w(44,"input",7),V(),h(45,"mat-error"),m(46),p()()()(),h(47,"app-extended-panel",8)(48,"div",5)(49,"mat-form-field",6)(50,"mat-label"),m(51),v(52,"translate"),p(),w(53,"input",7),V(),h(54,"mat-error"),m(55),p()(),h(56,"mat-form-field",6)(57,"mat-label"),m(58),v(59,"translate"),p(),w(60,"input",7),V(),h(61,"mat-error"),m(62),p()(),h(63,"mat-form-field",6)(64,"mat-label"),m(65),v(66,"translate"),p(),w(67,"input",7),V(),h(68,"mat-error"),m(69),p()(),h(70,"mat-form-field",6)(71,"mat-label"),m(72),v(73,"translate"),p(),w(74,"input",7),V(),h(75,"mat-error"),m(76),p()(),h(77,"mat-form-field",6)(78,"mat-label"),m(79),v(80,"translate"),p(),w(81,"input",7),V(),h(82,"mat-error"),m(83),p()(),h(84,"mat-form-field",6)(85,"mat-label"),m(86),v(87,"translate"),p(),w(88,"input",7),V(),h(89,"mat-error"),m(90),p()()()(),h(91,"app-extended-panel",8)(92,"div",5)(93,"mat-form-field",6)(94,"mat-label"),m(95),v(96,"translate"),p(),w(97,"input",7),V(),h(98,"mat-error"),m(99),p()(),h(100,"mat-form-field",6)(101,"mat-label"),m(102),v(103,"translate"),p(),w(104,"input",7),V(),h(105,"mat-error"),m(106),p()(),h(107,"mat-form-field",6)(108,"mat-label"),m(109),v(110,"translate"),p(),w(111,"input",7),V(),h(112,"mat-error"),m(113),p()(),h(114,"mat-form-field",6)(115,"mat-label"),m(116),v(117,"translate"),p(),w(118,"input",7),V(),h(119,"mat-error"),m(120),p()(),h(121,"mat-form-field",6)(122,"mat-label"),m(123),v(124,"translate"),p(),w(125,"input",7),V(),h(126,"mat-error"),m(127),p()()()()()),i&2&&(l(2),D(" ",b(3,88,"common.cancel")," "),l(3),D(" ",b(6,90,"common.confirm")," "),l(3),y("label",n.translate.instant("tool.sectors.sectorProperty.sectorsSize")),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.maxAreaHint")),l(2),f(b(13,92,"tool.sectors.sectorProperty.maxArea")),l(2),j(n.form.sectionMaxArea),l(2),f(n.getFieldErrorLabel(n.form.sectionMaxArea())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minAngleHint")),l(2),f(b(20,94,"tool.sectors.sectorProperty.minAngle")),l(2),j(n.form.sectionMinAngle),l(2),f(n.getFieldErrorLabel(n.form.sectionMinAngle())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.tilesLimitations")),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minRadiusHint")),l(2),f(b(29,96,"tool.sectors.sectorProperty.minRadius")),l(2),j(n.form.minTileRadius),l(2),f(n.getFieldErrorLabel(n.form.minTileRadius())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.maxRadiusHint")),l(2),f(b(36,98,"tool.sectors.sectorProperty.maxRadius")),l(2),j(n.form.maxTileRadius),l(2),f(n.getFieldErrorLabel(n.form.maxTileRadius())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.minMarginHint")),l(2),f(b(43,100,"tool.sectors.sectorProperty.minMargin")),l(2),j(n.form.tilesMargin),l(2),f(n.getFieldErrorLabel(n.form.tilesMargin())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.populationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.initialPopulationSizeHint")),l(2),f(b(52,102,"tool.sectors.sectorProperty.initialPopulationSize")),l(2),j(n.form.populationParams.initialPopulationSize),l(2),f(n.getFieldErrorLabel(n.form.populationParams.initialPopulationSize())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.populationSizeHint")),l(2),f(b(59,104,"tool.sectors.sectorProperty.populationSize")),l(2),j(n.form.populationParams.populationSize),l(2),f(n.getFieldErrorLabel(n.form.populationParams.populationSize())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.iterationsCountHint")),l(2),f(b(66,106,"tool.sectors.sectorProperty.iterationsCount")),l(2),j(n.form.populationParams.iterationsCount),l(2),f(n.getFieldErrorLabel(n.form.populationParams.iterationsCount())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfTrianglePositionDrawsHint")),l(2),f(b(73,108,"tool.sectors.sectorProperty.countOfTrianglePositionDraws")),l(2),j(n.form.populationParams.countOfTrianglePositionDraws),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfTrianglePositionDraws())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfTriesToInsertTileHint")),l(2),f(b(80,110,"tool.sectors.sectorProperty.countOfTriesToInsertTile")),l(2),j(n.form.populationParams.countOfTriesToInsertTile),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfTriesToInsertTile())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.countOfColorMatchingAttemptsHint")),l(2),f(b(87,112,"tool.sectors.sectorProperty.countOfColorMatchingAttempts")),l(2),j(n.form.populationParams.countOfColorMatchingAttempts),l(2),f(n.getFieldErrorLabel(n.form.populationParams.countOfColorMatchingAttempts())),l(),y("label",n.translate.instant("tool.sectors.sectorProperty.evaluationParams"))("shouldBeOpen",!1),l(2),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.singleSectionPopulationHint")),l(2),f(b(96,114,"tool.sectors.sectorProperty.singleSectionPopulation")),l(2),j(n.form.evaluationParams.singleSectionPopulation),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.singleSectionPopulation())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(b(103,116,"tool.sectors.sectorProperty.overlappingAreaOutsideSector")),l(2),j(n.form.evaluationParams.overlappingAreaOutsideSector),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.overlappingAreaOutsideSector())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingAreaOutsideSectorHint")),l(2),f(b(110,118,"tool.sectors.sectorProperty.additionalPopulationOfNeighboringSectors")),l(2),j(n.form.evaluationParams.additionalPopulationOfNeighboringSectors),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.additionalPopulationOfNeighboringSectors())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.overlappingNotPopulatedSectionsHint")),l(2),f(b(117,120,"tool.sectors.sectorProperty.overlappingNotPopulatedSections")),l(2),j(n.form.evaluationParams.overlappingNotPopulatedSections),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.overlappingNotPopulatedSections())),l(),y("matTooltip",n.translate.instant("tool.sectors.sectorProperty.tileColorMismatchHint")),l(2),f(b(124,122,"tool.sectors.sectorProperty.tileColorMismatch")),l(2),j(n.form.evaluationParams.tileColorMismatch),l(2),f(n.getFieldErrorLabel(n.form.evaluationParams.tileColorMismatch())))},dependencies:[L,ne,Le,Qe,Ye,yt,tt,et,fr,gr,sa,U,Ct,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;width:100%}[_nghost-%COMP%]   .sector-property-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:18px;margin-top:12px}"],changeDetection:0})}}return o})();function ca(o){return({value:t})=>o().includes(t())?at({kind:"nonUnique"}):null}var Kn=class{static isPointInsidePolygon(t,e){if(t.length<3)return!1;let i=new R(Number.MAX_VALUE,e.y),n=new dt(e,i),r=0,s=0;do{let a=new dt(t[s],t[(s+1)%t.length]);if(this.areLineIntersecting(a,n)){if(this.getDirection(a.start,e,a.end)==0)return this.isPointOnLine(a,e);r++}s=(s+1)%t.length}while(s!=0);return(r&1)==1}static areLineIntersecting(t,e){let i=this.getDirection(t.start,t.end,e.start),n=this.getDirection(t.start,t.end,e.end),r=this.getDirection(e.start,e.end,t.start),s=this.getDirection(e.start,e.end,t.end);return!!(i!=n&&r!=s||i==0&&this.isPointOnLine(t,e.start)||n==0&&this.isPointOnLine(t,e.end)||r==0&&this.isPointOnLine(e,t.start)||s==0&&this.isPointOnLine(e,t.end))}static isPointOnLine(t,e){return e.x<=Math.max(t.start.x,t.end.x)&&e.x>=Math.min(t.start.x,t.end.x)&&e.y<=Math.max(t.start.y,t.end.y)&&e.y>=Math.min(t.start.y,t.end.y)}static getDirection(t,e,i){let n=(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y);return n==0?0:n<0?2:1}};function da({value:o}){return o().length<3?at({kind:"tooFewVertices"}):dc(o())?at({kind:"edgesIntersect"}):null}function dc(o){let t=[];for(let e=0;e<o.length;++e)t.push(new dt(o[e],o.at(e-1)));for(let e=0;e<o.length;++e)for(let i=0;i<o.length;++i)if(!(e===i||(e+1)%o.length===i||(i+1)%o.length===e)&&Kn.areLineIntersecting(t[e],t[i]))return!0;return!1}function hc(o,t){if(o&1){let e=G();h(0,"div",11),C("mousedown",function(){let n=T(e).$implicit,r=O(2);return I(r.onBoxSelected(n))}),m(1),h(2,"button",12),C("click",function(){let n=T(e).$implicit,r=O(2);return I(r.removeVertex(n))})("mousedown",function(n){return T(e),I(n.stopPropagation())}),h(3,"mat-icon",13),m(4,"close"),p()()()}if(o&2){let e=t.$implicit,i=O(2);z("selected",e===i.selectedVertex()),l(),D(" ",i.getVertexLabel(e)," ")}}function pc(o,t){if(o&1){let e=G();h(0,"div",9),C("cdkDropListDropped",function(n){T(e);let r=O();return I(r.dropVertexBox(n))}),fe(1,hc,5,3,"div",10,Ht),p()}if(o&2){let e=O();l(),_e(e.form.vertices().value())}}function mc(o,t){o&1&&(h(0,"div",8),m(1),v(2,"translate"),p()),o&2&&(l(),f(b(2,1,"tool.sectors.sectorContour.addSectorVertices")))}var To=(()=>{class o{constructor(){this.selectedVertex=P(null),this.store=c(A),this.snackbarService=c(it),this.sectorsContoursService=c(ct),this.translate=c(X),this.route=c(gt),this.router=c($),this.destroyRef=c(K),this.existingSectors=this.store.selectSignal(ve),this.errorLabels={edgesIntersect:()=>this.translate.instant("tool.sectors.sectorContour.linesCannotIntersecting"),tooFewVertices:()=>this.translate.instant("tool.sectors.sectorContour.tooFewVertices"),nonUnique:()=>this.translate.instant("tool.sectors.sectorContour.nameAlreadyInUse"),required:()=>this.translate.instant("tool.sectors.sectorContour.nameRequired")},this.formData=P({id:null,name:null,color:null,vertices:[],properties:null}),this.usedSectorNames=Z(()=>this.existingSectors().filter(e=>e.id!==this.formData().id).map(e=>e.name)),this.form=bt(this.formData,e=>{H(e.name),kt(e.name,ca(this.usedSectorNames)),H(e.color),kt(e.vertices,da)}),this.onContourChangeEffect=ze(()=>{this.sectorsContoursService.emitEditedSectorContour({sector:this.formData(),selectedVertex:this.selectedVertex()})})}ngOnInit(){this.prepareSector(),this.subscribeOnCanvasClicked()}subscribeOnCanvasClicked(){this.sectorsContoursService.canvasClicked$.pipe(W(this.destroyRef)).subscribe(e=>this.addVertex(new R(e.x,e.y)))}prepareSector(){let e=this.route.snapshot.paramMap.get("id");if(e){let i=this.existingSectors().find(n=>n.id===e);this.formData.set(ae(M({},i),{vertices:i.vertices.map(n=>new R(n.x,n.y))})),this.selectedVertex.set(this.formData().vertices[0])}else{let i=ct.createNewSector();this.formData.set(i)}}addVertex(e){let i=[...this.form.vertices().value()],n=i.indexOf(this.selectedVertex());i.splice(n+1,0,e),this.form.vertices().setControlValue(i),this.selectedVertex.set(e)}removeVertex(e){let i=this.form.vertices().value().filter(n=>n!==e);this.form.vertices().setControlValue(i),e===this.selectedVertex()&&this.resetSelectedVertex()}navigateToSectorList(){this.router.navigate(["/tool/sectors"])}cancel(){this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()}save(){this.form().valid()?(this.store.dispatch(ue.sectorModified({modifiedSector:this.formData()})),this.sectorsContoursService.emitEditedSectorContour(null),this.navigateToSectorList()):this.showWarning(this.showValidationError())}showValidationError(){let e=this.form().errorSummary();return Fe.getErrorLabel(e,this.errorLabels)}getFieldErrorLabel(e){return Fe.getErrorLabel(e.errorSummary(),this.errorLabels)}showWarning(e){this.snackbarService.open(e,this.translate.instant("common.ok"),{duration:3e3})}onBoxSelected(e){this.selectedVertex.set(e)}dropVertexBox(e){let i=this.form.vertices().value();Wn(i,e.previousIndex,e.currentIndex),this.form.vertices().setControlValue(i)}getVertexLabel(e){return`(${e.x.toFixed(2)}, ${e.y.toFixed(2)})`}resetSelectedVertex(){let e=this.form.vertices().value();this.selectedVertex.set(e.at(-1)??null)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=S({type:o,selectors:[["app-sector-contour-edition"]],decls:18,vars:16,consts:[[1,"actions"],["mat-flat-button","",3,"click"],["mat-flat-button","","color","accent",3,"click"],[1,"info"],["subscriptSizing","dynamic",1,"density-3"],["matInput","",3,"field"],[3,"label","field"],["cdkDropList","",1,"vertices-list"],[1,"no-vertices"],["cdkDropList","",1,"vertices-list",3,"cdkDropListDropped"],["cdkDrag","",1,"vertex-box",3,"selected"],["cdkDrag","",1,"vertex-box",3,"mousedown"],["mat-icon-button","",1,"vertex-remove",3,"click","mousedown"],["matListIcon",""]],template:function(i,n){i&1&&(h(0,"div",0)(1,"button",1),C("click",function(){return n.cancel()}),m(2),v(3,"translate"),p(),h(4,"button",2),C("click",function(){return n.save()}),m(5),v(6,"translate"),p()(),h(7,"div",3)(8,"mat-form-field",4)(9,"mat-label"),m(10),v(11,"translate"),p(),w(12,"input",5),V(),h(13,"mat-error"),m(14),p()(),w(15,"app-color-picker",6),V(),te(16,pc,3,0,"div",7)(17,mc,3,3,"div",8),p()),i&2&&(l(2),f(b(3,10,"common.cancel")),l(3),f(b(6,12,"common.confirm")),l(5),f(b(11,14,"tool.sectors.sectorContour.sectorName")),l(2),j(n.form.name),l(2),f(n.getFieldErrorLabel(n.form.name())),l(),y("label",n.translate.instant("tool.sectors.sectorContour.sectorColor")),j(n.form.color),l(),ie(n.form.vertices().value().length?16:17))},dependencies:[L,ne,ke,Gn,qn,Le,Qe,Ye,yt,tt,et,De,Ee,_n,U,Ct,Y],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;gap:20px;height:100%}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}[_nghost-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1 1 0}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}[_nghost-%COMP%]   .info[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .no-vertices[_ngcontent-%COMP%]{color:var(--irr-contrast-light);margin:auto}.vertices-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.vertices-list[_ngcontent-%COMP%]   .vertex-box.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]{cursor:move}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-icon{width:24px;height:24px;font-size:24px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]    {--mat-icon-button-state-layer-size: 32px;padding:4px}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]     .mat-mdc-button-touch-target{width:var(--mat-icon-button-state-layer-size);height:var(--mat-icon-button-state-layer-size)}.vertices-list[_ngcontent-%COMP%]   .vertex-box[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{margin:-6px;color:var(--irr-contrast-medium)}.vertices-list[_ngcontent-%COMP%]   .vertex-box.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.vertices-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .cdk-drag[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-preview[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 16px;box-sizing:border-box;border-radius:4px;background:var(--irr-contrast-lightest);color:var(--irr-contrast-high);font-size:14px;box-shadow:0 0 5px 1px #0000001a}.cdk-drag-preview.selected[_ngcontent-%COMP%]{background:var(--irr-contrast-light)}.cdk-drag-preview[_ngcontent-%COMP%]{cursor:grab}.cdk-drag-preview[_ngcontent-%COMP%]   .vertex-remove[_ngcontent-%COMP%]{display:none}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}}return o})();var yb=[{path:"",redirectTo:"config",pathMatch:"full"},{path:"config",component:Hr,children:[{path:"",component:zr},{path:"project",component:Xr}]},{path:"tray",component:Qr,canActivate:[gn],children:[{path:"",component:cs},{path:"random",component:fo},{path:"random/:id",component:fo},{path:"tile/:id",component:ms}]},{path:"sectors",component:ys,canActivate:[gn],children:[{path:"",component:ra},{path:":id/property",component:la},{path:":id/contour",component:To},{path:"contour",component:To}]},{path:"generating",component:Rs,canActivate:[gn,As]}];export{yb as toolRoutes};
